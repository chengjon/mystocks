# Feature Specification: UI系统改进 - 字体系统、问财查询、自选股重构

**Feature Branch**: `005-ui`
**Created**: 2025-10-26
**Status**: Draft
**Input**: User description: "UI改进：字体系统、问财查询恢复、自选股重构"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 全局字体系统生效 (Priority: P1)

用户在系统设置中调整字体大小后，整个应用的字体立即响应变化，包括页面标题、正文、辅助文字等不同层级的文字都按照规范的Typography层级调整大小。

**Why this priority**: 这是基础的可访问性功能,影响所有用户的阅读体验。当前字体设置不生效严重影响用户体验，且字体系统是其他UI改进的基础。

**Independent Test**: 可通过访问系统设置页面，选择不同字体大小选项，然后导航到任意页面验证字体是否按比例调整来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在系统设置页面, **When** 选择"特小(12px)"字体选项, **Then** 全局基础字号变为12px，辅助文字10px，正文12px，小标题14px，标题16px，主标题20px
2. **Given** 用户在系统设置页面, **When** 选择"小(14px)"字体选项, **Then** 全局基础字号变为14px，其他层级按规范调整
3. **Given** 用户在系统设置页面, **When** 选择"中(16px)"字体选项, **Then** 全局基础字号变为16px（默认），其他层级按规范调整
4. **Given** 用户已设置字体大小, **When** 刷新页面或重新登录, **Then** 字体设置保持不变
5. **Given** 用户在任意页面, **When** 更改字体设置, **Then** 当前页面立即响应，无需刷新

---

### User Story 2 - 问财筛选默认查询恢复 (Priority: P2)

用户访问"市场数据 - 问财筛选"页面时，在"查询列表 - 默认查询"中看到完整的9个预设查询选项(qs_1到qs_9)，可以点击任意查询快速获取相应的筛选结果并联动到查询结果面板。

**Why this priority**: 恢复业务功能，问财筛选是核心功能之一。9个预设查询为用户提供快速入口，缺失影响功能完整性和用户效率。

**Independent Test**: 可通过访问问财筛选页面，验证默认查询列表显示9个选项，选择任意选项执行查询并查看结果来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户访问问财筛选页面, **When** 查看默认查询列表, **Then** 显示完整的qs_1至qs_9共9个预设查询
2. **Given** 用户在默认查询列表中, **When** 点击任意查询(如qs_3), **Then** 系统执行该查询并在查询结果面板显示结果
3. **Given** 用户执行了某个默认查询, **When** 查询完成, **Then** 查询结果面板实时更新并高亮显示当前查询来源
4. **Given** 默认查询执行失败, **When** API返回错误, **Then** 显示友好的错误消息并保持界面可用

---

### User Story 3 - 自选股页面重构为选项卡式布局 (Priority: P3)

用户访问自选股页面时，看到清晰的选项卡式布局，包括"用户自选"、"系统自选"、"策略自选"、"监控列表"四个标签页，每个标签页显示固定表头的表格，并通过highlight区分不同的分组(分组1、分组2、分组3、分组4等)。

**Why this priority**: 提升自选股管理的组织性和可用性。选项卡式布局更直观，分组高亮提升信息可读性。这是功能增强而非关键缺陷修复。

**Independent Test**: 可通过访问自选股页面，切换不同标签页，验证表格固定表头和分组高亮效果来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户访问自选股页面, **When** 页面加载, **Then** 显示选项卡式布局，包含"用户自选"、"系统自选"、"策略自选"、"监控列表"四个标签
2. **Given** 用户在自选股页面, **When** 点击任意标签页, **Then** 切换到对应的自选股列表，表格使用固定表头
3. **Given** 用户查看自选股表格, **When** 表格包含多个分组, **Then** 不同分组(分组1、分组2、分组3等)通过highlight效果区分
4. **Given** 用户在自选股表格中, **When** 滚动表格, **Then** 表头固定在顶部，数据行滚动
5. **Given** 用户在某个标签页, **When** 刷新页面, **Then** 保持当前标签页选中状态

---

### Edge Cases

- 字体大小设置为极端值(12px或20px)时，是否所有UI元素都能正确显示？
- 问财查询API超时或返回空结果时如何处理？
- 自选股列表为空时各标签页如何显示？
- 用户快速切换字体大小时，CSS变量更新是否会出现闪烁？
- 自选股表格数据量过大(>1000条)时，固定表头是否影响性能？
- 浏览器LocalStorage不可用时，字体设置如何降级？

## Requirements *(mandatory)*

### Functional Requirements

#### 字体系统 (FR-001 to FR-008)

- **FR-001**: 系统必须在全局CSS中定义Typography字体变量，包括--font-size-base(基础字号)、--font-size-helper(辅助文字)、--font-size-body(正文)、--font-size-subtitle(小标题)、--font-size-title(标题)、--font-size-heading(主标题)
- **FR-002**: 系统必须支持5个字体大小等级：特小(12px)、小(14px)、中(16px，默认)、大(18px)、特大(20px)
- **FR-003**: 字体层级必须遵循规范：辅助文字=基础字号-2px，正文=基础字号，小标题=基础字号+2px，标题=基础字号+4px，主标题=基础字号+8px
- **FR-004**: 系统必须使用Typography字体族：`"Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif`
- **FR-005**: 系统必须使用1.5的行高(line-height: 1.5)作为全局默认值
- **FR-006**: 用户更改字体大小时，系统必须立即更新CSS变量--font-size-base，无需刷新页面
- **FR-007**: 系统必须将用户的字体大小选择保存到LocalStorage，键名为preferences.fontSize
- **FR-008**: 页面加载时，系统必须从LocalStorage读取并应用已保存的字体设置，如无保存则使用默认值16px

#### 问财筛选 (FR-009 to FR-012)

- **FR-009**: 问财筛选页面必须在"默认查询"列表显示qs_1到qs_9共9个预设查询选项
- **FR-010**: 每个预设查询(qs_1到qs_9)必须包含查询名称、查询描述和对应的查询语句
- **FR-011**: 用户点击默认查询时，系统必须调用问财API执行查询并将结果显示在查询结果面板
- **FR-012**: 查询结果面板必须与默认查询列表联动，高亮显示当前查询来源

#### 自选股重构 (FR-013 to FR-020)

- **FR-013**: 系统必须将导航菜单中的"股票管理"改名为"自选股"
- **FR-014**: 自选股页面必须使用选项卡式布局(Tabs组件)，包含4个标签："用户自选"、"系统自选"、"策略自选"、"监控列表"
- **FR-015**: 每个标签页内容必须使用固定表头的表格(el-table的height属性)展示自选股数据
- **FR-016**: 表格必须通过highlight显示(如背景色或边框)区分不同的分组(分组1、分组2、分组3、分组4等)
- **FR-017**: 表格数据为空时，必须显示友好的空状态提示(el-empty)
- **FR-018**: 系统必须支持在标签页之间切换时保持各自的滚动位置
- **FR-019**: 刷新页面时，系统必须记住用户最后访问的标签页
- **FR-020**: 表格必须支持按股票代码、名称、涨跌幅等字段排序

### Key Entities

- **字体设置(Font Preference)**: 用户的字体大小偏好，包含字号值(12px-20px)和选择时间戳
- **问财查询(Wencai Query)**: 预设查询配置，包含查询ID(qs_1到qs_9)、查询名称、查询描述、查询语句
- **自选股(Watchlist Stock)**: 自选股票项，包含股票代码、名称、所属分组、所属类别(用户/系统/策略/监控)
- **自选股分组(Watchlist Group)**: 自选股的逻辑分组，包含分组ID、分组名称、分组顺序

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户在系统设置中更改字体大小后，所有页面的字体在500ms内立即响应变化
- **SC-002**: 用户设置的字体大小在浏览器刷新、重新登录后保持一致，保留率100%
- **SC-003**: 问财筛选页面加载时，默认查询列表在2秒内显示全部9个选项
- **SC-004**: 用户点击默认查询后，查询结果在5秒内显示(依赖API响应时间)
- **SC-005**: 自选股页面在包含1000条数据时，标签页切换和表格滚动响应时间<200ms
- **SC-006**: 95%的用户能够在首次访问自选股页面时立即理解选项卡布局和分组含义
- **SC-007**: 字体系统支持所有现有页面(Dashboard、市场数据、自选股、系统设置等)，覆盖率100%

## Assumptions *(optional)*

- 假设用户浏览器支持CSS自定义属性(CSS Variables)，不考虑IE11及更早版本
- 假设问财API的9个预设查询(qs_1到qs_9)的查询语句已在后端配置或前端常量中定义
- 假设自选股数据已有分组信息(group_id或group_name字段)，无需在本feature中实现分组管理功能
- 假设用户浏览器启用LocalStorage，字体设置降级策略为使用默认值(16px)
- 假设Element Plus的el-table、el-tabs组件已在项目中正确安装和配置

## Dependencies *(optional)*

- 依赖Element Plus UI框架(版本^2.8.0)
- 依赖Pinia状态管理库用于preferences store
- 依赖问财API后端接口(/api/market/wencai/*)
- 依赖自选股API后端接口(/api/watchlist/*)

## Out of Scope *(optional)*

- 自定义字体大小(用户输入任意数值)不在本feature范围内
- 问财查询的创建、编辑、删除功能不在本feature范围内
- 自选股的添加、删除、分组管理功能不在本feature范围内
- 深色模式/主题切换不在本feature范围内
- 字体族的自定义选择不在本feature范围内
