# Feature Specification: Market Data UI/UX Improvements

**Feature Branch**: `004-ui-short-name`
**Created**: 2025-10-26
**Status**: Draft
**Input**: User description: "改进市场数据页面UI：添加分页、固定表头、行业趋势图联动、字体设置功能、问财筛选恢复、自选股重构"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 资金流向趋势分析与交互 (Priority: P1)

用户需要查看行业资金流向数据,并快速分析特定行业的历史趋势。用户希望能够浏览大量数据时保持表头可见,并通过点击行业名称立即查看该行业的资金流向趋势图表,无需额外的导航或筛选操作。

**Why this priority**: 这是市场数据分析的核心功能,直接影响用户的投资决策效率。资金流向是判断市场热点的关键指标,快速的交互体验能显著提升用户分析效率。

**Independent Test**: 可通过访问资金流向页面,滚动数据表格验证固定表头功能,点击任意行业名称验证趋势图联动显示,切换不同行业验证图表数据更新。该功能独立完整,无需其他功能配合即可交付价值。

**Acceptance Scenarios**:

1. **Given** 用户在资金流向页面且数据超过一屏, **When** 用户向下滚动表格, **Then** 表头保持固定在视口顶部不随内容滚动
2. **Given** 用户查看资金流向数据表格, **When** 用户点击表格中任一"行业名称", **Then** 页面下方的"资金流向趋势图"立即更新显示该行业的历史趋势数据
3. **Given** 用户已选择某行业查看趋势图, **When** 用户点击另一行业名称, **Then** 趋势图平滑切换到新行业数据,并高亮显示当前选中行业
4. **Given** 资金流向数据超过50条, **When** 用户调整每页显示数量为20条, **Then** 表格分页显示,仅当总页数大于1时显示分页控件
5. **Given** 用户在分页表格中, **When** 用户切换到第2页, **Then** 表格显示第21-40条数据,表头保持固定,点击行业名称趋势图联动功能正常

---

### User Story 2 - 大数据量表格浏览体验优化 (Priority: P2)

用户在查看ETF行情数据和龙虎榜数据时,经常需要浏览数十甚至上百条记录。用户希望在滚动浏览时表头始终可见,便于快速对照列名理解数据,同时希望通过分页控制一次查看的数据量,避免页面加载缓慢。

**Why this priority**: 改善大数据量浏览体验,提升用户查找信息的效率。虽不如资金流向联动分析关键,但对频繁使用ETF和龙虎榜功能的用户价值显著。

**Independent Test**: 可通过分别访问ETF数据页面和龙虎榜页面,加载超过一屏的数据,滚动验证固定表头,调整每页显示数量验证分页功能。该功能独立于其他改进,可单独测试交付。

**Acceptance Scenarios**:

1. **Given** 用户在ETF数据页面且数据超过一屏, **When** 用户向下滚动, **Then** 表格列标题保持固定在视口顶部
2. **Given** 用户在龙虎榜页面, **When** 用户调整右上角"每页显示"设置为30条, **Then** 表格按30条/页分页显示,数据总数小于等于30时分页控件自动隐藏
3. **Given** ETF数据共80条,每页显示25条, **When** 用户查看第2页, **Then** 显示第26-50条数据,分页显示"2/4页"
4. **Given** 用户在龙虎榜第3页, **When** 用户点击上一页, **Then** 表格显示第2页数据,表头保持固定位置

---

### User Story 3 - 自选股组织与管理 (Priority: P2)

用户需要管理多个自选股分组(个人自选、系统推荐、策略匹配、监控列表),希望能够快速切换查看不同分组,并在表格中清晰区分不同分组的股票。用户期望通过选项卡式界面在不同分组间快速切换,无需返回上级菜单。

**Why this priority**: 自选股是用户个性化管理的核心功能,改进的组织方式能显著提升用户查找和管理效率。优先级略低于数据浏览功能,但对长期用户粘性重要。

**Independent Test**: 可通过访问自选股页面,验证4个选项卡(用户自选、系统自选、策略自选、监控列表)切换功能,在每个选项卡内验证分组高亮显示和固定表头。该功能模块独立,可单独测试用户体验。

**Acceptance Scenarios**:

1. **Given** 用户访问自选股页面, **When** 页面加载完成, **Then** 默认显示"用户自选"选项卡,其他3个选项卡(系统自选、策略自选、监控列表)可见但未激活
2. **Given** 用户在"用户自选"选项卡, **When** 用户点击"策略自选"选项卡, **Then** 页面切换到策略自选内容,该选项卡高亮显示,之前选项卡内容隐藏
3. **Given** 用户在任意选项卡查看股票表格, **When** 表格中有分组1、分组2、分组3等不同分组股票, **Then** 不同分组的行背景色或边框样式有明显区分
4. **Given** 用户切换了选项卡, **When** 用户刷新页面, **Then** 页面记住用户最后选择的选项卡并默认显示该选项卡内容

---

### User Story 4 - 全局字体大小调整 (Priority: P3)

用户根据个人视力和使用习惯,希望能够调整系统整体字体大小。用户在系统设置中调整字体大小后,期望所有页面(包括表格、卡片标题、按钮文字等)立即应用新字体大小,无需刷新页面。

**Why this priority**: 提升可访问性和用户舒适度,但不影响核心业务功能。对有特殊视力需求的用户重要,但整体用户群使用频率较低。

**Independent Test**: 可通过访问系统设置-显示设置,调整字体大小滑块,立即在当前页面和其他页面验证字体变化。该功能独立于其他UI改进,可单独测试和交付。

**Acceptance Scenarios**:

1. **Given** 用户在系统设置-显示设置页面, **When** 用户将字体大小从"Small(14px)"调整为"Medium(16px)", **Then** 当前页面所有文字(正文、标题、按钮、表格)立即应用新字体大小,无需保存或刷新
2. **Given** 用户已设置字体大小为"Large(18px)", **When** 用户导航到任意其他页面(如资金流向、龙虎榜), **Then** 新页面所有文字应用18px字体大小
3. **Given** 系统提供5个字体等级(Extra Small 12px, Small 14px, Medium 16px, Large 18px, Extra Large 20px), **When** 用户选择"Extra Small", **Then** 页面辅助文字12px,正文14px(自动基于基础字体调整),小标题相应缩小
4. **Given** 用户设置字体大小后关闭浏览器, **When** 用户下次登录系统, **Then** 系统记住用户偏好,自动应用上次设置的字体大小

---

### User Story 5 - 问财筛选快速查询 (Priority: P3)

用户使用问财筛选功能进行股票筛选时,希望能够快速访问常用的筛选条件,而不是每次都手动输入。用户期望看到9个预设的默认查询选项(qs_1至qs_9),点击即可执行筛选,查询结果联动显示在右侧面板。

**Why this priority**: 提升重复查询的效率,但仅影响使用问财筛选功能的用户群。优先级最低,因为用户可通过手动输入完成相同任务。

**Independent Test**: 可通过访问市场数据-问财筛选页面,验证默认查询列表显示9个预设选项,点击任一选项验证查询执行和结果联动显示。该功能模块独立,可最后测试交付。

**Acceptance Scenarios**:

1. **Given** 用户访问市场数据-问财筛选页面, **When** 页面加载完成, **Then** "查询列表-默认查询"区域显示qs_1到qs_9共9个预设查询选项
2. **Given** 用户查看默认查询列表, **When** 用户点击"qs_3"查询选项, **Then** 系统执行该预设查询,右侧"查询结果"面板更新显示符合条件的股票列表
3. **Given** 用户已执行qs_5查询且查询结果显示, **When** 用户点击另一个查询选项qs_7, **Then** 查询结果面板清空之前结果,显示qs_7的查询结果

---

### Edge Cases

- 当资金流向数据为空或少于10条时,分页控件如何显示?
- 用户设置极大字体(如30px)时,表格列是否会错位或溢出?
- 在移动设备小屏幕上,固定表头是否会遮挡过多内容?
- 用户快速连续点击多个行业名称时,趋势图联动是否会出现闪烁或数据错乱?
- 自选股4个选项卡中某个选项卡数据为空时,用户体验如何?
- 问财筛选的9个默认查询中某个查询返回0结果时,如何提示用户?
- 用户在第5页时调整每页显示数量,当前页码是否需要重置?

## Requirements *(mandatory)*

### Functional Requirements

#### 资金流向页面改进

- **FR-001**: 系统必须在资金流向数据表格滚动时保持表头固定在视口顶部
- **FR-002**: 系统必须在资金流向数据表格右上角提供"每页显示"设置,允许用户选择10-100条范围内的值
- **FR-003**: 系统必须在数据总数大于当前"每页显示"设置时显示分页控件,总数小于等于设置时自动隐藏分页控件
- **FR-004**: 系统必须为表格应用斑马纹样式(交替行背景色)以提升可读性
- **FR-005**: 系统必须将"行业名称"列的每一行渲染为可点击的超链接样式
- **FR-006**: 系统必须在资金流向数据卡片下方显示"资金流向趋势图"组件
- **FR-007**: 当用户点击表格中任一行业名称时,系统必须立即更新趋势图显示该行业的历史资金流向数据
- **FR-008**: 系统必须在趋势图中高亮显示当前选中的行业,并在图例中标注

#### ETF和龙虎榜页面改进

- **FR-009**: 系统必须在ETF数据表格和龙虎榜数据表格滚动时保持表头固定在视口顶部
- **FR-010**: 系统必须在ETF和龙虎榜数据卡片右上角提供"每页显示"设置,取值范围10-100条
- **FR-011**: 系统必须根据数据总数和"每页显示"设置自动显示或隐藏分页控件
- **FR-012**: 系统必须为ETF和龙虎榜表格应用斑马纹样式

#### 系统字体设置功能

- **FR-013**: 系统必须在"系统设置-显示设置"页面提供字体大小调整控件
- **FR-014**: 系统必须提供5个字体等级选项: Extra Small(12px)、Small(14px)、Medium(16px)、Large(18px)、Extra Large(20px)
- **FR-015**: 当用户调整字体大小时,系统必须立即应用新字体到当前页面所有文字元素(无需保存或刷新)
- **FR-016**: 系统必须基于用户选择的基础字体大小,自动调整不同层级文字: 辅助文字(基础-2px)、正文(基础)、小标题(基础+2px)、标题(基础+4px)、主标题(基础+6px)
- **FR-017**: 系统必须设置统一行高为1.5倍字体大小
- **FR-018**: 系统必须应用字体族: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif
- **FR-019**: 系统必须持久化用户字体大小偏好设置,在用户下次登录时自动应用
- **FR-020**: 系统必须确保字体调整后响应式布局不破坏,表格列宽自适应

#### 问财筛选默认查询恢复

- **FR-021**: 系统必须在"市场数据-问财筛选"页面的"查询列表-默认查询"区域显示9个预设查询选项(qs_1至qs_9)
- **FR-022**: 当用户点击任一默认查询选项时,系统必须执行对应的预设查询条件
- **FR-023**: 系统必须在右侧"查询结果"面板联动显示查询结果
- **FR-024**: 当用户点击新的默认查询选项时,系统必须清空之前的查询结果并显示新结果

#### 自选股页面重构

- **FR-025**: 系统必须将"股票管理"页面重命名为"自选股"
- **FR-026**: 系统必须使用选项卡样式布局,提供4个选项卡: "用户自选"、"系统自选"、"策略自选"、"监控列表"
- **FR-027**: 系统必须默认激活"用户自选"选项卡
- **FR-028**: 每个选项卡内的股票数据必须使用固定表头的表格展示
- **FR-029**: 系统必须在表格中使用高亮样式区分不同分组(分组1、分组2、分组3、分组4等),可通过行背景色或边框样式实现
- **FR-030**: 系统必须记住用户最后选择的选项卡,在页面刷新后默认显示该选项卡

### Key Entities

- **资金流向数据**: 包含行业名称、交易日期、净流入、主力流入、散户流入等属性,用于显示和趋势分析
- **行业趋势数据**: 包含行业名称、日期序列、资金流向值序列,用于趋势图表绘制
- **ETF行情数据**: 包含ETF代码、名称、价格、涨跌幅、成交量等属性
- **龙虎榜数据**: 包含股票代码、名称、上榜原因、买入卖出金额等属性
- **默认查询配置**: 包含9个预设查询(qs_1至qs_9),每个包含查询名称、查询条件、描述
- **自选股分组**: 包含分组名称(用户自选/系统自选/策略自选/监控列表)、股票列表、分组标识
- **用户显示偏好**: 包含字体大小设置、每页显示数量设置、最后访问选项卡等用户个性化配置

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户在资金流向页面点击行业名称后,趋势图在500毫秒内更新显示,用户无需等待或手动刷新
- **SC-002**: 用户在滚动超过3屏高度的表格时,表头始终停留在视口顶部,用户无需上下滚动即可对照列名
- **SC-003**: 用户调整字体大小后,当前页面在200毫秒内应用新字体,用户立即看到变化无需任何额外操作
- **SC-004**: 用户切换到ETF或龙虎榜页面后,在2秒内看到斑马纹表格和固定表头效果
- **SC-005**: 用户在自选股页面切换4个选项卡时,每次切换在300毫秒内完成,表格数据和分组高亮立即显示
- **SC-006**: 用户点击问财筛选默认查询选项后,在1秒内看到查询结果更新
- **SC-007**: 90%的用户能够在首次使用资金流向页面时,无需帮助文档即可成功点击行业名称查看趋势图
- **SC-008**: 字体大小调整功能上线后,用户关于"字体太小看不清"的反馈减少60%
- **SC-009**: 表格分页功能实现后,用户浏览超过100条数据的页面加载速度提升40%(从首次渲染到可交互时间)
- **SC-010**: 自选股选项卡重构后,用户在不同分组间切换的操作步骤从平均3步减少到1步

## Constraints & Assumptions

### Assumptions

- 用户主要使用现代浏览器(Chrome、Firefox、Edge最新版本),支持CSS position: sticky属性用于固定表头
- 资金流向历史趋势数据已存在于后端数据库,前端仅需调用现有API获取
- 问财筛选的9个默认查询(qs_1至qs_9)的具体查询条件已由产品团队定义,开发仅需恢复配置
- 用户显示偏好(字体大小、每页显示数量等)可存储在浏览器LocalStorage或后端用户配置表
- 自选股的4个分组(用户自选、系统自选、策略自选、监控列表)数据结构和API已存在

### Constraints

- 固定表头功能必须兼容响应式布局,在移动设备(宽度<768px)上可能需要调整实现方式
- 字体大小调整范围限制在12px-20px,避免极端字体导致布局破坏
- 每页显示数量范围限制在10-100条,防止单页数据过多影响性能
- 资金流向趋势图联动功能仅在同一页面内生效,不跨页面保持选中状态
- 所有表格分页必须支持前端分页和后端分页两种模式,具体模式由数据量决定

## Out of Scope

以下功能明确**不在**本次改进范围内:

- 修改资金流向、ETF、龙虎榜的数据来源或计算逻辑
- 添加新的筛选条件或自定义查询功能到问财筛选
- 实现自选股的添加、删除、移动分组等管理功能(仅重构UI布局)
- 修改图表库或重新设计趋势图的样式(仅联动功能)
- 实现暗黑模式或其他主题切换功能
- 添加移动端专属的手势交互(如下拉刷新、左右滑动切换选项卡)
- 实现表格列的拖拽排序或自定义显示列功能
- 导出表格数据为Excel或PDF格式

## Dependencies

- 前端UI框架: 假设使用Vue 3 + Element Plus或类似组件库,提供表格、分页、选项卡等基础组件
- 图表库: 假设使用ECharts或类似库用于资金流向趋势图绘制
- 后端API: 需要现有API支持获取资金流向历史趋势数据(如果不存在,需后端团队配合新增)
- 浏览器兼容性: 要求支持CSS Grid、Flexbox、position: sticky等现代CSS特性

## Risks

- **性能风险**: 大量数据(如1000+条记录)时,固定表头和斑马纹可能影响滚动性能,需进行虚拟滚动优化
- **兼容性风险**: 较旧浏览器(如IE11)不支持position: sticky,需提供降级方案或明确不支持
- **用户体验风险**: 字体大小调整可能导致部分用户设备上布局错位,需充分测试不同屏幕尺寸
- **数据一致性风险**: 资金流向趋势图联动时,如果后端数据更新不及时,可能显示过时数据
- **功能复杂度风险**: 自选股选项卡重构涉及多个分组数据加载,可能增加前端状态管理复杂度
