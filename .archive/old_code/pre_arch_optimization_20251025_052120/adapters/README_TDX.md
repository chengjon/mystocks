# TDXæ•°æ®æºé€‚é…å™¨ä½¿ç”¨æ–‡æ¡£

**åˆ›å»ºäºº**: Claude
**ç‰ˆæœ¬**: 2.1.0
**æ‰¹å‡†æ—¥æœŸ**: 2025-10-15
**æœ€åä¿®è®¢**: 2025-10-16
**æœ¬æ¬¡ä¿®è®¢å†…å®¹**: é€šè¾¾ä¿¡TDXé›†æˆè¯´æ˜

---

## æ¦‚è¿°

TDX(é€šè¾¾ä¿¡)æ•°æ®æºé€‚é…å™¨æ˜¯MyStocksç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®æºç»„ä»¶ä¹‹ä¸€,æä¾›Aè‚¡å¸‚åœºçš„å®æ—¶è¡Œæƒ…å’Œå†å²Kçº¿æ•°æ®è®¿é—®ã€‚

**ç‰ˆæœ¬**: 1.0.0
**ä½œè€…**: MyStocks Team
**æ—¥æœŸ**: 2025-10-15

## æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

1. **å®æ—¶è¡Œæƒ…æŸ¥è¯¢** - `get_real_time_data()`
   - æ”¯æŒæ²ªæ·±Aè‚¡å®æ—¶è¡Œæƒ…
   - åŒ…å«ä»·æ ¼ã€æˆäº¤é‡ã€äº”æ¡£è¡Œæƒ…ç­‰
   - è‡ªåŠ¨è¯†åˆ«å¸‚åœºä»£ç 

2. **å†å²Kçº¿æ•°æ®** - `get_stock_daily()`, `get_index_daily()`
   - æ”¯æŒæ—¥çº¿æ•°æ®è·å–
   - è‡ªåŠ¨åˆ†é¡µå¤„ç†(800æ¡/æ‰¹)
   - æ”¯æŒä»»æ„æ—¶é—´èŒƒå›´æŸ¥è¯¢

3. **å¤šå‘¨æœŸKçº¿** - `get_stock_kline()`, `get_index_kline()`
   - **1åˆ†é’Ÿçº¿** (`1m`)
   - **5åˆ†é’Ÿçº¿** (`5m`)
   - **15åˆ†é’Ÿçº¿** (`15m`)
   - **30åˆ†é’Ÿçº¿** (`30m`)
   - **1å°æ—¶çº¿** (`1h`)
   - **æ—¥çº¿** (`1d`)

4. **æœåŠ¡å™¨ç®¡ç†**
   - è‡ªåŠ¨è§£æconnect.cfgé…ç½®æ–‡ä»¶
   - 38ä¸ªTDXæœåŠ¡å™¨è‡ªåŠ¨å‘ç°
   - ä¸»æœåŠ¡å™¨ä¼˜å…ˆçº§é…ç½®
   - æ•…éšœè‡ªåŠ¨è½¬ç§»
   - è´Ÿè½½å‡è¡¡æ”¯æŒ

5. **é«˜å¯ç”¨ç‰¹æ€§**
   - æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶(1s â†’ 2s â†’ 4s)
   - è¿æ¥æ± ç®¡ç†
   - å®Œæ•´çš„é”™è¯¯å¤„ç†
   - è¯¦ç»†çš„æ—¥å¿—è®°å½•

### ğŸš§ å¾…å®ç°åŠŸèƒ½

- `get_stock_basic()` - è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
- `get_financial_data()` - è´¢åŠ¡æ•°æ®
- `get_index_components()` - æŒ‡æ•°æˆåˆ†è‚¡
- `get_market_calendar()` - äº¤æ˜“æ—¥å†(TDXä¸æ”¯æŒ)
- `get_news_data()` - æ–°é—»æ•°æ®(TDXä¸æ”¯æŒ)

## å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨

```python
from adapters.tdx_adapter import TdxDataSource

# åˆ›å»ºTDXæ•°æ®æºå®ä¾‹
tdx = TdxDataSource()

# è·å–å®æ—¶è¡Œæƒ…
quote = tdx.get_real_time_data('600519')  # è´µå·èŒ…å°
if isinstance(quote, dict):
    print(f"è‚¡ç¥¨: {quote['name']}")
    print(f"æœ€æ–°ä»·: {quote['price']:.2f}")
    print(f"æ¶¨è·Œå¹…: {(quote['price']/quote['pre_close']-1)*100:.2f}%")
    print(f"æˆäº¤é‡: {quote['volume']:,}æ‰‹")
```

### 2. å†å²Kçº¿æ•°æ®

```python
from datetime import datetime, timedelta

# è·å–è‚¡ç¥¨æ—¥çº¿æ•°æ®(æœ€è¿‘90å¤©)
end_date = datetime.now().strftime('%Y-%m-%d')
start_date = (datetime.now() - timedelta(days=90)).strftime('%Y-%m-%d')

df = tdx.get_stock_daily('600519', start_date, end_date)
print(f"è·å–{len(df)}æ¡æ—¥çº¿æ•°æ®")
print(df.head())

# è·å–æŒ‡æ•°æ—¥çº¿æ•°æ®
df_index = tdx.get_index_daily('000001', start_date, end_date)  # ä¸Šè¯æŒ‡æ•°
print(f"ä¸Šè¯æŒ‡æ•°æ•°æ®: {len(df_index)}æ¡")
```

### 3. å¤šå‘¨æœŸKçº¿æ•°æ®

```python
# è·å–5åˆ†é’ŸKçº¿(æœ€è¿‘2å¤©)
end_date = datetime.now().strftime('%Y-%m-%d')
start_date = (datetime.now() - timedelta(days=2)).strftime('%Y-%m-%d')

df_5m = tdx.get_stock_kline('600519', start_date, end_date, period='5m')
print(f"5åˆ†é’ŸKçº¿: {len(df_5m)}æ¡")

# è·å–1å°æ—¶Kçº¿
df_1h = tdx.get_stock_kline('600519', start_date, end_date, period='1h')
print(f"1å°æ—¶Kçº¿: {len(df_1h)}æ¡")

# æ‰€æœ‰æ”¯æŒçš„å‘¨æœŸ
periods = ['1m', '5m', '15m', '30m', '1h', '1d']
for period in periods:
    df = tdx.get_stock_kline('600519', start_date, end_date, period=period)
    print(f"{period}: {len(df)}æ¡æ•°æ®")
```

### 4. ä½¿ç”¨æ•°æ®æºç®¡ç†å™¨(æ¨è)

```python
from adapters.data_source_manager import get_default_manager

# è·å–é»˜è®¤æ•°æ®æºç®¡ç†å™¨(è‡ªåŠ¨æ³¨å†ŒTDXå’ŒAKShare)
manager = get_default_manager()

# æ–¹å¼1: æŒ‡å®šä½¿ç”¨TDXæ•°æ®æº
quote = manager.get_real_time_data('600519', source='tdx')

# æ–¹å¼2: è‡ªåŠ¨é€‰æ‹©(æŒ‰ä¼˜å…ˆçº§:tdx â†’ akshare)
quote = manager.get_real_time_data('600519')

# è·å–å†å²æ•°æ®(è‡ªåŠ¨æ•…éšœè½¬ç§»)
df = manager.get_stock_daily('600519', '2024-01-01', '2024-12-31')
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨`.env`æ–‡ä»¶ä¸­é…ç½®TDXæœåŠ¡å™¨å‚æ•°:

```bash
# TDXæœåŠ¡å™¨é…ç½®
TDX_SERVER_HOST=101.227.73.20  # é»˜è®¤æœåŠ¡å™¨åœ°å€
TDX_SERVER_PORT=7709            # é»˜è®¤ç«¯å£
TDX_MAX_RETRIES=3               # æœ€å¤§é‡è¯•æ¬¡æ•°
TDX_RETRY_DELAY=1               # é‡è¯•å»¶è¿Ÿ(ç§’)
TDX_API_TIMEOUT=10              # APIè¶…æ—¶(ç§’)
```

### æœåŠ¡å™¨é…ç½®æ–‡ä»¶

TdxDataSourceä¼šè‡ªåŠ¨è¯»å–`temp/connect.cfg`æ–‡ä»¶,è¯¥æ–‡ä»¶åŒ…å«38ä¸ªTDXæœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯:

```ini
[HQHOST]
HostNum=38
PrimaryHost=5

HostName01=é€šè¾¾ä¿¡æ·±åœ³åŒçº¿ä¸»ç«™1
IPAddress01=110.41.147.114
Port01=7709

HostName02=é€šè¾¾ä¿¡æ·±åœ³åŒçº¿ä¸»ç«™2
IPAddress02=110.41.2.72
Port02=7709
...
```

### è‡ªå®šä¹‰é…ç½®

```python
# ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å™¨
tdx = TdxDataSource(
    tdx_host='192.168.1.100',
    tdx_port=7709,
    max_retries=5,
    retry_delay=2,
    use_server_config=False  # ä¸ä½¿ç”¨connect.cfg
)

# ä½¿ç”¨connect.cfgä½†è‡ªå®šä¹‰é‡è¯•å‚æ•°
tdx = TdxDataSource(
    max_retries=5,
    retry_delay=2,
    use_server_config=True
)
```

## å¸‚åœºä»£ç è¯†åˆ«è§„åˆ™

### è‚¡ç¥¨å¸‚åœº

- **æ·±åœ³å¸‚åœº** (market=0)
  - 000xxx: æ·±å¸‚ä¸»æ¿
  - 002xxx: ä¸­å°æ¿
  - 300xxx: åˆ›ä¸šæ¿

- **ä¸Šæµ·å¸‚åœº** (market=1)
  - 600xxx, 601xxx, 603xxx: æ²ªå¸‚ä¸»æ¿
  - 688xxx: ç§‘åˆ›æ¿

### æŒ‡æ•°å¸‚åœº

- **æ·±åœ³æŒ‡æ•°** (market=0): 399xxx (å¦‚399001=æ·±è¯æˆæŒ‡)
- **ä¸Šæµ·æŒ‡æ•°** (market=1): 000xxx (å¦‚000001=ä¸Šè¯æŒ‡æ•°)

**æ³¨æ„**: æŒ‡æ•°çš„å¸‚åœºä»£ç ä¸è‚¡ç¥¨ä¸åŒ!

## æ•°æ®æ ¼å¼è¯´æ˜

### å®æ—¶è¡Œæƒ…æ•°æ®

```python
{
    'code': '600519',           # è‚¡ç¥¨ä»£ç 
    'name': 'è´µå·èŒ…å°',          # è‚¡ç¥¨åç§°
    'price': 1462.00,           # æœ€æ–°ä»·
    'pre_close': 1451.02,       # æ˜¨æ”¶ä»·
    'open': 1450.98,            # ä»Šå¼€
    'high': 1463.00,            # æœ€é«˜
    'low': 1445.08,             # æœ€ä½
    'volume': 42785,            # æˆäº¤é‡(æ‰‹)
    'amount': 6233407488.0,     # æˆäº¤é¢(å…ƒ)
    'bid1': 1461.99,            # ä¹°ä¸€ä»·
    'bid1_volume': 2,           # ä¹°ä¸€é‡
    'ask1': 1462.00,            # å–ä¸€ä»·
    'ask1_volume': 21,          # å–ä¸€é‡
    'timestamp': '2025-10-15 14:51:15'  # æŸ¥è¯¢æ—¶é—´
}
```

### Kçº¿æ•°æ®DataFrame

```python
# æ—¥çº¿æ•°æ®
        date    open    high     low   close  volume
0 2025-07-17 1528.00 1542.00 1526.01 1537.00 45678.0
1 2025-07-18 1538.00 1545.00 1530.00 1540.00 42345.0
...

# åˆ†é’Ÿçº¿æ•°æ®(åŒ…å«å®Œæ•´æ—¶é—´)
             date    open    high     low   close  volume
0 2025-10-15 09:30:00 1451.00 1455.00 1450.00 1454.00 125400.0
1 2025-10-15 09:35:00 1454.50 1458.00 1454.00 1456.50 98500.0
...
```

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç±»å‹

1. **è¿æ¥é”™è¯¯** - æœåŠ¡å™¨æ— æ³•è¿æ¥
```python
quote = tdx.get_real_time_data('600519')
if isinstance(quote, str):
    print(f"é”™è¯¯: {quote}")  # è¿”å›é”™è¯¯æ¶ˆæ¯å­—ç¬¦ä¸²
```

2. **å‚æ•°é”™è¯¯** - è‚¡ç¥¨ä»£ç æ ¼å¼é”™è¯¯
```python
quote = tdx.get_real_time_data('AAPL')
# è¿”å›: "æ— æ•ˆçš„è‚¡ç¥¨ä»£ç æ ¼å¼: AAPL (éœ€è¦6ä½æ•°å­—)"
```

3. **æ— æ•°æ®** - æŸ¥è¯¢ç»“æœä¸ºç©º
```python
df = tdx.get_stock_daily('999999', '2024-01-01', '2024-12-31')
# è¿”å›ç©ºDataFrame: pd.DataFrame()
```

### é‡è¯•æœºåˆ¶

TDXé€‚é…å™¨å†…ç½®æŒ‡æ•°é€€é¿é‡è¯•:

```
ç¬¬1æ¬¡å¤±è´¥ â†’ ç­‰å¾…1ç§’ â†’ é‡è¯•
ç¬¬2æ¬¡å¤±è´¥ â†’ ç­‰å¾…2ç§’ â†’ é‡è¯•
ç¬¬3æ¬¡å¤±è´¥ â†’ ç­‰å¾…4ç§’ â†’ é‡è¯•
ç¬¬4æ¬¡å¤±è´¥ â†’ æŠ›å‡ºå¼‚å¸¸
```

åŒæ—¶,å¦‚æœå¯ç”¨äº†`use_server_config=True`,æ¯æ¬¡é‡è¯•ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡å™¨ã€‚

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ‰¹é‡æŸ¥è¯¢

```python
# ä¸æ¨è: é€ä¸ªæŸ¥è¯¢
for symbol in ['600519', '600036', '000001']:
    quote = tdx.get_real_time_data(symbol)
    # å¤„ç†æ•°æ®...

# æ¨è: ä½¿ç”¨è¿æ¥æ± å¤ç”¨
tdx = TdxDataSource()  # åˆ›å»ºä¸€æ¬¡,å¤ç”¨å¤šæ¬¡
for symbol in symbols:
    quote = tdx.get_real_time_data(symbol)
```

### 2. æ—¥æœŸèŒƒå›´æ§åˆ¶

```python
# ä¸æ¨è: è·å–å…¨éƒ¨å†å²(å¯èƒ½æ•°ä¸‡æ¡)
df = tdx.get_stock_daily('600519', '1900-01-01', '2099-12-31')

# æ¨è: æŒ‰éœ€è·å–
df = tdx.get_stock_daily('600519', '2024-01-01', '2024-12-31')
```

### 3. å‘¨æœŸé€‰æ‹©

```python
# æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å‘¨æœŸ
# ç­–ç•¥å›æµ‹ â†’ ä½¿ç”¨æ—¥çº¿(1d)
# ç›˜ä¸­ç›‘æ§ â†’ ä½¿ç”¨5åˆ†é’Ÿ(5m)æˆ–15åˆ†é’Ÿ(15m)
# é«˜é¢‘äº¤æ˜“ â†’ ä½¿ç”¨1åˆ†é’Ÿ(1m)
```

## æµ‹è¯•

### è¿è¡ŒMVPæµ‹è¯•

```bash
# æµ‹è¯•åŸºç¡€åŠŸèƒ½(å®æ—¶è¡Œæƒ…+æ—¥çº¿)
python test_tdx_mvp.py

# æµ‹è¯•å¤šå‘¨æœŸKçº¿
python test_tdx_multiperiod.py

# æµ‹è¯•æœåŠ¡å™¨é…ç½®
python -c "from utils.tdx_server_config import TdxServerConfig; config = TdxServerConfig(); print(config)"
```

### é¢„æœŸç»“æœ

```
============================================================
æµ‹è¯•ç»“æœæ±‡æ€»
============================================================
server_config       : âœ“ PASS
real_time_quote     : âœ“ PASS
stock_daily         : âœ“ PASS
index_daily         : âœ“ PASS
error_handling      : âœ“ PASS

æ€»è®¡: 5/5 æµ‹è¯•é€šè¿‡

ğŸ‰ æ‰€æœ‰MVPåŠŸèƒ½æµ‹è¯•é€šè¿‡!
```

## å¸¸è§é—®é¢˜FAQ

### Q1: ä¸ºä»€ä¹ˆä½¿ç”¨æœ¬åœ°pytdxè€Œä¸æ˜¯pipå®‰è£…?

A: ä¸ºäº†æ”¯æŒäºŒæ¬¡å¼€å‘å’Œå®šåˆ¶åŒ–éœ€æ±‚,MyStocksä½¿ç”¨æœ¬åœ°`temp/pytdx/`ç›®å½•ä¸­çš„pytdxä»£ç ã€‚è¿™æ ·å¯ä»¥:
- ä¿®æ”¹å’Œæ‰©å±•pytdxåŠŸèƒ½
- ä¸å—PyPIç‰ˆæœ¬æ›´æ–°å½±å“
- ä¿è¯ä»£ç ç¨³å®šæ€§

### Q2: connect.cfgæ–‡ä»¶å¦‚ä½•è·å–?

A: connect.cfgæ˜¯é€šè¾¾ä¿¡å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶,é€šå¸¸ä½äºTDXå®‰è£…ç›®å½•(å¦‚`D:\ProgramData\tdx_new\`)ã€‚å°†å…¶å¤åˆ¶åˆ°`temp/`ç›®å½•å³å¯ã€‚

å¦‚æœæ²¡æœ‰connect.cfg,é€‚é…å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨é»˜è®¤æœåŠ¡å™¨(101.227.73.20:7709)ã€‚

### Q3: å¦‚ä½•å¤„ç†å¸‚åœºä¼‘å¸‚æ—¶æ®µ?

A: TDXæœåŠ¡å™¨åœ¨ä¼‘å¸‚æ—¶æ®µä»å¯è¿æ¥,ä½†è¿”å›çš„æ˜¯æœ€åä¸€ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®ã€‚å»ºè®®:
- ç»“åˆäº¤æ˜“æ—¥å†åˆ¤æ–­å½“å‰æ˜¯å¦äº¤æ˜“æ—¶æ®µ
- æ£€æŸ¥`timestamp`å­—æ®µåˆ¤æ–­æ•°æ®æ—¶æ•ˆæ€§
- ä½¿ç”¨`get_market_calendar()`è·å–äº¤æ˜“æ—¥å†(éœ€AKShareç­‰å…¶ä»–æ•°æ®æº)

### Q4: æ”¯æŒæ¸¯è‚¡/ç¾è‚¡å—?

A: ä¸æ”¯æŒã€‚TDXé€‚é…å™¨ä»…æ”¯æŒAè‚¡å¸‚åœº(æ·±äº¤æ‰€+ä¸Šäº¤æ‰€),ä¸åŒ…å«:
- æ¸¯è‚¡
- ç¾è‚¡
- æœŸè´§
- æœŸæƒ

å¦‚éœ€å…¶ä»–å¸‚åœºæ•°æ®,è¯·ä½¿ç”¨AKShareç­‰å…¶ä»–æ•°æ®æºã€‚

### Q5: æ•°æ®å»¶è¿Ÿå¤šå°‘?

A: TDXå®æ—¶è¡Œæƒ…æ•°æ®é€šå¸¸æœ‰3-5ç§’å»¶è¿Ÿ,ä¸å±äºLevel-2è¡Œæƒ…ã€‚é€‚åˆ:
- ç­–ç•¥ç ”å‘å’Œå›æµ‹
- ç›˜ä¸­ç›‘æ§
- ä½é¢‘äº¤æ˜“

ä¸é€‚åˆ:
- é«˜é¢‘äº¤æ˜“(æ¯«ç§’çº§)
- éœ€è¦ç²¾ç¡®åˆ°æ¯«ç§’çš„åœºæ™¯

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-10-15)

**MVPç‰ˆæœ¬å‘å¸ƒ**

- âœ… å®æ—¶è¡Œæƒ…æŸ¥è¯¢
- âœ… å†å²æ—¥çº¿æ•°æ®(è‚¡ç¥¨+æŒ‡æ•°)
- âœ… å¤šå‘¨æœŸKçº¿(1m/5m/15m/30m/1h/1d)
- âœ… æœåŠ¡å™¨é…ç½®ç®¡ç†(38ä¸ªæœåŠ¡å™¨)
- âœ… æ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… æ•°æ®éªŒè¯å’Œæ ¼å¼åŒ–
- âœ… å…¨éƒ¨æµ‹è¯•é€šè¿‡(5/5 MVP + 6/6 å¤šå‘¨æœŸ)

### åç»­è®¡åˆ’

- ğŸš§ è´¢åŠ¡æ•°æ®æ”¯æŒ
- ğŸš§ æŒ‡æ•°æˆåˆ†è‚¡æŸ¥è¯¢
- ğŸš§ æ›´å¤šKçº¿å‘¨æœŸ(å‘¨çº¿/æœˆçº¿)
- ğŸš§ åˆ†æ—¶æ•°æ®æ”¯æŒ
- ğŸš§ æ¿å—ä¿¡æ¯æŸ¥è¯¢

## è®¸å¯è¯

æœ¬é¡¹ç›®ä¸ºMyStocksç³»ç»Ÿçš„ä¸€éƒ¨åˆ†,éµå¾ªMITè®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**: `/opt/claude/mystocks_spec`
- **æ–‡æ¡£è·¯å¾„**: `adapters/README_TDX.md`
- **æµ‹è¯•è„šæœ¬**: `test_tdx_mvp.py`, `test_tdx_multiperiod.py`

---

*æœ€åæ›´æ–°: 2025-10-15*
