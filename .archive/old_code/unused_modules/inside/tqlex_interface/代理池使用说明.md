# 代理池配置说明

## 配置文件格式

在本项目中，代理配置文件位于：`instock/config/proxy.txt`
每行一个代理，格式为：`ip:port` 或 `username:password@ip:port`

## 代理池使用示例

```python
import random

def get_random_proxy():
    """
    从代理文件中随机获取一个代理
    """
    proxy_file = "instock/config/proxy.txt"
    try:
        with open(proxy_file, "r") as file:
            proxies = [line.strip() for line in file.readlines() if line.strip()]
            if proxies:
                proxy = random.choice(proxies)
                return {"http": proxy, "https": proxy}
    except Exception as e:
        print(f"读取代理文件失败: {e}")
    return None

# 使用示例
proxies = get_random_proxy()
if proxies:
    response = requests.get(url, proxies=proxies)
```

## 代理池管理建议

### 1. 代理格式示例
```
127.0.0.1:7860
52.13.248.29:3128
35.178.104.4:80
username:password@65.1.244.232:3128
13.126.79.133:80
54.212.22.168:3128
```

### 2. 代理验证函数
```python
import requests

def validate_proxy(proxy):
    """
    验证代理是否可用
    """
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
    }
    proxies = {"http": proxy, "https": proxy}
    
    try:
        response = requests.head("https://httpbin.org/ip", 
                               headers=headers, 
                               proxies=proxies, 
                               timeout=5)
        return response.status_code == 200
    except:
        return False

def get_valid_proxy():
    """
    获取一个可用的代理
    """
    proxy_file = "instock/config/proxy.txt"
    try:
        with open(proxy_file, "r") as file:
            proxies = [line.strip() for line in file.readlines() if line.strip()]
            random.shuffle(proxies)  # 随机打乱顺序
            
            for proxy in proxies:
                if validate_proxy(proxy):
                    return {"http": proxy, "https": proxy}
    except Exception as e:
        print(f"读取代理文件失败: {e}")
    return None
```

### 3. 代理轮询策略
```python
import time
import random

class ProxyPool:
    def __init__(self, proxy_file="instock/config/proxy.txt"):
        self.proxy_file = proxy_file
        self.proxies = self.load_proxies()
        self.current_index = 0
    
    def load_proxies(self):
        """加载代理列表"""
        try:
            with open(self.proxy_file, "r") as file:
                return [line.strip() for line in file.readlines() if line.strip()]
        except Exception as e:
            print(f"加载代理失败: {e}")
            return []
    
    def get_next_proxy(self):
        """轮询获取下一个代理"""
        if not self.proxies:
            return None
        
        proxy = self.proxies[self.current_index]
        self.current_index = (self.current_index + 1) % len(self.proxies)
        return {"http": proxy, "https": proxy}
    
    def get_random_proxy(self):
        """随机获取一个代理"""
        if not self.proxies:
            return None
        
        proxy = random.choice(self.proxies)
        return {"http": proxy, "https": proxy}
```

## 注意事项

1. **代理有效性**：定期检查代理的有效性
2. **频率控制**：避免过于频繁地切换代理
3. **错误处理**：代理失效时要有备用方案
4. **隐私保护**：不要在代码中硬编码代理账号密码