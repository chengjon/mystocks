# MyStocks BUG知识库

## 更新日期：2025-10-27
## 版本：v2.0

---

## 一、已修复BUG记录

### 2025-10-27 修复记录（Session 2）

#### BUG-013：前端服务端口配置错误
- **问题描述**：前端服务运行在3001端口而非要求的3000端口
- **根本原因**：3000端口被其他Node进程占用（PID: 98193）
- **解决方案**：
  1. 终止占用3000端口的进程
  2. 重新启动前端服务指定3000端口
  3. 建议在package.json中固定端口配置
- **影响范围**：前端访问
- **状态**：✅ 已修复

#### BUG-014：路由路径不存在（/stocks）
- **问题描述**：访问/stocks路径返回404错误
- **根本原因**：系统中不存在/stocks路径，正确路径是/watchlist
- **解决方案**：使用正确的路由路径/watchlist
- **影响范围**：自选股页面访问
- **状态**：✅ 已验证（无需代码修改）

#### BUG-015：前端功能完整性验证
- **验证项目**：
  1. 资金流向页面（固定表头、分页、斑马纹、行业链接、趋势图）
  2. ETF和龙虎榜页面（固定表头、分页、斑马纹）
  3. 字体设置功能（动态调整、持久化）
  4. 问财筛选（qs_1至qs_9默认查询）
  5. 自选股页面（选项卡、分组高亮）
- **验证结果**：所有功能已正确实现
- **状态**：✅ 已验证

### 2025-10-27 修复记录（Session 1）

#### BUG-001: Dashboard API 500错误
- **问题描述**：GET /api/data/dashboard/summary返回500错误
- **根本原因**：SQL查询使用错误列名`date`，实际数据库列名为`trade_date`
- **解决方案**：修改database.py第173-187行，将`date`改为`trade_date`
- **影响范围**：Dashboard页面数据加载
- **状态**：✅ 已修复

#### BUG-002: ECharts DOM尺寸错误
- **问题描述**：控制台报错"[ECharts] Can't get DOM width or height"
- **根本原因**：ECharts在DOM元素尺寸为0时初始化
- **解决方案**：在ChartWrapper.vue中添加v-if条件判断和nextTick延迟初始化
- **影响范围**：所有使用ECharts的图表组件
- **状态**：✅ 已修复

#### BUG-003: ChipRaceTable Props类型错误
- **问题描述**：Props验证失败，期望Number收到String
- **根本原因**：后端返回字符串类型，前端期望数字类型
- **解决方案**：修改ChipRaceTable.vue，使用Number()转换数据类型
- **影响范围**：竞价抢筹表格显示
- **状态**：✅ 已修复

#### BUG-004: LongHuBangTable Props类型错误
- **问题描述**：Props验证失败，期望Number收到String
- **根本原因**：后端返回字符串类型，前端期望数字类型
- **解决方案**：修改LongHuBangTable.vue，使用parseFloat()转换数据类型
- **影响范围**：龙虎榜表格显示
- **状态**：✅ 已修复

#### BUG-005: IndicatorLibrary ElTag类型验证错误
- **问题描述**：ElTag组件type属性验证失败
- **根本原因**：传递了空字符串给type属性
- **解决方案**：修改IndicatorLibrary.vue，移除type绑定，使用默认值
- **影响范围**：指标库页面标签显示
- **状态**：✅ 已修复

---

## 二、常见问题模式

### 1. 类型不匹配问题
**模式特征**：
- Vue Props验证警告
- 后端返回字符串，前端期望数字

**通用解决方案**：
```javascript
// 数据转换处理
const processedData = rawData.map(item => ({
  ...item,
  numericField: Number(item.numericField) || 0,
  floatField: parseFloat(item.floatField) || 0
}))
```

### 2. DOM尺寸问题
**模式特征**：
- ECharts或其他可视化库报DOM尺寸错误
- 组件在隐藏状态下初始化

**通用解决方案**：
```javascript
// 确保DOM就绪后初始化
await nextTick()
if (chartRef.value && chartRef.value.offsetWidth > 0) {
  initChart()
}
```

### 3. 数据库列名不一致
**模式特征**：
- SQL查询500错误
- 列名拼写或命名规范不一致

**通用解决方案**：
- 统一使用snake_case命名
- 建立数据库字段映射文档
- 使用ORM避免直接SQL

---

## 三、预防措施

### 前端开发规范
1. **类型验证**：
   - 对所有外部数据进行类型转换
   - 使用TypeScript增强类型安全
   - Props定义包含默认值和验证器

2. **DOM操作**：
   - 使用v-if控制组件渲染时机
   - 监听resize事件重新计算尺寸
   - 使用nextTick确保DOM更新

3. **路由管理**：
   - 维护路由文档
   - 使用路由名称而非路径
   - 添加404页面处理

### 后端开发规范
1. **API响应**：
   - 统一数据类型（数字用number不用string）
   - 使用数据验证中间件
   - 返回明确的错误信息

2. **数据库操作**：
   - 使用ORM而非原始SQL
   - 维护数据库schema文档
   - 列名使用一致的命名规范

---

## 四、测试检查清单

### 前端测试
- [ ] 控制台无错误和警告
- [ ] Props类型验证通过
- [ ] 图表正常渲染
- [ ] 路由跳转正常
- [ ] 数据加载和显示正确

### 后端测试
- [ ] API响应状态码正确
- [ ] 返回数据格式符合约定
- [ ] 错误处理完善
- [ ] 数据库查询正常

### 集成测试
- [ ] 前后端数据类型匹配
- [ ] 认证授权正常
- [ ] 异常情况处理
- [ ] 性能指标达标

---

## 五、版本更新记录

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| v2.0 | 2025-10-27 | 添加Session 2修复记录（BUG-013至015） |
| v1.0 | 2025-10-27 | 初始版本，包含BUG-001至005，012 |

---

## 六、待解决问题

1. **建议优化**：
   - 在package.json中固定端口配置
   - 添加/stocks到/watchlist的路由重定向
   - 完善类型定义文件

2. **潜在风险**：
   - 端口3000可能被其他服务占用
   - 字体大小修改影响全局样式
   - 某些浏览器可能不支持CSS Variables

---

**维护说明**：
- 每次修复BUG后更新此文档
- 记录问题模式帮助快速定位类似问题
- 定期回顾和优化解决方案