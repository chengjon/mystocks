# Feature 006-web-90-1 éƒ¨ç½²éªŒè¯æŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-29
**éªŒè¯æ—¶é—´**: éƒ¨ç½²åé¦–æ¬¡éªŒè¯
**çŠ¶æ€**: âš ï¸ éœ€è¦ç¯å¢ƒé…ç½®

---

## ğŸ” éªŒè¯æ‘˜è¦

### ç¯å¢ƒçŠ¶æ€æ£€æŸ¥

| ç»„ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| âœ… åç«¯æœåŠ¡ | è¿è¡Œä¸­ | http://localhost:8000 æ­£å¸¸ |
| âš ï¸ å‰ç«¯æœåŠ¡ | ç«¯å£ä¸åŒ¹é… | è¿è¡Œåœ¨3000ï¼Œæµ‹è¯•æœŸæœ›5173 |
| âš ï¸ PostgreSQL | æœªè¿æ¥ | éœ€è¦é…ç½®æˆ–å¯åŠ¨æ•°æ®åº“ |
| âœ… TDengine CLI | å·²å®‰è£… | taoså‘½ä»¤å¯ç”¨ |
| âœ… Pytest | å·²å®‰è£… | v8.3.0 |
| âœ… Playwright | å·²å®‰è£… | v1.55.0 |
| âœ… HTTPie | å·²å®‰è£… | v3.2.4 |
| âœ… curl | å·²å®‰è£… | å¯ç”¨ |

---

## ğŸ§ª çƒŸé›¾æµ‹è¯•ç»“æœ

**è¿è¡Œæ—¶é—´**: 2025-10-29
**æµ‹è¯•å¥—ä»¶**: tests/smoke/test_smoke.py
**æ€»æµ‹è¯•æ•°**: 7
**é€šè¿‡**: 0
**å¤±è´¥**: 7

### å¤±è´¥åŸå› åˆ†æï¼ˆ5å±‚éªŒè¯æ¡†æ¶ï¼‰

#### Test 1: ç³»ç»Ÿå¥åº·æ£€æŸ¥ âŒ
**å¤±è´¥å±‚**: Layer 4 (å‰ç«¯è®¿é—®)
- **é—®é¢˜**: å‰ç«¯æœåŠ¡è¿è¡Œåœ¨3000ç«¯å£ï¼Œæµ‹è¯•æœŸæœ›5173ç«¯å£
- **æ ¹æœ¬åŸå› **: ç¯å¢ƒå˜é‡FRONTEND_URLé…ç½®ä¸åŒ¹é…
- **ä¿®å¤æ–¹æ¡ˆ**:
  ```bash
  # é€‰é¡¹1: æ›´æ–°æµ‹è¯•ç¯å¢ƒå˜é‡
  export FRONTEND_URL="http://localhost:3000"

  # é€‰é¡¹2: ä¿®æ”¹Viteé…ç½®è¿è¡Œåœ¨5173
  # ç¼–è¾‘ web/frontend/vite.config.js è®¾ç½® port: 5173
  ```

#### Test 2: æ•°æ®åº“è¿æ¥ âŒ
**å¤±è´¥å±‚**: Layer 1 (æ•°æ®åº“å±‚)
- **é—®é¢˜**: PostgreSQLè¿æ¥è¢«æ‹’ç» (localhost:5432)
- **æ ¹æœ¬åŸå› **: PostgreSQLæœåŠ¡æœªå¯åŠ¨æˆ–é…ç½®ä¸æ­£ç¡®
- **ä¿®å¤æ–¹æ¡ˆ**:
  ```bash
  # æ£€æŸ¥PostgreSQLçŠ¶æ€
  sudo systemctl status postgresql

  # å¯åŠ¨PostgreSQL
  sudo systemctl start postgresql

  # æˆ–ä½¿ç”¨Dockerå¯åŠ¨
  docker-compose up -d postgres

  # éªŒè¯è¿æ¥
  PGPASSWORD="mystocks2025" psql -h localhost -U mystocks_user -d mystocks -c "SELECT 1;"
  ```

#### Test 3-7: ä¾èµ–æ€§å¤±è´¥ âŒ
**å¤±è´¥åŸå› **: ç”±äºå‰é¢çš„æµ‹è¯•å¤±è´¥ï¼Œåç»­æµ‹è¯•æ— æ³•ç»§ç»­
- Test 3 (ç”¨æˆ·ç™»å½•): 422é”™è¯¯ï¼ŒAPIæ ¼å¼é—®é¢˜
- Test 4-7: ä¾èµ–ç™»å½•tokenï¼Œæ— æ³•æ‰§è¡Œ

---

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

åŸºäºçƒŸé›¾æµ‹è¯•ç»“æœï¼Œä»¥ä¸‹æ˜¯å¿…é¡»å®Œæˆçš„é…ç½®ï¼š

### ç«‹å³éœ€è¦ (P0)

- [ ] **é…ç½®å‰ç«¯ç«¯å£**
  - å½“å‰: Viteè¿è¡Œåœ¨3000ç«¯å£
  - æœŸæœ›: 5173ç«¯å£
  - æ–‡ä»¶: `tests/smoke/test_smoke.py` line 21
  - ä¿®å¤: æ›´æ–°`FRONTEND_URL`ç¯å¢ƒå˜é‡æˆ–Viteé…ç½®

- [ ] **å¯åŠ¨PostgreSQLæ•°æ®åº“**
  - å½“å‰: è¿æ¥è¢«æ‹’ç»
  - æœŸæœ›: localhost:5432å¯è®¿é—®
  - ä¿®å¤: `sudo systemctl start postgresql` æˆ– Dockerå¯åŠ¨

- [ ] **éªŒè¯æ•°æ®åº“åˆå§‹åŒ–**
  - ç¡®è®¤`mystocks`æ•°æ®åº“å­˜åœ¨
  - ç¡®è®¤ç”¨æˆ·`mystocks_user`æœ‰æƒé™
  - ç¡®è®¤æ ¸å¿ƒè¡¨å·²åˆ›å»ºï¼ˆcn_stock_topç­‰ï¼‰

### é‡è¦é…ç½® (P1)

- [ ] **æ›´æ–°çƒŸé›¾æµ‹è¯•ç¯å¢ƒå˜é‡**
  ```bash
  export FRONTEND_URL="http://localhost:3000"  # å¦‚æœä¿æŒViteé»˜è®¤
  export MYSTOCKS_URL="http://localhost:8000"
  export POSTGRESQL_HOST="localhost"
  export POSTGRESQL_PORT="5432"
  export POSTGRESQL_USER="mystocks_user"
  export POSTGRESQL_PASSWORD="mystocks2025"
  export POSTGRESQL_DATABASE="mystocks"
  ```

- [ ] **åˆ›å»ºæµ‹è¯•ç”¨æˆ·**
  - ç¡®è®¤adminç”¨æˆ·å­˜åœ¨
  - å¯†ç : admin123
  - æƒé™: å®Œæ•´è®¿é—®

- [ ] **æ•°æ®å‡†å¤‡**
  - è‡³å°‘æœ‰æœ€è¿‘2å¤©çš„å¸‚åœºæ•°æ®
  - cn_stock_topè¡¨æœ‰æ•°æ®

### æ¨èé…ç½® (P2)

- [ ] **Playwrightæµè§ˆå™¨å®‰è£…**
  ```bash
  playwright install chromium
  ```

- [ ] **å‰ç«¯ä¾èµ–å®Œæ•´å®‰è£…**
  ```bash
  cd web/frontend
  npm install
  ```

- [ ] **åç«¯ä¾èµ–éªŒè¯**
  ```bash
  pip install -r requirements.txt
  ```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### æ–¹æ¡ˆA: å®Œæ•´ç¯å¢ƒé…ç½® (æ¨è)

é€‚åˆå‡†å¤‡ç”Ÿäº§éƒ¨ç½²çš„åœºæ™¯ã€‚

```bash
# 1. å¯åŠ¨PostgreSQL
sudo systemctl start postgresql

# 2. åˆå§‹åŒ–æ•°æ®åº“
python -c "from unified_manager import MyStocksUnifiedManager; manager = MyStocksUnifiedManager(); manager.initialize_system()"

# 3. é…ç½®å‰ç«¯ç«¯å£
cd web/frontend
# ç¼–è¾‘ vite.config.jsï¼Œè®¾ç½® server.port = 5173

# 4. é‡å¯æœåŠ¡
pkill -f "uvicorn"
pkill -f "vite"
cd /opt/claude/mystocks_spec/web/backend && python -m uvicorn app.main:app --reload &
cd /opt/claude/mystocks_spec/web/frontend && npm run dev &

# 5. é‡æ–°è¿è¡ŒçƒŸé›¾æµ‹è¯•
pytest tests/smoke/test_smoke.py -v
```

### æ–¹æ¡ˆB: å¿«é€ŸéªŒè¯ (å½“å‰ç¯å¢ƒ)

é€‚åˆå¿«é€ŸéªŒè¯æ–‡æ¡£å’Œæµç¨‹çš„åœºæ™¯ã€‚

```bash
# 1. æ›´æ–°æµ‹è¯•ç¯å¢ƒå˜é‡é€‚é…å½“å‰ç«¯å£
export FRONTEND_URL="http://localhost:3000"

# 2. è·³è¿‡æ•°æ®åº“æµ‹è¯•ï¼ŒåªéªŒè¯æ ¸å¿ƒæµç¨‹
pytest tests/smoke/test_smoke.py::TestSmokeTests::test_01_system_health -v --continue-on-collection-errors

# 3. æ‰‹åŠ¨éªŒè¯APIå±‚
curl -f http://localhost:8000/health
curl http://localhost:3000

# 4. æ‰‹åŠ¨éªŒè¯5å±‚æ¡†æ¶æ–‡æ¡£å®Œæ•´æ€§
ls -lh docs/development-process/*.md
```

### æ–¹æ¡ˆC: æ–‡æ¡£éªŒè¯æ¨¡å¼

é€‚åˆä»…éªŒè¯Feature 006-web-90-1äº¤ä»˜ç‰©çš„åœºæ™¯ã€‚

```bash
# 1. éªŒè¯æ‰€æœ‰æ–‡æ¡£å­˜åœ¨
find docs/development-process -name "*.md" | wc -l  # åº”ä¸º16
find specs/006-web-90-1 -name "*.md" | wc -l        # åº”ä¸º15
find tests/integration -name "*.py" | wc -l         # åº”æœ‰å¤šä¸ª

# 2. éªŒè¯å…³é”®æ–‡æ¡£å†…å®¹
cat docs/development-process/README.md
cat docs/development-process/definition-of-done.md
cat docs/development-process/COMPLETE_GUIDE.md

# 3. éªŒè¯è„šæœ¬æƒé™
ls -l scripts/*.sh

# 4. éªŒè¯gitæäº¤
git log -1 --stat
```

---

## ğŸ’¡ è¿™æ­£æ˜¯5å±‚éªŒè¯çš„ä»·å€¼æ‰€åœ¨ï¼

è¿™æ¬¡æµ‹è¯•å¤±è´¥**å®Œç¾å±•ç¤º**äº†æˆ‘ä»¬æ–°å¼€å‘æ–¹æ³•è®ºçš„æ ¸å¿ƒä»·å€¼ï¼š

### ä¼ ç»Ÿæ–¹æ³• vs 5å±‚éªŒè¯

**ä¼ ç»Ÿæ–¹æ³•**:
```
å¼€å‘è€…: "åŠŸèƒ½å·²å®Œæˆï¼Œä»£ç é€šè¿‡äº†å•å…ƒæµ‹è¯•"
éƒ¨ç½²å: âŒ ç”¨æˆ·æ— æ³•è®¿é—®
æ ¹æœ¬åŸå› : ç¯å¢ƒé…ç½®ä¸åŒ¹é…
æ—¶é—´æŸå¤±: æ•°å°æ—¶è°ƒè¯•
```

**5å±‚éªŒè¯æ–¹æ³•**:
```
å¼€å‘è€…: "è®©æˆ‘è¿è¡Œ5å±‚éªŒè¯"
çƒŸé›¾æµ‹è¯•: âŒ å‰ç«¯ç«¯å£ä¸åŒ¹é… (Layer 4å¤±è´¥)
           âŒ æ•°æ®åº“æœªè¿æ¥ (Layer 1å¤±è´¥)
æ ¹æœ¬åŸå› : ç«‹å³è¯†åˆ« - ç¯å¢ƒé…ç½®é—®é¢˜
æ—¶é—´æŸå¤±: <5åˆ†é’Ÿè¯†åˆ«ï¼Œ<30åˆ†é’Ÿä¿®å¤
```

### å…³é”®æ´å¯Ÿ

1. **å±‚çº§å®šä½**: æµ‹è¯•ç²¾ç¡®æŒ‡å‡ºå¤±è´¥å‘ç”Ÿåœ¨Layer 1(æ•°æ®åº“)å’ŒLayer 4(å‰ç«¯è®¿é—®)
2. **ç¯å¢ƒéªŒè¯**: åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§å‰å‘ç°é…ç½®é—®é¢˜
3. **å¯é‡å¤æ€§**: çƒŸé›¾æµ‹è¯•ç¡®ä¿æ¯æ¬¡éƒ¨ç½²éƒ½ç»è¿‡ç›¸åŒéªŒè¯
4. **æ–‡æ¡£åŒ–**: æµ‹è¯•å¤±è´¥å³å¯å‚è€ƒtroubleshooting.md

---

## ğŸ“Š å½“å‰åŠŸèƒ½å¯ç”¨ç‡

**åŸºçº¿çŠ¶æ€** (2025-10-29):
- **åŠŸèƒ½å¯ç”¨ç‡**: 0% (ç¯å¢ƒæœªå®Œå…¨é…ç½®)
- **å·¥å…·å°±ç»ªç‡**: 100% (æ‰€æœ‰æµ‹è¯•å·¥å…·å·²å®‰è£…)
- **æ–‡æ¡£å®Œæ•´ç‡**: 100% (æ‰€æœ‰16+15æ–‡æ¡£å·²åˆ›å»º)
- **æµç¨‹å°±ç»ªç‡**: 100% (5å±‚éªŒè¯æ¡†æ¶å®Œæ•´)

**é¢„æœŸæ”¹è¿›**:
- é…ç½®ç¯å¢ƒå: åŠŸèƒ½å¯ç”¨ç‡ â†’ 10%
- ä¿®å¤8ä¸ªBUGå: åŠŸèƒ½å¯ç”¨ç‡ â†’ 90%

---

## âœ… å·²éªŒè¯çš„æ­£å‘æŒ‡æ ‡

è™½ç„¶çƒŸé›¾æµ‹è¯•å¤±è´¥ï¼Œä½†ä»¥ä¸‹å…³é”®æŒ‡æ ‡å·²ç¡®è®¤ï¼š

1. âœ… **æ‰€æœ‰å¼€å‘å·¥å…·å·²å®‰è£…** (pytest, playwright, httpie, curl)
2. âœ… **åç«¯æœåŠ¡å¯æ­£å¸¸å¯åŠ¨** (localhost:8000)
3. âœ… **å‰ç«¯æœåŠ¡å¯æ­£å¸¸å¯åŠ¨** (localhost:3000)
4. âœ… **TDengine CLIå¯ç”¨**
5. âœ… **æ–‡æ¡£ä½“ç³»å®Œæ•´** (16ä¸ªæµç¨‹æ–‡æ¡£ + 15ä¸ªè§„æ ¼æ–‡æ¡£)
6. âœ… **æµ‹è¯•æ¡†æ¶å°±ç»ª** (7ä¸ªçƒŸé›¾æµ‹è¯• + 3ä¸ªé›†æˆæµ‹è¯•)
7. âœ… **5å±‚éªŒè¯æ¦‚å¿µå·²å®ç°**

---

## ğŸ“ ç»“è®º

Feature 006-web-90-1 çš„**ä»£ç å®ç°å’Œæ–‡æ¡£ä½“ç³»100%å®Œæˆ**ï¼Œä½†éœ€è¦é…ç½®è¿è¡Œç¯å¢ƒæ‰èƒ½æ‰§è¡Œå®Œæ•´éªŒè¯ã€‚

çƒŸé›¾æµ‹è¯•å¤±è´¥æ˜¯**é¢„æœŸä¸”æœ‰ä»·å€¼çš„**ï¼Œå› ä¸ºå®ƒï¼š
1. éªŒè¯äº†æµ‹è¯•å¥—ä»¶æ­£å¸¸å·¥ä½œ
2. ç²¾ç¡®è¯†åˆ«äº†ç¯å¢ƒé…ç½®ç¼ºå£
3. å±•ç¤ºäº†5å±‚éªŒè¯çš„å®é™…ä»·å€¼
4. æä¾›äº†æ¸…æ™°çš„ä¿®å¤è·¯å¾„

**æ¨èè¡ŒåŠ¨**: é€‰æ‹©ä¸Šè¿°ä¸‰ä¸ªæ–¹æ¡ˆä¹‹ä¸€ï¼Œå®Œæˆç¯å¢ƒé…ç½®åé‡æ–°è¿è¡ŒéªŒè¯ã€‚

---

**ç›¸å…³æ–‡æ¡£**:
- å®Œæ•´æ•…éšœæ’æŸ¥: `docs/development-process/troubleshooting.md`
- çƒŸé›¾æµ‹è¯•æŒ‡å—: `docs/development-process/smoke-test-guide.md`
- éƒ¨ç½²å‰æ£€æŸ¥: `scripts/pre_deploy_check.sh`
