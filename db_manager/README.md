# æ•°æ®åº“ç®¡ç†å™¨æ¨¡å—

æ•°æ®åº“ç®¡ç†å™¨æ¨¡å—æ˜¯MyStocksç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œæä¾›å¤šæ•°æ®åº“çš„ç»Ÿä¸€ç®¡ç†ã€è‡ªåŠ¨åŒ–ç›‘æ§å’Œé…ç½®é©±åŠ¨çš„è¡¨ç»“æ„ç®¡ç†ã€‚

## ğŸš€ æ–°åŠŸèƒ½äº®ç‚¹

### efinanceé›†æˆ - æ²ªæ·±Aè‚¡å®æ—¶è¡Œæƒ…
- **æ•°æ®æº**: efinance.stock.get_realtime_quotes() è·å–5755åªè‚¡ç¥¨å®æ—¶æ•°æ®
- **æ™ºèƒ½é€‚é…å™¨**: customer_adapter.py ç»Ÿä¸€ç®¡ç† efinance + easyquotation
- **åˆ—åæ ‡å‡†åŒ–**: è‡ªåŠ¨å°†ä¸­æ–‡åˆ—åè½¬æ¢ä¸ºè‹±æ–‡æ ‡å‡†åˆ—å
- **è‡ªåŠ¨è·¯ç”±**: å®æ—¶è¡Œæƒ…æ•°æ®è‡ªåŠ¨è·¯ç”±åˆ°PostgreSQLæ•°æ®åº“
- **ç›‘æ§é›†æˆ**: æ‰€æœ‰æ“ä½œè‡ªåŠ¨è®°å½•åˆ°ç‹¬ç«‹ç›‘æ§æ•°æ®åº“

### Redisçƒ­æ•°æ®å›ºåŒ–å’Œå¼ºåˆ¶æ›´æ–°
- **é—®é¢˜è§£å†³**: Redis 5åˆ†é’Ÿè¿‡æœŸæ•°æ®çš„æŒä¹…åŒ–ä¿å­˜
- **å¼ºåˆ¶æ›´æ–°**: æ”¯æŒè·³è¿‡ç¼“å­˜å¼ºåˆ¶è·å–æœ€æ–°æ•°æ®
- **å¤šé‡å¤‡ä»½**: TDengineæ—¶åºå­˜å‚¨ + PostgreSQLåˆ†æå­˜å‚¨ + æ–‡ä»¶ç³»ç»Ÿåº”æ€¥å¤‡ä»½
- **è‡ªåŠ¨å›ºåŒ–**: è¿‡æœŸå‰è‡ªåŠ¨å¤‡ä»½åˆ°æ°¸ä¹…å­˜å‚¨ï¼Œç¡®ä¿æ•°æ®ä¸ä¸¢å¤±

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºç¡€è¿è¡Œ
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ - ä½¿ç”¨æ”¹è¿›çš„customer_adapterå’Œefinance
python run_realtime_market_saver.py

# æµ‹è¯•customer_adapteræ˜¯å¦æ­£å¸¸å·¥ä½œ
python run_realtime_market_saver.py --test-adapter
```

### æ•°æ®è·å–é€‰é¡¹
```bash
# å•æ¬¡è¿è¡Œ
python run_realtime_market_saver.py --count 1

# æŒç»­è¿è¡Œï¼ˆæ¯5åˆ†é’Ÿä¸€æ¬¡ï¼‰
python run_realtime_market_saver.py --count -1 --interval 300

# æŒç»­è¿è¡Œï¼ˆæ¯1åˆ†é’Ÿä¸€æ¬¡ï¼‰
python run_realtime_market_saver.py --count -1 --interval 60
```

## ğŸ“Š æ•°æ®æµå‘å›¾

```
æ²ªæ·±Aè‚¡å®æ—¶æ•°æ®è·å–å’Œå­˜å‚¨æµç¨‹ (efinanceç‰ˆ):

efinance.stock.get_realtime_quotes()
           â†“
customer_adapter (æ•°æ®å¢å¼º + åˆ—åæ ‡å‡†åŒ–)
           â†“
MyStocksç»Ÿä¸€ç®¡ç†å™¨ (è‡ªåŠ¨è·¯ç”±åˆ†ç±»)
           â†“
  DataClassification.DAILY_KLINE
           â†“
    PostgreSQLæ•°æ®åº“
    (realtime_market_quotesè¡¨)
           â†“
      ç›‘æ§æ•°æ®åº“è®°å½•æ‰€æœ‰æ“ä½œ
```

## ğŸ“ æ¨¡å—æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒç®¡ç†æ–‡ä»¶

#### 1. `database_manager.py`
- **åŠŸèƒ½**: æ ¸å¿ƒæ•°æ®åº“ç®¡ç†å™¨ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹
- **ç‰¹æ€§**: è¿æ¥æ± ç®¡ç†ã€DDLç”Ÿæˆã€è¡¨ç»“æ„éªŒè¯ã€æ¡ä»¶å¯¼å…¥
- **æ”¯æŒæ•°æ®åº“**: MySQLã€PostgreSQLã€TDengineã€Redisã€MariaDB
- **ç”¨é€”**: ç»Ÿä¸€æ•°æ®åº“è®¿é—®æ¥å£ã€è‡ªåŠ¨åŒ–è¡¨ç®¡ç†

#### 2. `save_realtime_market_data.py` â­ **æœ€æ–°**
- **åŠŸèƒ½**: æ²ªæ·±å¸‚åœºAè‚¡å®æ—¶æ•°æ®ä¿å­˜ç³»ç»Ÿ
- **ç‰¹æ€§**: MyStocksç»Ÿä¸€æ¥å£ã€è‡ªåŠ¨æ•°æ®åˆ†ç±»è·¯ç”±ã€Redisçƒ­æ•°æ®å›ºåŒ–
- **æ•°æ®æµå‘**: 
  - å®æ—¶æ•°æ® â†’ Redis (5åˆ†é’Ÿçƒ­ç¼“å­˜)
  - å›ºåŒ–æ•°æ® â†’ TDengine (æ°¸ä¹…æ—¶åºå­˜å‚¨)
- **æ–°åŠŸèƒ½**: 
  - `--force-update`: å¼ºåˆ¶æ›´æ–°ï¼Œè·³è¿‡Redisç¼“å­˜
  - `--enable-fixation`: å¯ç”¨Redisæ•°æ®è‡ªåŠ¨å›ºåŒ–

#### 3. `redis_data_fixation.py` â­ **æ–°å¢**
- **åŠŸèƒ½**: Redisçƒ­æ•°æ®å›ºåŒ–ç®¡ç†å™¨
- **ç‰¹æ€§**: å¤šç§å›ºåŒ–ç­–ç•¥ã€è‡ªåŠ¨å¤‡ä»½ã€æ•°æ®æ¢å¤
- **å›ºåŒ–ç­–ç•¥**: immediateã€scheduledã€before_expireã€on_demand
- **å­˜å‚¨ç›®æ ‡**: TDengine + PostgreSQL + æ–‡ä»¶ç³»ç»Ÿ

#### 4. `df2sql.py`
- **åŠŸèƒ½**: DataFrameåˆ°SQLçš„æ™ºèƒ½è½¬æ¢å™¨
- **ç‰¹æ€§**: è‡ªåŠ¨æ•°æ®ç±»å‹æ˜ å°„ã€DDLç”Ÿæˆã€æ‰¹é‡æ’å…¥ä¼˜åŒ–
- **ç”¨é€”**: å°†pandas DataFrameè½¬æ¢ä¸ºæ•°æ®åº“è¡¨ç»“æ„å’Œæ•°æ®

#### 5. `init_db_monitor.py`
- **åŠŸèƒ½**: ç›‘æ§æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- **ç‰¹æ€§**: è‡ªåŠ¨åˆ›å»ºç›‘æ§è¡¨ã€æ—¥å¿—è®°å½•ã€ç¯å¢ƒæ£€æµ‹
- **ç”¨é€”**: åˆå§‹åŒ–ç›‘æ§æ•°æ®åº“å’Œç›¸å…³è¡¨ç»“æ„

#### 6. `db_utils.py`
- **åŠŸèƒ½**: æ•°æ®åº“å·¥å…·å‡½æ•°åº“
- **ç‰¹æ€§**: é€šç”¨æ•°æ®åº“æ“ä½œã€è¿æ¥æµ‹è¯•ã€çŠ¶æ€æ£€æŸ¥
- **ç”¨é€”**: æä¾›æ•°æ®åº“æ“ä½œçš„è¾…åŠ©åŠŸèƒ½

### é…ç½®æ–‡ä»¶

#### 1. `realtime_market_config.env` â­ **æ ¸å¿ƒé…ç½®**
- **ç”¨é€”**: å®æ—¶å¸‚åœºæ•°æ®ä¿å­˜ç³»ç»Ÿé…ç½®
- **å…³é”®å‚æ•°**:
  - `MARKET_SYMBOL=hs`: æ²ªæ·±å¸‚åœºä»£ç 
  - `SAVE_AS_REALTIME=true`: ä¿å­˜åˆ°Redisçƒ­æ•°æ®
  - `SAVE_AS_TICK=false`: æ˜¯å¦åŒæ—¶ä¿å­˜åˆ°TDengine
  - `CACHE_EXPIRE_SECONDS=300`: Redis 5åˆ†é’Ÿè¿‡æœŸ

#### 2. `redis_fixation_config.env` â­ **æ–°å¢**
- **ç”¨é€”**: Redisæ•°æ®å›ºåŒ–ç­–ç•¥é…ç½®
- **å…³é”®å‚æ•°**:
  - `FIXATION_STRATEGY=before_expire`: è¿‡æœŸå‰å›ºåŒ–
  - `FIXATION_INTERVAL_SECONDS=240`: 4åˆ†é’Ÿå›ºåŒ–é—´éš”
  - `BACKUP_TO_TICK_DATA=true`: å¤‡ä»½åˆ°TDengine
  - `RETENTION_DAYS=30`: æ•°æ®ä¿ç•™30å¤©

### éªŒè¯å’Œç›‘æ§æ–‡ä»¶

#### 1. `validate_mystocks_architecture.py` â­ **æ¶æ„éªŒè¯**
- **åŠŸèƒ½**: MyStocksç»Ÿä¸€æ¥å£æ¶æ„éªŒè¯
- **éªŒè¯å†…å®¹**: æ•°æ®åˆ†ç±»è·¯ç”±ã€ç»Ÿä¸€ç®¡ç†å™¨ã€ç›‘æ§ç³»ç»Ÿé›†æˆ
- **ç”¨é€”**: ç¡®ä¿ç³»ç»Ÿç¬¦åˆMyStocksè®¾è®¡è§„èŒƒ

### æµ‹è¯•å’Œç¤ºä¾‹æ–‡ä»¶

#### 5. `database_test_menu.py`
- **åŠŸèƒ½**: äº¤äº’å¼æ•°æ®åº“æµ‹è¯•èœå•
- **ç‰¹æ€§**: èœå•é©±åŠ¨ã€åŠŸèƒ½æµ‹è¯•ã€ç»“æœéªŒè¯
- **ç”¨é€”**: æµ‹è¯•å„ç§æ•°æ®åº“åŠŸèƒ½å’Œè¿æ¥

#### 6. `execute_example.py`
- **åŠŸèƒ½**: åŸºæœ¬æ‰§è¡Œç¤ºä¾‹
- **ç‰¹æ€§**: ç®€å•çš„åŠŸèƒ½æ¼”ç¤º
- **ç”¨é€”**: å¿«é€ŸéªŒè¯æ•°æ®åº“ç®¡ç†å™¨åŠŸèƒ½

#### 7. `execute_example_mysql_only.py`
- **åŠŸèƒ½**: MySQLä¸“ç”¨ç¤ºä¾‹
- **ç‰¹æ€§**: ä¸“æ³¨MySQLåŠŸèƒ½æµ‹è¯•
- **ç”¨é€”**: åœ¨åªæœ‰MySQLç¯å¢ƒä¸‹çš„åŠŸèƒ½éªŒè¯

#### 8. `fixed_example.py`
- **åŠŸèƒ½**: ä¿®å¤ç‰ˆç¤ºä¾‹ï¼ˆè§£å†³TDengineå¯¼å…¥é—®é¢˜ï¼‰
- **ç‰¹æ€§**: æ¡ä»¶å¯¼å…¥ã€é”™è¯¯å¤„ç†ä¼˜åŒ–
- **ç”¨é€”**: åœ¨ç¼ºå°‘TDengineç¯å¢ƒä¸‹æ­£å¸¸è¿è¡Œ

#### 9. `simple_test.py`
- **åŠŸèƒ½**: ç®€å•æµ‹è¯•è„šæœ¬
- **ç‰¹æ€§**: åŸºç¡€åŠŸèƒ½æµ‹è¯•ã€å¿«é€ŸéªŒè¯
- **ç”¨é€”**: å¿«é€Ÿæ£€æŸ¥æ¨¡å—å¯¼å…¥å’ŒåŸºæœ¬åŠŸèƒ½

#### 10. `tdengine_test.py`
- **åŠŸèƒ½**: TDengineä¸“ç”¨æµ‹è¯•
- **ç‰¹æ€§**: æ—¶åºæ•°æ®åº“åŠŸèƒ½æµ‹è¯•
- **ç”¨é€”**: éªŒè¯TDengineè¿æ¥å’Œæ“ä½œ

#### 11. `test_jupyter_compatibility.py`
- **åŠŸèƒ½**: Jupyterå…¼å®¹æ€§æµ‹è¯•
- **ç‰¹æ€§**: argparseå†²çªè§£å†³
- **ç”¨é€”**: ç¡®ä¿åœ¨Jupyterç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œ

#### 12. `test_multi_directory.py`
- **åŠŸèƒ½**: å¤šç›®å½•ç»“æ„æµ‹è¯•
- **ç‰¹æ€§**: è·¯å¾„å…¼å®¹æ€§æµ‹è¯•
- **ç”¨é€”**: éªŒè¯ä¸åŒç›®å½•ç»“æ„ä¸‹çš„åŠŸèƒ½

### å®‰å…¨å’ŒéªŒè¯æ–‡ä»¶

#### 13. `security_check.py`
- **åŠŸèƒ½**: å®‰å…¨æ£€æŸ¥è„šæœ¬
- **ç‰¹æ€§**: æ•æ„Ÿä¿¡æ¯æ£€æµ‹ã€å®‰å…¨é…ç½®éªŒè¯
- **ç”¨é€”**: ç¡®ä¿æ•°æ®åº“é…ç½®å’Œä»£ç çš„å®‰å…¨æ€§

#### 14. `security_check_report.txt`
- **åŠŸèƒ½**: å®‰å…¨æ£€æŸ¥æŠ¥å‘Š
- **ç”¨é€”**: è®°å½•å®‰å…¨æ£€æŸ¥ç»“æœ

### é…ç½®æ–‡ä»¶

#### 15. `table_config.yaml`
- **åŠŸèƒ½**: è¡¨ç»“æ„é…ç½®æ¨¡æ¿
- **ç‰¹æ€§**: YAMLæ ¼å¼ã€ç»“æ„åŒ–å®šä¹‰
- **ç”¨é€”**: å®šä¹‰è¡¨ç»“æ„å’Œæ•°æ®åº“é…ç½®

### è®¾è®¡æ–‡æ¡£

#### 16. `design_purpose.md`
- **åŠŸèƒ½**: ç³»ç»Ÿè®¾è®¡ç†å¿µå’Œæ¶æ„æ–‡æ¡£
- **å†…å®¹**: 5å¤§æ•°æ®åˆ†ç±»ã€æ•°æ®åº“é€‰æ‹©åŸåˆ™ã€æ¶æ„è®¾è®¡
- **ç”¨é€”**: ç³»ç»Ÿè®¾è®¡å‚è€ƒå’Œå¼€å‘æŒ‡å¯¼

### Jupyteræ”¯æŒ

#### 17. `JUPYTER_DEMO.ipynb`
- **åŠŸèƒ½**: Jupyter Notebookæ¼”ç¤º
- **ç‰¹æ€§**: äº¤äº’å¼ç¤ºä¾‹ã€å¯è§†åŒ–è¾“å‡º
- **ç”¨é€”**: åœ¨Jupyterç¯å¢ƒä¸­çš„åŠŸèƒ½æ¼”ç¤º

## ğŸ—ï¸ è®¾è®¡æ¶æ„

### å¤šæ•°æ®åº“ç»Ÿä¸€ç®¡ç†

```python
from db_manager.database_manager import DatabaseTableManager, DatabaseType

# ç»Ÿä¸€ç®¡ç†å™¨æ”¯æŒå¤šç§æ•°æ®åº“
manager = DatabaseTableManager()

# æ”¯æŒçš„æ•°æ®åº“ç±»å‹
- DatabaseType.MYSQL        # MySQLæ•°æ®åº“
- DatabaseType.POSTGRESQL   # PostgreSQLæ•°æ®åº“  
- DatabaseType.TDENGINE     # TDengineæ—¶åºæ•°æ®åº“
- DatabaseType.REDIS        # Rediså†…å­˜æ•°æ®åº“
- DatabaseType.MARIADB      # MariaDBæ•°æ®åº“
```

### é…ç½®é©±åŠ¨çš„è¡¨ç®¡ç†

```python
# é€šè¿‡YAMLé…ç½®è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
from db_manager.database_manager import DatabaseTableManager

manager = DatabaseTableManager()
table_config = {
    'table_name': 'stock_daily',
    'database_type': 'MySQL',
    'columns': [
        {'name': 'symbol', 'type': 'VARCHAR', 'length': 10},
        {'name': 'date', 'type': 'DATE'},
        {'name': 'close', 'type': 'DECIMAL', 'precision': 10, 'scale': 2}
    ]
}

success = manager.create_table_from_config(table_config)
```

### ç›‘æ§æ•°æ®åº“åˆ†ç¦»

```python
# ç›‘æ§æ•°æ®åº“ä¸ä¸šåŠ¡æ•°æ®åº“å®Œå…¨åˆ†ç¦»
from db_manager.init_db_monitor import init_monitoring_database

# åˆå§‹åŒ–ç‹¬ç«‹çš„ç›‘æ§æ•°æ®åº“
success = init_monitoring_database()

# ç›‘æ§è¡¨ç»“æ„è‡ªåŠ¨åˆ›å»ºï¼š
# - table_creation_log     # è¡¨åˆ›å»ºæ—¥å¿—
# - table_operation_log    # è¡¨æ“ä½œæ—¥å¿—  
# - table_validation_log   # è¡¨éªŒè¯æ—¥å¿—
# - column_definition_log  # åˆ—å®šä¹‰æ—¥å¿—
```

## ğŸ”§ ä¾èµ–ç®¡ç†

### å¿…éœ€ä¾èµ–
```bash
pip install pandas numpy pyyaml sqlalchemy
```

### å¯é€‰ä¾èµ–ï¼ˆæŒ‰éœ€å®‰è£…ï¼‰
```bash
# MySQLæ”¯æŒ
pip install pymysql

# PostgreSQLæ”¯æŒ  
pip install psycopg2-binary

# TDengineæ”¯æŒ
pip install taospy

# Redisæ”¯æŒ
pip install redis
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
from db_manager.database_manager import DatabaseTableManager, DatabaseType

# åˆ›å»ºç®¡ç†å™¨
manager = DatabaseTableManager()

# æµ‹è¯•æ•°æ®åº“è¿æ¥
connection = manager.get_connection(DatabaseType.MYSQL, 'test_db')

# æ£€æŸ¥è¿æ¥çŠ¶æ€
if connection:
    print("æ•°æ®åº“è¿æ¥æˆåŠŸ")
```

### 2. åˆå§‹åŒ–ç›‘æ§ç³»ç»Ÿ

```python
from db_manager.init_db_monitor import init_monitoring_database

# åˆå§‹åŒ–ç›‘æ§æ•°æ®åº“
success = init_monitoring_database(drop_existing=False)

if success:
    print("ç›‘æ§ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ")
```

## ğŸ“Š æ ¸å¿ƒç‰¹æ€§

### æ¡ä»¶å¯¼å…¥æœºåˆ¶
- è‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„æ•°æ®åº“é©±åŠ¨
- ç¼ºå°‘ä¾èµ–æ—¶ä¸å½±å“å…¶ä»–åŠŸèƒ½
- æä¾›æ¸…æ™°çš„é”™è¯¯æç¤ºå’Œå®‰è£…æŒ‡å¯¼

### å¤šç¯å¢ƒå…¼å®¹
- æ”¯æŒå‘½ä»¤è¡Œå’ŒJupyterç¯å¢ƒ
- è‡ªåŠ¨å¤„ç†argparseå†²çª
- ç¯å¢ƒå˜é‡é…ç½®ç®¡ç†

### è‡ªåŠ¨åŒ–ç›‘æ§
- æ‰€æœ‰æ•°æ®åº“æ“ä½œè‡ªåŠ¨è®°å½•
- è¡¨ç»“æ„å˜æ›´è¿½è¸ª
- æ€§èƒ½æŒ‡æ ‡ç›‘æ§

### é”™è¯¯å¤„ç†
- å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- å®‰å…¨æ£€æŸ¥å’ŒéªŒè¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒé…ç½®**: ç¡®ä¿`.env`æ–‡ä»¶æ­£ç¡®é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
2. **ä¾èµ–å®‰è£…**: æ ¹æ®å®é™…ä½¿ç”¨çš„æ•°æ®åº“å®‰è£…ç›¸åº”é©±åŠ¨
3. **æƒé™è®¾ç½®**: ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™åˆ›å»ºè¡¨å’Œæ•°æ®åº“
4. **Jupyterç¯å¢ƒ**: åœ¨Jupyterä¸­ä½¿ç”¨æ—¶å»ºè®®ç›´æ¥è°ƒç”¨APIå‡½æ•°è€Œéå‘½ä»¤è¡Œå‚æ•°

æ›´å¤šè¯¦ç»†ä½¿ç”¨ç¤ºä¾‹å’Œé…ç½®è¯´æ˜ï¼Œè¯·å‚è€ƒ [example.md](./example.md)ã€‚