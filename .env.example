# ===================================
# MyStocks 环境配置模板
# ===================================
#
# 使用方法：
# 1. 复制此文件为 .env: cp .env.example .env
# 2. 修改 .env 文件中的敏感信息
# 3. 确保 .env 文件已添加到 .gitignore
#
# 安全提醒：
# - 永远不要将包含真实密码的 .env 文件提交到版本控制
# - 生产环境请使用强密码和随机密钥
# - 定期轮换数据库密码和JWT密钥
#

# ===================================
# Database Configuration (三数据库架构)
# ===================================
#
# 系统使用三数据库架构 (优化后):
# - TDengine: 高频时序数据 (Tick, 分钟K线)
# - PostgreSQL: 所有其他数据类型 (日线, 参考数据, 衍生数据, 交易数据, 元数据)
# - Redis: 分布式缓存、消息总线、分布式锁
#

# TDengine Configuration (高频时序数据专用)
TDENGINE_HOST=192.168.123.104
TDENGINE_PORT=6030
TDENGINE_USER=root
TDENGINE_PASSWORD=your_taos_password_here
TDENGINE_DATABASE=market_data
TDENGINE_REST_PORT=6041

# PostgreSQL Configuration (通用数据仓库 + TimescaleDB扩展)
POSTGRESQL_HOST=192.168.123.104
POSTGRESQL_PORT=5438
POSTGRESQL_USER=postgres
POSTGRESQL_PASSWORD=your_postgresql_password_here
POSTGRESQL_DATABASE=mystocks

# Monitoring Database (使用PostgreSQL同库独立schema)
MONITOR_DB_URL=postgresql://postgres:your_postgresql_password_here@192.168.123.104:5438/mystocks

# ===================================
# Redis Configuration (分布式缓存 & 消息总线)
# ===================================
#
# Redis功能:
# 1. L2分布式缓存 (L1: 内存 → L2: Redis → L3: 磁盘)
# 2. 实时消息总线 (Pub/Sub) - 指标计算完成、价格更新等事件
# 3. 分布式锁 - 防止重复计算、资源竞争
# 4. 会话存储 - JWT token黑名单、用户会话
#

# Redis连接配置
REDIS_HOST=192.168.123.104
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=1  # 使用DB1避免与其他应用冲突

# Redis连接池配置
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_DECODE_RESPONSES=true

# 缓存配置
REDIS_CACHE_TTL=3600  # 默认缓存过期时间 (秒)
REDIS_CACHE_PREFIX=mystocks:  # 键前缀避免冲突
REDIS_ENABLE_CACHE=true  # 启用Redis缓存

# 消息总线配置
REDIS_PUBSUB_CHANNEL_PREFIX=mystocks:  # Pub/Sub频道前缀
REDIS_ENABLE_PUBSUB=true  # 启用消息总线

# 分布式锁配置
REDIS_LOCK_PREFIX=mystocks:lock:  # 锁前缀
REDIS_LOCK_DEFAULT_TIMEOUT=30  # 默认锁超时 (秒)
REDIS_ENABLE_LOCK=true  # 启用分布式锁

# 会话配置
REDIS_SESSION_PREFIX=mystocks:session:  # 会话键前缀
REDIS_SESSION_TTL=86400  # 会话过期时间 (24小时)

# 兼容性配置 (Celery等第三方库)
REDIS_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
CELERY_BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}
CELERY_RESULT_BACKEND=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}

# Application-Level Cache Configuration (应用层内存缓存 - L1)
CACHE_EXPIRE_SECONDS=300
LRU_CACHE_MAXSIZE=1000

# JWT Authentication Configuration (用于API认证)
# 重要：请使用强随机密钥，可以通过以下命令生成：
# openssl rand -hex 32
JWT_SECRET_KEY=your_very_secure_random_secret_key_change_this_in_production
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440

# ===================================
# FastAPI Backend Configuration
# ===================================
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8888
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# 后端可用端口范围 (支持多实例部署)
BACKEND_PORT_RANGE_START=8000
BACKEND_PORT_RANGE_END=8009

# Frontend Configuration
VITE_API_BASE_URL=http://localhost:8888

# 前端可用端口范围 (支持多实例部署)
FRONTEND_PORT_RANGE_START=3000
FRONTEND_PORT_RANGE_END=3009

# ===================================
# Quantitative Trading Configuration
# ===================================

# TDX (Tongdaxin) Data Source
TDX_DATA_PATH=/mnt/d/ProgramData/tdx_new/vipdoc
TDX_MARKETS=sh,sz,bj,cw,ds,ot
TDX_APPLY_ADJUSTMENT=true
TDX_SKIP_WEEKENDS=true

# RQAlpha Data Bundle (if using RQAlpha backtesting)
RQALPHA_DATA_PATH=/opt/claude/mystocks_spec/data/rqalpha_bundle

# Backtest Configuration
BACKTEST_INITIAL_CAPITAL=100000
BACKTEST_COMMISSION_RATE=0.0003
BACKTEST_SLIPPAGE_RATE=0.0001

# Strategy Configuration
STRATEGY_PARALLEL_WORKERS=4
STRATEGY_MAX_STOCKS_PER_RUN=1000
USE_MOCK_DATA=true

# ===================================
# BUGer Configuration (Bug Management)
# ===================================
BUGER_API_URL=http://localhost:3031/api
BUGER_API_KEY=sk_test_xyz123
PROJECT_ID=mystocks
PROJECT_NAME=MyStocks
PROJECT_ROOT=/opt/claude/mystocks_spec

# ===================================
# Security Configuration (安全配置)
# ===================================

# 管理员账户配置 (首次部署时使用)
# 注意：部署后请立即通过管理界面修改密码
ADMIN_INITIAL_PASSWORD=your_admin_initial_password_here
ADMIN_EMAIL=admin@mystocks.com

# 测试环境凭据（用于健康检查和E2E测试）
# 注意：这些仅用于开发和测试环境
TEST_ADMIN_USERNAME=admin
TEST_ADMIN_PASSWORD=admin123

# API访问限制
API_RATE_LIMIT=100
API_RATE_WINDOW=60  # 秒

# 会话配置
SESSION_TIMEOUT_HOURS=24
MAX_LOGIN_ATTEMPTS=5
LOGIN_LOCKOUT_MINUTES=15

# ===================================
# Development Configuration (开发环境配置)
# ===================================

# 开发模式开关
DEBUG_MODE=false
ENABLE_PROFILING=false
ENABLE_QUERY_LOGGING=false

# 测试数据库 (可选)
TEST_POSTGRESQL_DATABASE=mystocks_test
# 注意：测试数据库不应包含生产数据

# 外部服务配置 (已迁移到上面Redis Configuration部分)

# ===================================
# Production Configuration (生产环境配置)
# ===================================

# 日志配置
LOG_LEVEL=INFO
LOG_FILE_PATH=/var/log/mystocks/app.log
LOG_MAX_SIZE_MB=100
LOG_BACKUP_COUNT=5

# 监控配置
ENABLE_METRICS=true
METRICS_PORT=9090
HEALTH_CHECK_INTERVAL=30

# SSL/TLS配置 (生产环境推荐)
SSL_ENABLED=false
SSL_CERT_PATH=/etc/ssl/certs/mystocks.crt
SSL_KEY_PATH=/etc/ssl/private/mystocks.key

# 备份配置
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 每天凌晨2点
BACKUP_RETENTION_DAYS=30
BACKUP_PATH=/var/backups/mystocks
