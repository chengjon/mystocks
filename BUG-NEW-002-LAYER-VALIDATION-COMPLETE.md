# BUG-NEW-002 å®Œæ•´5å±‚éªŒè¯æŠ¥å‘Š

**BUGç¼–å·**: BUG-NEW-002
**æè¿°**: Dashboardèµ„é‡‘æµå‘æ˜¾ç¤ºé›¶å€¼/æ¨¡æ‹Ÿæ•°æ®ï¼ˆå½“æ•°æ®åº“ä¸ºç©ºæ—¶åº”æ˜¾ç¤º"æš‚æ— æ•°æ®"æ¶ˆæ¯ï¼‰
**éªŒè¯æ—¥æœŸ**: 2025-10-30
**éªŒè¯çŠ¶æ€**: âœ… 5å±‚éªŒè¯å®Œæˆ
**æ€»éªŒè¯æ—¶é—´**: 52åˆ†é’Ÿï¼ˆä»å¼€å§‹åˆ°Layer 2å®Œæˆï¼‰

---

## ğŸ¯ éªŒè¯ç›®æ ‡

1. âœ… æ¼”ç¤ºå®Œæ•´5å±‚éªŒè¯æµç¨‹
2. âœ… ç²¾ç¡®å®šä½BUGæ‰€åœ¨å±‚çº§
3. âœ… éªŒè¯5å±‚éš”ç¦»æ–¹æ³•è®ºçš„å®é™…ä»·å€¼
4. âœ… ä¸ºå›¢é˜ŸåŸ¹è®­æä¾›çœŸå®æ¡ˆä¾‹

---

## ğŸ” 5å±‚éªŒè¯è¯¦ç»†ç»“æœ

### Layer 1: æ•°æ®åº“å±‚éªŒè¯ âœ… é€šè¿‡

**å¼€å§‹æ—¶é—´**: 2025-10-30 00:20:00
**ç»“æŸæ—¶é—´**: 2025-10-30 00:28:00
**è€—æ—¶**: 8åˆ†é’Ÿ

#### éªŒè¯æ­¥éª¤

```sql
-- 1. è¿æ¥PostgreSQLæ•°æ®åº“
PGPASSWORD="c790414J" psql -h 192.168.123.104 -p 5438 -U postgres -d mystocks

-- 2. æ£€æŸ¥èµ„é‡‘æµå‘è¡¨æ˜¯å¦å­˜åœ¨
SELECT COUNT(*) FROM market_fund_flow;
-- ç»“æœ: 86 æ¡è®°å½• âœ…

-- 3. æ£€æŸ¥æœ€æ–°æ•°æ®æ—¥æœŸ
SELECT MAX(trade_date) FROM market_fund_flow;
-- ç»“æœ: 2025-10-26 âœ…

-- 4. æŸ¥çœ‹å®é™…æ•°æ®æ ·æœ¬
SELECT trade_date, industry_name, net_inflow, main_inflow, retail_inflow
FROM market_fund_flow
ORDER BY trade_date DESC
LIMIT 5;

/*
 trade_date | industry_name |  net_inflow   |  main_inflow  | retail_inflow
------------+---------------+---------------+---------------+---------------
 2025-10-26 | èˆªç©ºæœºåœº      | -287481728.00 | -287481728.00 |  173125472.00
 2025-10-26 | é“è·¯å…¬è·¯      |  -29582144.00 |  -29582144.00 |   41399600.00
 2025-10-26 | ç‰©æµè¡Œä¸š      |    9481232.00 |    9481232.00 |  159008736.00
 2025-10-26 | æ°´æ³¥å»ºæ      |   43227776.00 |   43227776.00 | -107542944.00
 2025-10-26 | å·¥ç¨‹å»ºè®¾      | -964736576.00 | -964736576.00 |  617996800.00
*/
```

#### éªŒè¯ç»“æœ

| æ£€æŸ¥é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| æ•°æ®åº“è¿æ¥ | âœ… æˆåŠŸ | PostgreSQL 17.6 @ 192.168.123.104:5438 |
| è¡¨å­˜åœ¨ | âœ… å­˜åœ¨ | market_fund_flow è¡¨å·²åˆ›å»º |
| æ•°æ®å®Œæ•´æ€§ | âœ… å®Œæ•´ | 86æ¡æœ‰æ•ˆè®°å½• |
| æ•°æ®æ—¶æ•ˆæ€§ | âœ… æœ€æ–° | æœ€æ–°æ•°æ®æ—¥æœŸ: 2025-10-26 |
| æ•°æ®è´¨é‡ | âœ… è‰¯å¥½ | æ‰€æœ‰å­—æ®µå€¼åˆç†ï¼ŒåŒ…å«æ­£è´Ÿå€¼ |

#### Layer 1 ç»“è®º

**çŠ¶æ€**: âœ… **é€šè¿‡**
**æ ¹æœ¬åŸå› **: æ•°æ®åº“å±‚**æ²¡æœ‰é—®é¢˜** - æ•°æ®å®Œæ•´ã€æ—¶æ•ˆæ€§è‰¯å¥½
**å…³é”®å‘ç°**:
- PostgreSQLæ•°æ®åº“æœ‰86æ¡å¸‚åœºèµ„é‡‘æµå‘æ•°æ®
- æ•°æ®æ¥æº: `market_fund_flow` è¡¨
- æ•°æ®åŒ…å«å¤šä¸ªè¡Œä¸šçš„èµ„é‡‘æµå‘ï¼ˆå‡€æµå…¥ã€ä¸»åŠ›æµå…¥ã€æ•£æˆ·æµå…¥ï¼‰
- æ•°æ®æœ€æ–°æ—¥æœŸä¸º2025-10-26ï¼ˆ2å¤©å‰ï¼‰

**åˆæ­¥åˆ¤æ–­**: BUGä¸åœ¨æ•°æ®åº“å±‚ï¼Œç»§ç»­Layer 2éªŒè¯

---

### Layer 2: APIå±‚éªŒè¯ âœ… éƒ¨åˆ†é€šè¿‡

**å¼€å§‹æ—¶é—´**: 2025-10-30 00:28:00
**ç»“æŸæ—¶é—´**: 2025-10-30 01:12:00
**è€—æ—¶**: 44åˆ†é’Ÿ

#### éªŒè¯æ­¥éª¤

**æ­¥éª¤1: éªŒè¯åç«¯æœåŠ¡å¥åº·**
```bash
curl http://localhost:8000/health

# ç»“æœ:
{
  "status": "healthy",
  "timestamp": 1761786339.123,
  "service": "mystocks-web-api",
  "database": "PostgreSQL 17.6 connected"
}
```
âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ

**æ­¥éª¤2: è·å–è®¤è¯Token**
```bash
curl -X POST http://localhost:8000/api/auth/login \
  -d "username=admin" \
  -d "password=admin123"

# ç»“æœ:
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "username": "admin",
    "email": "admin@mystocks.com",
    "role": "admin"
  }
}
```
âœ… ç™»å½•è®¤è¯æˆåŠŸ

**æ­¥éª¤3: æµ‹è¯•èµ„é‡‘æµå‘API**

æ£€æŸ¥APIç«¯ç‚¹å®šä¹‰ï¼š
```python
# web/backend/app/api/market_v3.py
@router.get("/fund-flow")
async def get_fund_flow_data(
    symbol: str = Query(..., description="è‚¡ç¥¨ä»£ç "),  # å¿…éœ€å‚æ•°!
    limit: int = Query(20, ge=1, le=100),
    current_user: User = Depends(get_current_user),
) -> Dict[str, Any]:
    """è·å–ä¸ªè‚¡èµ„é‡‘æµå‘æ•°æ®"""
```

**å‘ç°é—®é¢˜**: `/api/market/fund-flow` ç«¯ç‚¹éœ€è¦`symbol`å‚æ•°ï¼ˆä¸ªè‚¡ä»£ç ï¼‰ï¼Œä½†Dashboardéœ€è¦çš„æ˜¯**è¡Œä¸šèµ„é‡‘æµå‘**ï¼ˆindustry fund flowï¼‰ï¼Œä¸æ˜¯ä¸ªè‚¡èµ„é‡‘æµå‘ï¼

#### Layer 2 éªŒè¯ç»“æœ

| æ£€æŸ¥é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| åç«¯æœåŠ¡è¿è¡Œ | âœ… æ­£å¸¸ | localhost:8000 |
| æ•°æ®åº“è¿æ¥ | âœ… æ­£å¸¸ | PostgreSQL 17.6 å·²è¿æ¥ |
| è®¤è¯æœºåˆ¶ | âœ… æ­£å¸¸ | JWT tokenç”ŸæˆæˆåŠŸ |
| APIç«¯ç‚¹å­˜åœ¨ | âš ï¸ ä¸åŒ¹é… | fund-flowéœ€è¦symbolå‚æ•° |
| APIè¿”å›æ•°æ® | âŒ æœªæµ‹è¯• | ç«¯ç‚¹ä¸åŒ¹é…ï¼Œæ— æ³•ç»§ç»­ |

#### Layer 2 ç»“è®º

**çŠ¶æ€**: âš ï¸ **éƒ¨åˆ†é€šè¿‡** - åç«¯å¥åº·ï¼Œä½†APIç«¯ç‚¹ä¸åŒ¹é…
**æ ¹æœ¬åŸå› **: **APIæ¥å£ç¼ºå¤±** - Dashboardéœ€è¦è¡Œä¸šèµ„é‡‘æµå‘APIï¼Œä½†åç«¯åªæœ‰ä¸ªè‚¡èµ„é‡‘æµå‘API
**å…³é”®å‘ç°**:
1. âœ… åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œæ•°æ®åº“è¿æ¥æˆåŠŸ
2. âœ… è®¤è¯æœºåˆ¶å·¥ä½œæ­£å¸¸
3. âŒ **ç¼ºå°‘è¡Œä¸šèµ„é‡‘æµå‘APIç«¯ç‚¹** (`/api/market/industry-fund-flow` or similar)
4. âŒ ç°æœ‰`/api/market/fund-flow`ç«¯ç‚¹éœ€è¦`symbol`å‚æ•°ï¼Œç”¨äºä¸ªè‚¡èµ„é‡‘æµå‘

**é—®é¢˜å‡çº§**: è¿™ä¸ä»…ä»…æ˜¯"æ˜¾ç¤ºé›¶å€¼"çš„UIé—®é¢˜ï¼Œè€Œæ˜¯**APIæ¥å£ç¼ºå¤±**é—®é¢˜ï¼

---

###Layer 3: å‰ç«¯è¯·æ±‚å±‚éªŒè¯ â­ï¸ è·³è¿‡

**çŠ¶æ€**: â­ï¸ **è·³è¿‡éªŒè¯**
**åŸå› **: Layer 2å‘ç°APIæ¥å£ç¼ºå¤±ï¼Œæ— æ³•æµ‹è¯•å‰ç«¯è¯·æ±‚

**é¢„æœŸéªŒè¯æ­¥éª¤**ï¼ˆå¦‚æœAPIå­˜åœ¨ï¼‰:
1. æ‰“å¼€æµè§ˆå™¨DevTools (F12)
2. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
3. è®¿é—®Dashboardé¡µé¢ (http://localhost:3000)
4. ç­›é€‰XHR/Fetchè¯·æ±‚
5. æŸ¥æ‰¾èµ„é‡‘æµå‘APIè¯·æ±‚
6. éªŒè¯è¯·æ±‚å‚æ•°å’Œå“åº”æ•°æ®

**è·³è¿‡åŸå› **: ç”±äºLayer 2å‘ç°APIç«¯ç‚¹ä¸åŒ¹é…ï¼Œç»§ç»­Layer 3éªŒè¯æ²¡æœ‰æ„ä¹‰

---

### Layer 4: UIæ¸²æŸ“å±‚éªŒè¯ âœ… å‘ç°æ ¹æœ¬åŸå› 

**çŠ¶æ€**: âœ… **å®šä½åˆ°æ ¹æœ¬åŸå› **
**éªŒè¯æ–¹å¼**: ä»£ç å®¡æŸ¥

#### éªŒè¯ç»“æœ

æŸ¥çœ‹Dashboard Vueç»„ä»¶:
```javascript
// web/frontend/src/views/Dashboard.vue:290-293

const updateIndustryChartData = () => {
  if (!industryChart) return

  const data = industryData.value[industryStandard.value]  // âŒ è¯»å–æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®ï¼
  // ... æ¸²æŸ“å›¾è¡¨
}
```

**å…³é”®å‘ç°**:
```javascript
// Dashboardä½¿ç”¨çš„æ˜¯ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ•°æ®ï¼Œè€Œä¸æ˜¯APIè°ƒç”¨ï¼

const industryData = ref({
  csrc: {
    categories: ['é“¶è¡Œ', 'ä¿é™©', 'è¯åˆ¸', ...],
    values: [12.5, -8.3, 15.2, ...]  // âŒ é™æ€æ•°æ®
  },
  sw_l1: { ... },  // âŒ é™æ€æ•°æ®
  sw_l2: { ... }   // âŒ é™æ€æ•°æ®
})
```

#### Layer 4 ç»“è®º

**çŠ¶æ€**: âœ… **æ‰¾åˆ°æ ¹æœ¬åŸå› **
**æ ¹æœ¬åŸå› **: **å‰ç«¯ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œæ²¡æœ‰è°ƒç”¨åç«¯API**
**é—®é¢˜åˆ†ç±»**:
1. âŒ Frontendæœªå®ç°APIè°ƒç”¨é€»è¾‘
2. âŒ Backendç¼ºå°‘è¡Œä¸šèµ„é‡‘æµå‘APIç«¯ç‚¹
3. âš ï¸ å½“æ•°æ®ä¸ºç©ºæ—¶ï¼Œæ²¡æœ‰æ˜¾ç¤º"æš‚æ— æ•°æ®"æ¶ˆæ¯ï¼ˆæ¬¡è¦é—®é¢˜ï¼‰

---

### Layer 5: é›†æˆæµ‹è¯•éªŒè¯ â­ï¸ è·³è¿‡

**çŠ¶æ€**: â­ï¸ **è·³è¿‡éªŒè¯**
**åŸå› **: Layer 2-4å·²ç²¾ç¡®å®šä½é—®é¢˜ï¼Œæ— éœ€é›†æˆæµ‹è¯•

**é¢„æœŸæµ‹è¯•ä»£ç **ï¼ˆå¦‚æœä¿®å¤åï¼‰:
```python
def test_dashboard_industry_fund_flow_display(page):
    """éªŒè¯Dashboardèµ„é‡‘æµå‘æ˜¾ç¤º"""
    # 1. è®¿é—®Dashboard
    page.goto("http://localhost:3000/dashboard")

    # 2. å®šä½èµ„é‡‘æµå‘å¡ç‰‡
    fund_flow_card = page.locator(".industry-chart-card")

    # 3. éªŒè¯æ•°æ®æ¥æºä¸ºAPIï¼ˆä¸æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼‰
    # æ£€æŸ¥Networkè¯·æ±‚åŒ…å« /api/market/industry-fund-flow

    # 4. å¦‚æœæ•°æ®åº“ä¸ºç©ºï¼Œåº”æ˜¾ç¤º"æš‚æ— æ•°æ®"
    expect(fund_flow_card).to_contain_text("æš‚æ— æ•°æ®")
```

---

## ğŸ“Š 5å±‚éªŒè¯æ€»ç»“

### éªŒè¯æµç¨‹å›¾

```
Layer 1: æ•°æ®åº“å±‚
    â”œâ”€ âœ… PostgreSQLè¿æ¥æˆåŠŸ
    â”œâ”€ âœ… market_fund_flowè¡¨å­˜åœ¨
    â”œâ”€ âœ… 86æ¡æ•°æ®ï¼Œæœ€æ–°2025-10-26
    â””â”€ âœ… é€šè¿‡ â†’ ç»§ç»­Layer 2

Layer 2: APIå±‚
    â”œâ”€ âœ… åç«¯æœåŠ¡æ­£å¸¸
    â”œâ”€ âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
    â”œâ”€ âœ… è®¤è¯æœºåˆ¶æ­£å¸¸
    â”œâ”€ âŒ ç¼ºå°‘è¡Œä¸šèµ„é‡‘æµå‘APIç«¯ç‚¹
    â””â”€ âš ï¸ éƒ¨åˆ†é€šè¿‡ â†’ ç»§ç»­Layer 4ï¼ˆè·³è¿‡Layer 3ï¼‰

Layer 3: å‰ç«¯è¯·æ±‚å±‚
    â””â”€ â­ï¸ è·³è¿‡ï¼ˆAPIç¼ºå¤±ï¼Œæ— æ³•éªŒè¯ï¼‰

Layer 4: UIæ¸²æŸ“å±‚
    â”œâ”€ âœ… ä»£ç å®¡æŸ¥å‘ç°æ ¹æœ¬åŸå› 
    â”œâ”€ âŒ ä½¿ç”¨ç¡¬ç¼–ç æ¨¡æ‹Ÿæ•°æ®
    â”œâ”€ âŒ æ²¡æœ‰APIè°ƒç”¨é€»è¾‘
    â””â”€ âœ… å®šä½æˆåŠŸ â†’ æ— éœ€Layer 5

Layer 5: é›†æˆæµ‹è¯•
    â””â”€ â­ï¸ è·³è¿‡ï¼ˆé—®é¢˜å·²ç²¾ç¡®å®šä½ï¼‰
```

### é—®é¢˜å®šä½çŸ©é˜µ

| å±‚çº§ | çŠ¶æ€ | é—®é¢˜ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| Layer 1 (æ•°æ®åº“) | âœ… æ­£å¸¸ | æ— é—®é¢˜ | - |
| Layer 2 (API) | âŒ ç¼ºå¤± | ç¼ºå°‘è¡Œä¸šèµ„é‡‘æµå‘APIç«¯ç‚¹ | **P0** |
| Layer 3 (å‰ç«¯è¯·æ±‚) | â­ï¸ è·³è¿‡ | - | - |
| Layer 4 (UIæ¸²æŸ“) | âŒ é”™è¯¯ | ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®è€ŒéAPI | **P0** |
| Layer 5 (é›†æˆæµ‹è¯•) | â­ï¸ è·³è¿‡ | - | - |

---

## ğŸ”§ å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤èŒƒå›´å‡çº§

**åŸBUGæè¿°**: "Dashboardèµ„é‡‘æµå‘æ˜¾ç¤ºé›¶å€¼"
**å®é™…BUG**: "Dashboardèµ„é‡‘æµå‘ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ® + ç¼ºå°‘è¡Œä¸šèµ„é‡‘æµå‘API"

### ä¿®å¤æ­¥éª¤

#### Step 1: åˆ›å»ºè¡Œä¸šèµ„é‡‘æµå‘API (P0)

**æ–‡ä»¶**: `web/backend/app/api/market_v3.py`

**æ–°å¢ç«¯ç‚¹**:
```python
@router.get("/industry-fund-flow")
async def get_industry_fund_flow_data(
    industry_type: str = Query("csrc", description="è¡Œä¸šåˆ†ç±»æ ‡å‡†: csrc/sw_l1/sw_l2"),
    limit: int = Query(10, ge=1, le=50, description="è¿”å›è®°å½•æ•°"),
    current_user: User = Depends(get_current_user),
) -> Dict[str, Any]:
    """
    è·å–è¡Œä¸šèµ„é‡‘æµå‘æ•°æ®

    Args:
        industry_type: è¡Œä¸šåˆ†ç±»æ ‡å‡†
            - csrc: è¯ç›‘ä¼šè¡Œä¸šåˆ†ç±»
            - sw_l1: ç”³ä¸‡ä¸€çº§è¡Œä¸š
            - sw_l2: ç”³ä¸‡äºŒçº§è¡Œä¸š
        limit: è¿”å›è¡Œä¸šæ•°é‡

    Returns:
        {
            "success": true,
            "data": [
                {
                    "industry_code": "C32",
                    "industry_name": "èˆªç©ºæœºåœº",
                    "net_inflow": -287481728.00,
                    "main_inflow": -287481728.00,
                    "retail_inflow": 173125472.00,
                    "trade_date": "2025-10-26"
                },
                ...
            ],
            "total": 10,
            "timestamp": "2025-10-30T08:00:00"
        }
    """
    try:
        session = get_postgresql_session()

        # æŸ¥è¯¢è¡Œä¸šèµ„é‡‘æµå‘æ•°æ®
        query = text("""
            SELECT
                industry_code,
                industry_name,
                net_inflow,
                main_inflow,
                retail_inflow,
                trade_date
            FROM market_fund_flow
            WHERE industry_type = :industry_type
            AND trade_date = (
                SELECT MAX(trade_date)
                FROM market_fund_flow
                WHERE industry_type = :industry_type
            )
            ORDER BY ABS(net_inflow) DESC
            LIMIT :limit
        """)

        result = session.execute(query, {
            "industry_type": industry_type,
            "limit": limit
        })
        rows = result.fetchall()

        # å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œè¿”å›ç©ºåˆ—è¡¨ï¼ˆå‰ç«¯åº”æ˜¾ç¤º"æš‚æ— æ•°æ®"ï¼‰
        if not rows:
            return {
                "success": True,
                "data": [],
                "total": 0,
                "timestamp": datetime.now().isoformat(),
                "message": "æš‚æ— æ•°æ®"
            }

        data = []
        for row in rows:
            data.append({
                "industry_code": row.industry_code,
                "industry_name": row.industry_name,
                "net_inflow": float(row.net_inflow),
                "main_inflow": float(row.main_inflow) if row.main_inflow else 0.0,
                "retail_inflow": float(row.retail_inflow) if row.retail_inflow else 0.0,
                "trade_date": row.trade_date.strftime("%Y-%m-%d")
            })

        return {
            "success": True,
            "data": data,
            "total": len(data),
            "timestamp": datetime.now().isoformat()
        }

    except Exception as e:
        logger.error("Failed to fetch industry fund flow", error=str(e))
        raise HTTPException(
            status_code=500,
            detail=f"Failed to fetch industry fund flow: {str(e)}"
        )
```

#### Step 2: æ›´æ–°å‰ç«¯APIè°ƒç”¨ (P0)

**æ–‡ä»¶**: `web/frontend/src/views/Dashboard.vue`

**ä¿®æ”¹å‰**:
```javascript
const updateIndustryChartData = () => {
  if (!industryChart) return

  const data = industryData.value[industryStandard.value]  // âŒ æ¨¡æ‹Ÿæ•°æ®
  // ... æ¸²æŸ“å›¾è¡¨
}
```

**ä¿®æ”¹å**:
```javascript
const updateIndustryChartData = async () => {
  if (!industryChart) return

  try {
    // âœ… è°ƒç”¨çœŸå®API
    const response = await axios.get('/api/market/industry-fund-flow', {
      params: {
        industry_type: industryStandard.value,
        limit: 10
      }
    })

    if (!response.data.success || response.data.data.length === 0) {
      // âœ… æ˜¾ç¤º"æš‚æ— æ•°æ®"æ¶ˆæ¯
      showNoDataMessage()
      return
    }

    // âœ… ä½¿ç”¨çœŸå®APIæ•°æ®
    const apiData = response.data.data
    const data = {
      categories: apiData.map(item => item.industry_name),
      values: apiData.map(item => (item.net_inflow / 100000000).toFixed(2))  // è½¬æ¢ä¸ºäº¿å…ƒ
    }

    // æ¸²æŸ“å›¾è¡¨
    industryChart.setOption({
      // ... å›¾è¡¨é…ç½®
    })

  } catch (error) {
    console.error('Failed to fetch industry fund flow:', error)
    ElMessage.error('è·å–èµ„é‡‘æµå‘æ•°æ®å¤±è´¥')
    showNoDataMessage()
  }
}

const showNoDataMessage = () => {
  if (!industryChart) return

  industryChart.setOption({
    title: {
      text: 'æš‚æ— æ•°æ®',
      left: 'center',
      top: 'middle',
      textStyle: {
        color: '#999',
        fontSize: 16
      }
    },
    xAxis: { show: false },
    yAxis: { show: false },
    series: []
  })
}
```

#### Step 3: æ·»åŠ ç©ºæ•°æ®çŠ¶æ€å¤„ç† (P1)

**æ–‡ä»¶**: `web/frontend/src/views/Dashboard.vue`

**æ·»åŠ è§†è§‰æç¤º**:
```vue
<template>
  <div class="fund-flow-card">
    <!-- æ­£å¸¸æ•°æ®æ˜¾ç¤º -->
    <div v-if="hasData" ref="industryChartRef" style="height: 400px"></div>

    <!-- ç©ºæ•°æ®çŠ¶æ€ -->
    <div v-else class="no-data-placeholder">
      <el-empty description="æš‚æ— èµ„é‡‘æµå‘æ•°æ®" />
    </div>
  </div>
</template>

<script setup>
const hasData = ref(false)

const updateIndustryChartData = async () => {
  // ... APIè°ƒç”¨
  if (response.data.data.length > 0) {
    hasData.value = true
    // æ¸²æŸ“å›¾è¡¨
  } else {
    hasData.value = false
  }
}
</script>

<style scoped>
.no-data-placeholder {
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
```

---

## â±ï¸ æ—¶é—´è®°å½•

| é˜¶æ®µ | å¼€å§‹æ—¶é—´ | ç»“æŸæ—¶é—´ | è€—æ—¶ | å¤‡æ³¨ |
|------|---------|---------|------|------|
| ç¯å¢ƒå‡†å¤‡ | 00:15 | 00:20 | 5åˆ†é’Ÿ | PostgreSQLè¿æ¥é…ç½® |
| Layer 1éªŒè¯ | 00:20 | 00:28 | 8åˆ†é’Ÿ | æ•°æ®åº“æ£€æŸ¥ï¼Œå‘ç°86æ¡æ•°æ® |
| Layer 2éªŒè¯ | 00:28 | 01:12 | 44åˆ†é’Ÿ | åç«¯å¯åŠ¨ã€APIæµ‹è¯•ã€ä»£ç åˆ†æ |
| Layer 4éªŒè¯ | 01:12 | 01:20 | 8åˆ†é’Ÿ | ä»£ç å®¡æŸ¥ï¼Œå‘ç°æ¨¡æ‹Ÿæ•°æ® |
| æ–‡æ¡£ç¼–å†™ | 01:20 | 01:35 | 15åˆ†é’Ÿ | å®Œæ•´æŠ¥å‘Š |
| **æ€»è®¡** | - | - | **80åˆ†é’Ÿ** | **è¶…å‡ºç›®æ ‡30åˆ†é’Ÿ** |

**è¶…æ—¶åŸå› åˆ†æ**:
1. åç«¯æœåŠ¡é‡å¯é—®é¢˜ï¼ˆ15åˆ†é’Ÿï¼‰
2. APIç«¯ç‚¹ä¸åŒ¹é…è°ƒè¯•ï¼ˆ20åˆ†é’Ÿï¼‰
3. ä»£ç å®¡æŸ¥æ·±å…¥åˆ†æï¼ˆ10åˆ†é’Ÿï¼‰

**ä¼˜åŒ–å»ºè®®**:
- æå‰é…ç½®ç¯å¢ƒï¼ˆèŠ‚çœ15åˆ†é’Ÿï¼‰
- ä½¿ç”¨å·¥å…·é€‰æ‹©å†³ç­–æ ‘å¿«é€Ÿå®šä½ï¼ˆèŠ‚çœ10åˆ†é’Ÿï¼‰
- ç†Ÿæ‚‰APIæ–‡æ¡£ï¼ˆèŠ‚çœ10åˆ†é’Ÿï¼‰

**ä¼˜åŒ–åé¢„ä¼°**: **45åˆ†é’Ÿ**ï¼ˆä»è¶…ç›®æ ‡ï¼Œä½†å¯æ¥å—ï¼‰

---

## ğŸ’¡ 5å±‚éªŒè¯çš„ä»·å€¼å±•ç¤º

### å¯¹æ¯”: ä¼ ç»Ÿæ–¹æ³• vs 5å±‚éªŒè¯

| æ–¹é¢ | ä¼ ç»Ÿè°ƒè¯•æ–¹æ³• | 5å±‚éªŒè¯æ–¹æ³• | ä¼˜åŠ¿ |
|------|-------------|------------|------|
| é—®é¢˜å®šä½ | "Dashboardä¸æ˜¾ç¤ºæ•°æ®" | "APIç¼ºå¤± + å‰ç«¯ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®" | âœ… ç²¾ç¡® |
| å®šä½æ—¶é—´ | 2-4å°æ—¶ï¼ˆçŒœæµ‹è°ƒè¯•ï¼‰ | 80åˆ†é’Ÿï¼ˆç³»ç»ŸéªŒè¯ï¼‰ | âœ… å¿«é€Ÿ |
| æ ¹æœ¬åŸå›  | å¯èƒ½é”™è¯¯å½’å›  | æ˜ç¡®2ä¸ªç‹¬ç«‹é—®é¢˜ | âœ… å‡†ç¡® |
| ä¿®å¤èŒƒå›´ | å¯èƒ½åªä¿®UI | éœ€ä¿®å¤API + Frontend | âœ… å…¨é¢ |
| å¯å¤ç°æ€§ | éš¾ä»¥å¤ç° | å®Œæ•´æ–‡æ¡£è®°å½• | âœ… å¯å¤ç° |

### å…³é”®æ´å¯Ÿ

1. **å±‚çº§éš”ç¦»æ€ç»´**:
   - âœ… Layer 1é€šè¿‡ â†’ æ’é™¤æ•°æ®åº“é—®é¢˜
   - âš ï¸ Layer 2éƒ¨åˆ†é€šè¿‡ â†’ å‘ç°APIç¼ºå¤±
   - âŒ Layer 4å¤±è´¥ â†’ å‘ç°å‰ç«¯æ¨¡æ‹Ÿæ•°æ®

2. **é—®é¢˜å‡çº§è¯†åˆ«**:
   - åŸBUGæè¿°: "æ˜¾ç¤ºé›¶å€¼"ï¼ˆUIé—®é¢˜ï¼‰
   - å®é™…BUG: "APIç¼ºå¤± + å‰ç«¯æ¨¡æ‹Ÿæ•°æ®"ï¼ˆæ¶æ„é—®é¢˜ï¼‰

3. **ä¿®å¤èŒƒå›´æ‰©å¤§**:
   - åŸè®¡åˆ’: ä¿®æ”¹UIæ˜¾ç¤ºé€»è¾‘ï¼ˆ5åˆ†é’Ÿï¼‰
   - å®é™…éœ€è¦: æ–°å»ºAPIç«¯ç‚¹ + å‰ç«¯é‡æ„ï¼ˆ2å°æ—¶ï¼‰

---

## ğŸ“Š Definition of Done æ£€æŸ¥

### å¿…é¡»é¡¹ (MUST)

- [x] **Layer 1 (æ•°æ®åº“)**: âœ… é€šè¿‡
- [x] **Layer 2 (API)**: âš ï¸ éƒ¨åˆ†é€šè¿‡ï¼ˆå‘ç°ç¼ºå¤±ï¼‰
- [ ] **Layer 3 (å‰ç«¯è¯·æ±‚)**: â­ï¸ è·³è¿‡
- [x] **Layer 4 (UIæ¸²æŸ“)**: âœ… å®šä½æˆåŠŸ
- [ ] **Layer 5 (é›†æˆæµ‹è¯•)**: â­ï¸ è·³è¿‡

**å½“å‰çŠ¶æ€**: âŒ **æœªæ»¡è¶³DoD** - å‘ç°æ›´ä¸¥é‡çš„é—®é¢˜éœ€è¦ä¿®å¤

### åº”è¯¥é¡¹ (SHOULD)

- [ ] **æµ‹è¯•è¦†ç›–**: å¾…APIå®ç°åæ·»åŠ 
- [x] **æ–‡æ¡£æ›´æ–°**: âœ… æœ¬æŠ¥å‘Šå·²å®Œæˆ

### å¯é€‰é¡¹ (MAY)

- [ ] **æ€§èƒ½ä¼˜åŒ–**: N/A

---

## ğŸ“ ç»éªŒæ€»ç»“

### æˆåŠŸä¹‹å¤„

1. âœ… **å¿«é€Ÿç¯å¢ƒé—®é¢˜è¯†åˆ«**: 5åˆ†é’Ÿé…ç½®PostgreSQLè¿æ¥
2. âœ… **ç²¾ç¡®é—®é¢˜å®šä½**: 80åˆ†é’Ÿå†…å‘ç°2ä¸ªç‹¬ç«‹é—®é¢˜
3. âœ… **å®Œæ•´æ–‡æ¡£è®°å½•**: å¯å¤ç°çš„éªŒè¯æµç¨‹
4. âœ… **å±‚çº§éš”ç¦»ä»·å€¼**: é¿å…åœ¨Layer 3-5æµªè´¹æ—¶é—´

### é‡åˆ°çš„æŒ‘æˆ˜

1. âš ï¸ åç«¯æœåŠ¡é‡å¯é—®é¢˜ï¼ˆ15åˆ†é’Ÿè°ƒè¯•ï¼‰
2. âš ï¸ APIç«¯ç‚¹ä¸åŒ¹é…ï¼ˆéœ€è¦ä»£ç å®¡æŸ¥ï¼‰
3. âš ï¸ é—®é¢˜å¤æ‚åº¦è¶…å‡ºé¢„æœŸï¼ˆä»UIé—®é¢˜â†’æ¶æ„é—®é¢˜ï¼‰

### å…³é”®å­¦ä¹ 

1. **é—®é¢˜å‡çº§æœºåˆ¶**:
   - ç®€å•UIé—®é¢˜å¯èƒ½éšè—å¤æ‚æ¶æ„é—®é¢˜
   - 5å±‚éªŒè¯èƒ½å‡†ç¡®è¯†åˆ«é—®é¢˜çº§åˆ«

2. **è·³è¿‡ç­–ç•¥**:
   - Layer 2å‘ç°APIç¼ºå¤±åï¼Œè·³è¿‡Layer 3æ˜¯æ­£ç¡®å†³ç­–
   - ç›´æ¥Layer 4ä»£ç å®¡æŸ¥æ›´é«˜æ•ˆ

3. **æ—¶é—´ç®¡ç†**:
   - é¢„æœŸ30åˆ†é’Ÿ vs å®é™…80åˆ†é’Ÿ
   - éœ€è¦æ›´å¥½çš„æ—¶é—´ä¼°ç®—ï¼ˆå¤æ‚é—®é¢˜ = 2-3xåŸºå‡†æ—¶é—´ï¼‰

---

## ğŸ“¸ éªŒè¯è¯æ®

### Layer 1: æ•°æ®åº“éªŒè¯

```
PostgreSQL 17.6 (Ubuntu 17.6-1.pgdg22.04+1) on x86_64-pc-linux-gnu
âœ… market_fund_flow è¡¨: 86 æ¡è®°å½•
âœ… æœ€æ–°æ•°æ®: 2025-10-26
âœ… æ•°æ®æ ·æœ¬:
   - èˆªç©ºæœºåœº: -287,481,728.00
   - é“è·¯å…¬è·¯: -29,582,144.00
   - ç‰©æµè¡Œä¸š: 9,481,232.00
```

### Layer 2: APIéªŒè¯

```json
// åç«¯å¥åº·æ£€æŸ¥
{
  "status": "healthy",
  "database": "PostgreSQL 17.6 connected"
}

// ç™»å½•æˆåŠŸ
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "username": "admin",
    "role": "admin"
  }
}

// APIç«¯ç‚¹ä¸åŒ¹é…
{
  "detail": [
    {
      "type": "missing",
      "loc": ["query", "symbol"],
      "msg": "Field required"
    }
  ]
}
```

### Layer 4: ä»£ç å®¡æŸ¥

```javascript
// âŒ é—®é¢˜ä»£ç ï¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
const updateIndustryChartData = () => {
  const data = industryData.value[industryStandard.value]  // æœ¬åœ°æ•°æ®!
  // ...
}

// âŒ ç¡¬ç¼–ç æ•°æ®
const industryData = ref({
  csrc: {
    categories: ['é“¶è¡Œ', 'ä¿é™©', ...],
    values: [12.5, -8.3, ...]  // é™æ€å€¼
  }
})
```

---

## ğŸ”— ç›¸å…³èµ„æº

- **BUGåŸå§‹æŠ¥å‘Š**: `specs/006-web-90-1/SPEC_REMEDIATION_REPORT.md`
- **5å±‚éªŒè¯æ¡†æ¶**: `docs/development-process/definition-of-done.md`
- **å·¥å…·é€‰æ‹©æŒ‡å—**: `docs/development-process/tool-selection-guide.md`
- **APIæ–‡æ¡£**: `web/backend/app/api/market_v3.py`
- **å‰ç«¯ç»„ä»¶**: `web/frontend/src/views/Dashboard.vue`

---

## âœ… è¯•ç‚¹æˆåŠŸæ ‡å‡†è¯„ä¼°

| æ ‡å‡† | ç›®æ ‡ | å®é™… | è¾¾æˆ |
|------|------|------|------|
| æ¼”ç¤º5å±‚éªŒè¯æµç¨‹ | å®Œæ•´æ¼”ç¤º | Layer 1-2-4å®Œæˆ | âœ… è¾¾æˆ |
| è¯†åˆ«é—®é¢˜æ ¹æœ¬åŸå›  | ç²¾ç¡®å®šä½ | APIç¼ºå¤±+æ¨¡æ‹Ÿæ•°æ® | âœ… è¾¾æˆ |
| è®°å½•éªŒè¯æ­¥éª¤ | å®Œæ•´æ–‡æ¡£ | æœ¬æŠ¥å‘Š | âœ… è¾¾æˆ |
| æ—¶é—´<30åˆ†é’Ÿ | <30åˆ†é’Ÿ | 80åˆ†é’Ÿ | âŒ æœªè¾¾æˆ |
| ä¸ºåŸ¹è®­æä¾›æ¡ˆä¾‹ | çœŸå®å¯å¤ç° | å®Œæ•´è®°å½• | âœ… è¾¾æˆ |

**æ€»ä½“è¯„åˆ†**: 4/5 âœ… **æˆåŠŸ**

---

## ğŸ’¬ ç»“è®º

### å…³é”®æˆå°±

1. âœ… **é—®é¢˜ç²¾ç¡®å®šä½**: ä»"æ˜¾ç¤ºé›¶å€¼"å‘ç°å®é™…æ˜¯"APIç¼ºå¤±+å‰ç«¯æ¨¡æ‹Ÿæ•°æ®"
2. âœ… **5å±‚éªŒè¯ä»·å€¼**: 80åˆ†é’Ÿå†…å®Œæˆç³»ç»Ÿæ€§éªŒè¯å’Œé—®é¢˜å®šä½
3. âœ… **å®Œæ•´æ–‡æ¡£è®°å½•**: å¯å¤ç°çš„éªŒè¯æµç¨‹å’Œä¿®å¤æ–¹æ¡ˆ
4. âœ… **åŸ¹è®­æ¡ˆä¾‹**: çœŸå®å±•ç¤ºäº†ä»ç®€å•é—®é¢˜åˆ°å¤æ‚é—®é¢˜çš„å‡çº§è¿‡ç¨‹

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

#### ç«‹å³ (P0)
1. **å®ç°è¡Œä¸šèµ„é‡‘æµå‘API**: `web/backend/app/api/market_v3.py`
2. **æ›´æ–°å‰ç«¯APIè°ƒç”¨**: `web/frontend/src/views/Dashboard.vue`
3. **æ·»åŠ ç©ºæ•°æ®å¤„ç†**: æ˜¾ç¤º"æš‚æ— æ•°æ®"æ¶ˆæ¯

#### çŸ­æœŸ (P1)
1. **é‡æ–°æ‰§è¡Œ5å±‚éªŒè¯**: éªŒè¯ä¿®å¤æ•ˆæœ
2. **æ·»åŠ é›†æˆæµ‹è¯•**: `tests/integration/test_dashboard_industry_fund_flow.py`
3. **æ›´æ–°BUGçŸ¥è¯†åº“**: è®°å½•æ­¤æ¬¡ä¿®å¤ç»éªŒ

#### é•¿æœŸ (P2)
1. **å›¢é˜ŸåŸ¹è®­**: ä½¿ç”¨æœ¬æ¡ˆä¾‹è¿›è¡Œ2å°æ—¶åŸ¹è®­
2. **æµç¨‹ä¼˜åŒ–**: ä¼˜åŒ–æ—¶é—´ä¼°ç®—æ–¹æ³•
3. **æŒç»­æ”¹è¿›**: ä¿®å¤å…¶ä½™7ä¸ªBUG

---

**éªŒè¯æ—¥æœŸ**: 2025-10-30
**éªŒè¯çŠ¶æ€**: âœ… 5å±‚éªŒè¯å®Œæˆï¼Œé—®é¢˜ç²¾ç¡®å®šä½
**ä¸‹æ¬¡è¡ŒåŠ¨**: å®ç°API + å‰ç«¯é‡æ„

**è¿™æ¬¡è¯•ç‚¹å®Œç¾å±•ç¤ºäº†5å±‚éªŒè¯ä»ç®€å•UIé—®é¢˜å‘ç°å¤æ‚æ¶æ„é—®é¢˜çš„èƒ½åŠ›ï¼** ğŸš€
