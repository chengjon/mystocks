[pytest]
# 测试配置文件 - 2026-01-07 更新
# 配置 PYTHONPATH 解决 src 模块导入问题

# 项目根目录添加到 Python 路径
pythonpath = .

# 测试文件搜索路径（包含两个测试目录）
testpaths = tests web/backend/tests

# 测试文件匹配模式
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# pytest 命令行选项
addopts =
    -v
    --tb=short
    --strict-markers
    --strict-config
    # 并行执行配置（根据CPU核心数自动调整）
    -n auto
    --maxfail=5
    --disable-warnings
    # 覆盖率配置（同时覆盖src/和web/backend/app/）
    --cov=src --cov=web/backend/app
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-report=json:coverage.json
    --cov-fail-under=30
    # 排除测试目录和缓存
    --cov-context=test
    -p no:warnings

# pytest-asyncio配置
asyncio_mode = auto

# 测试标记
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    network: marks tests requiring network access
    gpu: marks tests requiring GPU support
    file_test: marks tests as file-level API tests
    contract_test: marks tests as contract validation tests
    esm: marks tests related to ESM module compatibility
    frontend: marks tests as frontend-related tests
    playwright: marks tests using Playwright browser automation
    health_check: marks tests as service health validation tests

# 警告过滤
filterwarnings =
    ignore::DeprecationWarning
    ignore::UserWarning
    ignore::pytest.PytestCollectionWarning

# 指定最小Python版本
minversion = 3.12
