# MyStocks Phase 3 - Bloomberg Terminal é£æ ¼ç»Ÿä¸€åŒ–æµ‹è¯•æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
2. [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
3. [æµ‹è¯•æ‰§è¡Œå‘½ä»¤](#æµ‹è¯•æ‰§è¡Œå‘½ä»¤)
4. [å¤±è´¥æ’æŸ¥](#å¤±è´¥æ’æŸ¥)
5. [ç»“æœè§£è¯»](#ç»“æœè§£è¯»)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç¯å¢ƒå‡†å¤‡

### 1. ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows (WSL2)
- **Node.js**: 16.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm**: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **PM2**: 5.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **æµè§ˆå™¨**: Chromium 90+, Firefox 88+, Safari 14+ï¼ˆç”¨äº Playwrightï¼‰

### 2. å®‰è£…ä¾èµ–

```bash
# è¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½•
cd /opt/claude/mystocks_spec/web/frontend

# å®‰è£…é¡¹ç›®ä¾èµ–ï¼ˆåŒ…å« Playwrightï¼‰
npm install

# å®‰è£… PM2ï¼ˆå…¨å±€ï¼‰
npm install -g pm2

# å®‰è£… serveï¼ˆç”¨äºç”Ÿäº§æ„å»ºæœåŠ¡ï¼‰
npm install -g serve

# éªŒè¯å®‰è£…
node --version   # >= 16.0.0
npm --version    # >= 8.0.0
pm2 --version    # >= 5.0.0
```

### 3. é¦–æ¬¡è¿è¡Œ Playwright

```bash
# å®‰è£… Playwright æµè§ˆå™¨é©±åŠ¨
npx playwright install

# éªŒè¯æµè§ˆå™¨å®‰è£…
npx playwright --version
```

---

## éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 2. å¯åŠ¨ PM2 æœåŠ¡
./start.sh

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 list

# 4. æŸ¥çœ‹æ—¥å¿—
pm2 logs mystocks-frontend --lines 50
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. æ„å»ºé¡¹ç›®
npm run build

# 2. åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# 3. ä½¿ç”¨ serve å¯åŠ¨ç”Ÿäº§æ„å»ºï¼ˆPM2 ç®¡ç†ï¼‰
pm2 start ecosystem.config.js --env production

# 4. ä¿å­˜ PM2 è¿›ç¨‹åˆ—è¡¨
pm2 save

# 5. éªŒè¯æœåŠ¡è¿è¡Œ
curl http://localhost:8080
```

### 3. éªŒè¯éƒ¨ç½²æˆåŠŸ

```bash
# æ£€æŸ¥ PM2 è¿›ç¨‹çŠ¶æ€ï¼ˆåº”ä¸º onlineï¼‰
npm run pm2:status

# æ£€æŸ¥ç«¯å£ç›‘å¬ï¼ˆåº”æ˜¾ç¤º PM2 è¿›ç¨‹ PIDï¼‰
lsof -i :8080

# æ£€æŸ¥æœåŠ¡å“åº”
curl -I http://localhost:8080

# åº”è¿”å›ï¼š
# HTTP/1.1 200 OK
# Content-Type: text/html
```

---

## æµ‹è¯•æ‰§è¡Œå‘½ä»¤

### å¿«é€Ÿæµ‹è¯•ï¼ˆå…¨é‡æµ‹è¯•ï¼‰

```bash
# è¿è¡Œæ‰€æœ‰ Phase 3 æµ‹è¯•
npm run test:phase3

# ç­‰ä»·å‘½ä»¤ï¼š
playwright test pm2-deployment.test.ts design-token.test.ts bloomberg-style.test.ts stock-colors.test.ts mobile-cleanup.test.ts
```

### åˆ†ç±»æµ‹è¯•

```bash
# PM2 éƒ¨ç½²éªŒè¯æµ‹è¯•
npm run test:pm2

# Design Token ç³»ç»ŸéªŒè¯æµ‹è¯•
npm run test:design-token

# Bloomberg é£æ ¼åˆè§„æµ‹è¯•
npm run test:bloomberg

# ä¸­å›½è‚¡å¸‚é¢œè‰²é€‚é…æµ‹è¯•
npm run test:stock-colors

# ç§»åŠ¨ç«¯ä»£ç æ¸…ç†éªŒè¯æµ‹è¯•
npm run test:mobile-cleanup
```

### æŒ‰æµè§ˆå™¨æµ‹è¯•

```bash
# ä»… Chromium æµ‹è¯•
npm run test:e2e:chromium

# ä»… Firefox æµ‹è¯•
npm run test:e2e:firefox

# ä»… WebKit (Safari) æµ‹è¯•
npm run test:e2e:webkit

# æ‰€æœ‰æµè§ˆå™¨
npm run test:e2e
```

### äº¤äº’å¼æµ‹è¯•

```bash
# UI æ¨¡å¼ï¼ˆå¸¦ç•Œé¢ï¼‰
npm run test:e2e:ui

# è°ƒè¯•æ¨¡å¼ï¼ˆé€æ­¥æ‰§è¡Œï¼‰
npm run test:e2e:debug
```

### æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

```bash
# ç”Ÿæˆ HTML æŠ¥å‘Šï¼ˆæµ‹è¯•å®Œæˆåè‡ªåŠ¨ç”Ÿæˆï¼‰
npm run test:phase3

# æŸ¥çœ‹æŠ¥å‘Š
open playwright-report/index.html  # macOS
xdg-open playwright-report/index.html  # Linux
start playwright-report/index.html  # Windows
```

---

## å¤±è´¥æ’æŸ¥

### åœºæ™¯ 1: PM2 å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: è¿è¡Œ `./start.sh` ååº”ç”¨æ— æ³•å¯åŠ¨

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version  # åº” >= 16.x

# 2. æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la dist/
# åº”åŒ…å« index.html å’Œ assets ç›®å½•

# 3. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080
# å¦‚æœè¢«å ç”¨ï¼Œæ‰¾å‡ºå ç”¨è¿›ç¨‹å¹¶ç»ˆæ­¢

# 4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
pm2 logs mystocks-frontend --lines 100 --err

# 5. å°è¯•æ‰‹åŠ¨å¯åŠ¨ï¼ˆç»•è¿‡ PM2ï¼‰
cd dist && python3 -m http.server 8080
# è®¿é—® http://localhost:8080 éªŒè¯
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# ç«¯å£è¢«å ç”¨æ—¶ï¼Œç»ˆæ­¢å ç”¨è¿›ç¨‹
PID=$(lsof -t -i:8080)
kill -9 $PID

# é‡æ–°å¯åŠ¨
./stop.sh && ./start.sh
```

### åœºæ™¯ 2: SCSS ç¼–è¯‘é”™è¯¯

**ç—‡çŠ¶**: é¡µé¢æ ·å¼æœªåŠ è½½ï¼Œæ—¥å¿—ä¸­æœ‰ `sass-loader` é”™è¯¯

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
pm2 logs mystocks-frontend --err | grep -i scss

# 2. æ£€æŸ¥ theme-tokens.scss æ–‡ä»¶
ls -la src/styles/theme-tokens.scss

# 3. éªŒè¯ SCSS å˜é‡è¯­æ³•
cat src/styles/theme-tokens.scss | head -20

# 4. æ£€æŸ¥æ˜¯å¦ç¼ºå°‘ä¾èµ–
npm list sass
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# é‡æ–°æ„å»º
npm run build

# é‡å¯ PM2
./stop.sh && ./start.sh
```

### åœºæ™¯ 3: Design Token æœªåŠ è½½

**ç—‡çŠ¶**: æµ‹è¯•å¤±è´¥ï¼Œæç¤º CSS å˜é‡æœªå®šä¹‰

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ theme-tokens.scss æ˜¯å¦å­˜åœ¨
cat src/styles/theme-tokens.scss | grep "color-accent"

# 2. æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ­£ç¡®å¯¼å…¥
grep -r "@import.*theme-tokens" src/

# 3. åœ¨æµè§ˆå™¨ä¸­æ£€æŸ¥ CSS å˜é‡
# æ‰“å¼€ http://localhost:8080
# åœ¨å¼€å‘è€…å·¥å…· Console ä¸­è¿è¡Œï¼š
getComputedStyle(document.body).getPropertyValue('--color-accent')
# åº”è¿”å›: #D4AF37 æˆ– rgb(212, 175, 55)
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥ç»„ä»¶æ ·å¼å¯¼å…¥
grep -A2 "<style" src/views/Dashboard.vue | grep "@import"

# å¦‚æœç¼ºå¤±ï¼Œæ·»åŠ ï¼š
# @import '@/styles/theme-tokens.scss';

# é‡æ–°æ„å»ºå’Œéƒ¨ç½²
npm run build && ./stop.sh && ./start.sh
```

### åœºæ™¯ 4: è§†è§‰å¯¹æ¯”æµ‹è¯•å¤±è´¥

**ç—‡çŠ¶**: æˆªå›¾å¯¹æ¯”å·®å¼‚è¶…è¿‡é˜ˆå€¼

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æŸ¥çœ‹å¤±è´¥æˆªå›¾
ls -la test-results/

# 2. æ£€æŸ¥ Playwright æˆªå›¾ç›®å½•
ls -la tests/screenshots/

# 3. æ›´æ–°åŸºå‡†æˆªå›¾ï¼ˆå¦‚æœæ ·å¼å˜æ›´åˆç†ï¼‰
npx playwright test --update-snapshots

# 4. æ£€æŸ¥æµè§ˆå™¨ç¼©æ”¾
# ç¡®ä¿æµè§ˆå™¨ç¼©æ”¾ä¸º 100%
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# å¦‚æœæ ·å¼å˜æ›´ç¬¦åˆé¢„æœŸï¼Œæ›´æ–°åŸºå‡†æˆªå›¾
npx playwright test --update-snapshots

# å¦‚æœæ˜¯çœŸå®é—®é¢˜ï¼Œæ£€æŸ¥æ ·å¼
npm run build && ./stop.sh && ./start.sh
```

### åœºæ™¯ 5: ECharts æ¸²æŸ“å¤±è´¥

**ç—‡çŠ¶**: ChartContainer æµ‹è¯•å¤±è´¥ï¼Œå›¾è¡¨æ— æ³•æ˜¾ç¤º

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ ECharts æ˜¯å¦åŠ è½½
curl http://localhost:8080 | grep "echarts"

# 2. åœ¨æµè§ˆå™¨ Console ä¸­æ£€æŸ¥
# æ‰“å¼€ http://localhost:8080/market
# Console: window.echarts
# åº”è¿”å› ECharts å¯¹è±¡ï¼Œè€Œé undefined

# 3. æ£€æŸ¥å›¾è¡¨é…ç½®
# Console: document.querySelector('.chart-container')
# åº”æ‰¾åˆ°å›¾è¡¨å®¹å™¨å…ƒç´ 
```

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥ ECharts ä¾èµ–
npm list echarts

# å¦‚æœç¼ºå¤±ï¼Œé‡æ–°å®‰è£…
npm install echarts@^5.5.0

# é‡æ–°æ„å»º
npm run build
```

---

## ç»“æœè§£è¯»

### PM2 éƒ¨ç½²éªŒè¯æµ‹è¯•

**æˆåŠŸæ ‡å¿—**:
```
âœ“ ecosystem.config.js should exist
âœ“ PM2 process should be online
âœ“ Application should respond to HTTP requests
âœ“ No SCSS compilation errors in logs
```

**å¤±è´¥æ ‡å¿—**:
```
âœ— PM2 process is not online
âœ— Port 8080 is occupied by another process
âœ— SCSS compilation error in logs
```

### Design Token ç³»ç»Ÿæµ‹è¯•

**æˆåŠŸæ ‡å¿—**:
```
âœ“ --color-accept should be defined and accessible
âœ“ Should not have old system colors (#409eff)
âœ“ Spacing should follow 8px grid system
âœ“ Font family should be Inter
```

**å¤±è´¥æ ‡å¿—**:
```
âœ— Design Token --color-accent is not defined
âœ— Found old system color #409eff in element
âœ— Padding 15px does not follow 8px grid
âœ— Font family is not Inter
```

### Bloomberg é£æ ¼åˆè§„æµ‹è¯•

**æˆåŠŸæ ‡å¿—**:
```
âœ“ Should use gold color (#D4AF37) for accents
âœ“ Background should be dark (#1A1A1A)
âœ“ Contrast ratio should meet WCAG AA (>= 4.5:1)
âœ“ Border radius should be minimal (0-8px)
```

**å¤±è´¥æ ‡å¿—**:
```
âœ— Element uses blue color instead of gold
âœ— Element has light background (> 200 RGB)
âœ— Contrast ratio 3.2:1 is below WCAG AA
âœ— Button has large border-radius (12px)
```

### ä¸­å›½è‚¡å¸‚é¢œè‰²æµ‹è¯•

**æˆåŠŸæ ‡å¿—**:
```
âœ“ --color-stock-down should be red (#EB4436)
âœ“ --color-stock-up should be green (#10B981)
âœ“ Positive change should display in red
âœ“ Negative change should display in green
```

**å¤±è´¥æ ‡å¿—**:
```
âœ— Stock down token is not red
âœ— Stock up token is not green
âœ— Positive change shows in green (Western style - WRONG)
âœ— Negative change shows in red (Western style - WRONG)
```

### ç§»åŠ¨ç«¯ä»£ç æ¸…ç†æµ‹è¯•

**æˆåŠŸæ ‡å¿—**:
```
âœ“ Should not have mobile @media queries
âœ“ Should not use el-col-xs or el-col-sm
âœ“ Layout should remain desktop-style at 375px
âœ“ Font sizes should not change between desktop/mobile
```

**å¤±è´¥æ ‡å¿—**:
```
âœ— Found @media (max-width: 768px) in styles
âœ— Found el-col-xs component (mobile)
âœ“ Layout collapses to single column at mobile viewport
âœ— Font size scales down at mobile viewport
```

---

## å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•æ—¶æç¤º "Cannot find module '@/styles/theme-tokens.scss'"

**åŸå› **: TypeScript è·¯å¾„åˆ«åæœªæ­£ç¡®é…ç½®

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ£€æŸ¥ vite.config.js ä¸­çš„åˆ«åé…ç½®
grep -A5 "resolve:" vite.config.js | grep "@"

# ç¡®ä¿æœ‰é…ç½®ï¼š
# resolve: {
#   alias: {
#     '@': path.resolve(__dirname, 'src')
#   }
# }
```

### Q2: Playwright æ— æ³•è¿æ¥åˆ° localhost:8080

**åŸå› **: PM2 æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ£€æŸ¥ PM2 æœåŠ¡
pm2 list

# 2. å¦‚æœæœªå¯åŠ¨ï¼Œå¯åŠ¨æœåŠ¡
./start.sh

# 3. å¦‚æœç«¯å£é”™è¯¯ï¼Œä¿®æ”¹é…ç½®
vim ecosystem.config.js
# ä¿®æ”¹ port: 8080 ä¸ºå…¶ä»–ç«¯å£

# 4. æ›´æ–° Playwright é…ç½®ä¸­çš„ BASE_URL
export BASE_URL=http://localhost:3000
npm run test:phase3
```

### Q3: è§†è§‰å¯¹æ¯”æµ‹è¯•é¢‘ç¹å¤±è´¥

**åŸå› **: æµè§ˆå™¨æ¸²æŸ“å·®å¼‚ã€å­—ä½“åŠ è½½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. ä½¿ç”¨å•ä¸€æµè§ˆå™¨æµ‹è¯•
npm run test:e2e:chromium

# 2. è°ƒæ•´æˆªå›¾é˜ˆå€¼
# ç¼–è¾‘ playwright.config.ts:
# threshold: 0.01,  # ä» 0.001 è°ƒæ•´ä¸º 0.01 (1%)

# 3. ç­‰å¾…å­—ä½“åŠ è½½
# åœ¨æµ‹è¯•ä¸­æ·»åŠ :
# await page.waitForLoadState('networkidle');
# await page.waitForTimeout(1000);
```

### Q4: æµ‹è¯•è¶…æ—¶

**åŸå› **: é¡µé¢åŠ è½½æ…¢ã€API è¯·æ±‚é˜»å¡

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´
# ç¼–è¾‘ playwright.config.ts:
# timeout: 60 * 1000,  # ä» 30s å¢åŠ åˆ° 60s

# 2. ä½¿ç”¨ mock æ•°æ®
npm run dev:mock

# 3. è·³è¿‡ç½‘ç»œç­‰å¾…
# åœ¨æµ‹è¯•ä¸­ä½¿ç”¨:
# await page.goto('/', { waitUntil: 'domcontentloaded' });
```

### Q5: PM2 æ—¥å¿—æ–‡ä»¶è¿‡å¤§

**åŸå› **: æ—¥å¿—æœªè½®è½¬ï¼Œé•¿æœŸç§¯ç´¯

**è§£å†³æ–¹æ¡ˆ**:

```bash
# 1. æ¸…ç©ºæ—§æ—¥å¿—
> logs/pm2-out.log
> logs/pm2-error.log

# 2. é…ç½® PM2 æ—¥å¿—è½®è½¬
# ç¼–è¾‘ ecosystem.config.js:
# log_date_format: 'YYYY-MM-DD',
# error_file: './logs/pm2-error-<DATE>.log',

# 3. å®šæœŸæ¸…ç†æ—¥å¿—ï¼ˆcronï¼‰
# 0 0 * * * find /opt/claude/mystocks_spec/web/frontend/logs -name "*.log" -mtime +7 -delete
```

---

## é™„å½•ï¼šå¿«é€Ÿå‚è€ƒå‘½ä»¤

### PM2 ç®¡ç†å‘½ä»¤

```bash
# å¯åŠ¨
./start.sh

# åœæ­¢
./stop.sh

# é‡å¯
./stop.sh && ./start.sh
# æˆ–
pm2 reload mystocks-frontend

# æŸ¥çœ‹çŠ¶æ€
pm2 list
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs mystocks-frontend
pm2 logs mystocks-frontend --lines 100
pm2 logs mystocks-frontend --err

# æ¸…ç©ºæ—¥å¿—
pm2 flush
pm2 reloadLogs
```

### Playwright æµ‹è¯•å‘½ä»¤

```bash
# å…¨é‡æµ‹è¯•
npm run test:phase3

# å•ä¸ªæµ‹è¯•æ–‡ä»¶
npx playwright test pm2-deployment.test.ts

# å•ä¸ªæµ‹è¯•ç”¨ä¾‹
npx playwright test pm2-deployment.test.ts -g "should have application running"

# è°ƒè¯•æ¨¡å¼
npx playwright test --debug

# ç”ŸæˆæŠ¥å‘Š
npx playwright test --reporter=html

# æ›´æ–°æˆªå›¾
npx playwright test --update-snapshots
```

### ç¯å¢ƒéªŒè¯å‘½ä»¤

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version

# æ£€æŸ¥ä¾èµ–å®‰è£…
npm list @playwright/test
npm list pm2
npm list serve

# éªŒè¯æµè§ˆå™¨é©±åŠ¨
npx playwright --version
npx playwright install --dry-run

# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la dist/
ls -la dist/index.html
```

---

## è”ç³»ä¸æ”¯æŒ

### æµ‹è¯•æ¡†æ¶é—®é¢˜

- Playwright æ–‡æ¡£: https://playwright.dev/
- PM2 æ–‡æ¡£: https://pm2.keymetrics.io/

### MyStocks é¡¹ç›®é—®é¢˜

- GitHub Issues: https://github.com/your-org/mystocks/issues
- é¡¹ç›®æ–‡æ¡£: `/opt/claude/mystocks_spec/docs/`

### æµ‹è¯•å¤±è´¥åˆ†æ

æµ‹è¯•å¤±è´¥æ—¶ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. æµ‹è¯•æ–‡ä»¶å’Œç”¨ä¾‹åç§°
2. å¤±è´¥æ—¥å¿—ï¼ˆ`playwright-report/index.html`ï¼‰
3. PM2 æ—¥å¿—ï¼ˆ`logs/pm2-error.log`ï¼‰
4. æµè§ˆå™¨æ§åˆ¶å°æˆªå›¾ï¼ˆå¦‚é€‚ç”¨ï¼‰
5. æ„å»ºç¯å¢ƒä¿¡æ¯ï¼ˆNode.js ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-10
**é€‚ç”¨ç‰ˆæœ¬**: MyStocks Phase 3 - Bloomberg Terminal Style Unification
