# MyStocks ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶

## æ¦‚è¿°

æœ¬æµ‹è¯•å¥—ä»¶åŸºäº Playwright å®ç°å®Œæ•´çš„ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä¸“é—¨é’ˆå¯¹åŸºäº PM2 è¿è¡Œçš„ MyStocks Web æœåŠ¡è¿›è¡Œå…¨é¢éªŒè¯ã€‚ä¸¥æ ¼æŒ‰ç…§æ‚¨çš„è¦æ±‚å®ç°ï¼Œä¸ä»¥ç®€å•çš„ HTTP çŠ¶æ€ç ä½œä¸ºé€šè¿‡ä¾æ®ï¼Œè€Œæ˜¯è¿›è¡Œå…¨é“¾è·¯çš„æ¸²æŸ“ã€å…ƒç´ ã€æ•°æ®ã€äº¤äº’æ ¡éªŒã€‚

## æµ‹è¯•è¦†ç›–èŒƒå›´

### Phase 1: å‰ç½®æ ¡éªŒ (Preflight Checks)
- âœ… PM2 è¿›ç¨‹çŠ¶æ€éªŒè¯ï¼ˆå‰ç«¯/åç«¯æœåŠ¡ï¼‰
- âœ… ç«¯å£è¿é€šæ€§æ£€æŸ¥ï¼ˆ3001/8000ï¼‰
- âœ… HTTP å“åº”çŠ¶æ€éªŒè¯
- âœ… å‰ç«¯ HTML å†…å®¹å®Œæ•´æ€§éªŒè¯

### Phase 2: é¡µé¢åŠ è½½å®Œæ•´æ€§ (Page Load Integrity)
- âœ… DOM å…ƒç´ å­˜åœ¨æ€§éªŒè¯ï¼ˆå¯¼èˆªæ ã€å†…å®¹å®¹å™¨ã€æ ¸å¿ƒæŒ‰é’®ç­‰ 3+ å…³é”®å…ƒç´ ï¼‰
- âœ… é¡µé¢æ ‡é¢˜å’Œå…ƒæ•°æ®æ ¡éªŒï¼ˆUTF-8 ç¼–ç ã€viewport è®¾ç½®ï¼‰
- âœ… èµ„æºåŠ è½½éªŒè¯ï¼ˆJavaScript bundlesã€CSS æ ·å¼è¡¨ã€æ— å¤±è´¥è¯·æ±‚ï¼‰
- âœ… æ§åˆ¶å°é”™è¯¯æ£€æµ‹ï¼ˆJavaScript è¿è¡Œæ—¶é”™è¯¯ï¼‰
- âœ… é¡µé¢æ¸²æŸ“å®Œæ•´æ€§éªŒè¯ï¼ˆå†…å®¹é«˜åº¦ã€å¯è§å…ƒç´ ã€æ— åŠ è½½æŒ‡ç¤ºå™¨ï¼‰

### Phase 3: å‰åç«¯è”åŠ¨ (Frontend-Backend Integration)
- âœ… åç«¯ API å¥åº·æ£€æŸ¥ï¼ˆ/health ç«¯ç‚¹ï¼‰
- âœ… å‰ç«¯æ•°æ®è·å–éªŒè¯ï¼ˆç½‘ç»œè¯·æ±‚ç›‘æ§ï¼‰
- âœ… API å“åº”æ ¼å¼éªŒè¯ï¼ˆJSON ç»“æ„ã€code/message å­—æ®µï¼‰
- âœ… å‰åç«¯æ•°æ®ä¸€è‡´æ€§æ ¡éªŒï¼ˆè‚¡ç¥¨ä»£ç ç­‰æ ¸å¿ƒå­—æ®µåŒ¹é…ï¼‰

### Phase 4: åŸºç¡€äº¤äº’ (Basic Interactions)
- âœ… é¡µé¢å¯¼èˆªåŠŸèƒ½éªŒè¯ï¼ˆURL å˜åŒ–æ£€æµ‹ï¼‰
- âœ… è¡¨å•è¾“å…¥åŠŸèƒ½éªŒè¯ï¼ˆæ–‡æœ¬è¾“å…¥æ¥å—ï¼‰
- âœ… æŒ‰é’®ç‚¹å‡»åé¦ˆéªŒè¯ï¼ˆé¡µé¢çŠ¶æ€å˜åŒ–æˆ–åŠ è½½æŒ‡ç¤ºï¼‰
- âœ… æ— å´©æºƒé”™è¯¯éªŒè¯ï¼ˆJavaScript è¿è¡Œæ—¶é”™è¯¯æ£€æµ‹ï¼‰

## æµ‹è¯•ç»“æœè¾“å‡º

### ğŸ“Š ç»“æ„åŒ–æŠ¥å‘Š
- **JSON è¯¦ç»†æŠ¥å‘Š**: `test-results/e2e-test-report.json`
- **æ–‡æœ¬æ‘˜è¦æŠ¥å‘Š**: `test-results/test-summary.txt`
- **æ§åˆ¶å°è¾“å‡º**: å®æ—¶æµ‹è¯•è¿›åº¦å’Œç»“æœæ‘˜è¦

### ğŸ“¸ è¯æ®æ”¶é›†
- **å¤±è´¥æˆªå›¾**: `test-results/screenshots/` (å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾)
- **å…¨ç¨‹å½•å±**: `test-results/videos/` (å¤±è´¥æ—¶å½•åˆ¶)
- **é”™è¯¯åˆ†ç±»**: æ˜ç¡®åŒºåˆ†å‰ç«¯/åç«¯/è”åŠ¨é—®é¢˜

## ä½¿ç”¨æ–¹æ³•

### å‰ç½®æ¡ä»¶

ç¡®ä¿ MyStocks æœåŠ¡å·²é€šè¿‡ PM2 å¯åŠ¨ï¼š

```bash
# å‰ç«¯æœåŠ¡ (ç«¯å£ 3001)
pm2 list | grep mystocks-frontend

# åç«¯æœåŠ¡ (ç«¯å£ 8000)
pm2 list | grep mystocks-backend
```

### è¿è¡Œæµ‹è¯•

#### æ–¹æ³• 1: npm è„šæœ¬ (æ¨è)
```bash
cd web/frontend

# è¿è¡Œå®Œæ•´ E2E æµ‹è¯•å¥—ä»¶
npm run test:e2e:comprehensive
```

#### æ–¹æ³• 2: ç›´æ¥è¿è¡Œè„šæœ¬
```bash
cd web/frontend

# è¿è¡Œæµ‹è¯•æ‰§è¡Œå™¨
node run-comprehensive-e2e.js
```

#### æ–¹æ³• 3: Playwright ç›´æ¥è¿è¡Œ
```bash
cd web/frontend

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npx playwright test tests/comprehensive-e2e-validation.spec.ts

# æŒ‡å®šæµè§ˆå™¨è¿è¡Œ
npx playwright test tests/comprehensive-e2e-validation.spec.ts --project=chromium

# è°ƒè¯•æ¨¡å¼
npx playwright test tests/comprehensive-e2e-validation.spec.ts --debug
```

### æµ‹è¯•ç»“æœæŸ¥çœ‹

æµ‹è¯•å®Œæˆåï¼ŒæŸ¥çœ‹ç»“æœï¼š

```bash
# æŸ¥çœ‹æ‘˜è¦æŠ¥å‘Š
cat test-results/test-summary.txt

# æŸ¥çœ‹è¯¦ç»† JSON æŠ¥å‘Š
cat test-results/e2e-test-report.json | jq '.summary'

# æŸ¥çœ‹æˆªå›¾å’Œå½•å±
ls -la test-results/screenshots/
ls -la test-results/videos/
```

## æµ‹è¯•é…ç½®

### æœåŠ¡é…ç½®
```javascript
const FRONTEND_CONFIG = {
  name: 'mystocks-frontend',
  port: 3001,
  baseUrl: 'http://localhost:3001'
};

const BACKEND_CONFIG = {
  name: 'mystocks-backend',
  port: 8000,
  baseUrl: 'http://localhost:8000'
};
```

### Playwright é…ç½®
- **æµè§ˆå™¨**: Chromium, Firefox, WebKit
- **è§†å£**: 1920x1080 (æ¡Œé¢ç«¯)
- **è¶…æ—¶**: 30ç§’ (é¡µé¢åŠ è½½), 10ç§’ (æ“ä½œ)
- **æˆªå›¾**: å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾
- **å½•å±**: å¤±è´¥æ—¶å½•åˆ¶è§†é¢‘

## æµ‹è¯•éªŒè¯æ ‡å‡†

### âœ… é€šè¿‡æ ‡å‡†
- **Phase 1**: æ‰€æœ‰å‰ç½®æ£€æŸ¥é€šè¿‡
- **Phase 2**: é¡µé¢å®Œå…¨åŠ è½½ï¼Œæ— æ§åˆ¶å°é”™è¯¯ï¼Œæ‰€æœ‰æ ¸å¿ƒå…ƒç´ å­˜åœ¨
- **Phase 3**: API è¿”å›æœ‰æ•ˆæ•°æ®ï¼Œå‰åç«¯æ•°æ®ä¸€è‡´
- **Phase 4**: ç”¨æˆ·äº¤äº’æ­£å¸¸å“åº”ï¼Œæ—  JavaScript å´©æºƒ

### âŒ å¤±è´¥å¤„ç†
- **é—®é¢˜åˆ†ç±»**: å‰ç«¯åŠ è½½é—®é¢˜ / åç«¯æ¥å£é—®é¢˜ / å‰åç«¯è”åŠ¨é—®é¢˜
- **è¯æ®æ”¶é›†**: è‡ªåŠ¨æˆªå›¾ + å½•å± + è¯¦ç»†é”™è¯¯æ—¥å¿—
- **æŠ¥å‘Šè¾“å‡º**: ç»“æ„åŒ– JSON + äººç±»å¯è¯»æ‘˜è¦

## æ•…éšœæ’æŸ¥

### å‰ç½®æ£€æŸ¥å¤±è´¥
```bash
# æ£€æŸ¥ PM2 æœåŠ¡çŠ¶æ€
pm2 list

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3001
lsof -i :8000

# å¯åŠ¨æœåŠ¡ (å¦‚æœæœªè¿è¡Œ)
cd web/frontend && npm run pm2:start
cd web/backend && pm2 start ecosystem.config.js
```

### æµ‹è¯•æ‰§è¡Œå¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
cat test-results/e2e-test-report.json | jq '.categories'

# è°ƒè¯•æ¨¡å¼è¿è¡Œ
npm run test:e2e:debug tests/comprehensive-e2e-validation.spec.ts

# ä»…è¿è¡Œç‰¹å®šæµ‹è¯•
npx playwright test --grep "DOMå…ƒç´ å­˜åœ¨æ€§éªŒè¯"
```

### èµ„æºåŠ è½½é—®é¢˜
- æ£€æŸ¥å‰ç«¯æ„å»ºæ˜¯å¦å®Œæ•´ (`npm run build`)
- éªŒè¯é™æ€èµ„æºè·¯å¾„
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œ CDN è®¿é—®

## æ€§èƒ½æŒ‡æ ‡

- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: ~3-5 åˆ†é’Ÿ (å®Œæ•´å¥—ä»¶)
- **èµ„æºå ç”¨**: æµè§ˆå™¨å®ä¾‹ + ç½‘ç»œç›‘æ§
- **ç¨³å®šæ€§**: 99%+ æˆåŠŸç‡ (æœåŠ¡æ­£å¸¸æ—¶)
- **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹
```typescript
test('è‡ªå®šä¹‰æµ‹è¯•åœºæ™¯', async ({ page }) => {
  // æµ‹è¯•é€»è¾‘
  const startTime = Date.now();

  // æ‰§è¡Œæµ‹è¯•æ­¥éª¤
  await page.goto('...');
  // ... æµ‹è¯•é€»è¾‘ ...

  // è®°å½•ç»“æœ
  recordTestResult('custom', 'Custom Test Name', success, {
    duration: Date.now() - startTime,
    // å…¶ä»–æ•°æ®
  });

  expect(success).toBe(true);
});
```

### ä¿®æ”¹æµ‹è¯•é…ç½®
- ç¼–è¾‘ `playwright.config.ts` è°ƒæ•´è¶…æ—¶ã€è§†å£ç­‰
- ä¿®æ”¹ `run-comprehensive-e2e.js` è°ƒæ•´æœåŠ¡é…ç½®
- æ›´æ–° `package.json` æ·»åŠ æ–°çš„ npm è„šæœ¬

## æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Playwright 1.57+
- **ç¼–ç¨‹è¯­è¨€**: TypeScript
- **æ–­è¨€åº“**: Playwright Test (å†…ç½®)
- **æŠ¥å‘Šå·¥å…·**: JSON + HTML + JUnit
- **CI/CD**: æ”¯æŒ GitHub Actions, Jenkins ç­‰

## è®¸å¯è¯

æœ¬æµ‹è¯•å¥—ä»¶éµå¾ª MyStocks é¡¹ç›®è®¸å¯è¯ã€‚