<template>
  <div class="pyprofiling-demo">
    <div class="demo-header">
      <h1>ğŸ“Š PyProfiling è¿ç§»åŠŸèƒ½æ¼”ç¤º</h1>
      <p class="subtitle">å±•ç¤ºä» PyProfiling é¡¹ç›®è¿ç§»çš„è‚¡ç¥¨é¢„æµ‹å’Œæ€§èƒ½åˆ†æåŠŸèƒ½</p>
    </div>

    <!-- åŠŸèƒ½å¯¼èˆª -->
    <div class="function-nav">
      <el-button
        v-for="tab in tabs"
        :key="tab.key"
        :type="activeTab === tab.key ? 'primary' : ''"
        @click="activeTab = tab.key"
      >
        {{ tab.icon }} {{ tab.label }}
      </el-button>
    </div>

    <!-- 1. é¡¹ç›®æ¦‚è§ˆ -->
    <el-card v-show="activeTab === 'overview'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ</span>
          <el-tag type="success">å·²è¿ç§»</el-tag>
        </div>
      </template>

      <div class="overview-section">
        <el-descriptions :column="2" border>
          <el-descriptions-item label="é¡¹ç›®åç§°">
            PyProfiling - è‚¡ç¥¨é¢„æµ‹ä¸æ€§èƒ½åˆ†æå·¥å…·åŒ…
          </el-descriptions-item>
          <el-descriptions-item label="ä¸»è¦ç”¨é€”">
            ä½¿ç”¨ LightGBM é¢„æµ‹è‚¡ç¥¨ä»·æ ¼ + Python æ€§èƒ½åˆ†æ
          </el-descriptions-item>
          <el-descriptions-item label="æ•°æ®æº">
            é€šè¾¾ä¿¡ï¼ˆTongdaxinï¼‰äºŒè¿›åˆ¶ .day æ–‡ä»¶
          </el-descriptions-item>
          <el-descriptions-item label="æ ¸å¿ƒæ¨¡å‹">
            LightGBM Regressorï¼ˆGBDT å›å½’ï¼‰
          </el-descriptions-item>
          <el-descriptions-item label="ç‰¹å¾å·¥ç¨‹">
            æ»šåŠ¨çª—å£ç‰¹å¾ï¼ˆ10æ­¥ Ã— 6ç‰¹å¾ = 60åˆ—ï¼‰
          </el-descriptions-item>
          <el-descriptions-item label="è¯„ä¼°æŒ‡æ ‡">
            RMSEï¼ˆå‡æ–¹æ ¹è¯¯å·®ï¼‰
          </el-descriptions-item>
        </el-descriptions>

        <div style="margin-top: 20px">
          <h3>ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</h3>
          <el-row :gutter="20" style="margin-top: 15px">
            <el-col :span="8">
              <el-card class="feature-card">
                <h4>ğŸ“ˆ è‚¡ç¥¨ä»·æ ¼é¢„æµ‹</h4>
                <ul>
                  <li>é€šè¾¾ä¿¡æ•°æ®è§£æ</li>
                  <li>æ»šåŠ¨çª—å£ç‰¹å¾å·¥ç¨‹</li>
                  <li>LightGBM æ¨¡å‹è®­ç»ƒ</li>
                  <li>é¢„æµ‹ç»“æœå¯è§†åŒ–</li>
                </ul>
              </el-card>
            </el-col>
            <el-col :span="8">
              <el-card class="feature-card">
                <h4>ğŸ¯ ç‰¹å¾é€‰æ‹©</h4>
                <ul>
                  <li>RFEï¼ˆé€’å½’ç‰¹å¾æ¶ˆé™¤ï¼‰</li>
                  <li>Mutual Information</li>
                  <li>LinearSVC ç‰¹å¾é€‰æ‹©</li>
                  <li>ExtraTreesClassifier</li>
                </ul>
              </el-card>
            </el-col>
            <el-col :span="8">
              <el-card class="feature-card">
                <h4>âš¡ æ€§èƒ½åˆ†æ</h4>
                <ul>
                  <li>cProfile å‡½æ•°åˆ†æ</li>
                  <li>line_profiler é€è¡Œåˆ†æ</li>
                  <li>memory_profiler å†…å­˜åˆ†æ</li>
                  <li>timeit æ‰§è¡Œæ—¶é—´æµ‹é‡</li>
                </ul>
              </el-card>
            </el-col>
          </el-row>
        </div>

        <el-alert
          title="æ•°æ®æµç¨‹"
          type="info"
          :closable="false"
          style="margin-top: 20px"
        >
          <div style="line-height: 2">
            <strong>å®Œæ•´æ•°æ®æµç¨‹ï¼š</strong><br>
            é€šè¾¾ä¿¡ .day æ–‡ä»¶ â†’ äºŒè¿›åˆ¶è§£æï¼ˆ32å­—èŠ‚ç»“æ„ï¼‰â†’ OHLCV DataFrame â†’
            æ»šåŠ¨çª—å£ç‰¹å¾å·¥ç¨‹ â†’ CSV æ•°æ®é›† â†’ LightGBM è®­ç»ƒ â†’ é¢„æµ‹ç»“æœ
          </div>
        </el-alert>
      </div>
    </el-card>

    <!-- 2. æ¨¡å‹é¢„æµ‹æ¼”ç¤º -->
    <el-card v-show="activeTab === 'prediction'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>ğŸ¤– è‚¡ç¥¨ä»·æ ¼é¢„æµ‹æ¨¡å‹</span>
          <el-tag type="warning">åŠŸèƒ½å±•ç¤º</el-tag>
        </div>
      </template>

      <div class="prediction-section">
        <el-alert
          title="æ¨¡å‹é…ç½®"
          type="info"
          :closable="false"
          style="margin-bottom: 20px"
        >
          <div>
            <strong>LightGBM è¶…å‚æ•°ï¼š</strong>
            <ul style="margin-top: 10px; line-height: 1.8">
              <li>num_leaves=25, learning_rate=0.2, n_estimators=70</li>
              <li>max_depth=15, bagging_fraction=0.8, feature_fraction=0.8</li>
              <li>reg_lambda=0.9ï¼ˆL2 æ­£åˆ™åŒ–ï¼‰</li>
            </ul>
          </div>
        </el-alert>

        <h3>æ¨¡å‹è®­ç»ƒæµç¨‹</h3>
        <el-steps :active="modelStep" finish-status="success" style="margin: 20px 0">
          <el-step title="æ•°æ®åŠ è½½" description="è¯»å–é€šè¾¾ä¿¡ .day æ–‡ä»¶" />
          <el-step title="ç‰¹å¾å·¥ç¨‹" description="ç”Ÿæˆæ»šåŠ¨çª—å£ç‰¹å¾ï¼ˆ10æ­¥Ã—6åˆ—ï¼‰" />
          <el-step title="æ•°æ®åˆ†å‰²" description="80% è®­ç»ƒé›† / 20% æµ‹è¯•é›†" />
          <el-step title="æ¨¡å‹è®­ç»ƒ" description="LightGBM GBDT å›å½’è®­ç»ƒ" />
          <el-step title="é¢„æµ‹è¯„ä¼°" description="è®¡ç®— RMSE å¹¶ç»˜åˆ¶é¢„æµ‹æ›²çº¿" />
        </el-steps>

        <div class="model-actions" style="margin-top: 20px">
          <el-button type="primary" @click="runModelDemo" :loading="modelLoading">
            è¿è¡Œæ¨¡å‹æ¼”ç¤º
          </el-button>
          <el-button @click="viewModelCode">
            æŸ¥çœ‹ä»£ç 
          </el-button>
        </div>

        <!-- æ¨¡å‹ç»“æœå±•ç¤º -->
        <div v-if="modelResults" class="model-results" style="margin-top: 20px">
          <h3>é¢„æµ‹ç»“æœ</h3>
          <el-descriptions :column="2" border>
            <el-descriptions-item label="RMSEï¼ˆå‡æ–¹æ ¹è¯¯å·®ï¼‰">
              {{ modelResults.rmse }}
            </el-descriptions-item>
            <el-descriptions-item label="è®­ç»ƒæ ·æœ¬æ•°">
              {{ modelResults.trainSamples }}
            </el-descriptions-item>
            <el-descriptions-item label="æµ‹è¯•æ ·æœ¬æ•°">
              {{ modelResults.testSamples }}
            </el-descriptions-item>
            <el-descriptions-item label="ç‰¹å¾ç»´åº¦">
              {{ modelResults.featureDim }}
            </el-descriptions-item>
          </el-descriptions>

          <el-alert
            title="é¢„æµ‹ç»“æœè¯´æ˜"
            type="success"
            :closable="false"
            style="margin-top: 15px"
          >
            æ¨¡å‹ä½¿ç”¨å†å² OHLCV æ•°æ®çš„æ»šåŠ¨çª—å£ç‰¹å¾ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªäº¤æ˜“æ—¥çš„æ”¶ç›˜ä»·ã€‚
            é¢„æµ‹ç»“æœå·²ä¿å­˜ä¸º predict.png å’Œ predict2.png å›¾ç‰‡ã€‚
          </el-alert>
        </div>
      </div>
    </el-card>

    <!-- 3. ç‰¹å¾å·¥ç¨‹ -->
    <el-card v-show="activeTab === 'features'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>ğŸ”¬ ç‰¹å¾å·¥ç¨‹ä¸ç‰¹å¾é€‰æ‹©</span>
          <el-tag type="info">æŠ€æœ¯è¯´æ˜</el-tag>
        </div>
      </template>

      <div class="features-section">
        <h3>æ»šåŠ¨çª—å£ç‰¹å¾ç”Ÿæˆ</h3>
        <el-descriptions :column="1" border style="margin-top: 15px">
          <el-descriptions-item label="çª—å£å¤§å°ï¼ˆstepï¼‰">
            10 ä¸ªäº¤æ˜“æ—¥
          </el-descriptions-item>
          <el-descriptions-item label="åŸå§‹ç‰¹å¾æ•°">
            6 åˆ—ï¼ˆcode, tradeDate, open, high, low, close, amount, volï¼‰
          </el-descriptions-item>
          <el-descriptions-item label="ç”Ÿæˆç‰¹å¾æ•°">
            10æ­¥ Ã— 6ç‰¹å¾ = 60 åˆ—ç‰¹å¾å‘é‡
          </el-descriptions-item>
          <el-descriptions-item label="ç›®æ ‡å˜é‡">
            nextCloseï¼ˆä¸‹ä¸€æ—¥æ”¶ç›˜ä»·ï¼Œä½¿ç”¨ shift(-1) ç”Ÿæˆï¼‰
          </el-descriptions-item>
        </el-descriptions>

        <h3 style="margin-top: 30px">ç‰¹å¾é€‰æ‹©ç®—æ³•</h3>
        <el-table :data="featureSelectionMethods" stripe style="margin-top: 15px">
          <el-table-column prop="method" label="æ–¹æ³•" width="200" />
          <el-table-column prop="module" label="æ¨¡å—è·¯å¾„" width="300" />
          <el-table-column prop="description" label="è¯´æ˜" />
          <el-table-column label="çŠ¶æ€" width="120">
            <template #default>
              <el-tag type="warning">ç‹¬ç«‹ç¤ºä¾‹</el-tag>
            </template>
          </el-table-column>
        </el-table>

        <el-alert
          title="é›†æˆè¯´æ˜"
          type="warning"
          :closable="false"
          style="margin-top: 20px"
        >
          ç‰¹å¾é€‰æ‹©æ¨¡å—ç›®å‰ä¸ºç‹¬ç«‹ç¤ºä¾‹ï¼Œæœªä¸ä¸»é¢„æµ‹ç®¡é“é›†æˆã€‚
          å¦‚éœ€ä½¿ç”¨ï¼Œéœ€ä» featselection/ ç›®å½•å¯¼å…¥å¹¶æ‰‹åŠ¨é›†æˆåˆ° model.py ä¸­ã€‚
        </el-alert>
      </div>
    </el-card>

    <!-- 4. æ€§èƒ½åˆ†æå·¥å…· -->
    <el-card v-show="activeTab === 'profiling'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>âš¡ Python æ€§èƒ½åˆ†æå·¥å…·</span>
          <el-tag type="info">å·¥å…·é›†</el-tag>
        </div>
      </template>

      <div class="profiling-section">
        <h3>æ€§èƒ½åˆ†æå·¥å…·å¯¹æ¯”</h3>
        <el-table :data="profilingTools" stripe style="margin-top: 15px">
          <el-table-column prop="tool" label="å·¥å…·" width="180" />
          <el-table-column prop="level" label="åˆ†æç²’åº¦" width="120" />
          <el-table-column prop="usage" label="ä½¿ç”¨æ–¹æ³•" />
          <el-table-column prop="output" label="è¾“å‡ºå†…å®¹" />
        </el-table>

        <h3 style="margin-top: 30px">æ€§èƒ½åˆ†æç¤ºä¾‹å‘½ä»¤</h3>
        <div class="command-examples">
          <el-card v-for="cmd in profilingCommands" :key="cmd.tool" class="command-card">
            <h4>{{ cmd.tool }}</h4>
            <el-input
              v-model="cmd.command"
              type="textarea"
              :rows="3"
              readonly
            >
              <template #prepend>å‘½ä»¤</template>
            </el-input>
            <p style="margin-top: 10px; color: #666; font-size: 13px">
              {{ cmd.description }}
            </p>
          </el-card>
        </div>

        <el-alert
          title="æ€§èƒ½ä¼˜åŒ–æµç¨‹"
          type="success"
          :closable="false"
          style="margin-top: 20px"
        >
          <div style="line-height: 2">
            <strong>æ¨èå·¥ä½œæµï¼š</strong><br>
            1. ä½¿ç”¨ <code>cProfile</code> å¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆå‡½æ•°<br>
            2. ä½¿ç”¨ <code>line_profiler</code> å¯¹ç“¶é¢ˆå‡½æ•°è¿›è¡Œé€è¡Œåˆ†æ<br>
            3. ä½¿ç”¨ <code>memory_profiler</code> æ£€æŸ¥å†…å­˜å ç”¨é—®é¢˜<br>
            4. ä½¿ç”¨ <code>timeit</code> å¯¹æ¯”ä¼˜åŒ–å‰åçš„æ‰§è¡Œæ—¶é—´
          </div>
        </el-alert>
      </div>
    </el-card>

    <!-- 5. æ•°æ®æ–‡ä»¶è¯´æ˜ -->
    <el-card v-show="activeTab === 'data'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>ğŸ“‚ æ•°æ®æ–‡ä»¶è¯´æ˜</span>
          <el-tag>é€šè¾¾ä¿¡æ ¼å¼</el-tag>
        </div>
      </template>

      <div class="data-section">
        <h3>é¡¹ç›®æ•°æ®æ–‡ä»¶</h3>
        <el-table :data="dataFiles" stripe style="margin-top: 15px">
          <el-table-column prop="file" label="æ–‡ä»¶è·¯å¾„" width="250" />
          <el-table-column prop="format" label="æ ¼å¼" width="150" />
          <el-table-column prop="description" label="è¯´æ˜" />
          <el-table-column prop="size" label="ç”¨é€”" width="200" />
        </el-table>

        <h3 style="margin-top: 30px">é€šè¾¾ä¿¡äºŒè¿›åˆ¶æ ¼å¼è§£æ</h3>
        <el-descriptions :column="1" border style="margin-top: 15px">
          <el-descriptions-item label="æ–‡ä»¶æ ¼å¼">
            32å­—èŠ‚å›ºå®šç»“æ„ï¼ˆstructï¼‰
          </el-descriptions-item>
          <el-descriptions-item label="è§£ææ–¹æ³•">
            struct.unpack('IIIIIfII', ...)
          </el-descriptions-item>
          <el-descriptions-item label="ä»·æ ¼å­—æ®µ">
            open/high/low/close å­˜å‚¨ä¸ºæ•´æ•°ï¼Œéœ€é™¤ä»¥ 100 è½¬æ¢
          </el-descriptions-item>
          <el-descriptions-item label="è¾“å‡ºåˆ—">
            ['code', 'tradeDate', 'open', 'high', 'low', 'close', 'amount', 'vol']
          </el-descriptions-item>
        </el-descriptions>

        <el-alert
          title="æ•°æ®å¤„ç†æµç¨‹"
          type="info"
          :closable="false"
          style="margin-top: 20px"
        >
          <div style="line-height: 2">
            <strong>æ•°æ®è½¬æ¢æ­¥éª¤ï¼š</strong><br>
            1. <code>utils.read_tdx_day_file()</code> è¯»å– .day äºŒè¿›åˆ¶æ–‡ä»¶<br>
            2. è§£æä¸º OHLCV DataFrameï¼ˆsh000001.csvï¼‰<br>
            3. <code>utils.gen_model_datum(step=10)</code> ç”Ÿæˆæ»šåŠ¨çª—å£ç‰¹å¾<br>
            4. è¾“å‡ºç‰¹å¾æ–‡ä»¶ï¼ˆsh000001_10.csvï¼‰ç”¨äºæ¨¡å‹è®­ç»ƒ
          </div>
        </el-alert>
      </div>
    </el-card>

    <!-- 6. API æœåŠ¡ -->
    <el-card v-show="activeTab === 'api'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>ğŸŒ Flask API æœåŠ¡</span>
          <el-tag type="warning">æœ€å°å®ç°</el-tag>
        </div>
      </template>

      <div class="api-section">
        <el-alert
          title="API çŠ¶æ€è¯´æ˜"
          type="warning"
          :closable="false"
        >
          <div>
            å½“å‰ <code>server.py</code> ä»…å®ç°äº†æ¬¢è¿é¡µé¢ï¼Œæœªæš´éœ² ML é¢„æµ‹ç«¯ç‚¹ã€‚
            æ¨¡å‹é¢„æµ‹é€»è¾‘ä»…å­˜åœ¨äº <code>model.py</code> ä½œä¸ºç‹¬ç«‹è„šæœ¬ã€‚
          </div>
        </el-alert>

        <h3 style="margin-top: 20px">ç°æœ‰ç«¯ç‚¹</h3>
        <el-descriptions :column="1" border style="margin-top: 15px">
          <el-descriptions-item label="æœåŠ¡åœ°å€">
            http://localhost:5000
          </el-descriptions-item>
          <el-descriptions-item label="ç«¯ç‚¹">
            GET /
          </el-descriptions-item>
          <el-descriptions-item label="è¿”å›">
            "æ¬¢è¿æ¥åˆ°é€šè¾¾ä¿¡æ•°æ®åˆ†æçš„ä¸–ç•Œ"
          </el-descriptions-item>
        </el-descriptions>

        <h3 style="margin-top: 30px">å»ºè®®å¢å¼ºçš„ API ç«¯ç‚¹</h3>
        <el-table :data="suggestedAPIs" stripe style="margin-top: 15px">
          <el-table-column prop="method" label="æ–¹æ³•" width="100" />
          <el-table-column prop="endpoint" label="ç«¯ç‚¹" width="250" />
          <el-table-column prop="description" label="åŠŸèƒ½è¯´æ˜" />
          <el-table-column label="ä¼˜å…ˆçº§" width="100">
            <template #default="scope">
              <el-tag :type="scope.row.priority === 'é«˜' ? 'danger' : 'info'">
                {{ scope.row.priority }}
              </el-tag>
            </template>
          </el-table-column>
        </el-table>

        <el-alert
          title="é›†æˆå»ºè®®"
          type="success"
          :closable="false"
          style="margin-top: 20px"
        >
          <div style="line-height: 2">
            <strong>æ¨èå°† PyProfiling åŠŸèƒ½é›†æˆåˆ°æœ¬é¡¹ç›®ï¼š</strong><br>
            1. åœ¨åç«¯ API ä¸­åˆ›å»º <code>/api/ml/predict</code> ç«¯ç‚¹<br>
            2. é›†æˆ LightGBM æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹é€»è¾‘<br>
            3. æ”¯æŒé€šè¾¾ä¿¡æ•°æ®è‡ªåŠ¨è§£æå’Œç‰¹å¾å·¥ç¨‹<br>
            4. æä¾›æ€§èƒ½åˆ†æ API ç”¨äºæ¨¡å‹ä¼˜åŒ–ç›‘æ§
          </div>
        </el-alert>
      </div>
    </el-card>

    <!-- 7. æŠ€æœ¯æ ˆä¸ä¾èµ– -->
    <el-card v-show="activeTab === 'tech'" class="demo-card">
      <template #header>
        <div class="card-header">
          <span>ğŸ”§ æŠ€æœ¯æ ˆä¸ä¾èµ–</span>
        </div>
      </template>

      <div class="tech-section">
        <h3>æ ¸å¿ƒä¾èµ–åŒ…</h3>
        <el-table :data="dependencies" stripe style="margin-top: 15px">
          <el-table-column prop="package" label="åŒ…å" width="200" />
          <el-table-column prop="version" label="ç‰ˆæœ¬" width="150" />
          <el-table-column prop="purpose" label="ç”¨é€”" />
        </el-table>

        <h3 style="margin-top: 30px">å®‰è£…è¯´æ˜</h3>
        <el-card class="install-card">
          <h4>ç¯å¢ƒè¦æ±‚</h4>
          <ul>
            <li>Python 3.6+</li>
            <li>pipï¼ˆå»ºè®®å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼‰</li>
          </ul>
          <h4 style="margin-top: 15px">å®‰è£…å‘½ä»¤</h4>
          <el-input
            value="pip install -r requirements.txt"
            readonly
            style="margin-top: 10px"
          >
            <template #prepend>å‘½ä»¤</template>
          </el-input>
          <p style="margin-top: 10px; color: #666; font-size: 13px">
            å¦‚é‡åˆ°å®‰è£…é—®é¢˜ï¼Œå¯å…ˆæ‰§è¡Œï¼š<br>
            <code>python -m pip install --force-reinstall pip setuptools</code>
          </p>
        </el-card>

        <h3 style="margin-top: 30px">ä¸­æ–‡å­—ä½“é…ç½®</h3>
        <el-alert
          title="Matplotlib ä¸­æ–‡æ˜¾ç¤º"
          type="info"
          :closable="false"
        >
          <div>
            é¡¹ç›®ä½¿ç”¨ SimHei å­—ä½“æ˜¾ç¤ºä¸­æ–‡æ ‡ç­¾ã€‚å¦‚é‡åˆ°ä¹±ç ï¼š<br>
            <code style="display: block; margin-top: 10px">
              plt.rcParams['font.sans-serif'] = ['SimHei']<br>
              plt.rcParams['axes.unicode_minus'] = False
            </code>
          </div>
        </el-alert>
      </div>
    </el-card>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'

// Tab åˆ‡æ¢
const activeTab = ref('overview')
const tabs = [
  { key: 'overview', label: 'é¡¹ç›®æ¦‚è§ˆ', icon: 'ğŸ“‹' },
  { key: 'prediction', label: 'æ¨¡å‹é¢„æµ‹', icon: 'ğŸ¤–' },
  { key: 'features', label: 'ç‰¹å¾å·¥ç¨‹', icon: 'ğŸ”¬' },
  { key: 'profiling', label: 'æ€§èƒ½åˆ†æ', icon: 'âš¡' },
  { key: 'data', label: 'æ•°æ®æ–‡ä»¶', icon: 'ğŸ“‚' },
  { key: 'api', label: 'API æœåŠ¡', icon: 'ğŸŒ' },
  { key: 'tech', label: 'æŠ€æœ¯æ ˆ', icon: 'ğŸ”§' }
]

// æ¨¡å‹é¢„æµ‹
const modelStep = ref(0)
const modelLoading = ref(false)
const modelResults = ref(null)

const runModelDemo = async () => {
  modelLoading.value = true
  modelStep.value = 0

  // æ¨¡æ‹Ÿæ¨¡å‹è®­ç»ƒæµç¨‹
  for (let i = 0; i <= 4; i++) {
    await new Promise(resolve => setTimeout(resolve, 800))
    modelStep.value = i + 1
  }

  // æ¨¡æ‹Ÿç»“æœ
  modelResults.value = {
    rmse: '2.35',
    trainSamples: '2400',
    testSamples: '600',
    featureDim: '60 (10æ­¥ Ã— 6ç‰¹å¾)'
  }

  modelLoading.value = false
  ElMessage.success('æ¨¡å‹æ¼”ç¤ºå®Œæˆï¼é¢„æµ‹ç»“æœå·²ç”Ÿæˆ')
}

const viewModelCode = () => {
  ElMessageBox.alert(
    `
# æ ¸å¿ƒä»£ç ç¤ºä¾‹

class Regressor:
    def __init__(self, step=10, feature_num=6):
        self.X, self.y = gen_model_datum(step=step, feature_num=6)

    def model_train(self):
        self.model = LGBMRegressor(
            boosting_type='gbdt',
            objective='regression',
            num_leaves=25,
            learning_rate=0.2,
            n_estimators=70,
            max_depth=15
        )
        self.model.fit(self.X_train, self.y_train)

    def model_predict(self):
        self.y_pred = self.model.predict(self.X_test)

    def model_evaluate(self):
        rmse = mean_squared_error(self.y_test, self.y_pred) ** 0.5
        print(f'RMSE: {rmse}')
    `,
    'æ¨¡å‹ä»£ç ',
    {
      confirmButtonText: 'å…³é—­',
      dangerouslyUseHTMLString: false
    }
  )
}

// ç‰¹å¾é€‰æ‹©æ–¹æ³•
const featureSelectionMethods = [
  {
    method: 'RFE',
    module: 'featselection/rfe.py',
    description: 'é€’å½’ç‰¹å¾æ¶ˆé™¤ï¼Œé€æ­¥ç§»é™¤ä¸é‡è¦ç‰¹å¾'
  },
  {
    method: 'Mutual Information',
    module: 'featselection/mutualinfoclassif.py',
    description: 'äº’ä¿¡æ¯ç‰¹å¾é€‰æ‹©ï¼Œè¡¡é‡ç‰¹å¾ä¸ç›®æ ‡çš„ç›¸å…³æ€§'
  },
  {
    method: 'LinearSVC',
    module: 'featselection/linearsvc.py',
    description: 'åŸºäºçº¿æ€§ SVM çš„ç‰¹å¾é€‰æ‹©'
  },
  {
    method: 'ExtraTreesClassifier',
    module: 'featselection/extratreesclassifier.py',
    description: 'æç«¯éšæœºæ ‘ç‰¹å¾é‡è¦æ€§'
  },
  {
    method: 'SelectPercentile',
    module: 'featselection/selectpercentile.py',
    description: 'é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç™¾åˆ†æ¯”ç‰¹å¾'
  }
]

// æ€§èƒ½åˆ†æå·¥å…·
const profilingTools = [
  {
    tool: 'time',
    level: 'ç²—ç²’åº¦',
    usage: 'time.time() å‰åè®¡æ—¶',
    output: 'æ€»æ‰§è¡Œæ—¶é—´'
  },
  {
    tool: 'timeit',
    level: 'è¯­å¥çº§',
    usage: 'python -m timeit -n 5 -r 5',
    output: 'å¤šæ¬¡æ‰§è¡Œçš„æœ€ä¼˜æ—¶é—´'
  },
  {
    tool: 'cProfile',
    level: 'å‡½æ•°çº§',
    usage: 'python -m cProfile -s cumulative',
    output: 'æ¯ä¸ªå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°å’Œç´¯è®¡æ—¶é—´'
  },
  {
    tool: 'line_profiler',
    level: 'è¡Œçº§',
    usage: 'kernprof -l -v script.py',
    output: 'æ¯è¡Œä»£ç çš„æ‰§è¡Œæ¬¡æ•°å’Œæ—¶é—´'
  },
  {
    tool: 'memory_profiler',
    level: 'è¡Œçº§',
    usage: 'python -m memory_profiler',
    output: 'æ¯è¡Œä»£ç çš„å†…å­˜å ç”¨å’Œå¢é‡'
  }
]

// æ€§èƒ½åˆ†æå‘½ä»¤ç¤ºä¾‹
const profilingCommands = [
  {
    tool: 'cProfile å‡½æ•°åˆ†æ',
    command: 'python -m cProfile -s cumulative -o profile.stats model.py',
    description: 'ç”Ÿæˆæ€§èƒ½ç»Ÿè®¡æ–‡ä»¶ï¼Œå¯ç”¨ pstats æ¨¡å—æŸ¥çœ‹'
  },
  {
    tool: 'line_profiler é€è¡Œåˆ†æ',
    command: '# 1. åœ¨å‡½æ•°ä¸Šæ·»åŠ  @profile è£…é¥°å™¨\n# 2. è¿è¡Œå‘½ä»¤\nkernprof -l -v model.py',
    description: 'è¾“å‡ºæ¯è¡Œä»£ç çš„æ‰§è¡Œæ—¶é—´å’Œæ¬¡æ•°'
  },
  {
    tool: 'memory_profiler å†…å­˜åˆ†æ',
    command: 'python -m memory_profiler model.py\n# å¯è§†åŒ–ï¼š\nmprof run model.py\nmprof plot',
    description: 'åˆ†æå†…å­˜å ç”¨æƒ…å†µï¼Œéœ€è¦ matplotlib ç”¨äºå¯è§†åŒ–'
  }
]

// æ•°æ®æ–‡ä»¶
const dataFiles = [
  {
    file: 'data/sh000001.day',
    format: 'é€šè¾¾ä¿¡äºŒè¿›åˆ¶',
    description: 'ä¸Šè¯æŒ‡æ•°åŸå§‹æ•°æ®ï¼ˆ32å­—èŠ‚ç»“æ„ï¼‰',
    size: 'åŸå§‹æ•°æ®æº'
  },
  {
    file: 'data/sh000001.csv',
    format: 'CSV',
    description: 'è½¬æ¢åçš„ OHLCV æ•°æ®',
    size: 'ä¸­é—´æ•°æ®'
  },
  {
    file: 'data/sh000001_3.csv',
    format: 'CSV',
    description: '3æ­¥æ»šåŠ¨çª—å£ç‰¹å¾',
    size: 'ç‰¹å¾æ•°æ®'
  },
  {
    file: 'data/sh000001_10.csv',
    format: 'CSV',
    description: '10æ­¥æ»šåŠ¨çª—å£ç‰¹å¾ï¼ˆé»˜è®¤ï¼‰',
    size: 'æ¨¡å‹è®­ç»ƒæ•°æ®'
  }
]

// å»ºè®®çš„ API ç«¯ç‚¹
const suggestedAPIs = [
  {
    method: 'POST',
    endpoint: '/api/ml/train',
    description: 'è®­ç»ƒæ–°çš„ LightGBM æ¨¡å‹',
    priority: 'é«˜'
  },
  {
    method: 'POST',
    endpoint: '/api/ml/predict',
    description: 'ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹',
    priority: 'é«˜'
  },
  {
    method: 'GET',
    endpoint: '/api/ml/model/info',
    description: 'è·å–æ¨¡å‹ä¿¡æ¯ï¼ˆRMSEã€å‚æ•°ç­‰ï¼‰',
    priority: 'ä¸­'
  },
  {
    method: 'POST',
    endpoint: '/api/ml/features/generate',
    description: 'ç”Ÿæˆæ»šåŠ¨çª—å£ç‰¹å¾',
    priority: 'ä¸­'
  },
  {
    method: 'GET',
    endpoint: '/api/profiling/report',
    description: 'è·å–æ€§èƒ½åˆ†ææŠ¥å‘Š',
    priority: 'ä½'
  }
]

// æ ¸å¿ƒä¾èµ–
const dependencies = [
  { package: 'LightGBM', version: '3.3.1', purpose: 'GBDT æ¢¯åº¦æå‡æ¡†æ¶' },
  { package: 'scikit-learn', version: '0.24.2', purpose: 'ç‰¹å¾é€‰æ‹©å’Œæ¨¡å‹å·¥å…·' },
  { package: 'pandas', version: '1.1.5', purpose: 'æ•°æ®å¤„ç†å’Œåˆ†æ' },
  { package: 'numpy', version: '-', purpose: 'æ•°å€¼è®¡ç®—' },
  { package: 'matplotlib', version: '3.3.4', purpose: 'ç»“æœå¯è§†åŒ–' },
  { package: 'seaborn', version: '0.11.2', purpose: 'é«˜çº§å¯è§†åŒ–' },
  { package: 'Flask', version: '2.0.2', purpose: 'Web æ¡†æ¶ï¼ˆAPI æœåŠ¡ï¼‰' },
  { package: 'line-profiler', version: '3.4.0', purpose: 'é€è¡Œæ€§èƒ½åˆ†æ' },
  { package: 'memory-profiler', version: '-', purpose: 'å†…å­˜å ç”¨åˆ†æ' }
]
</script>

<style scoped>
.pyprofiling-demo {
  padding: 20px;
  max-width: 1400px;
  margin: 0 auto;
}

.demo-header {
  text-align: center;
  margin-bottom: 30px;
}

.demo-header h1 {
  font-size: 32px;
  margin-bottom: 10px;
  color: #409eff;
}

.subtitle {
  color: #666;
  font-size: 14px;
}

.function-nav {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.demo-card {
  margin-bottom: 20px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 18px;
  font-weight: bold;
}

.overview-section,
.prediction-section,
.features-section,
.profiling-section,
.data-section,
.api-section,
.tech-section {
  padding: 10px 0;
}

.feature-card {
  height: 100%;
  background: #f8f9fa;
}

.feature-card h4 {
  margin-top: 0;
  color: #409eff;
  margin-bottom: 15px;
}

.feature-card ul {
  margin: 0;
  padding-left: 20px;
  line-height: 2;
}

.model-actions {
  display: flex;
  gap: 10px;
}

.command-examples {
  display: grid;
  grid-template-columns: 1fr;
  gap: 15px;
  margin-top: 15px;
}

.command-card {
  background: #f8f9fa;
}

.command-card h4 {
  margin-top: 0;
  margin-bottom: 10px;
  color: #409eff;
}

.install-card {
  background: #f8f9fa;
  margin-top: 15px;
}

.install-card h4 {
  margin-top: 0;
  margin-bottom: 10px;
  color: #409eff;
}

.install-card ul {
  margin: 0;
  padding-left: 20px;
  line-height: 1.8;
}

code {
  background: #f0f0f0;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'Courier New', monospace;
}
</style>
