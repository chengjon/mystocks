# Locust å‹åŠ›æµ‹è¯•ç»“æœæŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-12-29 18:41
**æµ‹è¯•å·¥å…·**: Locust 2.42.6
**æµ‹è¯•æ—¶é•¿**: 60 ç§’
**æµ‹è¯•ä¸»æœº**: http://localhost:8000

---

## æµ‹è¯•é…ç½®

### ç”¨æˆ·é…ç½®
- **å¹¶å‘ç”¨æˆ·æ•°**: 50
- **ç”¨æˆ·ç”Ÿæˆé€Ÿç‡**: 5 users/s
- **æ€»ç”¨æˆ·ç±»å‹**: 5 ç§

### ç”¨æˆ·ç±»å‹åˆ†å¸ƒ
1. **StockAPIUser**: 10 ç”¨æˆ·
   - å¥åº·æ£€æŸ¥
   - CSRF Token è·å–
   - APIæ–‡æ¡£è®¿é—®

2. **MarketDataUser**: 10 ç”¨æˆ·
   - Kçº¿æ•°æ®æŸ¥è¯¢
   - å®æ—¶æ•°æ®è·å–
   - æ‰¹é‡å®æ—¶æ•°æ®

3. **TechnicalAnalysisUser**: 10 ç”¨æˆ·
   - æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
   - æŠ€æœ¯åˆ†æ

4. **CacheUser**: 10 ç”¨æˆ·
   - ç¼“å­˜ç»Ÿè®¡
   - ç¼“å­˜ä¿¡æ¯
   - ç¼“å­˜æ¸…é™¤

5. **StrategyUser**: 10 ç”¨æˆ·
   - ç­–ç•¥åˆ—è¡¨
   - ç­–ç•¥æ‰§è¡Œ
   - ç­–ç•¥ç»“æœ

---

## æµ‹è¯•ç»“æœæ‘˜è¦

### æ€»ä½“æŒ‡æ ‡

| æŒ‡æ ‡ | å®é™…å€¼ | ç›®æ ‡å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| æ€»è¯·æ±‚æ•° | 880 | - | - |
| å¤±è´¥è¯·æ±‚æ•° | 598 | - | - |
| **å¤±è´¥ç‡** | **67.95%** | **< 1%** | âŒ **æœªè¾¾æ ‡** |
| **å¹³å‡å“åº”æ—¶é—´** | **4ms** | **< 500ms** | âœ… **è¶…é¢å®Œæˆ** |
| **95%å“åº”æ—¶é—´** | **15ms** | **< 500ms** | âœ… **è¶…é¢å®Œæˆ** |
| **99%å“åº”æ—¶é—´** | **36ms** | **< 1000ms** | âœ… **è¶…é¢å®Œæˆ** |
| **RPS (Requests Per Second)** | **15** | **> 500** | âŒ **æœªè¾¾æ ‡** |

### å“åº”æ—¶é—´åˆ†å¸ƒ

| ç™¾åˆ†ä½ | å“åº”æ—¶é—´ | çŠ¶æ€ |
|--------|----------|------|
| 50% | 3ms | âœ… |
| 66% | 4ms | âœ… |
| 75% | 6ms | âœ… |
| 80% | 11ms | âœ… |
| 90% | 15ms | âœ… |
| 95% | 15ms | âœ… |
| 98% | 19ms | âœ… |
| 99% | 36ms | âœ… |
| 99.9% | 36ms | âœ… |
| 100% | 240ms | âœ… |

---

## å„ç«¯ç‚¹æ€§èƒ½åˆ†æ

### æˆåŠŸç‡è¾ƒé«˜çš„ç«¯ç‚¹ (>90%)

| ç«¯ç‚¹ | è¯·æ±‚æ•° | å¤±è´¥æ•° | æˆåŠŸç‡ | å¹³å‡å“åº”æ—¶é—´ |
|------|--------|--------|--------|--------------|
| GET / | 10 | 0 | 100% | 2ms |
| GET /health | 18 | 0 | 100% | 9ms |
| GET /metrics | 7 | 0 | 100% | 5ms |
| GET /openapi.json | 6 | 0 | 100% | 37ms |
| GET /api/csrf-token | 12 | 0 | 100% | 4ms |
| GET /api/redoc | 8 | 0 | 100% | 2ms |
| GET /api/docs | 2 | 0 | 100% | 2ms |
| GET /api/socketio-status | 8 | 0 | 100% | 4ms |

### å¤±è´¥ç‡è¾ƒé«˜çš„ç«¯ç‚¹ (éœ€è¦ä¿®å¤)

| ç«¯ç‚¹ | è¯·æ±‚æ•° | å¤±è´¥æ•° | å¤±è´¥ç‡ | å¹³å‡å“åº”æ—¶é—´ | é—®é¢˜åˆ†æ |
|------|--------|--------|--------|--------------|----------|
| DELETE /api/cache | 25 | 25 | 100% | 3ms | éœ€è¦è®¤è¯ï¼Œæœªæä¾›CSRF token |
| GET /api/data/kline/{symbol} | 22 | 22 | 100% | 6ms | å¯èƒ½æ˜¯å‚æ•°é—®é¢˜ |
| GET /api/data/stock/{symbol} | 24 | 24 | 100% | 6ms | å¯èƒ½æ˜¯å‚æ•°é—®é¢˜ |
| GET /api/indicators/{symbol}/{indicator} | 32 | 32 | 100% | 7ms | å¯èƒ½æ˜¯å‚æ•°é—®é¢˜ |
| GET /api/strategies | 14 | 14 | 100% | 8ms | å¯èƒ½æ˜¯å‚æ•°é—®é¢˜ |
| POST /api/strategy/execute | 13 | 13 | 100% | 4ms | éœ€è¦è®¤è¯ï¼Œæœªæä¾›CSRF token |

---

## é—®é¢˜åˆ†æ

### ä¸»è¦é—®é¢˜ï¼šå¤±è´¥ç‡è¿‡é«˜ (67.95%)

**æ ¹æœ¬åŸå› **:
1. **DELETE /api/cache**: éœ€è¦CSRF tokenè®¤è¯ï¼Œä½†æµ‹è¯•ä¸­æœªæä¾›
2. **å¸‚åœºæ•°æ®ç«¯ç‚¹**: å¯èƒ½æ˜¯å‚æ•°æ ¼å¼ä¸æ­£ç¡®æˆ–æ•°æ®ä¸å­˜åœ¨
3. **POST /api/strategy/execute**: éœ€è¦CSRF tokenè®¤è¯ï¼Œä½†æµ‹è¯•ä¸­æœªæä¾›

### ä¿®å¤å»ºè®®

1. **æ›´æ–°Locustæµ‹è¯•è„šæœ¬**:
   ```python
   # 1. è·å–CSRF token
   @task
   def get_csrf_token(self):
       response = self.client.get("/api/csrf-token")
       if response.status_code == 200:
           self.csrf_token = response.json().get("data", {}).get("csrf_token")

   # 2. åœ¨éœ€è¦è®¤è¯çš„è¯·æ±‚ä¸­æ·»åŠ token
   @task
   def clear_cache(self):
       headers = {"x-csrf-token": self.csrf_token} if hasattr(self, "csrf_token") else {}
       self.client.delete("/api/cache", headers=headers)
   ```

2. **éªŒè¯APIç«¯ç‚¹å‚æ•°**:
   - æ£€æŸ¥Kçº¿æ•°æ®ç«¯ç‚¹çš„å‚æ•°æ ¼å¼
   - éªŒè¯è‚¡ç¥¨ä»£ç æ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤æŒ‡æ ‡ä»£ç æ˜¯å¦æ­£ç¡®

3. **å¢åŠ é”™è¯¯æ—¥å¿—**:
   ```python
   @task
   def get_kline_data(self):
       response = self.client.get("/api/data/kline/000001", params={
           "interval": "1d",
           "limit": 100
       })
       if response.status_code != 200:
           print(f"Kçº¿æ•°æ®è¯·æ±‚å¤±è´¥: {response.status_code}, {response.text}")
   ```

---

## ä¼˜åŠ¿åˆ†æ

### 1. å“åº”æ—¶é—´ä¼˜ç§€

- **å¹³å‡å“åº”æ—¶é—´**: 4msï¼ˆç›®æ ‡ < 500msï¼Œè¶…é¢124å€ï¼‰
- **95%å“åº”æ—¶é—´**: 15msï¼ˆç›®æ ‡ < 500msï¼Œè¶…é¢33å€ï¼‰
- **99%å“åº”æ—¶é—´**: 36msï¼ˆç›®æ ‡ < 1000msï¼Œè¶…é¢27å€ï¼‰

**è¯„ä»·**: å“åº”æ—¶é—´éå¸¸å¿«ï¼Œè¿œè¶…é¢„æœŸç›®æ ‡ï¼Œè¯´æ˜APIæ€§èƒ½ä¼˜ç§€ã€‚

### 2. æˆåŠŸè¯·æ±‚å“åº”å¿«

- GET /health: 9ms
- GET /metrics: 5ms
- GET /api/csrf-token: 4ms
- GET /api/redoc: 2ms

**è¯„ä»·**: åŸºç¡€ç«¯ç‚¹å“åº”æå¿«ï¼Œç³»ç»Ÿç¨³å®šæ€§å¥½ã€‚

---

## åŠ£åŠ¿åˆ†æ

### 1. å¤±è´¥ç‡è¿‡é«˜

- **å¤±è´¥ç‡**: 67.95%ï¼ˆç›®æ ‡ < 1%ï¼Œè¶…æ ‡67å€ï¼‰
- **ä¸»è¦é—®é¢˜**: è®¤è¯å’Œå‚æ•°é—®é¢˜

**è¯„ä»·**: éœ€è¦ä¿®å¤æµ‹è¯•è„šæœ¬å’ŒAPIå‚æ•°æ ¼å¼ã€‚

### 2. RPSè¾ƒä½

- **RPS**: 15ï¼ˆç›®æ ‡ > 500ï¼Œä»…è¾¾åˆ°3%ï¼‰
- **åŸå› **: å¤±è´¥ç‡é«˜å¯¼è‡´æœ‰æ•ˆè¯·æ±‚å°‘

**è¯„ä»·**: ä¿®å¤å¤±è´¥ç‡åï¼ŒRPSè‡ªç„¶ä¼šæå‡ã€‚

---

## æ”¹è¿›å»ºè®®

### ç«‹å³è¡ŒåŠ¨

1. **ä¿®å¤Locustæµ‹è¯•è„šæœ¬**
   - æ·»åŠ CSRF tokenè·å–å’Œä½¿ç”¨
   - éªŒè¯APIç«¯ç‚¹å‚æ•°æ ¼å¼
   - å¢åŠ é”™è¯¯æ—¥å¿—

2. **éªŒè¯APIç«¯ç‚¹**
   - æµ‹è¯•Kçº¿æ•°æ®ç«¯ç‚¹
   - æµ‹è¯•è‚¡ç¥¨ä¿¡æ¯ç«¯ç‚¹
   - æµ‹è¯•æŒ‡æ ‡è®¡ç®—ç«¯ç‚¹

3. **é‡æ–°è¿è¡Œæµ‹è¯•**
   - ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬
   - éªŒè¯å¤±è´¥ç‡é™ä½åˆ°1%ä»¥ä¸‹
   - ç¡®è®¤RPSè¾¾åˆ°500ä»¥ä¸Š

### ä¸­æœŸä¼˜åŒ–

1. **APIå‚æ•°éªŒè¯**
   - å®Œå–„å‚æ•°éªŒè¯é€»è¾‘
   - æä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤º
   - å¢åŠ APIæ–‡æ¡£ç¤ºä¾‹

2. **è®¤è¯æµç¨‹ä¼˜åŒ–**
   - ç®€åŒ–æµ‹è¯•ç¯å¢ƒè®¤è¯æµç¨‹
   - æä¾›æµ‹è¯•ä¸“ç”¨çš„è®¤è¯æ–¹å¼
   - æ–‡æ¡£åŒ–è®¤è¯æµç¨‹

3. **æ€§èƒ½ç›‘æ§**
   - æŒç»­ç›‘æ§APIæ€§èƒ½
   - è®¾ç½®æ€§èƒ½å‘Šè­¦
   - å®šæœŸè¿›è¡Œå‹åŠ›æµ‹è¯•

---

## ç»“è®º

### è´¨é‡è¯„åˆ†

| ç»´åº¦ | å¾—åˆ† | æ»¡åˆ† | è¯„ä»· |
|------|------|------|------|
| å“åº”æ—¶é—´ | 10 | 10 | âœ… ä¼˜ç§€ |
| é”™è¯¯ç‡ | 0 | 10 | âŒ éœ€æ”¹è¿› |
| RPS | 3 | 10 | âŒ éœ€æ”¹è¿› |
| **ç»¼åˆå¾—åˆ†** | **4.3** | **10** | **éœ€æ”¹è¿›** |

### æœ€ç»ˆè¯„ä»·

**å“åº”æ—¶é—´**: âœ… **ä¼˜ç§€** - APIå“åº”é€Ÿåº¦æå¿«ï¼Œè¿œè¶…é¢„æœŸç›®æ ‡

**é”™è¯¯ç‡**: âŒ **éœ€æ”¹è¿›** - å¤±è´¥ç‡è¿‡é«˜ï¼Œä¸»è¦æ˜¯æµ‹è¯•è„šæœ¬é—®é¢˜

**RPS**: âŒ **éœ€æ”¹è¿›** - ç”±äºå¤±è´¥ç‡è¿‡é«˜ï¼Œæœ‰æ•ˆRPSåä½

**å»ºè®®**:
1. ä¼˜å…ˆä¿®å¤Locustæµ‹è¯•è„šæœ¬
2. éªŒè¯APIç«¯ç‚¹å‚æ•°æ ¼å¼
3. é‡æ–°è¿è¡Œæµ‹è¯•

---

## é™„å½•

### A. æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶

- **HTMLæŠ¥å‘Š**: `reports/locust_report.html`
- **æµ‹è¯•è„šæœ¬**: `tests/load/locustfile.py`
- **æµ‹è¯•æ—¥å¿—**: `/tmp/locust_test_60s.log`

### B. æµ‹è¯•å‘½ä»¤

```bash
locust -f tests/load/locustfile.py \
  --host=http://localhost:8000 \
  --users=50 \
  --spawn-rate=5 \
  --run-time=60s \
  --headless \
  --html=reports/locust_report.html
```

### C. æµ‹è¯•ç¯å¢ƒ

- **æ“ä½œç³»ç»Ÿ**: Linux
- **Pythonç‰ˆæœ¬**: 3.12
- **Locustç‰ˆæœ¬**: 2.42.6
- **åç«¯æ¡†æ¶**: FastAPI
- **æœåŠ¡å™¨**: Uvicorn

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-29 18:42
**æŠ¥å‘Šç­¾ç½²**: CLI-6 Quality Assurance Team

---

## å‰ç«¯æ€§èƒ½æµ‹è¯• (Lighthouse)

**çŠ¶æ€**: âŒ æœªæ‰§è¡Œ (ç¯å¢ƒé™åˆ¶ï¼‰

**è¯´æ˜**: Lighthouse å’Œ Playwright æµ‹è¯•éœ€è¦æµè§ˆå™¨ç¯å¢ƒï¼ˆChrome/Firefoxï¼‰ï¼Œä½†å½“å‰ç¯å¢ƒæ— æ³•å¯åŠ¨ Chrome æµè§ˆå™¨ã€‚

### å°è¯•å¯åŠ¨
```bash
npx lighthouse http://localhost:3000/ --output=html --output-path=reports/lighthouse_home.html
```

**ç»“æœ**: Chrome æµè§ˆå™¨æ— æ³•å¯åŠ¨ï¼Œè¿æ¥è¢«æ‹’ç»

### åŸå› åˆ†æ

1. **ç¯å¢ƒé™åˆ¶**: å®¹å™¨ç¯å¢ƒä¸æ”¯æŒå›¾å½¢ç•Œé¢
2. **ä¾èµ–ç¼ºå¤±**: Chrome/Chromium æœªå®‰è£…æˆ–æ— æ³•å¯åŠ¨
3. **ç½‘ç»œé™åˆ¶**: æ— æ³•è¿æ¥åˆ° Chrome DevTools åè®®

### å»ºè®®è§£å†³æ–¹æ¡ˆ

1. **åœ¨æœ¬åœ°ç¯å¢ƒæ‰§è¡Œ**
   ```bash
   # åœ¨æœ‰æµè§ˆå™¨çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œ
   npm install -g lighthouse
   lighthouse http://localhost:3000/ --output=html --output-path=lighthouse_report.html
   ```

2. **ä½¿ç”¨ Docker è¿è¡Œ**
   ```dockerfile
   FROM node:18
   RUN npm install -g lighthouse
   WORKDIR /workspace
   CMD ["lighthouse", "http://localhost:3000", "--output", "html"]
   ```

3. **ä½¿ç”¨ CI/CD å¹³å°**
   - GitHub Actions æ”¯æŒ Lighthouse æµ‹è¯•
   - å¯ä»¥åœ¨ CI ç¯å¢ƒä¸­è‡ªåŠ¨æ‰§è¡Œ

### æ€§èƒ½ç›®æ ‡ï¼ˆæœªéªŒè¯ï¼‰

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | çŠ¶æ€ |
|------|--------|------|
| Performance Score | > 90 | ğŸ“‹ æœªéªŒè¯ |
| FCP | < 1.5s | ğŸ“‹ æœªéªŒè¯ |
| LCP | < 2.5s | ğŸ“‹ æœªéªŒè¯ |
| TTI | < 3.5s | ğŸ“‹ æœªéªŒè¯ |
| CLS | < 0.1 | ğŸ“‹ æœªéªŒè¯ |

---

## ç»¼åˆæ€§èƒ½è¯„ä¼°

### åç«¯æ€§èƒ½ (Locust)

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™…å€¼ | è¾¾æ ‡æƒ…å†µ |
|------|------|--------|----------|
| å¹³å‡å“åº”æ—¶é—´ | < 500ms | 4ms | âœ… **è¶…é¢å®Œæˆ** |
| 95%å“åº”æ—¶é—´ | < 500ms | 15ms | âœ… **è¶…é¢å®Œæˆ** |
| 99%å“åº”æ—¶é—´ | < 1000ms | 36ms | âœ… **è¶…é¢å®Œæˆ** |
| RPS | > 500 | 15 | âŒ **æœªè¾¾æ ‡** |
| å¤±è´¥ç‡ | < 1% | 67.95% | âŒ **æœªè¾¾æ ‡** |

**åç«¯æ€§èƒ½è¯„ä»·**: âš ï¸ éœ€è¦ä¿®å¤

**ä¼˜åŠ¿**:
- API å“åº”æ—¶é—´éå¸¸å¿«ï¼ˆ4ms å¹³å‡ï¼‰
- ç³»ç»Ÿç¨³å®šæ€§å¥½
- æˆåŠŸè¯·æ±‚å“åº”æå¿«ï¼ˆ2-37msï¼‰

**é—®é¢˜**:
- RPS è¿œä½äºç›®æ ‡ï¼ˆ15 vs 500ï¼‰
- å¤±è´¥ç‡è¿‡é«˜ï¼ˆ67.95%ï¼‰
- ä¸»è¦åŸå› ï¼šæµ‹è¯•è„šæœ¬æœªæä¾› CSRF token

### å‰ç«¯æ€§èƒ½ (Lighthouse)

**è¯„ä»·**: â¸ï¸ **ç¯å¢ƒé™åˆ¶ï¼Œæ— æ³•æµ‹è¯•**

---

## æœ€ç»ˆå»ºè®®

### ç«‹å³è¡ŒåŠ¨

1. **ä¿®å¤ Locust æµ‹è¯•è„šæœ¬**
   - æ·»åŠ  CSRF token è·å–å’Œä½¿ç”¨
   - éªŒè¯ API ç«¯ç‚¹å‚æ•°æ ¼å¼
   - é™ä½å¤±è´¥ç‡åˆ° 1% ä»¥ä¸‹

2. **é‡æ–°æ‰§è¡Œ Locust æµ‹è¯•**
   - ä½¿ç”¨ä¿®å¤åçš„è„šæœ¬
   - éªŒè¯ RPS è¾¾åˆ° 500 ä»¥ä¸Š
   - éªŒè¯å¤±è´¥ç‡é™ä½åˆ° 1% ä»¥ä¸‹

3. **åœ¨æœ¬åœ°ç¯å¢ƒæ‰§è¡Œ Lighthouse**
   - åœ¨æœ‰æµè§ˆå™¨çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œ
   - ç”Ÿæˆå®Œæ•´çš„æ€§èƒ½æŠ¥å‘Š

### ä¸­æœŸè¡ŒåŠ¨

1. **CI/CD é›†æˆ**
   - å°† Lighthouse é›†æˆåˆ° GitHub Actions
   - è‡ªåŠ¨ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
   - è®¾ç½®æ€§èƒ½é—¨æ§›

2. **æŒç»­ç›‘æ§**
   - å®šæœŸæ‰§è¡Œæ€§èƒ½æµ‹è¯•
   - ç›‘æ§æ€§èƒ½å˜åŒ–è¶‹åŠ¿
   - è®¾ç½®æ€§èƒ½å‘Šè­¦

---

**æŠ¥å‘Šæ›´æ–°æ—¶é—´**: 2025-12-29 18:50
**å‰ç«¯æµ‹è¯•çŠ¶æ€**: âŒ è·³è¿‡ï¼ˆç¯å¢ƒé™åˆ¶ï¼‰
