# 工具对比矩阵

**版本**: 1.0
**日期**: 2025-10-29
**目的**: 帮助开发者快速选择正确的验证工具

---

## 快速决策表

| 场景 | 推荐工具 | 理由 | 用时 |
|------|---------|------|------|
| 检查数据库是否有数据 | **手动 SQL** | 最直接 | 1 分钟 |
| 测试单个 API 端点 | **httpie** | 简洁高效 | 1 分钟 |
| 测试多个 API 端点 | **MCP Tools** | 快速迭代 | 5 分钟 |
| 首次查看页面显示 | **手动浏览器** | 直观可视化 | 2 分钟 |
| 验证页面并截图 | **MCP Playwright** | 自动截图 | 3 分钟 |
| 简单登录流程 (1-3步) | **MCP Playwright** | 快速验证 | 5 分钟 |
| 复杂多步流程 (4+步) | **Playwright 脚本** | 完全控制 | 首次 15 分钟 |
| 需要条件判断的测试 | **Playwright 脚本** | 编程逻辑 | 首次 20 分钟 |
| 需要重复运行的测试 | **Playwright 脚本** | 自动化 | 后续 1 分钟 |
| 调试 JavaScript 错误 | **手动浏览器 F12** | 交互式调试 | 5 分钟 |
| 复杂问题分析 | **AGENTS** | AI 辅助分析 | 10 分钟 |

---

## 三大工具类型对比

### 1. 手动验证 (Manual Verification)

**定义**: 开发者手动执行验证步骤

**包含工具**:
- 浏览器 + DevTools (F12)
- pgcli (数据库查询)
- httpie (API 测试)

**优点** ✅:
- ⚡ **启动最快**: 无需编写代码,立即开始
- 👁️ **直观可视**: 直接看到实际效果
- 🔍 **灵活探索**: 可以随时调整验证路径
- 📚 **学习成本低**: 基础工具,容易上手

**缺点** ❌:
- 🔁 **不可重复**: 每次需要手动重新执行
- 📝 **无记录**: 没有自动化证据
- ⏱️ **耗时**: 重复验证浪费时间
- 🐛 **易出错**: 人为操作可能遗漏步骤

**最佳场景**:
- ✅ 首次开发功能时的探索性验证
- ✅ 简单的一次性检查 (如查看数据是否存在)
- ✅ 调试复杂问题时的交互式探索
- ✅ 生产环境的验证 (不能运行脚本)

**避免场景**:
- ❌ 需要每次 PR 都运行的测试
- ❌ 复杂多步的验证流程
- ❌ 需要截图证据的正式验证

**时间投入**:
- 学习: 1-2 小时 (熟悉 DevTools 和 pgcli)
- 单次验证: 2-5 分钟
- 重复验证: 每次 2-5 分钟 (不能自动化)

---

### 2. MCP Tools (Model Context Protocol)

**定义**: Claude AI 通过 MCP 协议调用的自动化工具

**包含工具**:
- MCP Playwright Tools
- MCP Chrome DevTools

**优点** ✅:
- ⚡ **即时可用**: 无需编写脚本,直接调用
- 🎯 **针对性强**: 为特定任务优化的工具
- 📸 **自动截图**: 一键生成验证证据
- 🔄 **快速迭代**: 适合探索和调试
- 🤖 **AI 辅助**: Claude 可以智能选择工具

**缺点** ❌:
- 🚫 **无 CI/CD**: 不能集成到自动化流水线
- 📊 **有限逻辑**: 不支持复杂条件判断
- 🔁 **手动重复**: 需要手动重新执行
- 🎓 **需要 Claude**: 依赖 Claude Code 环境

**最佳场景**:
- ✅ 需要快速验证并生成截图
- ✅ 探索性验证 (不确定需要验证什么)
- ✅ 中等复杂度流程 (1-5 步)
- ✅ 一次性或低频验证任务
- ✅ 系统化多端点验证

**避免场景**:
- ❌ CI/CD 自动化测试
- ❌ 超过 5 步的复杂流程
- ❌ 需要复杂条件判断
- ❌ 高频重复的回归测试

**时间投入**:
- 学习: 15 分钟 (阅读文档和示例)
- 单次验证: 3-8 分钟
- 重复验证: 每次 3-8 分钟 (需手动重新执行)

---

### 3. Playwright 脚本 (Automated Scripts)

**定义**: 编写 Python 代码实现的完全自动化测试

**包含工具**:
- Playwright (Python API)
- pytest + pytest-playwright

**优点** ✅:
- 🔁 **完全自动化**: 一次编写,永久重复使用
- 🎯 **完全控制**: 支持复杂逻辑和条件判断
- 🚀 **CI/CD 集成**: 可在流水线中自动运行
- 📊 **测试报告**: 生成详细的测试结果
- 🔧 **可维护**: 代码版本控制,团队协作

**缺点** ❌:
- ⏱️ **启动慢**: 首次需要编写代码 (15-30 分钟)
- 📚 **学习成本**: 需要学习 Playwright API
- 🔒 **不够灵活**: 修改流程需要改代码
- 💻 **需要编程**: 不适合非技术人员

**最佳场景**:
- ✅ 复杂多步流程 (4+ 步)
- ✅ 需要重复运行的测试 (每次 PR)
- ✅ 需要条件判断和循环逻辑
- ✅ CI/CD 自动化集成
- ✅ 回归测试套件

**避免场景**:
- ❌ 一次性验证任务
- ❌ 快速探索性验证
- ❌ 简单的 1-2 步流程
- ❌ 生产环境验证

**时间投入**:
- 学习: 2-4 小时 (Playwright 基础)
- 首次编写: 15-30 分钟
- 重复验证: 1 分钟 (自动运行)
- 维护成本: 低 (稳定后很少需要修改)

---

## 详细对比矩阵

### 核心特性对比

| 特性 | 手动验证 | MCP Tools | Playwright 脚本 |
|------|---------|-----------|----------------|
| **启动速度** | ⭐⭐⭐⭐⭐ (即时) | ⭐⭐⭐⭐⭐ (即时) | ⭐⭐⭐ (需编写) |
| **可重复性** | ⭐ (手动) | ⭐⭐ (手动重新执行) | ⭐⭐⭐⭐⭐ (完全自动) |
| **灵活性** | ⭐⭐⭐⭐⭐ (完全自由) | ⭐⭐⭐⭐ (工具限制) | ⭐⭐⭐ (代码限制) |
| **截图证据** | ⭐⭐ (手动截图) | ⭐⭐⭐⭐⭐ (自动) | ⭐⭐⭐⭐⭐ (自动) |
| **复杂逻辑** | ⭐⭐ (人脑判断) | ⭐⭐ (有限) | ⭐⭐⭐⭐⭐ (编程) |
| **CI/CD 集成** | ❌ | ❌ | ✅ |
| **学习成本** | ⭐⭐⭐⭐⭐ (低) | ⭐⭐⭐⭐ (中低) | ⭐⭐⭐ (中) |
| **适合人群** | 所有人 | Claude 用户 | 开发者 |

### 成本效益分析

| 维度 | 手动验证 | MCP Tools | Playwright 脚本 |
|------|---------|-----------|----------------|
| **单次时间** | 2-5 分钟 | 3-8 分钟 | 1 分钟 (自动) |
| **首次投入** | 0 分钟 | 15 分钟学习 | 15-30 分钟编写 |
| **10 次验证** | 20-50 分钟 | 30-80 分钟 | 25-40 分钟 (首次+9次) |
| **100 次验证** | 200-500 分钟 | 300-800 分钟 | 115-130 分钟 |
| **盈亏平衡点** | - | - | **3-4 次后开始节省时间** |

**结论**: 如果验证需要运行 **3 次以上**,编写 Playwright 脚本更划算

### 具体场景推荐

#### 场景 1: 新功能开发 - 龙虎榜页面

**第 1 次验证** (开发中):
- 🔧 **手动验证**: 浏览器查看显示 (2 分钟)
- 🗄️ **手动 SQL**: 检查数据 (1 分钟)

**第 2 次验证** (修复 Bug 后):
- 🤖 **MCP Playwright**: 验证 + 截图 (3 分钟)

**第 3 次及以后**:
- ⚙️ **Playwright 脚本**: 自动化测试 (1 分钟)

#### 场景 2: 紧急修复生产 Bug

**工具选择**: 手动验证
- 🗄️ pgcli 检查数据
- 🌐 httpie 测试 API
- 👁️ 浏览器查看 UI

**原因**: 生产环境不能运行脚本,手动最快

#### 场景 3: 调试复杂前端问题

**第 1 步**: 手动浏览器 + DevTools (找到问题)
**第 2 步**: MCP Tools 复现并截图
**第 3 步**: Playwright 脚本防止回归

#### 场景 4: API 集成测试

**简单场景** (1-2 个端点):
- 🌐 **httpie**: 手动测试

**中等场景** (3-5 个端点):
- 🤖 **MCP Tools**: 系统化验证

**复杂场景** (完整 API 套件):
- ⚙️ **Playwright 脚本**: 完整自动化

---

## 工具切换时机

### 从手动 → MCP Tools

**时机**: 当你需要第 2 次验证同一功能时

**示例**:
```
开发龙虎榜功能
    ↓
第 1 次: 手动浏览器验证 → 发现 Bug
    ↓
修复 Bug
    ↓
第 2 次: 使用 MCP Tools 验证 + 截图
```

### 从 MCP Tools → Playwright 脚本

**时机**: 当你需要第 3-4 次验证同一功能时

**示例**:
```
第 1-2 次: MCP Tools 快速验证
    ↓
第 3 次: 编写 Playwright 脚本
    ↓
第 4+ 次: 自动运行脚本 (1 分钟)
```

### 从手动 → Playwright 脚本

**直接跳过 MCP 的场景**:
- ✅ 明确知道需要重复运行
- ✅ 流程复杂 (5+ 步)
- ✅ 需要 CI/CD 集成

---

## AGENTS (Claude AI 辅助)

### 什么是 AGENTS?

**AGENTS** 是 Claude Code 提供的专门 AI 助手,用于复杂分析和多步骤任务。

### 可用的 AGENTS

| Agent 类型 | 用途 | 示例场景 |
|-----------|------|---------|
| **Explore Agent** | 代码库探索 | "找出所有处理登录的代码" |
| **Code Reviewer** | 代码审查 | "审查这个 PR 的安全问题" |
| **Root Cause Debugger** | 问题诊断 | "为什么登录失败?" |
| **Web Fullstack Architect** | 架构设计 | "设计一个高可用的 API" |

### 何时使用 AGENTS?

**✅ 推荐场景**:
- 🔍 **复杂问题分析**: 需要分析大量代码或日志
- 🏗️ **架构设计**: 需要系统化的技术方案
- 🐛 **疑难 Bug 排查**: 问题原因不明确
- 📚 **代码库学习**: 快速理解陌生代码

**❌ 不推荐场景**:
- ❌ 简单验证 (用手动或 MCP Tools)
- ❌ 重复性任务 (用 Playwright 脚本)
- ❌ 明确的单一操作

### AGENTS vs 其他工具

| 特性 | 手动 | MCP Tools | Playwright | AGENTS |
|------|------|----------|-----------|--------|
| **分析能力** | ⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐⭐⭐⭐ |
| **执行速度** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| **适用场景** | 简单验证 | 中等验证 | 自动化 | 复杂分析 |

---

## 实战决策案例

### 案例 1: 登录功能测试

**需求**: 验证用户登录功能

**决策过程**:
```
1. 多少步骤? → 3 步 (输入用户名、密码、点击登录)
2. 需要重复? → 是 (每次 PR)
3. 需要截图? → 是
→ **选择**: Playwright 脚本
```

### 案例 2: 检查数据是否导入成功

**需求**: 验证龙虎榜数据是否导入

**决策过程**:
```
1. 验证什么? → 数据库有数据
2. 多少次? → 一次性
→ **选择**: 手动 SQL (pgcli)
```

**命令**:
```sql
SELECT COUNT(*) FROM cn_stock_top;
SELECT MAX(trade_date) FROM cn_stock_top;
```

### 案例 3: API 返回格式验证

**需求**: 验证 4 个 API 端点返回格式

**决策过程**:
```
1. 多少端点? → 4 个
2. 需要系统化? → 是
3. 需要截图? → 是
→ **选择**: MCP Playwright Tools
```

### 案例 4: 排查"页面无数据"问题

**需求**: 页面显示"无数据",但应该有数据

**决策过程**:
```
1. 问题复杂吗? → 是 (需要查数据库、API、前端)
2. 需要分析? → 是
→ **选择**:
   - Layer 5: 手动 SQL 检查
   - Layer 2: httpie 检查 API
   - Layer 4: 浏览器 F12 检查
   - 如果仍未解决: 使用 Root Cause Debugger Agent
```

---

## 决策流程图

```
开始验证任务
    ↓
是否为数据库查询?
    ├─ 是 → 使用 pgcli/SQL
    └─ 否 → 继续
            ↓
是否为 API 测试?
    ├─ 是 → 端点数量?
    │        ├─ 1-2 个 → httpie
    │        └─ 3+ 个 → MCP Tools
    └─ 否 → 继续
            ↓
需要验证 UI?
    ├─ 是 → 步骤数量?
    │        ├─ 1-2 步,首次 → 手动浏览器
    │        ├─ 1-3 步,需截图 → MCP Playwright
    │        └─ 4+ 步或重复 → Playwright 脚本
    └─ 否 → 继续
            ↓
是否为复杂问题分析?
    ├─ 是 → 使用 AGENTS
    └─ 否 → 回到手动验证
```

---

## 最佳实践总结

### ✅ 黄金规则

1. **简单优先**: 优先使用最简单的工具
2. **渐进升级**: 从手动 → MCP → 脚本
3. **3 次原则**: 重复 3 次以上就自动化
4. **记录证据**: 所有验证都要有截图或日志

### ⚠️ 常见错误

1. **过早优化**: 一次性任务编写复杂脚本
2. **过度手动**: 重复任务仍然手动执行
3. **工具滥用**: 用错误的工具做错误的事
4. **跳过验证**: 认为"代码通过就是完成"

### 📊 ROI 计算

**何时值得编写 Playwright 脚本?**

```
节省时间 = (手动时间 - 脚本运行时间) × 运行次数 - 编写时间

例如:
- 手动验证: 5 分钟/次
- 脚本运行: 1 分钟/次
- 编写脚本: 20 分钟

运行 N 次后的总时间:
- 手动: 5N 分钟
- 脚本: 20 + N 分钟

盈亏平衡: 5N = 20 + N → N = 5

结论: 运行 5 次后开始节省时间
```

---

## 参考文档

- **工具选型指南**: `docs/development-process/tool-selection-guide.md`
- **工具决策树**: `specs/006-web-90-1/contracts/tool-selection-decision-tree.md`
- **手动验证指南**: `docs/development-process/manual-verification-guide.md`
- **Playwright 示例**: `tests/integration/`

---

**版本历史**:
- v1.0 (2025-10-29): 初始版本,完整的工具对比矩阵
