# 📂 文件目录管理最佳实践方案 (File Directory Management Best Practices)

**版本**: 1.0  
**适用范围**: 通用软件开发项目 (特别是 Python/Node.js 等解释型语言项目)  
**基于案例**: MyStocks 项目目录治理经验  

---

## 1. 核心原则 (Core Principles)

在长期的项目迭代中，保持目录整洁至关重要。本项目总结出以下四大原则：

1.  **根目录极简主义**: 项目根目录（Root）仅保留"入口文件"和"顶级配置"，避免充斥着脚本、临时文件和文档。
2.  **按功能聚类**: 文件应根据其**用途**而非仅仅是**类型**进行存放（例如：开发脚本 vs 部署脚本）。
3.  **路径无关性**: 脚本和代码应具备在任何目录下运行的能力，避免依赖相对路径（`.`），应使用基于项目根目录的绝对路径解析。
4.  **自动化维护**: 依靠规范不够，必须依靠脚本自动检查和归档。

---

## 2. 标准目录结构蓝图 (Standard Structure)

推荐采用以下标准结构，这是一个经过验证的、可扩展的布局：

```text
Project_Root/
├── 📄 README.md                # 项目入口说明
├── 📄 LICENSE                  # 许可证
├── 📄 .gitignore               # Git忽略配置
├── 📄 requirements.txt         # (或 package.json) 依赖清单
│
├── 📂 src/ (或 app/)           # [核心] 源代码目录
│   ├── main.py                 # 应用入口
│   └── ...
│
├── 📂 config/                  # [配置] 集中管理所有配置文件
│   ├── .env.example            # 环境变量模板
│   ├── app_config.yaml         # 应用配置
│   └── docker-compose.yml      # 容器配置
│
├── 📂 scripts/                 # [工具] 各类脚本，按场景分类
│   ├── dev/                    # 开发辅助脚本 (如: 数据生成, 状态检查)
│   ├── deploy/                 # 部署相关脚本 (CI/CD, 启动脚本)
│   └── maintenance/            # 维护脚本 (如: 目录清理, 备份)
│
├── 📂 docs/                    # [文档] 除README外的所有文档
│   ├── api/                    # API文档
│   ├── guides/                 # 开发/使用指南
│   └── architecture/           # 架构设计文档
│
├── 📂 tests/                   # [测试] 测试代码
│   ├── unit/                   # 单元测试
│   └── integration/            # 集成测试
│
├── 📂 reports/                 # [产物] 生成的报告/结果
│   ├── analysis/               # 分析结果 (JSON/CSV)
│   └── coverage/               # 测试覆盖率报告
│
├── 📂 logs/                    # [日志] 运行时日志 (应在.gitignore中)
│   └── app/
│
└── 📂 temp/                    # [临时] 缓存或中间文件 (应在.gitignore中)
```

---

## 3. 文件分类与放置规则 (Placement Rules)

当您创建一个新文件时，请遵循以下决策树：

| 文件类型 | 典型后缀 | 错误位置 ❌ | 正确位置 ✅ | 理由 |
| :--- | :--- | :--- | :--- | :--- |
| **项目说明** | `.md` | 根目录 (除README外) | `docs/guides/` | 避免根目录被几十个文档淹没 |
| **开发工具脚本** | `.py`, `.sh` | 根目录 | `scripts/dev/` | 脚本通常是辅助性的，不应干扰核心代码视图 |
| **分析结果** | `.json`, `.csv` | 根目录 | `reports/analysis/` | 生成的文件会迅速膨胀，必须隔离 |
| **配置文件** | `.yaml`, `.ini` | 根目录 | `config/` | 集中管理配置，便于容器挂载和切换环境 |
| **测试代码** | `test_*.py` | 根目录 | `tests/` | 保持代码纯净，分离生产代码和测试代码 |
| **临时缓存** | `.cache`, `.tmp` | 根目录 | `temp/` | 确保这些文件可以随时被安全删除 |

---

## 4. 关键技术点：解决路径依赖 (Critical: Path Handling)

当我们将脚本从根目录移动到 `scripts/dev/` 后，最常见的问题是**代码找不到配置文件**。

**❌ 错误做法 (依赖执行位置):**
```python
# 如果在 scripts/dev/ 下执行，会找不到 config/
with open("config/settings.yaml") as f:  
    ...
```

**✅ 最佳实践 (动态获取项目根路径):**
无论脚本在哪个目录下执行，都应基于文件自身位置计算项目根目录。

```python
import os
import sys
from pathlib import Path

# 获取当前脚本的绝对路径
current_script_path = Path(__file__).resolve()

# 向上回溯找到项目根目录 (假设脚本在 scripts/dev/ 下，向上两级即为根目录)
# 或者根据特征文件(如requirements.txt)定位
PROJECT_ROOT = current_script_path.parent.parent.parent 

# 构建配置文件的绝对路径
CONFIG_PATH = PROJECT_ROOT / "config" / "settings.yaml"

# 加载配置
with open(CONFIG_PATH) as f:
    ...
```

---

## 5. 自动化维护机制 (Automation)

依靠人的自觉性是不够的，建议引入自动化脚本。

### 5.1 结构检查脚本 (`check-structure.sh`)
编写一个简单的 Shell 脚本，用于检测根目录是否"超标"。

```bash
#!/bin/bash
# 设定根目录文件数量阈值
LIMIT=10
COUNT=$(find . -maxdepth 1 -type f | grep -v ".git" | wc -l)

if [ "$COUNT" -gt "$LIMIT" ]; then
    echo "⚠️  警告: 根目录文件过多 ($COUNT > $LIMIT)！"
    echo "请运行 ./scripts/maintenance/organize-files.sh 进行整理。"
    exit 1
else
    echo "✅ 目录结构健康。"
fi
```

### 5.2 自动整理脚本
对于特定模式的文件（如自动生成的报告），可以编写脚本定期归档。

### 5.3 Git Hook 集成
将检查脚本集成到 `.git/hooks/pre-commit` 中，在提交代码前强制检查目录结构。

---

## 6. 迁移现有项目的步骤 (Migration Guide)

如果您接手了一个混乱的项目，请按以下步骤操作：

1.  **创建目录骨架**: 建立 `config`, `scripts`, `docs` 等文件夹。
2.  **分类移动**:
    *   `mv *.md docs/` (保留 README.md)
    *   `mv *.sh scripts/`
    *   `mv *.json reports/` (注意区分配置文件)
3.  **修复路径**: 批量搜索代码中的 `open(`, `pandas.read_`, `config/` 等关键字，按照第4节的方法修复路径。
4.  **更新 .gitignore**: 确保 `temp/`, `logs/`, `reports/` 被忽略。
5.  **更新文档**: 修改 README，说明脚本的新位置。

---

## 7. 总结

良好的目录结构是项目技术债治理的第一步。
*   **对人友好**: 新人能快速找到代码。
*   **对机器友好**: CI/CD 脚本更容易编写。
*   **对未来友好**: 项目规模扩大十倍也不会混乱。
