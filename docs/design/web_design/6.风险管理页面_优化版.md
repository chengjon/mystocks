# 6. é£é™©ç®¡ç†é¡µé¢_ä¼˜åŒ–ç‰ˆ

## ä¸»èœå•æ˜ å°„ï¼ˆå¯¹åº”ä¸»èœå•é¡¹å…­ï¼šé£é™©ç®¡ç†ï¼‰
- **è§’è‰²å®šä½**ï¼šå®æ—¶ç›‘æ§æŠ•èµ„ç»„åˆé£é™©ï¼Œæ§åˆ¶å›æ’¤ï¼Œé¢„è­¦æ­¢æŸï¼Œä¿æŠ¤æŠ•èµ„æ”¶ç›Š
- **å¿…å¤‡åŠŸèƒ½æ¸…å•**ï¼š
  - æŠ•èµ„ç»„åˆå®æ—¶é£é™©ç›‘æ§ï¼ˆå›æ’¤ã€æ³¢åŠ¨ç‡ã€è´å¡”å€¼ï¼‰
  - æ­¢æŸç­–ç•¥ä¸æ­¢ç›ˆç­–ç•¥è®¾ç½®ä¸æ‰§è¡Œï¼ˆå›ºå®šæ­¢æŸã€ç§»åŠ¨æ­¢æŸã€æ¡ä»¶æ­¢æŸï¼‰
  - é£é™©é¢„è­¦é€šçŸ¥ç³»ç»Ÿï¼ˆä»·æ ¼é¢„è­¦ã€æŠ€æœ¯ä¿¡å·é¢„è­¦ã€èµ„é‡‘ç®¡ç†é¢„è­¦ï¼‰
  - é£é™©æŠ¥å‘Šç”Ÿæˆï¼ˆå†å²å›æ’¤åˆ†æã€é£é™©æ”¶ç›Šæ¯”åˆ†æï¼‰
  - ä»“ä½ç®¡ç†ä¸èµ„é‡‘ç®¡ç†ï¼ˆå•è‚¡ä»“ä½æ§åˆ¶ã€æ¿å—é›†ä¸­åº¦æ§åˆ¶ï¼‰

## ç²¾ç®€æ‘˜è¦ä¸å®æ–½è¦ç‚¹
- **é¡µé¢æ‘˜è¦**ï¼šé£é™©ç®¡ç†é¡µæä¾›å…¨é¢çš„æŠ•èµ„ç»„åˆé£é™©æ§åˆ¶èƒ½åŠ›ï¼ŒåŒ…æ‹¬å®æ—¶ç›‘æ§ã€é¢„è­¦é€šçŸ¥ã€æ­¢æŸç­–ç•¥å’Œé£é™©åˆ†æ
- **æ ¸å¿ƒåŠŸèƒ½ï¼ˆå‰5ä¼˜å…ˆçº§ï¼‰**ï¼šæŠ•èµ„ç»„åˆé£é™©ä»ªè¡¨ç›˜ã€å•è‚¡é£é™©ç›‘æ§ä¸Kçº¿å›¾æ˜¾ç¤ºã€æ­¢æŸç­–ç•¥è®¾ç½®ã€é£é™©é¢„è­¦ç³»ç»Ÿã€å†å²é£é™©åˆ†ææŠ¥å‘Š
- **API/æ•°æ®ä¾èµ–**ï¼šæŠ•èµ„ç»„åˆæ•°æ®æ¥è‡ªPostgreSQLï¼Œå®æ—¶è¡Œæƒ…æ¥è‡ªTDengineï¼Œ/api/v1/riskæä¾›é£é™©ç›‘æ§æ¥å£ï¼Œ/api/v1/alertsæä¾›é¢„è­¦é€šçŸ¥
- **å®æ–½è¦ç‚¹**ï¼šKçº¿å›¾ä¸é£é™©æŒ‡æ ‡è”åŠ¨æ˜¾ç¤ºï¼Œæ­¢æŸç­–ç•¥è‡ªåŠ¨æ‰§è¡Œï¼Œé¢„è­¦ç³»ç»Ÿæ”¯æŒå¤šæ¸ é“é€šçŸ¥ï¼Œé£é™©æŠ¥å‘Šå¯å¯¼å‡º
- **éªŒæ”¶æ ‡å‡†ï¼ˆä¸€å¥è¯ï¼‰**ï¼šç”¨æˆ·èƒ½ä¸ºæŠ•èµ„ç»„åˆè®¾ç½®é£é™©é˜ˆå€¼å¹¶æ”¶åˆ°é¢„è­¦é€šçŸ¥ï¼ŒæŸ¥çœ‹å•è‚¡é£é™©è¯¦æƒ…å’ŒKçº¿å›¾ï¼Œæ‰§è¡Œæ­¢æŸç­–ç•¥

---
**Owner**: é‡åŒ–å·¥ç¨‹ / ååŒ: æ•°æ®å·¥ç¨‹, å‰ç«¯(NiceGUI)  
**Collaborators**: QA

**MVP æœ€å°å®ç°ä»»åŠ¡**ï¼š
- å®ç°æŠ•èµ„ç»„åˆé£é™©ä»ªè¡¨ç›˜ï¼ˆæ˜¾ç¤ºæ€»èµ„äº§ã€å›æ’¤ã€æ³¢åŠ¨ç‡ç­‰æ ¸å¿ƒæŒ‡æ ‡ï¼‰
- å®ç°å•è‚¡é£é™©è¯¦æƒ…é¡µé¢ï¼ˆå¸¦Kçº¿å›¾æ˜¾ç¤ºæŠ€æœ¯æŒ‡æ ‡å’Œé£é™©ä¿¡å·ï¼‰
- å®ç°åŸºç¡€æ­¢æŸç­–ç•¥è®¾ç½®ï¼ˆå›ºå®šæ­¢æŸç™¾åˆ†æ¯”ï¼Œç§»åŠ¨æ­¢æŸï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- é£é™©æŒ‡æ ‡å®æ—¶æ›´æ–°ï¼ŒKçº¿å›¾æ­£ç¡®æ˜¾ç¤ºæŠ€æœ¯ä¿¡å·ï¼Œæ­¢æŸç­–ç•¥å¯æ­£å¸¸è®¾ç½®å’Œè§¦å‘

**å®ç°è¯´æ˜**ï¼šé£é™©æ•°æ®å­˜å‚¨åˆ°PostgreSQLï¼Œå®æ—¶ä»·æ ¼æ¥è‡ªTDengineï¼ŒKçº¿å›¾ä½¿ç”¨TradingViewæ˜¾ç¤ºæŠ€æœ¯æŒ‡æ ‡ï¼Œé¢„è­¦é€šè¿‡WebSocketæ¨é€

---

## 3.6 é£é™©ç®¡ç†é¡µé¢ï¼ˆRisk Managementï¼‰

**åŠŸèƒ½å®šä½**ï¼šæŠ•èµ„ç»„åˆé£é™©ç›‘æ§ã€æ­¢æŸç­–ç•¥ã€é£é™©é¢„è­¦ã€ä»“ä½ç®¡ç†

### NiceGUIç»„ä»¶å®ç°

**1. æŠ•èµ„ç»„åˆé£é™©ä»ªè¡¨ç›˜ï¼ˆui.cardï¼Œé¡¶éƒ¨ï¼‰**

```python
# æŠ•èµ„ç»„åˆæ¦‚è§ˆï¼ˆui.rowï¼‰
# æ€»èµ„äº§é¢æ¿ï¼ˆui.statistics_cardï¼‰
- æ€»èµ„äº§ï¼šÂ¥1,250,000ï¼ˆ+2.5%ï¼‰
- ä»Šæ—¥æ”¶ç›Šï¼šÂ¥31,250ï¼ˆ+2.57%ï¼‰
- æŒä»“å¸‚å€¼ï¼šÂ¥1,150,000
- ç°é‡‘ä½™é¢ï¼šÂ¥100,000

# é£é™©æŒ‡æ ‡é¢æ¿ï¼ˆui.statistics_cardï¼‰
- æœ€å¤§å›æ’¤ï¼š-8.5%ï¼ˆå½“å‰å‘¨æœŸï¼‰
- å¹´åŒ–æ³¢åŠ¨ç‡ï¼š18.2%
- å¤æ™®æ¯”ç‡ï¼š1.35
- è´å¡”å€¼ï¼š1.12ï¼ˆvs æ²ªæ·±300ï¼‰
- ç´¢æè¯ºæ¯”ç‡ï¼š2.1

# æŒä»“åˆ†å¸ƒï¼ˆui.echarts_pieï¼‰
æŒä»“è¡Œä¸šåˆ†å¸ƒï¼š
â”œâ”€â”€ ç§‘æŠ€è‚¡ï¼š35%
â”œâ”€â”€ åŒ»è¯ç”Ÿç‰©ï¼š25%
â”œâ”€â”€ æ–°èƒ½æºï¼š20%
â”œâ”€â”€ é‡‘èï¼š12%
â””â”€â”€ å…¶ä»–ï¼š8%

# ä»“ä½é›†ä¸­åº¦ï¼ˆui.progress_barï¼‰
- å‰10å¤§é‡ä»“è‚¡å æ¯”ï¼š65%ï¼ˆçº¢è‰²è­¦å‘Š>70%ï¼‰
- å•è‚¡æœ€å¤§ä»“ä½ï¼š12%ï¼ˆæµ¦å‘é“¶è¡Œï¼Œç»¿è‰²<15%ï¼‰
- è¡Œä¸šé›†ä¸­åº¦ï¼šHHIæŒ‡æ•° 0.18ï¼ˆæ­£å¸¸<0.25ï¼‰
```

**2. å•è‚¡é£é™©è¯¦æƒ…é¡µé¢ï¼ˆui.tabså­é¡µé¢1ï¼‰**

```python
# è‚¡ç¥¨é€‰æ‹©å™¨ï¼ˆui.auto_completeï¼‰
- æœç´¢æŒä»“è‚¡ç¥¨ï¼ˆæ”¯æŒä»£ç /åç§°/æ‹¼éŸ³ï¼‰
- æ˜¾ç¤ºæŒä»“ä¿¡æ¯ï¼šæ•°é‡ã€æˆæœ¬ä»·ã€å½“å‰ä»·ã€ç›ˆäº

# Kçº¿å›¾ä¸é£é™©æŒ‡æ ‡æ˜¾ç¤ºï¼ˆTradingView Klinechartï¼‰
# ä¸»å›¾åŒº
- Kçº¿å›¾ï¼ˆçº¢æ¶¨ç»¿è·Œï¼Œæ”¯æŒå‰å¤æƒ/åå¤æƒ/ä¸å¤æƒï¼‰
- ç§»åŠ¨å¹³å‡çº¿ï¼ˆMA5/10/20/60ï¼Œä¸åŒé¢œè‰²ï¼‰
- å¸ƒæ—å¸¦ï¼ˆBOLLä¸Šè½¨/ä¸­è½¨/ä¸‹è½¨ï¼ŒåŠé€æ˜å¡«å……ï¼‰
- æ­¢æŸçº¿æ ‡æ³¨ï¼ˆå›ºå®šæ­¢æŸ/ç§»åŠ¨æ­¢æŸçº¿ï¼Œçº¢è‰²è™šçº¿ï¼‰
- é£é™©ä¿¡å·æ ‡è®°ï¼ˆçº¢è‰²ä¸‰è§’å–å‡ºä¿¡å·ã€ç»¿è‰²ä¸‰è§’ä¹°å…¥ä¿¡å·ï¼‰

# å‰¯å›¾åŒº1ï¼šé£é™©æŒ‡æ ‡ï¼ˆui.plotlyï¼‰
- RSIæŒ‡æ ‡ï¼ˆæ ‡æ³¨è¶…ä¹°70/è¶…å–30ï¼Œçº¢è‰²åŒºåŸŸæ ‡è¯†é£é™©åŒºåŸŸï¼‰
- KDJæŒ‡æ ‡ï¼ˆé‡‘å‰/æ­»å‰ä¿¡å·ï¼Œçº¢è‰²/ç»¿è‰²æ ‡è¯†ï¼‰
- MACDæŸ±çŠ¶å›¾ï¼ˆDIF/DEAçº¿ï¼Œçº¢ç»¿æŸ±æ ‡è¯†ä¹°å–ä¿¡å·ï¼‰

# å‰¯å›¾åŒº2ï¼šæˆäº¤é‡ä¸èµ„é‡‘æµ
- æˆäº¤é‡æŸ±çŠ¶å›¾ï¼ˆçº¢è‰²ä¸Šæ¶¨æ—¥/ç»¿è‰²ä¸‹è·Œæ—¥ï¼‰
- ä¸»åŠ›èµ„é‡‘å‡€æµå…¥ï¼ˆçº¢è‰²æµå…¥/ç»¿è‰²æµå‡ºï¼‰
- é‡æ¯”æŒ‡æ ‡ï¼ˆæˆäº¤é‡ç›¸å¯¹5æ—¥å‡é‡å€æ•°ï¼‰

# å‰¯å›¾åŒº3ï¼šæ³¢åŠ¨ç‡åˆ†æ
- çœŸå®æ³¢åŠ¨ç‡ï¼ˆATRæŒ‡æ ‡ï¼‰
- ä»·æ ¼é€šé“ï¼ˆæ”¯æ’‘/é˜»åŠ›ä½ï¼‰
- å›æ’¤åˆ†æï¼ˆä»é«˜ç‚¹å›æ’¤çš„ç™¾åˆ†æ¯”ï¼‰

# é£é™©å‚æ•°é…ç½®ï¼ˆui.collapseï¼‰
- å›ºå®šæ­¢æŸï¼š-8%ï¼ˆå¯è°ƒæ•´ï¼‰
- ç§»åŠ¨æ­¢æŸï¼š-5%ï¼ˆåŸºäºæˆæœ¬ä»·ï¼‰
- æ­¢ç›ˆç›®æ ‡ï¼š+20%ï¼ˆä¸‰æ®µå¼æ­¢ç›ˆï¼š30%/40%/40%ï¼‰
- ä»“ä½é™åˆ¶ï¼šæœ€å¤§15%ï¼ˆåŸºäºæ€»èµ„äº§ï¼‰
- æŠ€æœ¯æ­¢æŸï¼šè·Œç ´MA20ä¸”æˆäº¤é‡æ”¾å¤§

# å®æ—¶é£é™©ä¿¡å·ï¼ˆui.badge_groupï¼‰
ğŸŸ¢ è¶‹åŠ¿è‰¯å¥½ï¼šä»·æ ¼ä½äºMA20ä¸Šæ–¹
ğŸŸ¡ æ³¨æ„é£é™©ï¼šRSIè¾¾åˆ°65ï¼Œæ¥è¿‘è¶…ä¹°
ğŸ”´ ç´§æ€¥æ­¢æŸï¼šè§¦å‘ç§»åŠ¨æ­¢æŸæ¡ä»¶
ğŸŸ¢ èµ„é‡‘æµå…¥ï¼šä¸»åŠ›èµ„é‡‘å‡€æµå…¥
```

**3. é£é™©é¢„è­¦ç³»ç»Ÿï¼ˆui.tabså­é¡µé¢2ï¼‰**

```python
# é¢„è­¦è§„åˆ™é…ç½®ï¼ˆui.tableï¼‰
è§„åˆ™åç§° | é¢„è­¦æ¡ä»¶ | é¢„è­¦çº§åˆ« | é€šçŸ¥æ–¹å¼ | çŠ¶æ€
ä»·æ ¼çªç ´é¢„è­¦ | æ¶¨è·Œå¹…>Â±5% | é«˜ | å¼¹çª—+çŸ­ä¿¡ | å¯ç”¨
æŠ€æœ¯ä¿¡å·é¢„è­¦ | RSI>70æˆ–RSI<30 | ä¸­ | é‚®ä»¶+Appæ¨é€ | å¯ç”¨
èµ„é‡‘é£é™©é¢„è­¦ | ä¸»åŠ›å‡€æµå‡º>1000ä¸‡ | é«˜ | å¼¹çª—+çŸ­ä¿¡ | å¯ç”¨
ä»“ä½é£é™©é¢„è­¦ | å•è‚¡ä»“ä½>15% | ä¸­ | é‚®ä»¶+Appæ¨é€ | å¯ç”¨
æµåŠ¨æ€§é£é™©é¢„è­¦ | æˆäº¤é‡<100ä¸‡ | ä½ | é‚®ä»¶ | å¯ç”¨

# å®æ—¶é¢„è­¦æ¶ˆæ¯ï¼ˆui.logï¼‰
[09:35] âš ï¸ é«˜é£é™©é¢„è­¦ï¼šæµ¦å‘é“¶è¡Œ(600000)è·Œå¹…è¾¾-6.2%ï¼Œè¶…è¿‡é¢„è­¦é˜ˆå€¼
[09:32] ğŸ“§ é‚®ä»¶æé†’ï¼šæ‹›å•†é“¶è¡Œ(600036)RSIè¾¾åˆ°75ï¼Œå·²è¿›å…¥è¶…ä¹°åŒºåŸŸ
[09:30] ğŸ’° èµ„é‡‘é¢„è­¦ï¼šå®å¾·æ—¶ä»£(300750)ä¸»åŠ›èµ„é‡‘å‡€æµå‡º2.3äº¿
[09:28] ğŸ“Š ä»“ä½é¢„è­¦ï¼šæ¯”äºšè¿ª(002594)å½“å‰ä»“ä½16.5%ï¼Œè¶…è¿‡è®¾å®šä¸Šé™15%
[09:25] ğŸ”” æµåŠ¨æ€§é¢„è­¦ï¼šä¸‡ç§‘A(000002)ä»Šæ—¥æˆäº¤é‡ä»…800ä¸‡ï¼ŒæµåŠ¨æ€§ä¸è¶³

# é¢„è­¦ç»Ÿè®¡ï¼ˆui.chartsï¼‰
ä»Šæ—¥é¢„è­¦åˆ†å¸ƒï¼ˆé¥¼å›¾ï¼‰ï¼š
â”œâ”€â”€ ä»·æ ¼é¢„è­¦ï¼š12æ¬¡
â”œâ”€â”€ æŠ€æœ¯ä¿¡å·ï¼š8æ¬¡
â”œâ”€â”€ èµ„é‡‘é£é™©ï¼š5æ¬¡
â”œâ”€â”€ ä»“ä½é¢„è­¦ï¼š3æ¬¡
â””â”€â”€ æµåŠ¨æ€§ï¼š2æ¬¡

è¿‘7æ—¥é¢„è­¦è¶‹åŠ¿ï¼ˆçº¿å›¾ï¼‰ï¼š
æ—¥æœŸï¼š1å·  2å·  3å·  4å·  5å·  6å·  7å·
æ¬¡æ•°ï¼š15   22   18   25   12   20   30
```

**4. æ­¢æŸç­–ç•¥ç®¡ç†ï¼ˆui.tabså­é¡µé¢3ï¼‰**

```python
# æ­¢æŸç­–ç•¥åˆ—è¡¨ï¼ˆui.aggridï¼‰
ç­–ç•¥åç§° | è‚¡ç¥¨æ±  | æ­¢æŸç±»å‹ | å‚æ•°è®¾ç½® | çŠ¶æ€ | æ“ä½œ
å›ºå®šæ­¢æŸç­–ç•¥ | æ ¸å¿ƒæŒä»“æ±  | å›ºå®šç™¾åˆ†æ¯” | -8% | âœ…è¿è¡Œä¸­ | ç¼–è¾‘/åˆ é™¤
ç§»åŠ¨æ­¢æŸç­–ç•¥ | çŸ­çº¿äº¤æ˜“æ±  | ç§»åŠ¨è¿½è¸ª | -5%è¿½è¸ª | âœ…è¿è¡Œä¸­ | ç¼–è¾‘/åˆ é™¤
æŠ€æœ¯æ­¢æŸç­–ç•¥ | å…¨éƒ¨æŒä»“ | æŠ€æœ¯æŒ‡æ ‡ | è·Œç ´MA20 | âœ…è¿è¡Œä¸­ | ç¼–è¾‘/åˆ é™¤
æ¡ä»¶æ­¢æŸç­–ç•¥ | é«˜é£é™©è‚¡ | å¤åˆæ¡ä»¶ | RSI>80ä¸”æ”¾é‡ | â¸ï¸æš‚åœ | ç¼–è¾‘/åˆ é™¤

# ç­–ç•¥æ‰§è¡Œæ—¥å¿—ï¼ˆui.logï¼‰
[15:00] æ‰§è¡Œæ—¥ç»ˆæ­¢æŸæ£€æŸ¥ï¼šæ£€æŸ¥35åªæŒä»“è‚¡ç¥¨
[14:58] âœ… æµ¦å‘é“¶è¡Œ(600000)ï¼šç§»åŠ¨æ­¢æŸè§¦å‘ï¼Œå½“å‰ä»·æ ¼10.2å…ƒï¼Œæ‰§è¡Œå–å‡º
[14:55] âœ… æ‹›å•†é“¶è¡Œ(600036)ï¼šå›ºå®šæ­¢æŸæœªè§¦å‘ï¼Œå½“å‰ä»·æ ¼45.8å…ƒ
[14:52] âœ… å®å¾·æ—¶ä»£(300750)ï¼šæŠ€æœ¯æ­¢æŸæœªè§¦å‘ï¼ŒMA20ä¸º198.5å…ƒï¼Œå½“å‰ä»·205.2å…ƒ
[14:50] ğŸ“Š æ­¢æŸç­–ç•¥æ‰§è¡Œå®Œæˆï¼šè§¦å‘1æ¬¡ï¼Œæ‰§è¡Œ1æ¬¡ï¼ŒæˆåŠŸç‡100%

# ç­–ç•¥å›æµ‹åˆ†æï¼ˆui.plotlyï¼‰
æ­¢æŸç­–ç•¥æ•ˆæœåˆ†æï¼š
- ç­–ç•¥æ”¶ç›Šæ›²çº¿å¯¹æ¯”ï¼ˆå«æ­¢æŸvsä¸å«æ­¢æŸï¼‰
- å›æ’¤æ§åˆ¶æ•ˆæœï¼ˆæœ€å¤§å›æ’¤ä»-15%é™è‡³-8%ï¼‰
- èƒœç‡ä¸ç›ˆäºæ¯”åˆ†æ
- ç­–ç•¥å‚æ•°æ•æ„Ÿæ€§åˆ†æ
```

**5. ä»“ä½ç®¡ç†ï¼ˆui.tabså­é¡µé¢4ï¼‰**

```python
# ä»“ä½æ¦‚è§ˆï¼ˆui.cardï¼‰
- æ€»ä»“ä½ï¼š92%ï¼ˆé£é™©è¾ƒé«˜ï¼Œ>95%ä¸ºé«˜é£é™©ï¼‰
- å¯ç”¨ç°é‡‘ï¼šÂ¥100,000
- èèµ„èåˆ¸ä½™é¢ï¼šÂ¥50,000ï¼ˆèèµ„ä¹°å…¥ï¼‰
- ä¿è¯é‡‘æ¯”ä¾‹ï¼š65%ï¼ˆå……è¶³>50%ï¼‰

# ä»“ä½åˆ†å¸ƒå›¾è¡¨ï¼ˆui.echarts_barï¼‰
è‚¡ç¥¨åç§°     | ä»“ä½å æ¯” | ç›ˆäºé‡‘é¢ | é£é™©è¯„çº§
æµ¦å‘é“¶è¡Œ     | 12.0%    | +8,500   | ğŸŸ¡ä¸­ç­‰
æ‹›å•†é“¶è¡Œ     | 11.5%    | +12,300  | ğŸŸ¢ä½
å®å¾·æ—¶ä»£     | 10.8%    | -5,200   | ğŸ”´é«˜
æ¯”äºšè¿ª       | 9.2%     | +15,600  | ğŸŸ¡ä¸­ç­‰
äº”ç²®æ¶²       | 8.5%     | +3,200   | ğŸŸ¢ä½

# ä»“ä½è°ƒæ•´å»ºè®®ï¼ˆui.alertsï¼‰
ğŸŸ¢ å»ºè®®å¢æŒï¼šå¹³å®‰é“¶è¡Œ(000001)ï¼Œå½“å‰ä»“ä½3.2%ï¼Œå»ºè®®æå‡è‡³8%
ğŸŸ¡ å»ºè®®å‡æŒï¼šå®å¾·æ—¶ä»£(300750)ï¼Œé£é™©è¯„çº§é«˜ï¼Œå»ºè®®ä»10.8%é™è‡³8%
ğŸ”´ ç´§æ€¥è°ƒæ•´ï¼šä¸‡ç§‘A(000002)ï¼Œè¿ç»­ä¸‹è·Œï¼Œå»ºè®®æ­¢æŸæˆ–å‡ä»“
ğŸŸ¢ ä¿æŒè§‚å¯Ÿï¼šä¸‰ä¸€é‡å·¥(600031)ï¼ŒæŠ€æœ¯é¢è‰¯å¥½ï¼Œå»ºè®®æŒæœ‰

# ä»“ä½é›†ä¸­åº¦åˆ†æï¼ˆui.statistics_cardï¼‰
- å‰5å¤§é‡ä»“è‚¡ï¼š52.1%ï¼ˆç›®æ ‡<60%ï¼‰
- å‰10å¤§é‡ä»“è‚¡ï¼š75.3%ï¼ˆç›®æ ‡<80%ï¼‰
- è¡Œä¸šé›†ä¸­åº¦HHIï¼š0.18ï¼ˆç›®æ ‡<0.25ï¼‰
- å•è‚¡æœ€å¤§ä»“ä½ï¼š12.0%ï¼ˆç›®æ ‡<15%ï¼‰
```

**6. é£é™©æŠ¥å‘Šä¸åˆ†æï¼ˆui.tabså­é¡µé¢5ï¼‰**

```python
# é£é™©æŠ¥å‘Šç”Ÿæˆå™¨ï¼ˆui.cardï¼‰
- æŠ¥å‘Šå‘¨æœŸé€‰æ‹©ï¼šè¿‘7æ—¥/è¿‘30æ—¥/è¿‘90æ—¥/è¿‘1å¹´/è‡ªå®šä¹‰åŒºé—´
- æŠ¥å‘Šç±»å‹ï¼š
  - âœ… æŠ•èµ„ç»„åˆé£é™©åˆ†æ
  - âœ… æ­¢æŸç­–ç•¥æ‰§è¡ŒæŠ¥å‘Š  
  - âœ… ä»“ä½ç®¡ç†ç»©æ•ˆæŠ¥å‘Š
  - âœ… é£é™©é¢„è­¦ç»Ÿè®¡æŠ¥å‘Š

# å†å²é£é™©åˆ†æï¼ˆui.plotlyï¼‰
é£é™©æ”¶ç›Šåˆ†æï¼š
- æ”¶ç›Šç‡æ›²çº¿ vs æœ€å¤§å›æ’¤æ›²çº¿
- å¤æ™®æ¯”ç‡æ—¶é—´åºåˆ—
- ç´¢æè¯ºæ¯”ç‡å˜åŒ–è¶‹åŠ¿
- æ³¢åŠ¨ç‡ä¸æ”¶ç›Šæ•£ç‚¹å›¾

# é£é™©å½’å› åˆ†æï¼ˆui.tree_mapï¼‰
é£é™©æ¥æºåˆ†è§£ï¼š
â”œâ”€â”€ ç³»ç»Ÿæ€§é£é™©ï¼ˆÎ²é£é™©ï¼‰
â”‚   â”œâ”€â”€ æ²ªæ·±300ç›¸å…³æ€§ï¼š45%
â”‚   â”œâ”€â”€ ä¸­è¯500ç›¸å…³æ€§ï¼š35%
â”‚   â””â”€â”€ è¡Œä¸šç³»ç»Ÿæ€§é£é™©ï¼š20%
â”œâ”€â”€ ä¸ªè‚¡ç‰¹å®šé£é™©
â”‚   â”œâ”€â”€ æµ¦å‘é“¶è¡Œï¼š8%
â”‚   â”œâ”€â”€ å®å¾·æ—¶ä»£ï¼š12%
â”‚   â””â”€â”€ å…¶ä»–ä¸ªè‚¡ï¼š30%
â””â”€â”€ å…¶ä»–é£é™©
    â”œâ”€â”€ æµåŠ¨æ€§é£é™©ï¼š5%
    â””â”€â”€ æ“ä½œé£é™©ï¼š3%

# é£é™©è°ƒæ•´æ”¶ç›Šï¼ˆui.statistics_cardï¼‰
- å¹´åŒ–æ”¶ç›Šç‡ï¼š15.8%
- å¹´åŒ–æ³¢åŠ¨ç‡ï¼š18.2%
- å¤æ™®æ¯”ç‡ï¼š0.87ï¼ˆç›®æ ‡>1.0ï¼‰
- ç´¢æè¯ºæ¯”ç‡ï¼š1.25ï¼ˆç›®æ ‡>1.5ï¼‰
- æœ€å¤§å›æ’¤ï¼š-8.5%ï¼ˆæ§åˆ¶ç›®æ ‡<-10%ï¼‰
- é£é™©è°ƒæ•´åæ”¶ç›Šï¼š12.3%
```

**7. Kçº¿å›¾ä¸TradingViewé›†æˆ**

```javascript
// TradingView Klinecharté£é™©åˆ†æå›¾è¡¨
new TradingView.widget({
    "width": "100%",
    "height": "500px",
    "symbol": stock_code,
    "interval": "D",
    "timezone": "Asia/Shanghai",
    "theme": "dark",
    "style": "1", // 1=çƒ›å°å›¾ï¼Œ0=ç¾å›½çº¿
    "locale": "zh_CN",
    "toolbar_bg": "#f1f3f6",
    "enable_publishing": false,
    "hide_top_toolbar": false,
    "hide_legend": false,
    "save_image": false,
    "container_id": "risk_analysis_chart",
    
    // é£é™©åˆ†æä¸“ç”¨æŒ‡æ ‡
    "studies": [
        "RSI@tv-basicstudies", // RSIç›¸å¯¹å¼ºå¼±æŒ‡æ ‡
        "MACD@tv-basicstudies", // MACDæŒ‡æ ‡
        "KDJ@tv-basicstudies", // KDJéšæœºæŒ‡æ ‡
        "BollingerBands@tv-basicstudies", // å¸ƒæ—å¸¦
        
        // è‡ªå®šä¹‰é£é™©æŒ‡æ ‡
        "ATR@tv-basicstudies", // å¹³å‡çœŸå®æ³¢å¹…
        "Volume@tv-basicstudies" // æˆäº¤é‡
    ],
    
    // é£é™©çº¿å åŠ 
    "overrides": {
        "mainSeriesProperties.stopLossLine.color": "#ff4444",
        "mainSeriesProperties.stopLossLine.width": 2,
        "mainSeriesProperties.stopLossLine.style": 2, // è™šçº¿
        "mainSeriesProperties.takeProfitLine.color": "#44ff44",
        "mainSeriesProperties.takeProfitLine.width": 2,
        "mainSeriesProperties.takeProfitLine.style": 2
    },
    
    // å›è°ƒå‡½æ•°
    "onChartReady": function(chart) {
        // é£é™©ä¿¡å·æ ‡æ³¨
        chart.onChartReady().then(() => {
            const widget = chart.activeChart();
            
            // æ­¢æŸçº¿ç»˜åˆ¶
            widget.chart().createShape({
                price: stop_loss_price,
                color: '#ff4444',
                text: 'æ­¢æŸçº¿'
            });
            
            // æŠ€æœ¯ä¿¡å·æ ‡è®°
            widget.chart().createShape({
                time: signal_time,
                color: signal_type === 'sell' ? '#ff4444' : '#44ff44',
                text: signal_text
            });
        });
    }
});

// å®æ—¶é£é™©æ•°æ®æ›´æ–°
function updateRiskData(stock_code) {
    // è·å–å®æ—¶ä»·æ ¼
    fetch(`/api/v1/risk/price/${stock_code}`)
        .then(response => response.json())
        .then(data => {
            updateRiskIndicators(data);
            updateStopLossLine(data);
        });
    
    // è·å–é£é™©ä¿¡å·
    fetch(`/api/v1/risk/signals/${stock_code}`)
        .then(response => response.json())
        .then(data => {
            displayRiskSignals(data);
        });
}

// é£é™©æŒ‡æ ‡è®¡ç®—
function calculateRiskMetrics(stock_data) {
    const indicators = {
        rsi: calculateRSI(stock_data, 14),
        macd: calculateMACD(stock_data),
        kdj: calculateKDJ(stock_data, 9, 3, 3),
        atr: calculateATR(stock_data, 14),
        bollinger: calculateBollingerBands(stock_data, 20, 2),
        stopLoss: calculateStopLoss(stock_data, 'moving', 0.05)
    };
    
    return indicators;
}
```

### æ•°æ®å­˜å‚¨è®¾è®¡ï¼ˆPostgreSQL + TDengineï¼‰

```sql
-- æŠ•èµ„ç»„åˆé…ç½®ï¼ˆPostgreSQLï¼‰
CREATE TABLE portfolio_config (
    portfolio_id SERIAL PRIMARY KEY,
    portfolio_name VARCHAR(100),
    total_assets DECIMAL(15,2),
    available_cash DECIMAL(15,2),
    margin_balance DECIMAL(15,2),
    create_time TIMESTAMP DEFAULT NOW(),
    last_update TIMESTAMP DEFAULT NOW()
);

-- æŒä»“æ˜ç»†ï¼ˆPostgreSQLï¼‰
CREATE TABLE position_detail (
    position_id SERIAL PRIMARY KEY,
    portfolio_id INT REFERENCES portfolio_config(portfolio_id),
    stock_code VARCHAR(10),
    stock_name VARCHAR(50),
    share_count INT,
    cost_price DECIMAL(10,3),
    current_price DECIMAL(10,3),
    market_value DECIMAL(15,2),
    unrealized_pnl DECIMAL(15,2),
    position_ratio DECIMAL(5,2), -- æŒä»“å æ¯”
    risk_level VARCHAR(10) -- LOW/MEDIUM/HIGH
);

-- é£é™©é¢„è­¦è§„åˆ™ï¼ˆPostgreSQLï¼‰
CREATE TABLE risk_alert_rules (
    rule_id SERIAL PRIMARY KEY,
    rule_name VARCHAR(100),
    alert_condition JSONB, -- é¢„è­¦æ¡ä»¶
    alert_level VARCHAR(20), -- HIGH/MEDIUM/LOW
    notification_methods JSONB, -- é€šçŸ¥æ–¹å¼
    is_enabled BOOLEAN DEFAULT true,
    create_time TIMESTAMP DEFAULT NOW()
);

-- é¢„è­¦è®°å½•ï¼ˆPostgreSQLï¼‰
CREATE TABLE alert_records (
    alert_id SERIAL PRIMARY KEY,
    rule_id INT REFERENCES risk_alert_rules(rule_id),
    stock_code VARCHAR(10),
    alert_message TEXT,
    alert_level VARCHAR(20),
    is_processed BOOLEAN DEFAULT false,
    alert_time TIMESTAMP DEFAULT NOW()
);

-- æ­¢æŸç­–ç•¥ï¼ˆPostgreSQLï¼‰
CREATE TABLE stop_loss_strategies (
    strategy_id SERIAL PRIMARY KEY,
    strategy_name VARCHAR(100),
    strategy_type VARCHAR(50), -- 'FIXED'/'MOVING'/'TECHNICAL'/'CONDITIONAL'
    strategy_params JSONB, -- ç­–ç•¥å‚æ•°
    target_stocks JSONB, -- ç›®æ ‡è‚¡ç¥¨æ± 
    is_active BOOLEAN DEFAULT true,
    create_time TIMESTAMP DEFAULT NOW()
);

-- é£é™©æŒ‡æ ‡å†å²ï¼ˆTDengineï¼‰
CREATE STABLE risk_indicators (
    ts TIMESTAMP,
    rsi DOUBLE,
    macd_diff DOUBLE,
    macd_dea DOUBLE,
    kdj_k DOUBLE,
    kdj_d DOUBLE,
    atr DOUBLE,
    bollinger_upper DOUBLE,
    bollinger_middle DOUBLE,
    bollinger_lower DOUBLE,
    stop_loss_price DOUBLE,
    signal_strength INT  -- ä¿¡å·å¼ºåº¦è¯„åˆ†
) TAGS (
    stock_code NCHAR(10),
    period NCHAR(10)
);
```

### APIæ¥å£è®¾è®¡

```python
# æŠ•èµ„ç»„åˆé£é™©æ¥å£
@api.get("/api/v1/risk/portfolio/{portfolio_id}/overview")
async def get_portfolio_risk_overview(portfolio_id: str):
    """è·å–æŠ•èµ„ç»„åˆé£é™©æ¦‚è§ˆ"""
    return {
        "total_assets": 1250000.0,
        "daily_pnl": 31250.0,
        "daily_return": 0.0257,
        "max_drawdown": -0.085,
        "volatility": 0.182,
        "sharpe_ratio": 1.35,
        "beta": 1.12,
        "sortino_ratio": 2.1
    }

@api.get("/api/v1/risk/stock/{stock_code}/details")
async def get_stock_risk_details(stock_code: str):
    """è·å–å•è‚¡é£é™©è¯¦æƒ…ï¼ˆåŒ…å«Kçº¿å›¾æ•°æ®ï¼‰"""
    return {
        "basic_info": {
            "stock_code": "600000",
            "stock_name": "æµ¦å‘é“¶è¡Œ",
            "current_price": 10.25,
            "position_ratio": 0.12,
            "unrealized_pnl": 8500.0
        },
        "risk_indicators": {
            "rsi": 65.2,
            "macd": 0.15,
            "kdj_k": 72.5,
            "atr": 0.32,
            "signal_strength": 75
        },
        "chart_data": {
            "symbol": "600000",
            "interval": "D",
            "data": [...]  # Kçº¿æ•°æ®
        }
    }

@api.get("/api/v1/risk/alerts")
async def get_risk_alerts():
    """è·å–é£é™©é¢„è­¦åˆ—è¡¨"""
    return {
        "total_alerts": 25,
        "high_priority": 5,
        "medium_priority": 12,
        "low_priority": 8,
        "alerts": [
            {
                "alert_id": "001",
                "stock_code": "600000",
                "alert_type": "PRICE_RISK",
                "message": "æµ¦å‘é“¶è¡Œè·Œå¹…è¾¾-6.2%ï¼Œè¶…è¿‡é¢„è­¦é˜ˆå€¼",
                "level": "HIGH",
                "alert_time": "2024-01-15 09:35:00",
                "is_processed": false
            }
        ]
    }

@api.post("/api/v1/risk/stop-loss-strategy")
async def create_stop_loss_strategy(strategy: StopLossStrategy):
    """åˆ›å»ºæ­¢æŸç­–ç•¥"""
    pass

@api.get("/api/v1/risk/portfolio/{portfolio_id}/exposure")
async def get_portfolio_exposure(portfolio_id: str):
    """è·å–æŠ•èµ„ç»„åˆæ•å£åˆ†æ"""
    return {
        "sector_exposure": {
            "ç§‘æŠ€": 0.35,
            "åŒ»è¯": 0.25,
            "æ–°èƒ½æº": 0.20,
            "é‡‘è": 0.12,
            "å…¶ä»–": 0.08
        },
        "concentration_metrics": {
            "top10_weight": 0.753,
            "hh_index": 0.18,
            "max_single_position": 0.12
        }
    }
```

### å…³é”®ç‰¹æ€§è¯´æ˜

1. **Kçº¿å›¾é£é™©åˆ†æ**ï¼šé›†æˆTradingViewä¸“ä¸šå›¾è¡¨ï¼Œæ˜¾ç¤ºæŠ€æœ¯æŒ‡æ ‡å’Œé£é™©ä¿¡å·
2. **å®æ—¶é£é™©ç›‘æ§**ï¼šæŠ•èµ„ç»„åˆé£é™©æŒ‡æ ‡å®æ—¶æ›´æ–°ï¼ŒWebSocketæ¨é€é¢„è­¦
3. **æ™ºèƒ½æ­¢æŸç­–ç•¥**ï¼šæ”¯æŒå›ºå®šã€ç§»åŠ¨ã€æŠ€æœ¯ã€å¤åˆæ­¢æŸç­–ç•¥
4. **å¤šç»´åº¦é£é™©åˆ†æ**ï¼šä»ä¸ªè‚¡åˆ°ç»„åˆã€ä»æŠ€æœ¯åˆ°åŸºæœ¬é¢å…¨é¢é£é™©è¯„ä¼°
5. **Aè‚¡ç‰¹è‰²é£é™©æ§åˆ¶**ï¼šè€ƒè™‘T+1äº¤æ˜“ã€ä»·æ ¼é™åˆ¶ã€æœ€å°äº¤æ˜“å•ä½ç­‰Aè‚¡ç‰¹æœ‰è§„åˆ™

### éªŒæ”¶æ ‡å‡†

- **åŠŸèƒ½éªŒæ”¶**ï¼šæŠ•èµ„ç»„åˆé£é™©æŒ‡æ ‡æ­£ç¡®è®¡ç®—ï¼Œå•è‚¡Kçº¿å›¾æ˜¾ç¤ºé£é™©ä¿¡å·ï¼Œæ­¢æŸç­–ç•¥å¯æ­£å¸¸è§¦å‘
- **æ€§èƒ½éªŒæ”¶**ï¼šé£é™©æ•°æ®å®æ—¶æ›´æ–°ï¼ˆå»¶è¿Ÿ<3ç§’ï¼‰ï¼Œæ­¢æŸç­–ç•¥æ‰§è¡ŒæˆåŠŸç‡>99%
- **ç”¨æˆ·ä½“éªŒ**ï¼šé£é™©é¢„è­¦åŠæ—¶å‡†ç¡®ï¼ŒKçº¿å›¾äº¤äº’æµç•…ï¼Œé£é™©æŠ¥å‘Šå¯¼å‡ºæ­£å¸¸

---
**å¼€å‘å®Œæˆæ—¶é—´**: é¢„ä¼°2å‘¨  
**æµ‹è¯•é‡ç‚¹**: Kçº¿å›¾ä¸é£é™©æŒ‡æ ‡è”åŠ¨ã€æ­¢æŸç­–ç•¥å‡†ç¡®æ€§ã€é¢„è­¦ç³»ç»Ÿå¯é æ€§  
**é£é™©ç‚¹**: æ­¢æŸç­–ç•¥è¯¯è§¦å‘ã€é£é™©è®¡ç®—å»¶è¿Ÿã€é¢„è­¦é€šçŸ¥ä¸¢å¤±
