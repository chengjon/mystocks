# 一、仪表盘页面 - 优化版

## 页面概述
仪表盘页面作为A股量化交易系统的首页，展示全局汇总信息和关键市场数据，帮助用户快速了解市场态势和投资组合表现。

## 核心功能模块

### 1. 大盘概况卡片组
**功能定位**: 展示A股整体市场运行状态

**组件结构**:
```python
# 顶部4列卡片布局 (ui.grid + ui.card)
- 卡片1: 上涨家数统计
  - 主数据: 上涨家数 (大号红色显示)
  - 辅助数据: 上涨占比、涨停数量
  - 颜色: 红色主题，绿色箭头表示昨日对比

- 卡片2: 下跌家数统计
  - 主数据: 下跌家数 (大号绿色显示)
  - 辅助数据: 下跌占比、跌停数量
  - 颜色: 绿色主题，红色箭头表示昨日对比

- 卡片3: 平盘家数
  - 显示平盘股票数量和占比
  - 平均换手率数据
  - 灰色主题

- 卡片4: 市场情绪
  - 情绪指数 (0-100进度条显示)
  - 北向资金净流入
  - 两市成交额
  - 颜色: 根据情绪值动态变化
```

**数据接口**:
- `/api/v1/market/summary` - 获取市场整体统计
- `/api/v1/market/limit` - 获取涨跌停统计
- `/api/v1/fund/north_flow` - 获取北向资金数据

### 2. 三大指数分时图
**功能定位**: 展示上证、深证、创业板指数的实时走势

**组件结构**:
```python
# 3列图表布局 (ui.grid + ui.plotly)
- 上证综指分时图 (左)
  - 实时价格线 (红涨绿跌)
  - 昨收基准线 (黄色虚线)
  - 成交量柱状图 (副图)
  - 涨跌幅显示 (右上角)

- 深证成指分时图 (中)
  - 同上结构，实时数据更新

- 创业板指分时图 (右)
  - 同上结构，实时数据更新
```

**技术要点**:
- 实时刷新频率: 3秒 (WebSocket推送)
- 支持时间范围: 9:30-15:00
- A股特色: 集合竞价时段标识 (9:15-9:25)
- 午休时段处理 (11:30-13:00)

**数据接口**:
- `/api/v1/market/index/quote` - 获取三大指数实时行情
- WebSocket: `/ws/market/realtime` - 实时数据推送

### 3. 数据更新状态面板
**功能定位**: 监控各数据源健康状态和更新时间

**组件结构**:
```python
# 数据源状态表 (ui.table)
字段:
- 数据源名称 (AKShare/Tushare/通达信/龙虎榜/财务数据)
- 最后更新时间 (格式: HH:MM:SS)
- 状态指示器 (🟢在线/🔴离线/⏸️待更新)
- 更新频率 (实时/盘后/每日)
- 数据量统计 (条数/秒)

控制功能:
- 手动刷新按钮 (ui.button)
- 自动刷新开关 (ui.switch)
- 异常数据源高亮显示
```

**监控逻辑**:
- 实时心跳检测
- 数据延迟告警 (超过设定阈值)
- 自动重连机制

**数据接口**:
- `/api/v1/system/datasource/status` - 获取数据源状态
- `/api/v1/system/datasource/health` - 健康检查

### 4. 市场热度分析
**功能定位**: 展示板块和概念的市场热度，识别资金流向

**组件结构**:
```python
# 热度矩阵图 (ui.plotly + 气泡图)
X轴: 板块/概念 (申万一级行业 + 热门概念)
Y轴: 资金流向强度 (主力净流入占比)
颜色: 红涨绿跌 (涨幅决定)
气泡大小: 成交额

交互功能:
- 点击气泡: 显示该板块成分股列表 (ui.dialog)
- 鼠标悬停: 显示详细数据 (资金流入额、涨跌幅、成交额)
- 板块筛选: 支持按行业分类筛选
```

**板块数据**:
- 申万一级行业 (31个)
- 热门概念板块 (动态)
- 北向资金偏好板块
- 机构重仓板块

**数据接口**:
- `/api/v1/sector/heatmap` - 获取板块热度数据
- `/api/v1/fund/flow_by_sector` - 获取板块资金流

### 5. 资金流向排名
**功能定位**: 展示N天持续净流入/流出的股票排行

**组件结构**:
```python
# 资金流向排行 (ui.card + ui.table)
左侧: 净流入排行榜
字段:
- 排名
- 股票代码/名称
- N天累计净流入 (大号金额显示)
- 连续流入天数
- 主力占比

右侧: 净流出排行榜
字段:
- 排名
- 股票代码/名称
- N天累计净流出 (红色显示)
- 连续流出天数
- 主力占比

控制组件:
- 时间选择器 (ui.select): 3天/5天/10天/20天
- 排序切换 (ui.button): 流入榜/流出榜
```

**颜色编码**:
- 连续流入>5天: 金色高亮
- 主力占比>70%: 加粗显示
- 首次流入: 绿色标记

**数据接口**:
- `/api/v1/fund/flow_ranking` - 获取资金流向排名
- 参数: period (3/5/10/20), direction (in/out)

### 6. 板块表现展示
**功能定位**: 展示用户自定义股票池的实时表现

**组件结构**:
```python
# 标签页切换 (ui.tabs)
Tab1: 自选股表现
Tab2: 策略选股表现
Tab3: 行业选股表现
Tab4: 概念选股表现

每个Tab内容:
- 表格显示 (ui.aggrid)
字段:
- 代码 | 名称 | 最新价 | 涨跌幅 | 成交量 | 成交额 | 换手率 | 量比 | 所属板块

统计摘要 (表格上方ui.row):
- 总数、上涨家数、下跌家数、平盘家数
- 平均涨幅、总市值
```

**交互功能**:
- 实时刷新 (3秒)
- 涨跌幅颜色编码 (红涨绿跌)
- 涨停/跌停特殊标记
- 排序和筛选
- 双击跳转到个股详情

**数据接口**:
- `/api/v1/pool/{pool_type}/performance` - 获取各类股票池表现
- 支持pool_type: custom/strategy/industry/concept

### 7. 快速导航
**功能定位**: 提供快速跳转到其他功能模块的入口

**组件结构**:
```python
# 快捷入口卡片 (ui.grid, 3x2布局)
📊 市场行情 | 💹 市场数据 | ⭐ 股票管理
🔍 数据分析 | ⚠️ 风险管理 | 🔄 策略回测

每个卡片:
- 大号图标
- 模块名称
- 功能描述
- 点击跳转路由
```

**数据接口**:
- 静态配置，无需API
- 使用Vue Router进行页面跳转

## 技术实现要点

### 前端技术栈
- **框架**: NiceGUI (Python原生)
- **图表**: Plotly (K线图、技术指标)
- **表格**: AG Grid (高性能表格)
- **实时通信**: WebSocket (3秒推送)

### 数据库设计
```sql
-- 仪表盘配置表 (PostgreSQL)
CREATE TABLE dashboard_config (
    config_id SERIAL PRIMARY KEY,
    user_id INT,
    layout JSONB,        -- 布局配置
    widgets JSONB,       -- 显示的组件
    refresh_interval INT DEFAULT 3,
    update_time TIMESTAMP DEFAULT NOW()
);

-- 市场快照表 (TDengine超级表)
CREATE STABLE market_snapshot (
    ts TIMESTAMP,
    index_code NCHAR(10),
    price DOUBLE,
    volume BIGINT,
    amount DOUBLE,
    rise_count INT,
    fall_count INT
) TAGS (
    market NCHAR(10)  -- 'SH'/'SZ'/'CYB'
);

-- 数据源状态表
CREATE TABLE datasource_status (
    status_id SERIAL PRIMARY KEY,
    datasource_name VARCHAR(50),
    status VARCHAR(20),      -- 'ONLINE'/'OFFLINE'/'UPDATING'
    last_update TIMESTAMP,
    update_frequency VARCHAR(20),
    data_count INT
);
```

### API接口规范
```python
# 统一响应格式
{
    "code": 200,
    "message": "success",
    "data": {
        # 具体数据内容
    },
    "timestamp": "2025-11-12T08:00:00Z"
}

# 错误响应格式
{
    "code": 400,
    "message": "Invalid parameter",
    "data": null,
    "timestamp": "2025-11-12T08:00:00Z"
}
```

### 性能优化
- **缓存策略**: Redis缓存热点数据，5分钟过期
- **分页加载**: 大数据量表格支持虚拟滚动
- **懒加载**: 非首屏组件按需加载
- **WebSocket**: 实时数据使用WebSocket推送，减少HTTP轮询

### A股特色处理
- **T+1限制**: 今日买入的股票在可用数量中显示为0
- **涨跌停**: 涨跌停股票在列表中特殊标记
- **100股整数倍**: 交易数量自动调整为100的倍数
- **集合竞价**: 9:15-9:25时段特殊标识
- **午休时段**: 11:30-13:00时间段图表空白处理

## MVP验收标准
1. **基础展示**: 能正确显示三大指数分时图和基础市场统计
2. **实时更新**: WebSocket数据推送正常，3秒刷新无卡顿
3. **交互功能**: 表格排序、筛选、双击跳转功能正常
4. **数据准确性**: 显示的数据与数据源数据一致
5. **响应式设计**: 在不同屏幕尺寸下正常显示

## 开发优先级
1. **P0**: 三大指数分时图 + 基础市场统计
2. **P1**: 数据源状态监控 + 资金流向排名
3. **P2**: 市场热度分析 + 板块表现展示
4. **P3**: 快速导航 + 个性化配置

---

**Owner**: 前端(NiceGUI) + 数据工程
**技术难点**: WebSocket实时数据推送、大数据量表格性能优化
**预计开发时间**: 2周
**依赖关系**: 需要数据源接入和TDengine数据库配置
