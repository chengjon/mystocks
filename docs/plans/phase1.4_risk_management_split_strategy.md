# Phase 1.4: æ‹†åˆ† risk_management.py (2,112è¡Œ) â†’ 4ä¸ªé£é™©æ¨¡å—æ‰§è¡Œè®¡åˆ’

**æ—¶é—´**: 2026-01-30T10:30:00Z  
**çŠ¶æ€**: âœ… è§„åˆ’å®Œæˆ  
**ä¼˜å…ˆçº§**: P0 (é«˜ä¼˜å…ˆçº§ - Pythonæ–‡ä»¶æ‹†åˆ†ä¼˜å…ˆï¼‰

---

## ğŸ“Š **æ–‡ä»¶ä¿¡æ¯**

**åŸæ–‡ä»¶**: `/opt/claude/mystocks_spec/web/backend/app/api/risk_management.py` (2,112è¡Œ)

**ç›®æ ‡**: å°†2,112è¡Œæ‹†åˆ†ä¸º4ä¸ªé£é™©æ¨¡å—ï¼Œæ¯ä¸ª< 500è¡Œ

---

## ğŸ“Š **æ‹†åˆ†ç­–ç•¥**

### æ‹†åˆ†æ–¹æ¡ˆ

1. `risk_base.py` (~500è¡Œ) - é£é™©ç®¡ç†åŸºç¡€ç±»
2. `risk_monitoring.py` (~500è¡Œ) - é£é™©ç›‘æ§æ¨¡å—
3. `risk_alerts.py` (~400è¡Œ) - é£é™©å‘Šè­¦æ¨¡å—
4. `risk_settings.py` (~400è¡Œ) - é£é™©è®¾ç½®æ¨¡å—
5. `risk_calculator.py` (~500è¡Œ) - é£é™©è®¡ç®—å™¨
6. `risk_dashboard.py` (~350è¡Œ) - é£é™©ä»ªè¡¨ç›˜

### ç›®å½•ç»“æ„

```
web/backend/app/services/risk_management/
â”œâ”€â”€ risk_base.py (~500è¡Œ)
â”œâ”€â”€ risk_monitoring.py (~500è¡Œ)
â”œâ”€â”€ risk_alerts.py (~400è¡Œ)
â”œâ”€â”€ risk_settings.py (~400è¡Œ)
â”œâ”€â”€ risk_calculator.py (~500è¡Œ)
â””â”€â”€ risk_dashboard.py (~350è¡Œ)
```

### å‘åå…¼å®¹æ¥å£

- `risk_management_new.py` (~200è¡Œ) - é‡æ–°å¯¼å‡ºæ‰€æœ‰é£é™©æ¨¡å—

---

## ğŸ“Š **å…·ä½“æ‹†åˆ†å†…å®¹**

### Module 1: risk_base.py (~500è¡Œ)

**åŒ…å«å†…å®¹**:
1. RiskBaseæŠ½è±¡åŸºç±»
2. é£é™©æŒ‡æ ‡å®šä¹‰ï¼ˆVaRã€CVaRã€Sharpe Ratioç­‰ï¼‰
3. é£é™©äº‹ä»¶è®°å½•
4. åŸºç¡€é£é™©è®¡ç®—æ–¹æ³•

**ä¸»è¦ç±»**:
- RiskMetricsï¼ˆé£é™©æŒ‡æ ‡æ•°æ®ç±»ï¼‰
- RiskEventï¼ˆé£é™©äº‹ä»¶ç±»ï¼‰
- RiskProfileï¼ˆé£é™©é…ç½®ç±»ï¼‰
- RiskBaseï¼ˆé£é™©ç®¡ç†åŸºç±»ï¼‰

---

### Module 2: risk_monitoring.py (~500è¡Œ)

**åŒ…å«å†…å®¹**:
1. å®æ—¶é£é™©ç›‘æ§
2. é£é™©é˜ˆå€¼æ£€æŸ¥
3. é£é™©äº‹ä»¶æ—¥å¿—
4. é£é™©æŒ‡æ ‡ç»Ÿè®¡

**ä¸»è¦æ–¹æ³•**:
- `monitor_risk_profile()` - ç›‘æ§é£é™©é…ç½®
- `check_risk_thresholds()` - æ£€æŸ¥é£é™©é˜ˆå€¼
- `log_risk_event()` - è®°å½•é£é™©äº‹ä»¶
- `calculate_risk_metrics()` - è®¡ç®—é£é™©æŒ‡æ ‡

---

### Module 3: risk_alerts.py (~400è¡Œ)

**åŒ…å«å†…å®¹**:
1. å‘Šè­¦è§„åˆ™ç®¡ç†
2. å‘Šè­¦æ¸ é“ç®¡ç†ï¼ˆé‚®ä»¶ã€Webhookã€çŸ­ä¿¡ï¼‰
3. å‘Šè­¦è§¦å‘å™¨
4. å‘Šè­¦å†å²è®°å½•

**ä¸»è¦æ–¹æ³•**:
- `create_alert_rule()` - åˆ›å»ºå‘Šè­¦è§„åˆ™
- `trigger_alert()` - è§¦å‘å‘Šè­¦
- `send_alert_notification()` - å‘é€å‘Šè­¦é€šçŸ¥
- `get_alert_history()` - è·å–å‘Šè­¦å†å²

---

### Module 4: risk_settings.py (~400è¡Œ)

**åŒ…å«å†…å®¹**:
1. é£é™©å‚æ•°é…ç½®
2. é£é™©æ¨¡å‹é€‰æ‹©
3. é£é™©é˜ˆå€¼è®¾ç½®
4. ç”¨æˆ·é£é™©ç®¡ç†é…ç½®

**ä¸»è¦æ–¹æ³•**:
- `get_risk_settings()` - è·å–é£é™©è®¾ç½®
- `update_risk_settings()` - æ›´æ–°é£é™©è®¾ç½®
- `reset_risk_settings()` - é‡ç½®é£é™©è®¾ç½®
- `get_available_risk_models()` - è·å–å¯ç”¨çš„é£é™©æ¨¡å‹

---

### Module 5: risk_calculator.py (~500è¡Œ)

**åŒ…å«å†…å®¹**:
1. VaRè®¡ç®—ï¼ˆValue at Riskï¼‰
2. CVaRè®¡ç®—ï¼ˆConditional Value at Riskï¼‰
3. Sharpe Ratioè®¡ç®—
4. æœ€å¤§å›æ’¤è®¡ç®—
5. Betaç³»æ•°è®¡ç®—
6. æ³¢åŠ¨ç‡è®¡ç®—

**ä¸»è¦æ–¹æ³•**:
- `calculate_var()` - è®¡ç®—æ–¹å·®
- `calculate_var_with_return()` - è®¡ç®—å¸¦æ”¶ç›Šç‡çš„æ–¹å·®
- `calculate_cvar()` - è®¡ç®—æ¡ä»¶VaR
- `calculate_sharpe_ratio()` - è®¡ç®—å¤æ™®æ¯”ç‡
- `calculate_max_drawdown()` - è®¡ç®—æœ€å¤§å›æ’¤
- `calculate_beta()` - è®¡ç®—Betaç³»æ•°

---

### Module 6: risk_dashboard.py (~350è¡Œ)

**åŒ…å«å†…å®¹**:
1. é£é™©ä»ªè¡¨ç›˜æ•°æ®æ±‡æ€»
2. é£é™©å›¾è¡¨æ•°æ®
3. é£é™©æŠ¥å‘Šç”Ÿæˆ
4. å®æ—¶é£é™©ç›‘æ§UI

**ä¸»è¦æ–¹æ³•**:
- `get_risk_dashboard_summary()` - è·å–ä»ªè¡¨ç›˜æ‘˜è¦
- `get_risk_chart_data()` - è·å–å›¾è¡¨æ•°æ®
- `generate_risk_report()` - ç”Ÿæˆé£é™©æŠ¥å‘Š
- `get_realtime_risk_monitoring()` - å®æ—¶é£é™©ç›‘æ§

---

## ğŸ“Š **éªŒæ”¶æ ‡å‡†**

- [ ] 6ä¸ªæ–°æ¨¡å—å·²åˆ›å»º
- [ ] æ‰€æœ‰æ¨¡å—< 500è¡Œ
- [ ] æ¨¡å—èŒè´£å•ä¸€
- [ ] ä¾èµ–å…³ç³»æ¸…æ™°
- [ ] å‘åå…¼å®¹æ¥å£å·²åˆ›å»º
- [ ] åŸæ–‡ä»¶å·²å¤‡ä»½
- [ ] æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®

---

## ğŸ“Š **é¢„è®¡æ—¶é—´**

| æ¨¡å— | é¢„è®¡æ—¶é—´ |
|------|----------|
| åˆ›å»ºç›®å½•ç»“æ„ | 0.5å°æ—¶ |
| åˆ›å»ºrisk_base.py | 1å°æ—¶ |
| åˆ›å»ºrisk_monitoring.py | 1å°æ—¶ |
| åˆ›å»ºrisk_alerts.py | 0.8å°æ—¶ |
| åˆ›å»ºrisk_settings.py | 0.8å°æ—¶ |
| åˆ›å»ºrisk_calculator.py | 1å°æ—¶ |
| åˆ›å»ºrisk_dashboard.py | 0.8å°æ—¶ |
| åˆ›å»ºrisk_management_new.py | 0.5å°æ—¶ |
| æµ‹è¯•éªŒè¯ | 1.5å°æ—¶ |

**æ€»è®¡**: 8å°æ—¶

---

## ğŸ“‹ **æ‰§è¡Œè®¡åˆ’**

### Step 1: åˆ›å»ºç›®å½•ç»“æ„ï¼ˆé¢„è®¡0.5å°æ—¶ï¼‰

**ä»»åŠ¡**:
- åˆ›å»º `web/backend/app/services/risk_management/` ç›®å½•
- åˆ›å»º `__init__.py` æ–‡ä»¶

---

### Step 2: åˆ›å»ºrisk_base.py (~500è¡Œ)ï¼ˆé¢„è®¡1å°æ—¶ï¼‰

**ä»»åŠ¡**:
- åˆ›å»ºRiskMetricsæ•°æ®ç±»
- åˆ›å»ºRiskEventé£é™©äº‹ä»¶ç±»
- åˆ›å»ºRiskProfileé£é™©é…ç½®ç±»
- åˆ›å»ºRiskBaseé£é™©ç®¡ç†åŸºç±»
- æ·»åŠ åŸºç¡€é£é™©è®¡ç®—æ–¹æ³•

---

### Step 3: åˆ›å»ºrisk_monitoring.py (~500è¡Œ)ï¼ˆé¢„è®¡1å°æ—¶ï¼‰

**ä»»åŠ¡**:
- å®æ—¶é£é™©ç›‘æ§æ–¹æ³•
- é£é™©é˜ˆå€¼æ£€æŸ¥æ–¹æ³•
- é£é™©äº‹ä»¶æ—¥å¿—æ–¹æ³•
- é£é™©æŒ‡æ ‡ç»Ÿè®¡æ–¹æ³•

---

### Step 4: åˆ›å»ºrisk_alerts.py (~400è¡Œ)ï¼ˆé¢„è®¡0.8å°æ—¶ï¼‰

**ä»»åŠ¡**:
- å‘Šè­¦è§„åˆ™ç®¡ç†æ–¹æ³•
- å‘Šè­¦æ¸ é“ç®¡ç†æ–¹æ³•
- å‘Šè­¦è§¦å‘å™¨æ–¹æ³•
- å‘Šè­¦é€šçŸ¥æ–¹æ³•
- å‘Šè­¦å†å²è®°å½•æ–¹æ³•

---

### Step 5: åˆ›å»ºrisk_settings.py (~400è¡Œ)ï¼ˆé¢„è®¡0.8å°æ—¶ï¼‰

**ä»»åŠ¡**:
- é£é™©å‚æ•°é…ç½®æ–¹æ³•
- é£é™©æ¨¡å‹é€‰æ‹©æ–¹æ³•
- é£é™©é˜ˆå€¼è®¾ç½®æ–¹æ³•
- ç”¨æˆ·é£é™©ç®¡ç†é…ç½®æ–¹æ³•

---

### Step 6: åˆ›å»ºrisk_calculator.py (~500è¡Œ)ï¼ˆé¢„è®¡1å°æ—¶ï¼‰

**ä»»åŠ¡**:
- VaRè®¡ç®—æ–¹æ³•
- CVaRè®¡ç®—æ–¹æ³•
- Sharpe Ratioè®¡ç®—æ–¹æ³•
- æœ€å¤§å›æ’¤è®¡ç®—æ–¹æ³•
- Betaç³»æ•°è®¡ç®—æ–¹æ³•
- æ³¢åŠ¨ç‡è®¡ç®—æ–¹æ³•

---

### Step 7: åˆ›å»ºrisk_dashboard.py (~350è¡Œ)ï¼ˆé¢„è®¡0.8å°æ—¶ï¼‰

**ä»»åŠ¡**:
- é£é™©ä»ªè¡¨ç›˜æ•°æ®æ±‡æ€»æ–¹æ³•
- é£é™©å›¾è¡¨æ•°æ®è·å–æ–¹æ³•
- é£é™©æŠ¥å‘Šç”Ÿæˆæ–¹æ³•
- å®æ—¶é£é™©ç›‘æ§UIæ–¹æ³•

---

### Step 8: åˆ›å»ºrisk_management_new.py (~200è¡Œ)ï¼ˆé¢„è®¡0.5å°æ—¶ï¼‰

**ä»»åŠ¡**:
- é‡æ–°å¯¼å‡ºæ‰€æœ‰é£é™©æ¨¡å—
- æä¾›ä¸åŸrisk_management.pyç›¸åŒçš„æ¥å£
- ç¡®ä¿ç°æœ‰ä»£ç å¯ä»¥æ— ç¼åˆ‡æ¢

---

### Step 9: æµ‹è¯•å’ŒéªŒè¯ï¼ˆé¢„è®¡1.5å°æ—¶ï¼‰

**ä»»åŠ¡**:
- è¿è¡Œæ‰€æœ‰é£é™©æ¨¡å—çš„å•å…ƒæµ‹è¯•
- æµ‹è¯•å‘åå…¼å®¹æ€§
- éªŒè¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸ“‹ **å¼€å§‹æ‰§è¡Œ**

**çŠ¶æ€**: âœ… å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥ç«‹å³å¼€å§‹æ‰§è¡ŒStep 1

**ä¸‹ä¸€æ­¥**: å¼€å§‹åˆ›å»ºç›®å½•ç»“æ„

---

**å®Œæˆæ—¶é—´**: 2026-01-30T10:30:00Z  
**æ‰§è¡Œäºº**: Claude Code  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: âœ… **Phase 1.4 å‡†å¤‡å®Œæˆ**

---

**æ³¨æ„**: Phase 1.3 å·²æˆåŠŸå®Œæˆï¼ˆæ‹†åˆ†data_adapter.pyï¼‰ï¼ŒPhase 1.4 æ˜¯ä¸‹ä¸€ä¸ªPythonæ–‡ä»¶æ‹†åˆ†ä»»åŠ¡

---

**å»ºè®®**: æ˜¯å¦ç«‹å³å¼€å§‹æ‰§è¡ŒPhase 1.4çš„æ‹†åˆ†å·¥ä½œï¼Ÿ

- **é€‰é¡¹A**: ç«‹å³å¼€å§‹æ‰§è¡Œæ‰€æœ‰æ‹†åˆ†æ­¥éª¤ï¼ˆé¢„è®¡8å°æ—¶ï¼‰
- **é€‰é¡¹B**: åˆ†é˜¶æ®µæ‰§è¡Œï¼Œå…ˆæ‹†åˆ†éƒ¨åˆ†æ¨¡å—éªŒè¯

è¯·å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©ï¼Œæˆ‘ä¼šç«‹å³æ‰§è¡Œï¼
