# Database Service æ‹†åˆ†æ–¹æ¡ˆ

**æ–‡ä»¶**: src/database/database_service.py (1,392è¡Œï¼‰
**çŠ¶æ€**: æ‰§è¡Œä¸­
**ç›®æ ‡**: æ‹†åˆ†ä¸º4ä¸ªæ¨¡å—ï¼Œæ¯ä¸ª < 500è¡Œ

---

## ğŸ“Š æ–‡ä»¶ç»“æ„åˆ†æ

### ä¸»è¦ç»„ä»¶è¯†åˆ«

1. **è¿æ¥ç®¡ç†** (~200è¡Œï¼‰
   - `get_stock_list` æ–¹æ³•
   - æ”¯æŒåˆ†é¡µå’Œç­›é€‰

2. **æŸ¥è¯¢æœåŠ¡** (~300è¡Œï¼‰
   - å¤šä¸ªæŸ¥è¯¢æ–¹æ³•
   - SQLæ„å»ºå’Œæ‰§è¡Œ

3. **äº‹åŠ¡æœåŠ¡** (~300è¡Œ)
   - äº‹åŠ¡ç®¡ç†
   - æ‰¹é‡æ“ä½œ

4. **è¿ç§»æœåŠ¡** (~200è¡Œï¼‰
   - æ•°æ®åº“è¿ç§»
   - è¡¨ç»“æ„ç®¡ç†

5. **æ•°æ®åº“è®¿é—®å±‚** (~200è¡Œ)
   - å®ä¾‹ç®¡ç†
   - è¿æ¥æ± 

6. **å·¥å…·å‡½æ•°** (~200è¡Œ)
   - æ•°æ®æ ¼å¼åŒ–
   - ç»“æœå¤„ç†

---

## ğŸ¯ æ‹†åˆ†æ–¹æ¡ˆ

```
src/database/services/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ connection_service.py          # è¿æ¥ç®¡ç† (~200è¡Œï¼‰
â”œâ”€â”€ query_service.py               # æŸ¥è¯¢æœåŠ¡ (~400è¡Œï¼‰
â”œâ”€â”€ transaction_service.py         # äº‹åŠ¡æœåŠ¡ (~300è¡Œï¼‰
â”œâ”€â”€ migration_service.py          # è¿ç§»æœåŠ¡ (~200è¡Œ)
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ helpers.py                 # å·¥å…·å‡½æ•° (~200è¡Œ)
```

**æ–‡ä»¶æ•°**: 6ä¸ªæ–‡ä»¶
**å¹³å‡è¡Œæ•°**: ~250è¡Œ/æ–‡ä»¶
**ç¬¦åˆæ ‡å‡†**: âœ… å…¨éƒ¨ < 500è¡Œ

---

## ğŸ“‹ å®æ–½æ­¥éª¤

### Phase 1: åˆ›å»ºæœåŠ¡ç›®å½•ç»“æ„ (30åˆ†é’Ÿï¼‰

#### Task 1.1: åˆ›å»ºç›®å½•
- [ ] åˆ›å»º `src/database/services/` ç›®å½•
- [ ] åˆ›å»º `src/database/services/utils/` å­ç›®å½•

#### Task 1.2: åˆ›å»º __init__.py
- [ ] åˆ›å»º `src/database/services/__init__.py`
- [ ] åˆ›å»º `src/database/services/utils/__init__.py`

---

### Phase 2: æ‹†åˆ†è¿æ¥ç®¡ç† (1-2å°æ—¶)

#### Task 2.1: æå–è¿æ¥ç›¸å…³ä»£ç 
- [ ] ä»database_service.pyæå–è¿æ¥ç®¡ç†é€»è¾‘
- [ ] åˆ›å»º `connection_service.py`
- [ ] å®ç° `DatabaseConnectionManager` ç±»

---

### Phase 3: æ‹†åˆ†æŸ¥è¯¢æœåŠ¡ (1-2å°æ—¶)

#### Task 3.1: æå–æŸ¥è¯¢æ–¹æ³•
- [ ] æå–æ‰€æœ‰æŸ¥è¯¢æ–¹æ³•
- [ ] åˆ›å»º `query_service.py`
- [ ] å®ç° `QueryService` ç±»
- [ ] åŒ…å«SQLæ„å»ºå’Œæ‰§è¡Œé€»è¾‘

---

### Phase 4: æ‹†åˆ†äº‹åŠ¡æœåŠ¡ (1-2å°æ—¶)

#### Task 4.1: æå–äº‹åŠ¡ç®¡ç†ä»£ç 
- [ ] æå–äº‹åŠ¡ç®¡ç†æ–¹æ³•
- [ ] åˆ›å»º `transaction_service.py`
- [ ] å®ç° `TransactionService` ç±»
- [ ] åŒ…å«äº‹åŠ¡å¼€å§‹ã€æäº¤ã€å›æ»šé€»è¾‘

---

### Phase 5: æ‹†åˆ†è¿ç§»æœåŠ¡ (1-2å°æ—¶)

#### Task 5.1: æå–è¿ç§»é€»è¾‘
- [ ] æå–æ•°æ®åº“è¿ç§»ç›¸å…³æ–¹æ³•
- [ ] åˆ›å»º `migration_service.py`
- [ ] å®ç° `MigrationService` ç±»
- [ ] åŒ…å«è¡¨ç»“æ„ç®¡ç†ã€æ•°æ®è¿ç§»é€»è¾‘

---

### Phase 6: æå–å·¥å…·å‡½æ•° (1å°æ—¶)

#### Task 6.1: æå–è¾…åŠ©å‡½æ•°
- [ ] æå–æ•°æ®æ ¼å¼åŒ–å’Œç»“æœå¤„ç†å‡½æ•°
- [ ] åˆ›å»º `utils/helpers.py`
- [ ] å®ç°å·¥å…·å‡½æ•°ç±»

---

### Phase 7: æ›´æ–°å¯¼å…¥è·¯å¾„ (30åˆ†é’Ÿ)

#### Task 7.1: æ›´æ–°ä¸» __init__.py
- [ ] æ›´æ–° `src/database/__init__.py`
- [ ] å¯¼å‡ºæ‰€æœ‰æ–°çš„æœåŠ¡ç±»

#### Task 7.2: å…¨å±€æœç´¢æ›¿æ¢
- [ ] æœç´¢æ—§çš„å¯¼å…¥è·¯å¾„
- [ ] æ›¿æ¢ä¸ºæ–°æœåŠ¡å¯¼å…¥
- [ ] éªŒè¯æ— å¾ªç¯ä¾èµ–

---

### Phase 8: æµ‹è¯•éªŒè¯ (1-2å°æ—¶)

#### Task 8.1: å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•æ¯ä¸ªæœåŠ¡ç±»çš„ç‹¬ç«‹æ€§
- [ ] éªŒè¯SQLæŸ¥è¯¢æ­£ç¡®æ€§
- [ ] æµ‹è¯•äº‹åŠ¡éš”ç¦»çº§åˆ«

#### Task 8.2: é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•æœåŠ¡é—´åä½œ
- [ ] éªŒè¯å®Œæ•´çš„æ•°æ®åº“æ“ä½œæµç¨‹
- [ ] å¯¹æ¯”æµ‹è¯•åŸºçº¿

---

## â± æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|--------|------|----------|
| Phase 1: åˆ›å»ºç›®å½• | 2ä¸ªå­ä»»åŠ¡ | 30åˆ†é’Ÿ |
| Phase 2: è¿æ¥æœåŠ¡ | 1ä¸ªå­ä»»åŠ¡ | 1-2å°æ—¶ |
| Phase 3: æŸ¥è¯¢æœåŠ¡ | 1ä¸ªå­ä»»åŠ¡ | 1-2å°æ—¶ |
| Phase 4: äº‹åŠ¡æœåŠ¡ | 1ä¸ªå­ä»»åŠ¡ | 1-2å°æ—¶ |
| Phase 5: è¿ç§»æœåŠ¡ | 1ä¸ªå­ä»»åŠ¡ | 1-2å°æ—¶ |
| Phase 6: å·¥å…·å‡½æ•° | 1ä¸ªå­ä»»åŠ¡ | 1å°æ—¶ |
| Phase 7: æ›´æ–°å¯¼å…¥ | 2ä¸ªå­ä»»åŠ¡ | 30åˆ†é’Ÿ |
| Phase 8: æµ‹è¯•éªŒè¯ | 2ä¸ªå­ä»»åŠ¡ | 1-2å°æ—¶ |
| **æ€»è®¡** | **11ä¸ªå­ä»»åŠ¡** | **~6-7å°æ—¶** |

---

## ğŸ¯ æ‹†åˆ†åŸåˆ™

1. **èŒè´£å•ä¸€**: æ¯ä¸ªæœåŠ¡ç±»ä¸“æ³¨ä¸€ä¸ªåŠŸèƒ½åŸŸ
2. **æ¥å£ç»Ÿä¸€**: æ‰€æœ‰æœåŠ¡éµå¾ªç›¸åŒçš„æ–¹æ³•ç­¾å
3. **ä¾èµ–æ¸…æ™°**: æœåŠ¡é—´é€šè¿‡ä¾èµ–æ³¨å…¥é€šä¿¡
4. **æ˜“äºæµ‹è¯•**: æ¯ä¸ªæœåŠ¡å¯ç‹¬ç«‹æµ‹è¯•
5. **å‘åå…¼å®¹**: ä¿ç•™åŸæ¥å£ï¼Œé€šè¿‡é€‚é…å±‚æä¾›

---

## ğŸ“Š æ–‡ä»¶æ¸…å•

### æ–°åˆ›å»ºçš„æ–‡ä»¶

1. **connection_service.py** (~200è¡Œ)
   - `DatabaseConnectionManager` ç±»
   - è¿æ¥æ± ç®¡ç†
   - PostgreSQLè¿æ¥é…ç½®

2. **query_service.py** (~400è¡Œ)
   - `QueryService` ç±»
   - SQLæŸ¥è¯¢æ„å»º
   - å‚æ•°åŒ–æŸ¥è¯¢
   - ç»“æœæ ¼å¼åŒ–

3. **transaction_service.py** (~300è¡Œ)
   - `TransactionService` ç±»
   - äº‹åŠ¡ç®¡ç†
   - æ‰¹é‡æ“ä½œæ”¯æŒ
   - éš”ç¦»çº§åˆ«æ§åˆ¶

4. **migration_service.py** (~200è¡Œ)
   - `MigrationService` ç±»
   - è¡¨ç»“æ„ç®¡ç†
   - æ•°æ®è¿ç§»
   - ç‰ˆæœ¬æ§åˆ¶

5. **utils/helpers.py** (~200è¡Œ)
   - `DatabaseHelpers` ç±»
   - æ•°æ®æ ¼å¼åŒ–
   - ç»“æœè½¬æ¢
   - é”™è¯¯å¤„ç†

### ä¿®æ”¹çš„æ–‡ä»¶

1. **src/database/__init__.py**
   - å¯¼å‡ºæ‰€æœ‰æ–°æœåŠ¡ç±»
   - æ›´æ–°å¯¼å…¥è·¯å¾„
   - å®šä¹‰æœåŠ¡æ¥å£

2. **database_service.py**
   - ä¿ç•™å‘åå…¼å®¹
   - é‡æ–°å¯¼å‡ºæ–°æœåŠ¡ç±»

---

## âœ… éªŒæ”¶æ ‡å‡†

### æ–‡ä»¶æ‹†åˆ†éªŒæ”¶
- [ ] æ‰€æœ‰æ–‡ä»¶ < 500è¡Œ
- [ ] æ¯ä¸ªæœåŠ¡èŒè´£å•ä¸€
- [ ] æ¨¡å—é—´ä¾èµ–æ¸…æ™°
- [ ] __init__.py å¯¼å‡ºè§„èŒƒ
- [ ] æ— å¾ªç¯ä¾èµ–

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰åŸæœ‰åŠŸèƒ½ä¿æŒä¸å˜
- [ ] æœåŠ¡æ¥å£ä¿æŒå…¼å®¹
- [ ] æµ‹è¯•é€šè¿‡ç‡ â‰¥ 95%
- [ ] æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™ï¼ˆÂ±5%ï¼‰

### è´¨é‡éªŒæ”¶
- [ ] ä»£ç ç¬¦åˆå¼€å‘è§„èŒƒ
- [ ] ç±»å‹æ³¨è§£å®Œæ•´
- [ ] æ–‡æ¡£å­—ç¬¦ä¸²æ¸…æ™°
- [ ] æ— é‡å¤ä»£ç 

---

## ğŸš€ åç»­è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œ**: å¼€å§‹ Phase 1 - åˆ›å»ºç›®å½•ç»“æ„
2. **åˆ›å»ºåˆ†æ”¯**: `refactor/database-services-split` åˆ†æ”¯
3. **æŒç»­æäº¤**: æ¯å®Œæˆä¸€ä¸ªæœåŠ¡æ¨¡å—æäº¤ä¸€æ¬¡
4. **è‡ªåŠ¨åŒ–**: è€ƒè™‘ä½¿ç”¨è„šæœ¬è¾…åŠ©æ‹†åˆ†

---

**æ–¹æ¡ˆç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2026-01-30T06:35:00Z
**çŠ¶æ€**: å¾…æ‰¹å‡†å’Œæ‰§è¡Œ
