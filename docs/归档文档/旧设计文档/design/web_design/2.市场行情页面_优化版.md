# äºŒã€å¸‚åœºè¡Œæƒ…é¡µé¢ - ä¼˜åŒ–ç‰ˆ

## é¡µé¢æ¦‚è¿°
å¸‚åœºè¡Œæƒ…é¡µé¢æ˜¯Aè‚¡é‡åŒ–äº¤æ˜“ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®å±•ç¤ºé¡µé¢ï¼Œæä¾›å®æ—¶è¡Œæƒ…ç›‘æ§ã€æŠ€æœ¯æŒ‡æ ‡åˆ†æå’Œä¸“ä¸šçº§æ•°æ®åˆ†æå·¥å…·ã€‚

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. å®æ—¶è¡Œæƒ…ç›‘æ§
**åŠŸèƒ½å®šä½**: å±•ç¤ºå…¨å¸‚åœºå®æ—¶è‚¡ç¥¨è¡Œæƒ…ï¼Œæ”¯æŒå¤šç»´åº¦ç­›é€‰å’Œæ“ä½œ

**ç»„ä»¶ç»“æ„**:
```python
# è‚¡ç¥¨é€‰æ‹©å™¨ (é¡¶éƒ¨ui.row)
- æ•°æ®æºåˆ‡æ¢ (ui.select):
  - AKShareå®æ—¶è¡Œæƒ…
  - Tushareå®æ—¶è¡Œæƒ…
  - é€šè¾¾ä¿¡TDXæ¥å£ (ä¸“ä¸šç‰ˆ)
  - Level-2æ·±åº¦è¡Œæƒ… (ä»˜è´¹æ¥å£)

- è‚¡ç¥¨æ± é€‰æ‹© (ui.select):
  - è‡ªé€‰è‚¡æ± 
  - æ²ªæ·±300æˆåˆ†è‚¡
  - ä¸­è¯500æˆåˆ†è‚¡
  - åˆ›ä¸šæ¿æŒ‡æˆåˆ†è‚¡
  - è‡ªå®šä¹‰è‚¡ç¥¨åˆ—è¡¨ (å¤šé€‰è¾“å…¥æ¡†)

# å®æ—¶è¡Œæƒ…è¡¨æ ¼ (ui.aggrid, ä¸»ä½“åŒºåŸŸ)
å­—æ®µè®¾è®¡:
- åŸºç¡€ä¿¡æ¯: ä»£ç  | åç§° | è¡Œä¸š | æ¿å—
- è¡Œæƒ…æ•°æ®: æœ€æ–°ä»· | æ¶¨è·Œå¹… | æ¶¨è·Œé¢ | ä»Šå¼€ | æœ€é«˜ | æœ€ä½ | æ˜¨æ”¶
- æˆäº¤æ•°æ®: æˆäº¤é‡ | æˆäº¤é¢ | æ¢æ‰‹ç‡ | é‡æ¯” | æŒ¯å¹…
- ä¼°å€¼æŒ‡æ ‡: å¸‚ç›ˆç‡ | å¸‚å‡€ç‡ | æ€»å¸‚å€¼

ç‰¹æ®Šæ˜¾ç¤º:
- æ¶¨åœæ ‡è®°: æ•´è¡Œçº¢è‰²èƒŒæ™¯ + "æ¶¨åœ"æ ‡ç­¾
- è·Œåœæ ‡è®°: æ•´è¡Œç»¿è‰²èƒŒæ™¯ + "è·Œåœ"æ ‡ç­¾
- STè‚¡ç¥¨: é»„è‰²"ST"badge
- åœç‰Œè‚¡ç¥¨: ç°è‰²æ˜¾ç¤º
- æ–°è‚¡ä¸Šå¸‚: è“è‰²"N"æ ‡è®°
```

**å®æ—¶æ›´æ–°æœºåˆ¶**:
```python
# WebSocketè¿æ¥ç®¡ç†
import asyncio
import websockets

class MarketDataClient:
    async def connect_realtime(self, symbols):
        uri = "ws://localhost:8000/ws/market/realtime"
        async with websockets.connect(uri) as websocket:
            # å‘é€è®¢é˜…è¯·æ±‚
            await websocket.send(json.dumps({
                "action": "subscribe",
                "symbols": symbols
            }))

            # ç›‘å¬å®æ—¶æ•°æ®
            async for message in websocket:
                data = json.loads(message)
                self.update_table(data)

# å‰ç«¯æ›´æ–°é€»è¾‘
def update_quote_table(data):
    for row in data:
        grid_api.update_row_data([row])
```

**é«˜çº§åŠŸèƒ½**:
```python
# å¿«é€Ÿç­›é€‰å™¨ (ui.input)
- è¾“å…¥ä»£ç /åç§°å¿«é€Ÿæœç´¢
- æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œæ‹¼éŸ³åŒ¹é…

# é«˜çº§ç­›é€‰é¢æ¿ (ui.dialog)
ç­›é€‰æ¡ä»¶:
- æ¶¨è·Œå¹…èŒƒå›´: -10% ~ +10% (åŒæ»‘å—)
- æˆäº¤é¢èŒƒå›´: >1äº¿ (æ•°å€¼è¾“å…¥)
- é‡æ¯”èŒƒå›´: >2 (æ•°å€¼è¾“å…¥)
- æ¢æ‰‹ç‡èŒƒå›´: >5% (æ»‘å—)
- å¸‚å€¼èŒƒå›´: 100äº¿ä»¥ä¸‹/ä»¥ä¸Š
- è¡Œä¸šç­›é€‰: å¤šé€‰ä¸‹æ‹‰æ¡†
- æ¦‚å¿µç­›é€‰: å¤šé€‰æ ‡ç­¾

# å³é”®èœå• (context menu)
æ“ä½œé€‰é¡¹:
- æŸ¥çœ‹Kçº¿å›¾ (è·³è½¬åˆ°æŠ€æœ¯åˆ†æTab)
- åŠ å…¥è‡ªé€‰è‚¡ (è°ƒç”¨æ·»åŠ API)
- æŸ¥çœ‹èµ„é‡‘æµå‘ (è·³è½¬èµ„é‡‘æµå‘é¡µé¢)
- æŸ¥çœ‹é¾™è™æ¦œ (è·³è½¬é¾™è™æ¦œé¡µé¢)
- å¤åˆ¶è‚¡ç¥¨ä»£ç 
- æŸ¥çœ‹åŸºæœ¬é¢ä¿¡æ¯
```

**æ•°æ®æ¥å£**:
```python
# è·å–å®æ—¶è¡Œæƒ…
GET /api/v1/market/quotes
å‚æ•°:
- symbols: è‚¡ç¥¨ä»£ç åˆ—è¡¨ (é€—å·åˆ†éš”)
- fields: æŒ‡å®šè¿”å›å­—æ®µ
- source: æ•°æ®æº (akshare/tushare/tdx)

# WebSocketå®æ—¶æ¨é€
WebSocket: /ws/market/realtime
æ¶ˆæ¯æ ¼å¼:
{
    "type": "quote_update",
    "data": {
        "600036": {
            "code": "600036",
            "name": "æ‹›å•†é“¶è¡Œ",
            "price": 32.50,
            "change": 1.25,
            "change_pct": 3.89,
            "volume": 125800000,
            "amount": 4085000000,
            "timestamp": "2025-11-12T08:30:00Z"
        }
    }
}
```

### 2. æŠ€æœ¯æŒ‡æ ‡åˆ†æ
**åŠŸèƒ½å®šä½**: æä¾›ä¸“ä¸šçš„æŠ€æœ¯åˆ†æå·¥å…·ï¼Œæ”¯æŒå¤šç§æŒ‡æ ‡å’Œè‡ªå®šä¹‰å…¬å¼

**ç»„ä»¶ç»“æ„**:
```python
# è‚¡ç¥¨é€‰æ‹©å™¨ (é¡¶éƒ¨ui.inputè‡ªåŠ¨è¡¥å…¨)
- è¾“å…¥ä»£ç /åç§°/æ‹¼éŸ³è‡ªåŠ¨æœç´¢
- æ”¯æŒå†å²æŸ¥çœ‹è®°å½• (æœ€è¿‘10åª)
- æ”¶è—å¸¸ç”¨è‚¡ç¥¨å¿«é€Ÿè®¿é—®

# Kçº¿å›¾ä¸»åŒºåŸŸ (ui.plotly, 70%é«˜åº¦)
ä¸»å›¾å†…å®¹:
- Kçº¿å›¾ (çº¢æ¶¨ç»¿è·Œï¼Œæ”¯æŒå¤æƒåˆ‡æ¢)
- å‡çº¿ç³»ç»Ÿ (MA5/10/20/60/120/250)
- å¸ƒæ—å¸¦ (BOLLä¸Šä¸­ä¸‹è½¨ï¼Œå¯è°ƒèŠ‚å‚æ•°)
- æˆäº¤é‡æŸ±çŠ¶å›¾ (å‰¯å›¾1)

æŠ€æœ¯æŒ‡æ ‡å‰¯å›¾:
- MACD (å‰¯å›¾2): DIF/DEAçº¿ + MACDæŸ±çŠ¶å›¾
- RSI (å‰¯å›¾3): ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡ï¼Œè¶…ä¹°è¶…å–çº¿
- KDJ (å‰¯å›¾4): éšæœºæŒ‡æ ‡ï¼ŒK/D/Jä¸‰çº¿

# æŒ‡æ ‡é…ç½®é¢æ¿ (å³ä¾§ui.column, 30%å®½åº¦)
TA-LibæŒ‡æ ‡åº“ (åˆ†ç±»æ˜¾ç¤º):
â”œâ”€ è¶‹åŠ¿æŒ‡æ ‡
â”‚  â”œâ”€ MA/EMA/SMA (ç§»åŠ¨å¹³å‡çº¿)
â”‚  â”œâ”€ MACD (æŒ‡æ•°å¹³æ»‘å¼‚åŒç§»åŠ¨å¹³å‡)
â”‚  â”œâ”€ BOLL (å¸ƒæ—å¸¦)
â”‚  â”œâ”€ ADX (å¹³å‡æ–¹å‘æŒ‡æ•°)
â”‚  â””â”€ SAR (æŠ›ç‰©çº¿è½¬å‘æŒ‡æ ‡)
â”œâ”€ åŠ¨é‡æŒ‡æ ‡
â”‚  â”œâ”€ RSI (ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡)
â”‚  â”œâ”€ KDJ (éšæœºæŒ‡æ ‡)
â”‚  â”œâ”€ CCI (å•†å“é€šé“æŒ‡æ•°)
â”‚  â”œâ”€ WR (å¨å»‰æŒ‡æ ‡)
â”‚  â””â”€ ROC (å˜åŠ¨ç‡æŒ‡æ ‡)
â”œâ”€ æˆäº¤é‡æŒ‡æ ‡
â”‚  â”œâ”€ OBV (èƒ½é‡æ½®)
â”‚  â”œâ”€ VOL (æˆäº¤é‡)
â”‚  â”œâ”€ VRSI (æˆäº¤é‡RSI)
â”‚  â””â”€ MFI (èµ„é‡‘æµæŒ‡æ•°)
â””â”€ æ³¢åŠ¨ç‡æŒ‡æ ‡
   â”œâ”€ ATR (å¹³å‡çœŸå®æ³¢å¹…)
   â”œâ”€ KELTNER (è‚¯ç‰¹çº³é€šé“)
   â””â”€ å¸ƒæ—å¸¦å®½åº¦
```

**äº¤äº’åŠŸèƒ½**:
```python
# æ—¶é—´èŒƒå›´é€‰æ‹© (ui.button_group)
- è¿‘1æœˆ | è¿‘3æœˆ | è¿‘6æœˆ | è¿‘1å¹´ | è¿‘3å¹´ | å…¨éƒ¨ | è‡ªå®šä¹‰

# å‘¨æœŸåˆ‡æ¢ (ui.select)
- æ—¥çº¿ | å‘¨çº¿ | æœˆçº¿ | 60åˆ†é’Ÿ | 30åˆ†é’Ÿ | 15åˆ†é’Ÿ | 5åˆ†é’Ÿ | 1åˆ†é’Ÿ

# å¤æƒåˆ‡æ¢ (ui.select)
- å‰å¤æƒ (é»˜è®¤)
- åå¤æƒ
- ä¸å¤æƒ

# å›¾è¡¨äº¤äº’
- åå­—å…‰æ ‡ (æ˜¾ç¤ºç²¾ç¡®OHLCæ•°æ®)
- åŒºé—´é€‰æ‹© (æ¡†é€‰è®¡ç®—æ¶¨è·Œå¹…ã€æœ€å¤§å›æ’¤ã€æ³¢åŠ¨ç‡)
- ç¼©æ”¾æ‹–æ‹½ (é¼ æ ‡æ»šè½®ç¼©æ”¾ã€æ‹–æ‹½å¹³ç§»)
- æ—¶é—´è½´å¯¼èˆª (ç‚¹å‡»æ—¶é—´è½´å¿«é€Ÿè·³è½¬)
```

**è‡ªå®šä¹‰æŒ‡æ ‡ç¼–è¾‘å™¨**:
```python
# æŒ‡æ ‡å…¬å¼ç¼–è¾‘å™¨ (ui.code)
æ”¯æŒPythonè¯­æ³•:
import pandas as pd
import numpy as np

def custom_indicator(df):
    """
    è‡ªå®šä¹‰æŒ‡æ ‡è®¡ç®—å…¬å¼
    dfåŒ…å«: open, high, low, close, volumeåˆ—
    """
    # ç¤ºä¾‹: ä»·æ ¼åç¦»å‡çº¿ç™¾åˆ†æ¯”
    ma20 = df['close'].rolling(20).mean()
    deviation = (df['close'] - ma20) / ma20 * 100
    return deviation

# æŒ‡æ ‡å‚æ•°é…ç½®
- å‚æ•°è¾“å…¥æ¡† (åŠ¨æ€ç”Ÿæˆui.number/ui.select)
- å‚æ•°è¯´æ˜ (ui.markdown)
- å®æ—¶é¢„è§ˆæ•ˆæœ
```

**æ•°æ®æ¥å£**:
```python
# è·å–Kçº¿æ•°æ®
GET /api/v1/market/kline/{symbol}
å‚æ•°:
- period: å‘¨æœŸ (1m/5m/15m/30m/1h/1d/1w/1m)
- start_date: å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)
- end_date: ç»“æŸæ—¥æœŸ (YYYY-MM-DD)
- adjust: å¤æƒç±»å‹ (qfq/hqf/wqf)

# è·å–æŠ€æœ¯æŒ‡æ ‡
GET /api/v1/indicators/calc
å‚æ•°:
- symbol: è‚¡ç¥¨ä»£ç 
- indicator: æŒ‡æ ‡åç§° (macd/rsi/kdj/bollç­‰)
- period: è®¡ç®—å‘¨æœŸ
- params: æŒ‡æ ‡å‚æ•° (JSONæ ¼å¼)

# è‡ªå®šä¹‰æŒ‡æ ‡è®¡ç®—
POST /api/v1/indicators/custom
Body:
{
    "symbol": "600036",
    "formula": "è‡ªå®šä¹‰æŒ‡æ ‡Pythonä»£ç ",
    "params": {
        "param1": 14,
        "param2": 20
    }
}
```

### 3. TDXé€šè¾¾ä¿¡æ¥å£
**åŠŸèƒ½å®šä½**: é›†æˆé€šè¾¾ä¿¡ä¸“ä¸šç‰ˆæ•°æ®ï¼Œæä¾›Level-2æ·±åº¦è¡Œæƒ…

**ç»„ä»¶ç»“æ„**:
```python
# TDXè¿æ¥é…ç½® (é¡¶éƒ¨ui.card)
- æœåŠ¡å™¨åœ°å€ (ui.input): 127.0.0.1
- ç«¯å£ (ui.number): 7709
- è¿æ¥çŠ¶æ€æŒ‡ç¤º (ui.badge): ğŸŸ¢å·²è¿æ¥ / ğŸ”´æœªè¿æ¥
- è¿æ¥æµ‹è¯•æŒ‰é’® (ui.button)
- é‡è¿æŒ‰é’® (ui.button)

# TDXç‰¹è‰²æ•°æ®å±•ç¤º (ui.tabs)
Tab1: Level-2ç›˜å£æ•°æ®
- åæ¡£ä¹°å–ç›˜ (ui.table):
  ä¹°ç›˜: ä¹°1ä»·/é‡ ~ ä¹°10ä»·/é‡ (ç»¿è‰²èƒŒæ™¯)
  å–ç›˜: å–1ä»·/é‡ ~ å–10ä»·/é‡ (çº¢è‰²èƒŒæ™¯)
- ç›˜å£åšåº¦åˆ†æ (ui.chartæŸ±çŠ¶å›¾)

Tab2: é€ç¬”æˆäº¤æ•°æ®
- å®æ—¶æˆäº¤æ˜ç»† (ui.table):
  - æˆäº¤æ—¶é—´ | æˆäº¤ä»·æ ¼ | æˆäº¤é‡ | æ€§è´¨ (ä¹°å…¥/å–å‡º)
- å¤§å•æ ‡è®° (>1000æ‰‹é«˜äº®)
- æˆäº¤å¯†åº¦åˆ†æ (ui.plotly)

Tab3: åˆ†æ—¶æˆäº¤æ˜ç»†
- åˆ†æ—¶æˆäº¤é‡ (ui.plotly):
  - æ¯åˆ†é’Ÿæˆäº¤é‡æŸ±çŠ¶å›¾
  - ä¸»åŠ¨ä¹°å…¥/å–å‡ºåˆ†è‰²æ˜¾ç¤º
- èµ„é‡‘æµå‘ç»Ÿè®¡
- å¤§å•è½¨è¿¹è¿½è¸ª
```

**TDXä¸“ç”¨åŠŸèƒ½**:
```python
# æ¿å—è”åŠ¨åˆ†æ
- æ‰€å±æ¿å—å®æ—¶æ¶¨è·Œ
- æ¿å—å†…ä¸ªè‚¡æ’å
- æ¿å—èµ„é‡‘æµå‘
- é¾™å¤´è‚¡è¯†åˆ«

# èµ„é‡‘æµå‘åˆ†æ
- ä¸»åŠ›èµ„é‡‘æµå…¥æµå‡º
- æ•£æˆ·èµ„é‡‘åŠ¨å‘
- æœºæ„vsæ¸¸èµ„å¯¹æ¯”
- èµ„é‡‘æµå‘è¶‹åŠ¿

# æŠ€æœ¯åˆ†æå¢å¼º
- åˆ†æ—¶å‡ä»·çº¿å åŠ 
- ä¹°å–åŠ›é“å¯¹æ¯”å›¾
- å†…å¤–ç›˜æ¯”ä¾‹ç»Ÿè®¡
- å§”æ¯”å§”å·®è®¡ç®—

# é¢„è­¦åŠŸèƒ½
- å¤§å•ä¹°å…¥é¢„è­¦
- å¼‚åŠ¨è‚¡ç¥¨æé†’
- æ¶¨è·Œåœæ¿ç›‘æ§
- æˆäº¤é‡å¼‚å¸¸é¢„è­¦
```

**æ•°æ®æ¥å£**:
```python
# TDXè¿æ¥ç®¡ç†
POST /api/v1/tdx/connect
Body: {"host": "127.0.0.1", "port": 7709}

# è·å–Level-2æ•°æ®
GET /api/v1/tdx/level2/{symbol}
è¿”å›: åæ¡£ä¹°å–ç›˜ + é€ç¬”æˆäº¤

# è·å–åˆ†æ—¶æ•°æ®
GET /api/v1/tdx/minute/{symbol}
è¿”å›: åˆ†æ—¶æˆäº¤ + èµ„é‡‘æµå‘

# æ¿å—æ•°æ®
GET /api/v1/tdx/sector/{industry}
è¿”å›: æ¿å—å†…ä¸ªè‚¡ + æ¶¨è·Œå¹…æ’å
```

### 4. æ•°æ®å­˜å‚¨è®¾è®¡

**PostgreSQLè¡¨ç»“æ„**:
```sql
-- è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
CREATE TABLE stock_basic (
    stock_code VARCHAR(10) PRIMARY KEY,
    stock_name VARCHAR(50),
    industry VARCHAR(30),
    concept TEXT,  -- JSONæ•°ç»„æ ¼å¼
    list_date DATE,
    market VARCHAR(10),  -- SH/SZ
    is_st BOOLEAN DEFAULT false,
    is_new BOOLEAN DEFAULT false
);

-- æŠ€æœ¯æŒ‡æ ‡é…ç½®
CREATE TABLE indicator_config (
    indicator_id SERIAL PRIMARY KEY,
    indicator_name VARCHAR(50),
    indicator_formula TEXT,  -- Pythonä»£ç 
    parameters JSONB,
    is_builtin BOOLEAN DEFAULT false,
    create_time TIMESTAMP DEFAULT NOW()
);

-- TDXè¿æ¥é…ç½®
CREATE TABLE tdx_config (
    config_id SERIAL PRIMARY KEY,
    server_address VARCHAR(50),
    port INT,
    is_active BOOLEAN DEFAULT true,
    last_connected TIMESTAMP,
    connection_status VARCHAR(20)
);
```

**TDengineè¡¨ç»“æ„**:
```sql
-- å®æ—¶è¡Œæƒ…è¶…çº§è¡¨
CREATE STABLE realtime_quote (
    ts TIMESTAMP,
    open_price DOUBLE,
    high_price DOUBLE,
    low_price DOUBLE,
    close_price DOUBLE,
    volume BIGINT,
    amount DOUBLE,
    turnover_rate DOUBLE,
    pe_ratio DOUBLE,
    pb_ratio DOUBLE
) TAGS (
    stock_code NCHAR(10),
    stock_name NCHAR(20),
    market NCHAR(10)
);

-- æŠ€æœ¯æŒ‡æ ‡ç»“æœè¶…çº§è¡¨
CREATE STABLE indicator_data (
    ts TIMESTAMP,
    indicator_value DOUBLE,
    signal INT  -- 1ä¹°å…¥/-1å–å‡º/0ä¸­æ€§
) TAGS (
    stock_code NCHAR(10),
    indicator_name NCHAR(50),
    period NCHAR(10)
);
```

## æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
```python
# è™šæ‹Ÿæ»šåŠ¨ (AG Grid)
gridOptions = {
    'rowBuffer': 100,  -- ç¼“å†²åŒºè¡Œæ•°
    'rowSelection': 'multiple',
    'suppressRowClickSelection': True,
    'cacheQuickFilter': True,
    'domLayout': 'autoHeight'
}

# æ•°æ®åˆ†é¡µ
def get_paginated_quotes(page=1, page_size=100):
    offset = (page - 1) * page_size
    # æ•°æ®åº“åˆ†é¡µæŸ¥è¯¢
    return quotes[offset:offset + page_size]
```

### åç«¯ä¼˜åŒ–
```python
# Redisç¼“å­˜
import redis
r = redis.Redis(host='localhost', port=6379, db=1)

# è¡Œæƒ…æ•°æ®ç¼“å­˜ (30ç§’è¿‡æœŸ)
def get_realtime_quotes(symbols):
    cache_key = f"quotes:{hash(frozenset(symbols))}"
    cached_data = r.get(cache_key)

    if cached_data:
        return json.loads(cached_data)

    # ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®
    quotes = fetch_latest_quotes(symbols)
    r.setex(cache_key, 30, json.dumps(quotes))
    return quotes

# WebSocketè¿æ¥æ± 
import asyncio
from asyncio import Queue

class MarketDataBroadcaster:
    def __init__(self):
        self.connections = set()
        self.data_queue = Queue()

    async def broadcast(self, data):
        if self.connections:
            disconnected = set()
            for ws in self.connections:
                try:
                    await ws.send(json.dumps(data))
                except:
                    disconnected.add(ws)
            self.connections -= disconnected
```

## Aè‚¡ç‰¹è‰²å¤„ç†

### äº¤æ˜“è§„åˆ™é€‚é…
```python
# T+1äº¤æ˜“é™åˆ¶
def check_trading_restriction(symbol, action, quantity):
    # æ£€æŸ¥æ˜¯å¦ä»Šæ—¥ä¹°å…¥
    today_buys = get_today_buys(symbol)
    if today_buys > 0 and action == 'SELL':
        return {
            'allowed': False,
            'reason': 'T+1é™åˆ¶ï¼Œä»Šæ—¥ä¹°å…¥è‚¡ç¥¨æ— æ³•å–å‡º',
            'available_quantity': 0
        }
    return {'allowed': True}

# æ¶¨è·Œåœé™åˆ¶
def check_price_limit(symbol, target_price):
    last_close = get_last_close_price(symbol)
    if last_close:
        upper_limit = last_close * 1.10  # æ¶¨åœä»·
        lower_limit = last_close * 0.90  # è·Œåœä»·

        if target_price > upper_limit:
            return {'allowed': False, 'reason': 'è¶…è¿‡æ¶¨åœä»·'}
        if target_price < lower_limit:
            return {'allowed': False, 'reason': 'ä½äºè·Œåœä»·'}

    return {'allowed': True}

# 100è‚¡æ•´æ•°å€éªŒè¯
def validate_quantity(quantity):
    if quantity % 100 != 0:
        return {
            'valid': False,
            'reason': 'Aè‚¡äº¤æ˜“æ•°é‡å¿…é¡»ä¸º100çš„æ•´æ•°å€',
            'adjusted_quantity': (quantity // 100) * 100
        }
    return {'valid': True}
```

### ç‰¹æ®Šæ ‡è®°æ˜¾ç¤º
```python
# æ¶¨åœè·Œåœæ ‡è®°
def get_price_limit_status(price, change_pct):
    if change_pct >= 9.8:  # æ¶¨åœ
        return {'status': 'limit_up', 'color': 'red', 'badge': 'æ¶¨åœ'}
    elif change_pct <= -9.8:  # è·Œåœ
        return {'status': 'limit_down', 'color': 'green', 'badge': 'è·Œåœ'}
    else:
        return {'status': 'normal'}

# STè‚¡ç¥¨æ ‡è®°
def get_st_mark(stock_info):
    if stock_info.get('is_st'):
        return {'badge': 'ST', 'color': 'orange'}
    return None
```

## MVPéªŒæ”¶æ ‡å‡†
1. **åŸºç¡€è¡Œæƒ…æ˜¾ç¤º**: èƒ½æ­£ç¡®æ˜¾ç¤ºå®æ—¶è¡Œæƒ…è¡¨æ ¼ï¼Œæ”¯æŒæ’åºå’Œç­›é€‰
2. **æŠ€æœ¯æŒ‡æ ‡å±•ç¤º**: Kçº¿å›¾èƒ½æ­£ç¡®æ˜¾ç¤ºï¼ŒæŒ‡æ ‡è®¡ç®—ç»“æœå‡†ç¡®
3. **å®æ—¶æ›´æ–°**: WebSocketè¿æ¥ç¨³å®šï¼Œ3ç§’å†…æ•°æ®æ›´æ–°
4. **TDXé›†æˆ**: é€šè¾¾ä¿¡è¿æ¥æ­£å¸¸ï¼Œèƒ½è·å–Level-2æ•°æ®
5. **æ€§èƒ½è¦æ±‚**: æ”¯æŒ1000åªè‚¡ç¥¨åŒæ—¶æ˜¾ç¤ºï¼Œå“åº”æ—¶é—´<2ç§’

## å¼€å‘ä¼˜å…ˆçº§
1. **P0**: å®æ—¶è¡Œæƒ…è¡¨æ ¼ + åŸºç¡€Kçº¿å›¾
2. **P1**: TA-LibæŠ€æœ¯æŒ‡æ ‡é›†æˆ
3. **P2**: WebSocketå®æ—¶æ›´æ–° + é«˜çº§ç­›é€‰
4. **P3**: TDXæ¥å£é›†æˆ + è‡ªå®šä¹‰æŒ‡æ ‡
5. **P4**: Level-2æ•°æ® + ä¸“ä¸šåˆ†æå·¥å…·

---

**Owner**: å‰ç«¯(NiceGUI) + åç«¯å·¥ç¨‹å¸ˆ + æ•°æ®å·¥ç¨‹
**æŠ€æœ¯éš¾ç‚¹**: WebSocketé«˜é¢‘æ•°æ®æ¨é€ã€æŠ€æœ¯æŒ‡æ ‡å®æ—¶è®¡ç®—ã€å¤§æ•°æ®é‡è¡¨æ ¼æ€§èƒ½
**é¢„è®¡å¼€å‘æ—¶é—´**: 3å‘¨
**ä¾èµ–å…³ç³»**: éœ€è¦TA-Libåº“ã€TDengineæ•°æ®åº“ã€é€šè¾¾ä¿¡å®¢æˆ·ç«¯
