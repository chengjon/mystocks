# 项目数据工作流程

**文档版本**: v1.0
**创建日期**: 2025-10-20
**创建人**: JohnC
**适用范围**: MyStocks量化交易数据管理系统（以下简称：本系统）

菜单项目的格式参考：
功能实现：使用easyquotation的update_stock_codes()函数获取
输出格式：list
数据保存：postgresql
应用范围：任何需要查询全市场股票代码的位置
备注：无
相关代码：无

[1. 数据初始化](#1-数据初始化)





# 1. 数据初始化
目的：数据初始化的目的是为了提前处理本系统各项功能所需的数据。
数据来源：有三个，一是通过本项目设计的相关Adapter接口接入；二是通过tdx接口，从tdx的工作目录抓取；三是通过本项目连接的本地数据库。
初始化的数据列表与频率：

## 1.1 获取全市场股票代码
功能实现：使用easyquotation的update_stock_codes()函数获取
输出格式：list
数据保存：postgresql
应用范围：任何需要查询全市场股票代码的位置
备注：无
相关代码：
"""
import easyquotation as eq
import pandas as pd
#获取所有股票代码
codes = eq.update_stock_codes()
"""


## 1.2 获取Shanghai/Shenzhen (SHSZ) and Hong Kong (HKEX)市场日历
功能实现：使用https://github.com/rainx/cn_stock_holidays.git 安装。本项目已经用uv pip install cn-stock-holidays安装本项目，
输出格式：list
数据保存：数据提取下来后，保存在本项目目录下：config/calendars/day.txt和config/calendars/day_future.txt
应用范围：任何需要查询全市场股票代码的位置
备注：当前版本：cn-stock-holidays==2.1.3
相关代码：

## 1.3 农历日期
功能实现：安装方式：npm install --save chinese-lunar-calendar
输出格式：
数据保存：
应用范围：web页面首页上面的卡片中的日期，把当前的日期和农历日期显示在： 统计卡片区的日期卡片上（没有可新建）
备注：
相关代码：
"""
import { getLunar } from 'chinese-lunar-calendar'
getLunar() {
    let data = getLunar(new Date().getFullYear(), (new Date().getMonth() + 1), new Date().getDate());
    console.log(data);
    return data.dateStr
},
"""


## 1.4 获取全市场行情
功能实现：使用easyquotation的market_snapshot()函数获取
输出格式：DataFrame
数据保存：postgresql
应用范围：任何需要引用或查询全市场股票行情的位置
备注：无
相关代码：
"""
import easyquotation as eq
import pandas as pd

#选择行情
quotation = eq.use('tencent') # 新浪 ['sina'] 腾讯 ['tencent', 'qq']
#获取所有股票行情
# prefix 指定返回行情的股票代码是否带 sz/sh/bj 市场前缀
market_data = quotation.market_snapshot(prefix=True)
# 将数据转换为DataFrame
df = pd.DataFrame.from_dict(market_data, orient='index')
"""

## 1.5 获取行业分类信息

### 1.5.1 证监会行业分类数据
功能实现：使用数据源：http://www.csrc.gov.cn/csrc/c100103/common_list.shtml
输出格式：SQL表
数据保存：postgresql
应用范围：任何需要引用或查询行业分类数据的位置
备注：目前已经从数据源抓取了相关数据保存在MySQL中，地址如下：
"""
引用数据库：MySQL
地址：192.168.123.104:3306
name: root
password: c790414J
数据库名：mystocks
表名：security_class_2024
"""
相关代码：


### 1.5.2 baostock行业分类
功能实现：bs.query_stock_industry() 函数获取
输出格式：list
数据保存：postgresql数据库中的bs_blocks表
应用范围：任何需要引用或查询行业分类数据的位置
备注：无
相关代码：
"""
数据格式：
Index(['updateDate', 'code', 'code_name', 'industry', 'industryClassification'],      dtype='object')
import baostock as bs
import pandas as pd

# 登陆系统
lg = bs.login()
# 获取行业分类数据
rs = bs.query_stock_industry()
# 打印结果集
industry_list = []
while (rs.error_code == '0') & rs.next():
    # 获取一条记录，将记录合并在一起
    industry_list.append(rs.get_row_data())
result = pd.DataFrame(industry_list, columns=rs.fields)
# 结果集输出到csv文件
#result.to_csv("D:/stock_industry.csv", encoding="gbk", index=False)
print(result)
"""

### 1.5.3 通达信获取本地数据
功能实现：从TDX获取行业板块数据

输出格式：list
数据保存：postgresql数据库中的tdx_blocks表。
应用范围：任何需要查询全市场股票代码的位置
备注：详见：TDX目录规则.md
相关代码：
"""
先确认TDX安装地址："D:\ProgramData\tdx_new\"
"D:\ProgramData\tdx_new\incon.dat"
trading4/tdx_block_data: 通达信行业板块，概念板块，风格板块，指数板块，细分行业成分股数据读取获取
/opt/claude/mystocks_spec/data_sources/tdx/block_file

使用read_tdx_day_file.py来读取TDX
/opt/claude/mystocks_spec/data_sources/tdx/read_tdx_day_file.py
把读取到的数据保存到postgresql
"""
