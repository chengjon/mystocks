# ArtDeco V3.0 å›¾è¡¨ç»„ä»¶è§†è§‰å›å½’æµ‹è¯•æ–¹æ¡ˆ

**ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-25
**é¡¹ç›®**: MyStocksé‡åŒ–äº¤æ˜“æ•°æ®ç®¡ç†ç³»ç»Ÿ
**çŠ¶æ€**: æ–¹æ¡ˆè®¾è®¡

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æµ‹è¯•ç›®æ ‡ä¸èŒƒå›´](#æµ‹è¯•ç›®æ ‡ä¸èŒƒå›´)
3. [å·¥å…·é€‰å‹](#å·¥å…·é€‰å‹)
4. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
5. [å®ç°æ–¹æ¡ˆ](#å®ç°æ–¹æ¡ˆ)
6. [æµ‹è¯•ç”¨ä¾‹è®¾è®¡](#æµ‹è¯•ç”¨ä¾‹è®¾è®¡)
7. [CI/CDé›†æˆ](#cicdé›†æˆ)
8. [æŠ¥å‘Šä¸ç›‘æ§](#æŠ¥å‘Šä¸ç›‘æ§)
9. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
10. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)

---

## æ¦‚è¿°

### èƒŒæ™¯

ArtDeco V3.0 Webè®¾è®¡ç³»ç»Ÿå·²å®ŒæˆPhase 0-3å‡çº§ï¼ŒåŒ…æ‹¬ï¼š
- 20ä¸ªEChartså›¾è¡¨ç»„ä»¶åº”ç”¨ArtDecoä¸»é¢˜
- å®Œæ•´çš„é¢œè‰²ã€å­—ä½“ã€åŠ¨æ•ˆç³»ç»Ÿ
- 6ä¸ªç”Ÿäº§ç¯å¢ƒå›¾è¡¨ç»„ä»¶æ–°å¢ä¸»é¢˜åº”ç”¨

ä¸ºç¡®ä¿è®¾è®¡ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ï¼Œéœ€è¦å»ºç«‹**è§†è§‰å›å½’æµ‹è¯•**æœºåˆ¶ï¼Œé˜²æ­¢æ ·å¼é€€åŒ–ã€‚

### å®šä¹‰

**è§†è§‰å›å½’æµ‹è¯• (Visual Regression Testing)**:
é€šè¿‡æˆªå›¾å¯¹æ¯”ï¼Œè‡ªåŠ¨æ£€æµ‹UIç•Œé¢åœ¨ä»£ç å˜æ›´åæ˜¯å¦å‘ç”Ÿæ„å¤–çš„è§†è§‰å˜åŒ–ã€‚

### æ ¸å¿ƒä»·å€¼

| ä»·å€¼ | æè¿° |
|------|------|
| æ—©æœŸå‘ç°é—®é¢˜ | åœ¨CIä¸­æ•è·æ„å¤–çš„è®¾è®¡å˜æ›´ |
| å‡å°‘äººå·¥å®¡æ ¸ | è‡ªåŠ¨åŒ–æˆªå›¾å¯¹æ¯”ï¼Œå‡å°‘äººå·¥å·¥ä½œé‡ |
| è®°å½•å˜æ›´å†å² | ä¿å­˜æ¯æ¬¡æ„å»ºçš„æˆªå›¾ï¼Œä¾¿äºè¿½æº¯ |
| ä¿éšœè®¾è®¡ä¸€è‡´æ€§ | ç¡®ä¿æ‰€æœ‰é¡µé¢ç¬¦åˆArtDeco V3.0è§„èŒƒ |

---

## æµ‹è¯•ç›®æ ‡ä¸èŒƒå›´

### æµ‹è¯•ç›®æ ‡

1. **æ•è·æ„å¤–å˜æ›´**: è¯†åˆ«ä»£ç å˜æ›´å¯¼è‡´çš„éé¢„æœŸè§†è§‰å˜åŒ–
2. **éªŒè¯è®¾è®¡ä¸€è‡´æ€§**: ç¡®ä¿æ‰€æœ‰å›¾è¡¨ç¬¦åˆArtDeco V3.0è§„èŒƒ
3. **ç›‘æ§æ—¶é—´åºåˆ—**: è¿½è¸ªè®¾è®¡ç³»ç»Ÿçš„é•¿æœŸæ¼”å˜
4. **æ”¯æŒå¿«é€Ÿè¿­ä»£**: åœ¨ä¸å½±å“è´¨é‡çš„å‰æä¸‹æ”¯æŒå¿«é€Ÿå¼€å‘

### æµ‹è¯•èŒƒå›´

#### åŒ…å«èŒƒå›´

| ç±»åˆ« | ç»„ä»¶æ•°é‡ | è¯´æ˜ |
|------|---------|------|
| **EChartså›¾è¡¨ç»„ä»¶** | 20ä¸ª | å·²åº”ç”¨ArtDecoä¸»é¢˜çš„å›¾è¡¨ |
| **Dashboardé¡µé¢** | 1ä¸ª | ä¸»ä»ªè¡¨æ¿é¡µé¢çš„å›¾è¡¨åŒºåŸŸ |
| **æŠ€æœ¯åˆ†æé¡µé¢** | 1ä¸ª | åŒ…å«Kçº¿å’ŒæŠ€æœ¯æŒ‡æ ‡å›¾è¡¨ |
| **äº¤æ˜“ç®¡ç†é¡µé¢** | 1ä¸ª | ç»Ÿè®¡å’Œé£é™©å›¾è¡¨ |
| **å›æµ‹åˆ†æé¡µé¢** | 1ä¸ª | å›æµ‹ç»“æœå›¾è¡¨ |

#### EChartså›¾è¡¨ç»„ä»¶æ¸…å•

| åºå· | ç»„ä»¶ | æ–‡ä»¶è·¯å¾„ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| 1 | è¡Œä¸šåˆ†å¸ƒå›¾ | `views/Dashboard.vue` | P0 |
| 2 | å¸‚åœºçƒ­åŠ›å›¾ | `views/Dashboard.vue` | P0 |
| 3 | æŒ‡æ•°å›¾è¡¨ | `views/Phase4Dashboard.vue` | P1 |
| 4 | åˆ†å¸ƒå›¾è¡¨ | `views/Phase4Dashboard.vue` | P1 |
| 5 | ç»„åˆå›¾è¡¨ | `views/Phase4Dashboard.vue` | P1 |
| 6 | æŠ€æœ¯åˆ†æå›¾ | `views/technical/TechnicalAnalysis.vue` | P0 |
| 7 | å¥åº·é›·è¾¾å›¾ | `components/chart/HealthRadarChart.vue` | P1 |
| 8 | èµ„äº§å›¾è¡¨ | `views/trade-management/components/StatisticsTab.vue` | P1 |
| 9 | æ”¶ç›Šå›¾è¡¨ | `views/trade-management/components/StatisticsTab.vue` | P1 |
| 10 | ç»„åˆé£é™©å›¾ | `views/components/RiskOverviewTab.vue` | P1 |
| 11 | é£é™©åˆ†å¸ƒå›¾ | `views/components/RiskOverviewTab.vue` | P1 |
| 12 | èµ„é‡‘æµå‘å›¾ | `components/market/FundFlowPanel.vue` | P1 |
| 13 | é«˜çº§çƒ­åŠ›å›¾ | `components/charts/AdvancedHeatmap.vue` | P1 |
| 14 | æ¡‘åŸºå›¾ | `components/charts/SankeyChart.vue` | P1 |
| 15 | æ ‘çŠ¶å›¾ | `components/charts/TreeChart.vue` | P1 |
| 16 | å…³ç³»å›¾ | `components/charts/RelationChart.vue` | P1 |
| 17 | å›¾è¡¨å®¹å™¨ | `components/shared/charts/ChartContainer.vue` | P1 |
| 18 | ç­–ç•¥å¡ç‰‡å›¾ | `components/artdeco/trading/ArtDecoStrategyCard.vue` | P1 |
| 19 | æŒä»“å¡ç‰‡å›¾ | `components/artdeco/trading/ArtDecoPositionCard.vue` | P1 |
| 20 | äº¤æ˜“å†³ç­–å›¾è¡¨ | `views/TradingDecisionCenter.vue` | P0 |

#### æ’é™¤èŒƒå›´

| ç»„ä»¶ | æ’é™¤åŸå›  |
|------|---------|
| KLineChart | ä½¿ç”¨klinechartsåº“ï¼ŒéECharts |
| ProKLineChart | ä½¿ç”¨klinechartsåº“ï¼ŒéECharts |
| HeatmapCard | è‡ªå®šä¹‰ç½‘æ ¼å®ç°ï¼Œéæ ‡å‡†ECharts |
| Demoé¡µé¢ | éç”Ÿäº§ç¯å¢ƒ |

### æµ‹è¯•ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | å®šä¹‰ | è¦†ç›–ç»„ä»¶ |
|--------|------|---------|
| **P0** | æ ¸å¿ƒä¸šåŠ¡é¡µé¢ï¼Œå¿…é¡»æµ‹è¯• | Dashboardã€æŠ€æœ¯åˆ†æã€äº¤æ˜“å†³ç­– |
| **P1** | é‡è¦åŠŸèƒ½é¡µé¢ï¼Œå»ºè®®æµ‹è¯• | Phase4Dashboardã€StatisticsTabã€RiskOverviewTab |
| **P2** | ä¸€èˆ¬åŠŸèƒ½é¡µé¢ï¼Œå¯é€‰æµ‹è¯• | å…¶ä»–å›¾è¡¨ç»„ä»¶ |

---

## å·¥å…·é€‰å‹

### æ¨èæ–¹æ¡ˆ

#### 1. Playwright Visual Tests (ä¸»æ–¹æ¡ˆ)

**ä¸ºä»€ä¹ˆé€‰æ‹©Playwright**:
- å†…ç½®è§†è§‰æµ‹è¯•æ”¯æŒ
- è·¨æµè§ˆå™¨æµ‹è¯•èƒ½åŠ›
- ä¸°å¯Œçš„æˆªå›¾API
- åƒç´ çº§å¯¹æ¯”åŠŸèƒ½
- ä¸ç°æœ‰æµ‹è¯•æ¡†æ¶é›†æˆè‰¯å¥½

**ç‰ˆæœ¬è¦æ±‚**:
```
Playwright >= 1.40.0
Node.js >= 18.0.0
```

#### 2. æˆªå›¾å¯¹æ¯”å·¥å…·

**pixelmatch** (Playwrightå†…ç½®):
- åƒç´ çº§å·®å¼‚æ£€æµ‹
- å¯é…ç½®é˜ˆå€¼
- é«˜æ€§èƒ½
- æ”¯æŒç”Ÿæˆå·®å¼‚å›¾

#### 3. å­˜å‚¨æ–¹æ¡ˆ

**æ–¹æ¡ˆA: æœ¬åœ°å­˜å‚¨** (æ¨èç”¨äºå¼€å‘)
```
test-results/
â”œâ”€â”€ visual/
â”‚   â”œâ”€â”€ baseline/    # åŸºçº¿æˆªå›¾
â”‚   â”œâ”€â”€ current/     # å½“å‰æˆªå›¾
â”‚   â”œâ”€â”€ diff/        # å·®å¼‚å›¾
â”‚   â””â”€â”€ report/      # HTMLæŠ¥å‘Š
```

**æ–¹æ¡ˆB: äº‘å­˜å‚¨** (æ¨èç”¨äºCI)
- Git LFS (é€‚åˆå°è§„æ¨¡)
- AWS S3 / MinIO
- Artifactory

### å¤‡é€‰æ–¹æ¡ˆ

| å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|
| Percy | ä¸“ä¸šçš„è§†è§‰æµ‹è¯•äº‘æœåŠ¡ | ä»˜è´¹ã€æœ‰é…é¢é™åˆ¶ |
| Chromatic | Storybooké›†æˆå¥½ | ä»˜è´¹ã€ä¸“æ³¨äºReact |
| Loki | ç®€å•æ˜“ç”¨ | åŠŸèƒ½æœ‰é™ |
| BackstopJS | è€ç‰Œå·¥å…· | é…ç½®å¤æ‚ |

### æœ€ç»ˆé€‰æ‹©

**ä¸»æ–¹æ¡ˆ**: Playwright Visual Tests + æœ¬åœ°å­˜å‚¨
- å……åˆ†åˆ©ç”¨ç°æœ‰PlaywrightåŸºç¡€è®¾æ–½
- é›¶é¢å¤–æˆæœ¬
- å®Œå…¨å¯æ§

---

## æµ‹è¯•ç­–ç•¥

### æµ‹è¯•ç±»å‹

#### 1. å…¨é¡µé¢æˆªå›¾æµ‹è¯•

**ç›®çš„**: æ•è·æ•´ä¸ªé¡µé¢çš„è§†è§‰å˜åŒ–

**é€‚ç”¨åœºæ™¯**:
- Dashboardé¦–é¡µ
- æŠ€æœ¯åˆ†æé¡µé¢
- äº¤æ˜“ç®¡ç†é¡µé¢

**é…ç½®**:
```typescript
// å…¨é¡µé¢æˆªå›¾
await page.goto('/dashboard');
await page.waitForLoadState('networkidle');
await expect(page).toHaveScreenshot('dashboard-full.png', {
  fullPage: true,
  animations: 'disabled',
});
```

#### 2. ç»„ä»¶æˆªå›¾æµ‹è¯•

**ç›®çš„**: ç²¾ç¡®æ•è·å•ä¸ªå›¾è¡¨ç»„ä»¶çš„å˜åŒ–

**é€‚ç”¨åœºæ™¯**:
- EChartså›¾è¡¨ç»„ä»¶
- ç‹¬ç«‹å¡ç‰‡ç»„ä»¶

**é…ç½®**:
```typescript
// ç»„ä»¶æˆªå›¾
const chartLocator = page.locator('#industryChart');
await expect(chartLocator).toHaveScreenshot('industry-chart.png', {
  animations: 'disabled',
});
```

#### 3. å“åº”å¼æµ‹è¯•

**ç›®çš„**: éªŒè¯ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤º

**æµ‹è¯•åˆ†è¾¨ç‡**:
| åˆ†è¾¨ç‡ | å®½åº¦ | ç”¨é€” |
|--------|------|------|
| Desktop HD | 1920x1080 | ä¸»è¦æµ‹è¯•åˆ†è¾¨ç‡ |
| Desktop | 1440x900 | å¸¸ç”¨å·¥ä½œåˆ†è¾¨ç‡ |
| Laptop | 1280x800 | ä¾¿æºè®¾å¤‡ |
| Tablet | 768x1024 | å¹³æ¿æ¨ªå± |

**é…ç½®**:
```typescript
// ä½¿ç”¨Playwrightçš„è®¾å¤‡æ¨¡æ‹Ÿ
const devices = ['Desktop Chrome', 'Desktop Firefox', 'iPad Pro'];
for (const device of devices) {
  test(`Dashboard on ${device}`, async ({ page }) => {
    const context = await browser.newContext({
      ...devices[device],
    });
    // æµ‹è¯•é€»è¾‘
  });
}
```

#### 4. æš—è‰²æ¨¡å¼æµ‹è¯•

**ç›®çš„**: éªŒè¯ArtDeco V3.0æš—è‰²ä¸»é¢˜æ­£ç¡®æ˜¾ç¤º

**æµ‹è¯•å†…å®¹**:
- é‡‘è‰²å“ç‰Œå…ƒç´ å¯¹æ¯”åº¦
- æ•°æ®é¢œè‰²æ­£ç¡®æ˜¾ç¤º
- èƒŒæ™¯ä¸€è‡´æ€§

### è§¦å‘æœºåˆ¶

#### è‡ªåŠ¨åŒ–è§¦å‘

| è§¦å‘æ¡ä»¶ | æ‰§è¡Œæµ‹è¯• |
|---------|---------|
| PRåˆ›å»º/æ›´æ–° | è¿è¡ŒP0+P1çº§åˆ«æµ‹è¯• |
| ä»£ç åˆå¹¶åˆ°main | è¿è¡Œå…¨éƒ¨è§†è§‰æµ‹è¯• |
| æ¯æ—¥å®šæ—¶ä»»åŠ¡ | è¿è¡Œå…¨éƒ¨è§†è§‰æµ‹è¯• |
| æ‰‹åŠ¨è§¦å‘ | å¯é€‰æ‹©è¿è¡Œç‰¹å®šæµ‹è¯• |

#### æµ‹è¯•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è§†è§‰å›å½’æµ‹è¯•æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. ä»£ç å˜æ›´ â†’ 2. CIè§¦å‘ â†’ 3. ç”Ÿæˆæˆªå›¾ â†’ 4. å¯¹æ¯”åˆ†æ        â”‚
â”‚                  â†“                                          â”‚
â”‚  5. ç”ŸæˆæŠ¥å‘Š â†’ 6. ç»“æœåˆ¤æ–­ â†’ 7. é€šçŸ¥å¤„ç†                    â”‚
â”‚                  â†“                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚          â”‚ æ— å·®å¼‚ â†’ é€šè¿‡ â”‚                                    â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                  â†“                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚          â”‚ æœ‰å·®å¼‚ â†’ äººå·¥å®¡æ ¸ â”‚                                â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                  â†“                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚          â”‚ æ‰¹å‡† â†’ æ›´æ–°åŸºçº¿ â”‚                                 â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¹æ¯”ç­–ç•¥

#### åƒç´ å·®å¼‚é˜ˆå€¼

```typescript
const visualConfig = {
  // åƒç´ åŒ¹é…é˜ˆå€¼ (0-1)
  threshold: 0.2,
  
  // æœ€å¤§å·®å¼‚åƒç´ æ¯”ä¾‹
  maxDiffPixels: 0.01,  // 1%
  
 // å¿½ç•¥åŒºåŸŸ (åŠ¨æ€å†…å®¹)
  ignoreRegions: [
    '.timestamp',      // æ—¶é—´æˆ³
    '.live-indicator', // å®æ—¶æŒ‡ç¤ºå™¨
    '.loading-spinner', // åŠ è½½åŠ¨ç”»
  ],
};
```

#### å·®å¼‚åˆ†ç±»

| ç±»åˆ« | åƒç´ å·®å¼‚ | å¤„ç†æ–¹å¼ |
|------|---------|---------|
| **æ— å·®å¼‚** | 0% | æµ‹è¯•é€šè¿‡ |
| **å¾®å°å·®å¼‚** | <0.5% | è‡ªåŠ¨é€šè¿‡ï¼Œå¯è®°å½• |
| **å¯æ¥å—å·®å¼‚** | 0.5%-1% | äººå·¥ç¡®è®¤åé€šè¿‡ |
| **æ˜¾è‘—å·®å¼‚** | 1%-5% | éœ€äººå·¥å®¡æ ¸ |
| **ä¸¥é‡å·®å¼‚** | >5% | é˜»æ–­åˆå¹¶ï¼Œéœ€ä¿®å¤ |

---

## å®ç°æ–¹æ¡ˆ

### ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ visual/                          # è§†è§‰å›å½’æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ visual.config.ts        # è§†è§‰æµ‹è¯•é…ç½®
â”‚   â”‚   â”œâ”€â”€ thresholds.ts           # å·®å¼‚é˜ˆå€¼é…ç½®
â”‚   â”‚   â””â”€â”€ breakpoints.ts          # å“åº”å¼æ–­ç‚¹é…ç½®
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ dashboard.visual.spec.ts
â”‚   â”‚   â”œâ”€â”€ technical-analysis.visual.spec.ts
â”‚   â”‚   â”œâ”€â”€ trade-management.visual.spec.ts
â”‚   â”‚   â””â”€â”€ risk-overview.visual.spec.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ charts/
â”‚   â”‚   â”‚   â”œâ”€â”€ industry-chart.visual.spec.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ market-heatmap.visual.spec.ts
â”‚   â”‚   â”‚   â””â”€â”€ health-radar.visual.spec.ts
â”‚   â”‚   â””â”€â”€ cards/
â”‚   â”‚       â”œâ”€â”€ strategy-card.visual.spec.ts
â”‚   â”‚       â””â”€â”€ position-card.visual.spec.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ screenshot-helper.ts    # æˆªå›¾è¾…åŠ©å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ comparison-helper.ts    # å¯¹æ¯”è¾…åŠ©å‡½æ•°
â”‚   â”‚   â””â”€â”€ baseline-manager.ts     # åŸºçº¿ç®¡ç†
â”‚   â”œâ”€â”€ fixtures/
â”‚   â”‚   â”œâ”€â”€ visual-test.fixture.ts  # æµ‹è¯•å¤¹å…·
â”‚   â”‚   â””â”€â”€ chart-data.fixture.ts   # å›¾è¡¨æ•°æ®å¤¹å…·
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ e2e/
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ DashboardPage.ts        # é¡µé¢å¯¹è±¡
```

### æ ¸å¿ƒé…ç½®

#### 1. è§†è§‰æµ‹è¯•é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `tests/visual/config/visual.config.ts`

```typescript
import { defineConfig, devices } from '@playwright/test';

export const visualConfig = defineConfig({
  // æµ‹è¯•é…ç½®
  testDir: './tests/visual',
  fullyParallel: true,
  
  // è§†è§‰æµ‹è¯•ä¸“ç”¨é…ç½®
  expect: {
    toHaveScreenshot: {
      // åƒç´ å·®å¼‚é˜ˆå€¼
      threshold: 0.2,
      // æœ€å¤§å·®å¼‚åƒç´ æ¯”ä¾‹
      maxDiffPixels: 0.01,
      // å¿½ç•¥åŠ¨ç”»
      animations: 'disabled',
      // å¿½ç•¥æ»šåŠ¨æ¡
      styleWithLayoutIgnore: ['scrollbar', '::-webkit-scrollbar'],
    },
  },
  
  // é¡¹ç›®é…ç½®
  projects: [
    // P0: æ ¸å¿ƒé¡µé¢æµ‹è¯•
    {
      name: 'visual-p0',
      testMatch: /.*visual.spec.ts/,
      testIgnore: /components\//,
      use: {
        ...devices['Desktop Chrome'],
        baseURL: process.env.E2E_BASE_URL || 'http://localhost:3000',
        screenshot: 'on',
        video: 'retain-on-failure',
      },
    },
    
    // P1: ç»„ä»¶æµ‹è¯•
    {
      name: 'visual-p1',
      testMatch: /components\/.*\.spec.ts/,
      use: {
        ...devices['Desktop Chrome'],
        baseURL: process.env.E2E_BASE_URL || 'http://localhost:3000',
      },
    },
    
    // å“åº”å¼æµ‹è¯•
    {
      name: 'visual-responsive',
      testMatch: /.*responsive.*\.spec.ts/,
      use: {
        ...devices['iPad Pro'],
        baseURL: process.env.E2E_BASE_URL || 'http://localhost:3000',
      },
    },
  ],
  
  // æˆªå›¾å­˜å‚¨
  screenshotDir: './test-results/visual',
  
  // æŠ¥å‘Š
  reporter: [
    ['html', { outputFolder: './test-results/visual-report' }],
    ['json', { outputFile: './test-results/visual-results.json' }],
  ],
});
```

#### 2. å·®å¼‚é˜ˆå€¼é…ç½®

**æ–‡ä»¶**: `tests/visual/config/thresholds.ts`

```typescript
export interface ThresholdConfig {
  // æ•´ä½“åƒç´ å·®å¼‚é˜ˆå€¼ (0-1)
  overallThreshold: number;
  
  // ç»„ä»¶ç‰¹å®šé˜ˆå€¼
  componentThresholds: Record<string, number>;
  
  // å¿½ç•¥çš„é€‰æ‹©å™¨
  ignoreSelectors: string[];
  
  // æœ€å¤§å…è®¸å·®å¼‚åƒç´ æ¯”ä¾‹
  maxDiffRatio: number;
}

export const defaultThresholds: ThresholdConfig = {
  overallThreshold: 0.2,
  
  componentThresholds: {
    // P0ç»„ä»¶ä½¿ç”¨æ›´ä¸¥æ ¼çš„é˜ˆå€¼
    'industryChart': 0.1,
    'marketHeatChart': 0.1,
    'technicalAnalysisChart': 0.1,
    
    // P1ç»„ä»¶ä½¿ç”¨é»˜è®¤é˜ˆå€¼
    'default': 0.2,
  },
  
  ignoreSelectors: [
    // åŠ¨æ€å†…å®¹
    '.elapsed-time',
    '.current-time',
    '.timestamp',
    '.live-indicator',
    '.loading-spinner',
    '.skeleton-loader',
    
    // åŠ¨ç”»å…ƒç´ 
    '.animating',
    '[class*="animate-"]',
    
    // å®æ—¶æ•°æ®
    '.realtime-price',
    '.price-change',
    '.volume-value',
    
    // å·¥å…·æç¤ºï¼ˆæ‚¬åœæ—¶å‡ºç°ï¼‰
    '.el-tooltip',
    '.tippy-popper',
  ],
  
  maxDiffRatio: 0.01, // 1%
};

export const responsiveBreakpoints = {
  'Desktop HD': { width: 1920, height: 1080 },
  'Desktop': { width: 1440, height: 900 },
  'Laptop': { width: 1280, height: 800 },
  'Tablet': { width: 768, height: 1024 },
};
```

#### 3. æµ‹è¯•å¤¹å…·

**æ–‡ä»¶**: `tests/visual/fixtures/visual-test.fixture.ts`

```typescript
import { test as base, Page, Locator } from '@playwright/test';
import { defaultThresholds } from '../config/thresholds';

// åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•å¤¹å…·
export const test = base.extend({
  // é¡µé¢ä¸Šä¸‹æ–‡
  page: async ({ page }, use) => {
    // ç­‰å¾…ç½‘ç»œç©ºé—²
    await page.waitForLoadState('networkidle');
    
    // è®¾ç½®è§†å£
    await page.setViewportSize({ width: 1920, height: 1080 });
    
    await use(page);
  },
  
  // å›¾è¡¨å®šä½å™¨
  chartLocator: async ({ page }, use) => {
    const getChartLocator = (selector: string) => {
      return page.locator(selector).first();
    };
    
    await use(getChartLocator);
  },
  
  // ç­‰å¾…å›¾è¡¨æ¸²æŸ“
  waitForChartRender: async ({ page }, use) => {
    const waitForChart = async (selector: string, timeout = 10000) => {
      const chart = page.locator(selector).first();
      
      // ç­‰å¾…å›¾è¡¨å¯è§
      await chart.waitFor({ state: 'visible', timeout });
      
      // ç­‰å¾…EChartså®ä¾‹åˆå§‹åŒ–
      await page.waitForFunction(
        (sel) => {
          const el = document.querySelector(sel);
          return el && el.classList.contains('echarts-instance');
        },
        selector,
        { timeout }
      );
    };
    
    await use(waitForChart);
  },
  
  // æˆªå›¾æ¯”è¾ƒå™¨
  screenshotComparator: async ({}, use) => {
    const compareScreenshots = async (
      actualBuffer: Buffer,
      expectedPath: string
    ): Promise<{ match: boolean; diffRatio: number; diffBuffer?: Buffer }> => {
      // è¯»å–æœŸæœ›æˆªå›¾
      const fs = await import('fs');
      const path = await import('path');
      
      if (!fs.existsSync(expectedPath)) {
        return { match: false, diffRatio: 1, diffBuffer: actualBuffer };
      }
      
      const expectedBuffer = fs.readFileSync(expectedPath);
      
      // ä½¿ç”¨Playwrightå†…ç½®æ¯”è¾ƒ
      // è¿™é‡Œå¯ä»¥é›†æˆpixelmatchè¿›è¡Œæ›´ç²¾ç»†çš„æ¯”è¾ƒ
      const match = actualBuffer.equals(expectedBuffer);
      
      if (match) {
        return { match: true, diffRatio: 0 };
      }
      
      // è®¡ç®—å·®å¼‚ (ç®€åŒ–ç‰ˆï¼Œå®é™…å¯ä½¿ç”¨pixelmatch)
      // æ­¤å¤„çœç•¥å…·ä½“å®ç°
      
      return { match: false, diffRatio: 0.01 };
    };
    
    await use(compareScreenshots);
  },
});

// å¯¼å‡ºç±»å‹
export { expect } from '@playwright/test';
```

### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

#### 1. Dashboardé¡µé¢è§†è§‰æµ‹è¯•

**æ–‡ä»¶**: `tests/visual/pages/dashboard.visual.spec.ts`

```typescript
import { test, expect } from '../fixtures/visual-test.fixture';

test.describe('Dashboard Page - Visual Regression', () => {
  const dashboardPath = '/dashboard';
  
  test.beforeEach(async ({ page }) => {
    // å¯¼èˆªåˆ°Dashboardé¡µé¢
    await page.goto(dashboardPath);
    
    // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
    await page.waitForLoadState('networkidle');
    
    // ç¦ç”¨åŠ¨ç”»
    await page.addStyleTag({
      content: `
        *, *::before, *::after {
          animation-duration: 0s !important;
          transition-duration: 0s !important;
        }
      `,
    });
  });
  
  test('Dashboard full page - Desktop HD', async ({ page }) => {
    // å…¨é¡µé¢æˆªå›¾
    await expect(page).toHaveScreenshot('dashboard-desktop-hd.png', {
      fullPage: true,
      animations: 'disabled',
    });
  });
  
  test('Industry distribution chart', async ({ page, waitForChartRender }) => {
    // å®šä½è¡Œä¸šåˆ†å¸ƒå›¾
    const industryChart = page.locator('#industryChart').first();
    
    // ç­‰å¾…å›¾è¡¨æ¸²æŸ“
    await waitForChartRender('#industryChart');
    
    // ç»„ä»¶æˆªå›¾
    await expect(industryChart).toHaveScreenshot('dashboard-industry-chart.png', {
      animations: 'disabled',
    });
  });
  
  test('Market heatmap chart', async ({ page, waitForChartRender }) => {
    // å®šä½å¸‚åœºçƒ­åŠ›å›¾
    const heatmapChart = page.locator('#marketHeatChart').first();
    
    // ç­‰å¾…å›¾è¡¨æ¸²æŸ“
    await waitForChartRender('#marketHeatChart');
    
    // ç»„ä»¶æˆªå›¾
    await expect(heatmapChart).toHaveScreenshot('dashboard-market-heatmap.png', {
      animations: 'disabled',
    });
  });
  
  test('Statistics cards section', async ({ page }) => {
    // å®šä½ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ
    const statsSection = page.locator('.stats-grid').first();
    
    await expect(statsSection).toHaveScreenshot('dashboard-stats-section.png', {
      animations: 'disabled',
    });
  });
});
```

#### 2. æŠ€æœ¯åˆ†æé¡µé¢è§†è§‰æµ‹è¯•

**æ–‡ä»¶**: `tests/visual/pages/technical-analysis.visual.spec.ts`

```typescript
import { test, expect } from '../fixtures/visual-test.fixture';

test.describe('Technical Analysis Page - Visual Regression', () => {
  const technicalAnalysisPath = '/technical-analysis';
  
  test.beforeEach(async ({ page }) => {
    await page.goto(technicalAnalysisPath);
    await page.waitForLoadState('networkidle');
    
    // ç¦ç”¨åŠ¨ç”»
    await page.addStyleTag({
      content: `
        *, *::before, *::after {
          animation-duration: 0s !important;
          transition-duration: 0s !important;
        }
      `,
    });
  });
  
  test('Technical analysis full page', async ({ page }) => {
    await expect(page).toHaveScreenshot('technical-analysis-full.png', {
      fullPage: true,
      animations: 'disabled',
    });
  });
  
  test('Main K-line chart with indicators', async ({ page, waitForChartRender }) => {
    await waitForChartRender('#mainChart');
    
    const mainChart = page.locator('#mainChart').first();
    await expect(mainChart).toHaveScreenshot('technical-analysis-main-chart.png');
  });
  
  test('Indicator panel', async ({ page }) => {
    const indicatorPanel = page.locator('.indicator-panel').first();
    await expect(indicatorPanel).toHaveScreenshot('technical-analysis-indicators.png');
  });
  
  test('Stock selector dropdown', async ({ page }) => {
    const stockSelector = page.locator('.stock-selector').first();
    
    // å±•å¼€ä¸‹æ‹‰èœå•
    await stockSelector.click();
    await page.waitForTimeout(500);
    
    await expect(stockSelector).toHaveScreenshot('technical-analysis-stock-selector.png');
  });
});
```

#### 3. EChartså›¾è¡¨ç»„ä»¶è§†è§‰æµ‹è¯•

**æ–‡ä»¶**: `tests/visual/components/charts/industry-chart.visual.spec.ts`

```typescript
import { test, expect } from '../../fixtures/visual-test.fixture';

test.describe('Industry Chart - Visual Regression', () => {
  test.beforeEach(async ({ page }) => {
    // å¯¼èˆªåˆ°åŒ…å«è¡Œä¸šå›¾è¡¨çš„é¡µé¢
    await page.goto('/dashboard');
    await page.waitForLoadState('networkidle');
    
    // ç¦ç”¨æ‰€æœ‰åŠ¨ç”»
    await page.addStyleTag({
      content: `
        *, *::before, *::after {
          animation-duration: 0s !important;
          transition-duration: 0s !important;
        }
      `,
    });
  });
  
  test('Industry pie chart', async ({ page, waitForChartRender }) => {
    // å®šä½è¡Œä¸šé¥¼å›¾
    const pieChart = page.locator('.echarts-container >> nth=0');
    
    // ç­‰å¾…æ¸²æŸ“
    await waitForChartRender('.echarts-container >> nth=0');
    
    // æˆªå›¾
    await expect(pieChart).toHaveScreenshot('industry-pie-chart.png', {
      animations: 'disabled',
    });
  });
  
  test('Industry bar chart', async ({ page, waitForChartRender }) => {
    const barChart = page.locator('.echarts-container >> nth=1');
    await waitForChartRender('.echarts-container >> nth=1');
    
    await expect(barChart).toHaveScreenshot('industry-bar-chart.png', {
      animations: 'disabled',
    });
  });
  
  test('Chart with gold theme colors', async ({ page, waitForChartRender }) => {
    const chart = page.locator('#industryChart');
    await waitForChartRender('#industryChart');
    
    // éªŒè¯å›¾è¡¨åŒ…å«ArtDecoé‡‘è‰²ä¸»é¢˜
    await expect(chart).toHaveScreenshot('industry-chart-gold-theme.png', {
      animations: 'disabled',
    });
  });
});
```

#### 4. å“åº”å¼è§†è§‰æµ‹è¯•

**æ–‡ä»¶**: `tests/visual/pages/dashboard.responsive.visual.spec.ts`

```typescript
import { test, expect } from '../fixtures/visual-test.fixture';
import { devices } from '@playwright/test';

const responsiveDevices = [
  { name: 'Desktop HD', ...devices['Desktop Chrome'] },
  { name: 'Desktop', ...devices['Macbook Pro 14'] },
  { name: 'Tablet', ...devices['iPad Pro'] },
];

responsiveDevices.forEach(({ name, viewport }) => {
  test.describe(`Dashboard Responsive - ${name}`, () => {
    test.beforeEach(async ({ page }) => {
      await page.goto('/dashboard');
      await page.waitForLoadState('networkidle');
      
      // è®¾ç½®è§†å£
      if (viewport) {
        await page.setViewportSize(viewport);
      }
      
      // ç¦ç”¨åŠ¨ç”»
      await page.addStyleTag({
        content: `
          *, *::before, *::after {
            animation-duration: 0s !important;
            transition-duration: 0s !important;
          }
        `,
      });
    });
    
    test('Dashboard layout adapts to viewport', async ({ page }) => {
      await expect(page).toHaveScreenshot(`dashboard-${name.toLowerCase().replace(/\s+/g, '-')}.png`, {
        fullPage: true,
        animations: 'disabled',
      });
    });
    
    test('Charts resize correctly', async ({ page, waitForChartRender }) => {
      const chart = page.locator('#industryChart').first();
      await waitForChartRender('#industryChart');
      
      await expect(chart).toHaveScreenshot(`dashboard-chart-${name.toLowerCase().replace(/\s+/g, '-')}.png`);
    });
  });
});
```

### åŸºçº¿ç®¡ç†å·¥å…·

**æ–‡ä»¶**: `tests/visual/utils/baseline-manager.ts`

```typescript
import * as fs from 'fs';
import * as path from 'path';

export class BaselineManager {
  private baselineDir: string;
  private currentDir: string;
  private diffDir: string;
  
  constructor(baseDir = './test-results/visual') {
    this.baselineDir = path.join(baseDir, 'baseline');
    this.currentDir = path.join(baseDir, 'current');
    this.diffDir = path.join(baseDir, 'diff');
  }
  
  // åˆå§‹åŒ–ç›®å½•
  async initialize(): Promise<void> {
    for (const dir of [this.baselineDir, this.currentDir, this.diffDir]) {
      if (!fs.existsSync(dir)) {
        fs.mkdirSync(dir, { recursive: true });
      }
    }
  }
  
  // è·å–åŸºçº¿è·¯å¾„
  getBaselinePath(testName: string): string {
    return path.join(this.baselineDir, `${testName}.png`);
  }
  
  // è·å–å½“å‰æˆªå›¾è·¯å¾„
  getCurrentPath(testName: string): string {
    return path.join(this.currentDir, `${testName}.png`);
  }
  
  // è·å–å·®å¼‚å›¾è·¯å¾„
  getDiffPath(testName: string): string {
    return path.join(this.diffDir, `${testName}-diff.png`);
  }
  
  // æ›´æ–°åŸºçº¿
  async updateBaseline(testName: string, screenshotBuffer: Buffer): Promise<void> {
    const baselinePath = this.getBaselinePath(testName);
    fs.writeFileSync(baselinePath, screenshotBuffer);
    console.log(`âœ… Updated baseline: ${baselinePath}`);
  }
  
  // æ£€æŸ¥åŸºçº¿æ˜¯å¦å­˜åœ¨
  baselineExists(testName: string): boolean {
    return fs.existsSync(this.getBaselinePath(testName));
  }
  
  // åˆ—å‡ºæ‰€æœ‰åŸºçº¿
  listBaselines(): string[] {
    if (!fs.existsSync(this.baselineDir)) {
      return [];
    }
    return fs.readdirSync(this.baselineDir).filter(f => f.endsWith('.png'));
  }
  
  // åˆ é™¤åŸºçº¿
  deleteBaseline(testName: string): void {
    const baselinePath = this.getBaselinePath(testName);
    if (fs.existsSync(baselinePath)) {
      fs.unlinkSync(baselinePath);
    }
  }
  
  // æ¸…ç†å½“å‰å’Œå·®å¼‚ç›®å½•
  async cleanup(): Promise<void> {
    for (const dir of [this.currentDir, this.diffDir]) {
      if (fs.existsSync(dir)) {
        fs.rmSync(dir, { recursive: true, force: true });
      }
    }
    await this.initialize();
  }
}

// CLIå·¥å…·
async function main() {
  const manager = new BaselineManager();
  const command = process.argv[2];
  
  switch (command) {
    case 'init':
      await manager.initialize();
      console.log('âœ… Visual test directories initialized');
      break;
      
    case 'list':
      const baselines = manager.listBaselines();
      console.log(`Found ${baselines.length} baselines:`);
      baselines.forEach(b => console.log(`  - ${b}`));
      break;
      
    case 'update':
      const testName = process.argv[3];
      if (!testName) {
        console.error('Usage: node baseline-manager.js update <test-name>');
        process.exit(1);
      }
      console.log(`To update baseline: ${testName}, use Playwright's --update-snapshots flag`);
      break;
      
    case 'cleanup':
      await manager.cleanup();
      console.log('âœ… Cleaned up current and diff directories');
      break;
      
    default:
      console.log('Usage: node baseline-manager.js <command>');
      console.log('Commands:');
      console.log('  init       - Initialize directories');
      console.log('  list       - List existing baselines');
      console.log('  update     - Update a baseline (use --update-snapshots)');
      console.log('  cleanup    - Clean up current and diff directories');
  }
}

main().catch(console.error);
```

---

## æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### æµ‹è¯•ç”¨ä¾‹çŸ©é˜µ

| ç”¨ä¾‹ID | é¡µé¢/ç»„ä»¶ | æµ‹è¯•å†…å®¹ | ä¼˜å…ˆçº§ | é¢„æœŸç»“æœ |
|--------|----------|---------|--------|---------|
| VIS-001 | Dashboard | å…¨é¡µé¢æˆªå›¾ | P0 | åŒ¹é…åŸºçº¿ |
| VIS-002 | Dashboard | è¡Œä¸šåˆ†å¸ƒå›¾ | P0 | åŒ¹é…åŸºçº¿ |
| VIS-003 | Dashboard | å¸‚åœºçƒ­åŠ›å›¾ | P0 | åŒ¹é…åŸºçº¿ |
| VIS-004 | Dashboard | ç»Ÿè®¡å¡ç‰‡åŒº | P1 | åŒ¹é…åŸºçº¿ |
| VIS-005 | Technical Analysis | å…¨é¡µé¢æˆªå›¾ | P0 | åŒ¹é…åŸºçº¿ |
| VIS-006 | Technical Analysis | ä¸»Kçº¿å›¾ | P0 | åŒ¹é…åŸºçº¿ |
| VIS-007 | Technical Analysis | æŒ‡æ ‡é¢æ¿ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-008 | Trade Management | ç»Ÿè®¡å›¾è¡¨ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-009 | Trade Management | æ”¶ç›Šå›¾è¡¨ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-010 | Risk Overview | é£é™©å›¾è¡¨ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-011 | All Pages | å“åº”å¼(1920px) | P1 | åŒ¹é…åŸºçº¿ |
| VIS-012 | All Pages | å“åº”å¼(1440px) | P1 | åŒ¹é…åŸºçº¿ |
| VIS-013 | All Pages | å“åº”å¼(768px) | P2 | åŒ¹é…åŸºçº¿ |
| VIS-014 | Strategy Card | ç­–ç•¥å¡ç‰‡å›¾ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-015 | Position Card | æŒä»“å¡ç‰‡å›¾ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-016 | Fund Flow | èµ„é‡‘æµå‘å›¾ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-017 | Advanced Heatmap | é«˜çº§çƒ­åŠ›å›¾ | P1 | åŒ¹é…åŸºçº¿ |
| VIS-018 | Sankey Chart | æ¡‘åŸºå›¾ | P2 | åŒ¹é…åŸºçº¿ |
| VIS-019 | Tree Chart | æ ‘çŠ¶å›¾ | P2 | åŒ¹é…åŸºçº¿ |
| VIS-020 | Relation Chart | å…³ç³»å›¾ | P2 | åŒ¹é…åŸºçº¿ |

### æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…

#### VIS-001: Dashboardå…¨é¡µé¢æˆªå›¾

```typescript
// tests/visual/pages/dashboard.visual.spec.ts

test('Dashboard full page screenshot', async ({ page }) => {
  // æ­¥éª¤1: å¯¼èˆªåˆ°Dashboardé¡µé¢
  await page.goto('/dashboard');
  
  // æ­¥éª¤2: ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
  await page.waitForLoadState('networkidle');
  
  // æ­¥éª¤3: ç¦ç”¨æ‰€æœ‰CSSåŠ¨ç”»
  await page.addStyleTag({
    content: `
      *, *::before, *::after {
        animation-duration: 0s !important;
        transition-duration: 0s !important;
      }
    `,
  });
  
  // æ­¥éª¤4: ç­‰å¾…å›¾è¡¨æ¸²æŸ“å®Œæˆ
  await page.waitForFunction(() => {
    const charts = document.querySelectorAll('.echarts-container canvas');
    return charts.length >= 2; // å‡è®¾Dashboardæœ‰è‡³å°‘2ä¸ªå›¾è¡¨
  });
  
  // æ­¥éª¤5: æˆªå›¾
  await expect(page).toHaveScreenshot('dashboard-full.png', {
    fullPage: true,
    animations: 'disabled',
  });
});
```

#### VIS-002: è¡Œä¸šåˆ†å¸ƒå›¾

```typescript
test('Industry distribution chart screenshot', async ({ page, waitForChartRender }) => {
  // æ­¥éª¤1: å¯¼èˆªåˆ°Dashboard
  await page.goto('/dashboard');
  await page.waitForLoadState('networkidle');
  
  // æ­¥éª¤2: ç¦ç”¨åŠ¨ç”»
  await page.addStyleTag({
    content: `
      *, *::before, *::after {
        animation-duration: 0s !important;
        transition-duration: 0s !important;
      }
    `,
  });
  
  // æ­¥éª¤3: å®šä½å›¾è¡¨å®¹å™¨
  const chartContainer = page.locator('#industryChart').first();
  
  // æ­¥éª¤4: ç­‰å¾…å›¾è¡¨æ¸²æŸ“
  await waitForChartRender('#industryChart');
  
  // æ­¥éª¤5: ç¡®ä¿å›¾è¡¨å¯è§
  await chartContainer.waitFor({ state: 'visible' });
  
  // æ­¥éª¤6: æˆªå›¾
  await expect(chartContainer).toHaveScreenshot('industry-chart.png', {
    animations: 'disabled',
  });
});
```

### æ•°æ®é©±åŠ¨æµ‹è¯•

```typescript
// tests/visual/data/chart-scenarios.ts

export interface ChartTestScenario {
  name: string;
  path: string;
  chartSelector: string;
  waitForSelector?: string;
  priority: 'P0' | 'P1' | 'P2';
}

export const chartScenarios: ChartTestScenario[] = [
  {
    name: 'Dashboard - Industry Chart',
    path: '/dashboard',
    chartSelector: '#industryChart',
    waitForSelector: '.echarts-container canvas',
    priority: 'P0',
  },
  {
    name: 'Dashboard - Market Heatmap',
    path: '/dashboard',
    chartSelector: '#marketHeatChart',
    waitForSelector: '.echarts-container canvas',
    priority: 'P0',
  },
  {
    name: 'Technical Analysis - Main Chart',
    path: '/technical-analysis',
    chartSelector: '#mainChart',
    waitForSelector: '.echarts-container canvas',
    priority: 'P0',
  },
  // ...æ›´å¤šåœºæ™¯
];

// æ•°æ®é©±åŠ¨æµ‹è¯•ç”Ÿæˆ
chartScenarios.forEach((scenario) => {
  test(`${scenario.name} - Screenshot`, async ({ page, waitForChartRender }) => {
    await page.goto(scenario.path);
    await page.waitForLoadState('networkidle');
    
    await page.addStyleTag({
      content: `
        *, *::before, *::after {
          animation-duration: 0s !important;
          transition-duration: 0s !important;
        }
      `,
    });
    
    const chartLocator = page.locator(scenario.chartSelector).first();
    await waitForChartRender(scenario.chartSelector);
    
    const filename = scenario.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
    await expect(chartLocator).toHaveScreenshot(`${filename}.png`, {
      animations: 'disabled',
    });
  });
});
```

---

## CI/CDé›†æˆ

æœ¬èŠ‚éµå¾ªMyStocksé¡¹ç›®ç°æœ‰çš„CI/CDæ¡†æ¶è§„èŒƒï¼Œä¸ç°æœ‰å·¥ä½œæµä¿æŒä¸€è‡´ã€‚

### GitHub Actionså·¥ä½œæµ

**æ–‡ä»¶**: `.github/workflows/visual-testing.yml`

éµå¾ªé¡¹ç›®ç°æœ‰çš„å·¥ä½œæµå‘½åè§„èŒƒï¼ˆ`[test-type].yml`ï¼‰ï¼Œä¸å…¶ä»–æµ‹è¯•å·¥ä½œæµä¿æŒä¸€è‡´ã€‚

```yaml
name: Visual Testing

on:
  push:
    branches: [main, develop]
    paths:
      - 'web/frontend/src/**'
      - 'tests/visual/**'
      - '.github/workflows/visual-testing.yml'
  pull_request:
    paths:
      - 'web/frontend/src/**'
      - 'tests/visual/**'
      - '.github/workflows/visual-testing.yml'
  schedule:
    # éµå¾ªæ€§èƒ½ç›®æ ‡: CIæ‰§è¡Œæ—¶é—´<15åˆ†é’Ÿ
    # æ¯å‘¨æ—¥2:00è¿è¡Œï¼Œé¿å¼€é«˜å³°æœŸ
    - cron: '0 2 * * 0'
  workflow_dispatch:
    inputs:
      test_mode:
        description: 'Test execution mode'
        required: false
        default: 'standard'
        type: choice
        options:
          - standard
          - full
          - update-baseline

env:
  # å…¨å±€ç¯å¢ƒå˜é‡
  NODE_VERSION: '20'
  PNPM_VERSION: '8'
  E2E_BASE_URL: 'http://localhost:3000'
  PLAYWRIGHT_BROWSERS_PATH: '/mspw/.cache/mspw-playwright-browsers'

jobs:
  # éµå¾ªç°æœ‰jobå‘½å: [job-name]
  visual-testing:
    name: Visual Testing (P$P0+$P1)
    runs-on: ubuntu-latest
    timeout-minutes: 20  # éµå¾ªCIæ€§èƒ½ç›®æ ‡

    steps:
      # éµå¾ªç°æœ‰æ­¥éª¤å‘½åè§„èŒƒ
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'
          cache-dependency-path: web/frontend/pnpm-lock.yaml

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        working-directory: ./web/frontend
        run: pnpm install --frozen-lockfile

      - name: Cache Playwright browsers
        uses: actions/cache@v4
        with:
          path: ${{ env.PLAYWRIGHT_BROWSERS_PATH }}
          key: playwright-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            playwright-${{ runner.os }}-

      - name: Install Playwright browsers
        run: pnpm exec playwright install --with-deps chromium

      - name: Start frontend dev server
        working-directory: ./web/frontend
        run: |
          pnpm run dev &
          # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨ï¼Œéµå¾ªç°æœ‰è¶…æ—¶ç­–ç•¥
          for i in {1..30}; do
            if curl -s http://localhost:3000 > /dev/null 2>&1; then
              echo "âœ… Frontend server ready"
              break
            fi
            sleep 1
          done

      - name: Execute visual tests
        working-directory: ./
        env:
          TEST_MODE: ${{ github.event.inputs.test_mode || 'standard' }}
        run: |
          case "$TEST_MODE" in
            update-baseline)
              echo "ğŸ“¸ Updating visual baselines..."
              pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots
              ;;
            full)
              echo "ğŸ” Running full visual test suite..."
              pnpm exec playwright test --config=tests/visual/config/visual.config.ts
              ;;
            standard|*)
              echo "âœ… Running standard visual tests (P0+P1)..."
              pnpm exec playwright test --config=tests/visual/config/visual.config.ts --project=visual-p0,visual-p1
              ;;
          esac

      - name: Upload visual test artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: visual-test-results
          path: test-results/
          retention-days: 30  # éµå¾ªç°æœ‰artifactä¿ç•™ç­–ç•¥

      - name: Upload visual test report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: visual-test-report
          path: test-results/visual-report/
          retention-days: 30

      - name: Verify visual regression results
        if: github.event.inputs.test_mode != 'update-baseline'
        run: |
          if [ -f "test-results/test-results.json" ]; then
            FAILED=$(cat test-results/test-results.json | grep -o '"failures":[0-9]*' | grep -o '[0-9]*' | head -1)
            if [ "$FAILED" != "0" ] && [ -n "$FAILED" ]; then
              echo "âŒ Visual regression tests failed: $FAILED failures"
              echo "ğŸ“Š View details in the artifacts"
              exit 1
            fi
          fi
          echo "âœ… All visual regression tests passed"

      - name: Cleanup
        if: always()
        run: |
          pkill -f "pnpm run dev" || true
          pkill -f "vite" || true

  # å“åº”å¼æµ‹è¯•ï¼ˆç‹¬ç«‹jobï¼Œä¸ç°æœ‰æµ‹è¯•ç±»å‹å¯¹é½ï¼‰
  visual-testing-responsive:
    name: Visual Testing (Responsive)
    runs-on: ubuntu-latest
    timeout-minutes: 15
    if: github.event.inputs.test_mode == 'full' || github.event.inputs.test_mode == 'update-baseline'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'pnpm'

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: ${{ env.PNPM_VERSION }}

      - name: Install dependencies
        working-directory: ./web/frontend
        run: pnpm install --frozen-lockfile

      - name: Install Playwright browsers
        run: pnpm exec playwright install --with-deps chromium

      - name: Start frontend dev server
        working-directory: ./web/frontend
        run: |
          pnpm run dev &
          sleep 15

      - name: Run responsive visual tests
        working-directory: ./
        run: |
          if [ "${{ github.event.inputs.test_mode }}" == "update-baseline" ]; then
            pnpm exec playwright test --config=tests/visual/config/visual.config.ts --project=visual-responsive --update-snapshots
          else
            pnpm exec playwright test --config=tests/visual/config/visual.config.ts --project=visual-responsive
          fi

      - name: Upload responsive test artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: visual-test-results-responsive
          path: test-results/
          retention-days: 30

      - name: Cleanup
        if: always()
        run: |
          pkill -f "pnpm run dev" || true
```

### ä¸ç°æœ‰CI/CDå·¥ä½œæµé›†æˆ

#### 1. é›†æˆåˆ°code-quality.yml

åœ¨ä»£ç è´¨é‡æ£€æŸ¥å·¥ä½œæµä¸­æ·»åŠ è§†è§‰æµ‹è¯•å‰ç½®æ£€æŸ¥ï¼š

```yaml
# .github/workflows/code-quality.yml (è¿½åŠ )

  visual-prerequisites:
    name: Check if visual tests are needed
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    outputs:
      needs_visual_test: ${{ steps.check-files.outputs.result }}
    steps:
      - name: Check for frontend changes
        id: check-files
        run: |
          if git diff --name-only ${{ github.event.pull_request.base.sha }}..${{ github.sha }} | grep -q 'web/frontend/src/'; then
            echo "result=true" >> $GITHUB_OUTPUT
          else
            echo "result=false" >> $GITHUB_OUTPUT
          fi

  visual-quality-gate:
    name: Visual Quality Gate
    needs: visual-prerequisites
    runs-on: ubuntu-latest
    if: needs.visual_test == 'true'
    # ... åŒ visual-testing job
```

#### 2. é›†æˆåˆ°e2e-testing.yml

è§†è§‰æµ‹è¯•å¯ä½œä¸ºE2Eæµ‹è¯•çš„è¡¥å……ï¼Œåœ¨e2e-testing.ymlä¸­æ·»åŠ ï¼š

```yaml
# .github/workflows/e2e-testing.yml (è¿½åŠ )

  visual-e2e:
    name: Visual E2E Tests
    runs-on: ubuntu-latest
    timeout-minutes: 25
    steps:
      # ... åŒ visual-testing job é…ç½®
```

### åŸºçº¿æ›´æ–°æµç¨‹

éµå¾ªé¡¹ç›®ç°æœ‰çš„åŸºçº¿ç®¡ç†è§„èŒƒï¼Œé€šè¿‡ç‹¬ç«‹çš„workflow_dispatchè§¦å‘ï¼š

**æ–‡ä»¶**: `.github/workflows/visual-baseline-update.yml`

```yaml
name: Visual Baseline Update

on:
  workflow_dispatch:
    inputs:
      scope:
        description: 'Update scope'
        required: true
        type: choice
        options:
          - all
          - pages
          - components
      reason:
        description: 'Reason for update'
        required: true
        type: string

jobs:
  update-baselines:
    name: Update Visual Baselines
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: ${{ github.ref }}

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: '8'

      - name: Install dependencies
        working-directory: ./web/frontend
        run: pnpm install --frozen-lockfile

      - name: Install Playwright browsers
        run: pnpm exec playwright install --with-deps chromium

      - name: Start frontend dev server
        working-directory: ./web/frontend
        run: |
          pnpm run dev &
          sleep 15

      - name: Update visual baselines
        working-directory: ./
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BASELINE_SCOPE: ${{ github.event.inputs.scope }}
        run: |
          echo "ğŸ“¸ Updating visual baselines (scope: $BASELINE_SCOPE)"
          echo "Reason: ${{ github.event.inputs.reason }}"
          echo ""
          
          # æ ¹æ®scopeé€‰æ‹©æ›´æ–°èŒƒå›´
          case "$BASELINE_SCOPE" in
            all)
              pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots
              ;;
            pages)
              pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots --project=visual-p0,visual-p1
              ;;
            components)
              pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots --project=visual-p1
              ;;
          esac

      - name: Commit updated baselines
        run: |
          # æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„åŸºçº¿æ–‡ä»¶
          if git status --porcelain | grep -q "test-results/baseline"; then
            echo "ğŸ“ Committing updated baselines..."
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add test-results/baseline/
            git commit -m "chore: update visual baselines

Reason: ${{ github.event.inputs.reason }}

Updated by: ${{ github.actor }}
Branch: ${{ github.ref_name }}"
            git push
            echo "âœ… Baselines committed and pushed"
          else
            echo "âœ… No baseline changes detected"
          fi

      - name: Cleanup
        if: always()
        run: |
          pkill -f "pnpm run dev" || true
```

### GitLab CIé…ç½®

**æ–‡ä»¶**: `.gitlab-ci.yml` (è¿½åŠ )

éµå¾ªç°æœ‰çš„stageå‘½åè§„èŒƒï¼š

```yaml
# Visual Testing Stage
.visual-testing:
  stage: visual
  image: node:20
  before_script:
    - pnpm ci
    - pnpm exec playwright install --with-deps chromium
  script:
    - pnpm exec playwright test --config=tests/visual/config/visual.config.ts
  artifacts:
    when: always
    paths:
      - test-results/
      - test-results/visual-report/
    expire_in: 30 days
  only:
    changes:
      - web/frontend/src/**
      - tests/visual/**
    refs:
      - main
      - develop
      - merge_requests

.visual-baseline-update:
  stage: visual
  image: node:20
  before_script:
    - pnpm ci
    - pnpm exec playwright install --with-deps chromium
  script:
    - pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots
  artifacts:
    when: always
    paths:
      - test-results/baseline/
  only:
    - schedules
```

### CI/CDæ€§èƒ½ç›‘æ§

éµå¾ªCICD_CONTINUOUS_OPTIMIZATION.mdçš„æ€§èƒ½ç›®æ ‡ï¼š

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å‘Šè­¦é˜ˆå€¼ | ç›‘æ§æ–¹å¼ |
|------|--------|----------|----------|
| è§†è§‰æµ‹è¯•æ‰§è¡Œæ—¶é—´ | < 15åˆ†é’Ÿ | > 20åˆ†é’Ÿ | GitHub Actions |
| æµ‹è¯•é€šè¿‡ç‡ | > 95% | < 90% | æµ‹è¯•æŠ¥å‘Š |
| åŸºçº¿æ›´æ–°æˆåŠŸç‡ | > 98% | < 95% | å·¥ä½œæµæ—¥å¿— |

### ä¸ç°æœ‰æµ‹è¯•æ¡†æ¶é›†æˆ

#### 1. æµ‹è¯•ç»“æœæ±‡æ€»

è§†è§‰æµ‹è¯•ç»“æœä¸ç°æœ‰æµ‹è¯•æŠ¥å‘Šç³»ç»Ÿé›†æˆï¼š

```typescript
// tests/visual/utils/test-result-aggregator.ts

import { VisualTestResult } from './types';

export interface AggregatedTestResult {
  total: number;
  passed: number;
  failed: number;
  skipped: number;
  passRate: number;
  duration: number;
  timestamp: string;
}

export async function aggregateVisualResults(): Promise<AggregatedTestResult> {
  // ä»test-results/test-results.jsonè¯»å–ç»“æœ
  // è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼
  // ä¸ç°æœ‰æµ‹è¯•æŠ¥å‘Šç³»ç»Ÿé›†æˆ
}
```

#### 2. é€šçŸ¥é›†æˆ

è§†è§‰æµ‹è¯•ç»“æœé€šè¿‡ç°æœ‰é€šçŸ¥æ¸ é“å‘é€ï¼š

```typescript
// tests/visual/utils/notification.ts

import { sendNotification } from '../utils/notification';

export async function notifyVisualTestResult(
  result: 'passed' | 'failed',
  details: string
): Promise<void> {
  await sendNotification({
    title: result === 'passed' 
      ? 'âœ… Visual Tests Passed' 
      : 'âŒ Visual Tests Failed',
    message: result === 'passed'
      ? 'All visual regression tests passed successfully'
      : `Visual regression tests failed with ${details}`,
    status: result,
    details: details,
  });
}
```

### æ•…éšœæ¢å¤ç­–ç•¥

éµå¾ªé¡¹ç›®çš„æ•…éšœæ¢å¤è§„èŒƒï¼š

| åœºæ™¯ | å¤„ç†ç­–ç•¥ |
|------|---------|
| æµ‹è¯•è¶…æ—¶ | å¢åŠ è¶…æ—¶æ—¶é—´è‡³30åˆ†é’Ÿï¼Œé‡è¯•1æ¬¡ |
| æˆªå›¾å¤±è´¥ | é‡è¯•3æ¬¡ï¼Œè®°å½•è¯¦ç»†æ—¥å¿— |
| åŸºçº¿æ›´æ–°å¤±è´¥ | å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼Œè®°å½•é—®é¢˜ |
| æœåŠ¡å¯åŠ¨å¤±è´¥ | æ£€æŸ¥ç«¯å£å ç”¨ï¼Œé‡è¯•å¯åŠ¨ |
| ç½‘ç»œè¶…æ—¶ | å¢åŠ ç­‰å¾…æ—¶é—´è‡³30ç§’ |
        default: 'development'
        type: choice
        options:
          - development
          - staging
          - production

jobs:
  update-baselines:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        working-directory: ./web/frontend
        run: pnpm install --frozen-lockfile
      
      - name: Install Playwright
        run: pnpm exec playwright install --with-deps chromium
      
      - name: Start server
        working-directory: ./web/frontend
        run: |
          pnpm run dev &
          sleep 15
      
      - name: Update baselines
        working-directory: ./
        env:
          E2E_BASE_URL: 'http://localhost:3000'
        run: |
          pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots
      
      - name: Commit updated baselines
        if: github.event.inputs.environment == 'production'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add test-results/baseline/
          git commit -m "Update visual baselines - $(date +%Y-%m-%d)"
          git push
```

---

## æŠ¥å‘Šä¸ç›‘æ§

### HTMLæŠ¥å‘Š

Playwrightå†…ç½®HTMLæŠ¥å‘Šæä¾›:
- æµ‹è¯•æ¦‚è§ˆ
- å¤±è´¥è¯¦æƒ…
- æˆªå›¾å¯¹æ¯”
- å·®å¼‚é«˜äº®

æŠ¥å‘Šä½ç½®: `test-results/visual-report/index.html`

### è‡ªå®šä¹‰æŠ¥å‘Šç”Ÿæˆ

**æ–‡ä»¶**: `tests/visual/utils/report-generator.ts`

```typescript
import * as fs from 'fs';
import * as path from 'path';

interface VisualTestResult {
  testName: string;
  status: 'passed' | 'failed';
  baselinePath: string;
  currentPath: string;
  diffPath?: string;
  diffRatio: number;
  timestamp: string;
}

export class VisualReportGenerator {
  private results: VisualTestResult[] = [];
  
  addResult(result: VisualTestResult): void {
    this.results.push(result);
  }
  
  generateHtmlReport(outputPath: string): void {
    const html = `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visual Regression Test Report</title>
  <style>
    body { font-family: 'Barlow', sans-serif; background: #0A0A0A; color: #F2F0E4; }
    .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
    h1 { color: #D4AF37; font-family: 'Cinzel', serif; }
    .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
    .card { background: #1A1A1A; padding: 16px; border-radius: 8px; border: 1px solid #333; }
    .card.passed { border-color: #00E676; }
    .card.failed { border-color: #FF5252; }
    .card h3 { margin: 0; font-size: 14px; color: #A0A0A0; }
    .card .value { font-size: 32px; font-weight: bold; color: #D4AF37; }
    .test-item { background: #1A1A1A; padding: 16px; margin-bottom: 8px; border-radius: 8px; }
    .test-item.passed { border-left: 4px solid #00E676; }
    .test-item.failed { border-left: 4px solid #FF5252; }
    .test-name { font-weight: bold; }
    .test-details { margin-top: 8px; font-size: 14px; color: #A0A0A0; }
    .screenshots { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px; }
    .screenshot { background: #0A0A0A; padding: 8px; border-radius: 4px; }
    .screenshot img { max-width: 100%; height: auto; }
    .diff-overlay { position: relative; }
    .diff-overlay img { position: absolute; top: 0; left: 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ Visual Regression Test Report</h1>
    <p>Generated: ${new Date().toLocaleString('zh-CN')}</p>
    
    <div class="summary">
      <div class="card">
        <h3>Total Tests</h3>
        <div class="value">${this.results.length}</div>
      </div>
      <div class="card passed">
        <h3>Passed</h3>
        <div class="value">${this.results.filter(r => r.status === 'passed').length}</div>
      </div>
      <div class="card failed">
        <h3>Failed</h3>
        <div class="value">${this.results.filter(r => r.status === 'failed').length}</div>
      </div>
      <div class="card">
        <h3>Pass Rate</h3>
        <div class="value">${((this.results.filter(r => r.status === 'passed').length / this.results.length) * 100).toFixed(1)}%</div>
      </div>
    </div>
    
    <h2>Test Results</h2>
    ${this.results.map(result => `
      <div class="test-item ${result.status}">
        <div class="test-name">${result.testName}</div>
        <div class="test-details">
          Status: ${result.status.toUpperCase()} | 
          Diff: ${(result.diffRatio * 100).toFixed(2)}% | 
          Time: ${result.timestamp}
        </div>
        <div class="screenshots">
          <div class="screenshot">
            <h4>Baseline</h4>
            <img src="${path.relative(outputPath, result.baselinePath)}" />
          </div>
          <div class="screenshot">
            <h4>Current</h4>
            <img src="${path.relative(outputPath, result.currentPath)}" />
          </div>
          ${result.diffPath ? `
            <div class="screenshot">
              <h4>Diff</h4>
              <img src="${path.relative(outputPath, result.diffPath)}" />
            </div>
          ` : ''}
        </div>
      </div>
    `).join('')}
  </div>
</body>
</html>
    `;
    
    fs.writeFileSync(outputPath, html);
  }
  
  generateJsonReport(outputPath: string): void {
    const report = {
      timestamp: new Date().toISOString(),
      summary: {
        total: this.results.length,
        passed: this.results.filter(r => r.status === 'passed').length,
        failed: this.results.filter(r => r.status === 'failed').length,
        passRate: this.results.length > 0 
          ? (this.results.filter(r => r.status === 'passed').length / this.results.length * 100).toFixed(2)
          : 0,
      },
      results: this.results,
    };
    
    fs.writeFileSync(outputPath, JSON.stringify(report, null, 2));
  }
}
```

### Slack/é’‰é’‰é€šçŸ¥

```typescript
// tests/visual/utils/notification.ts

import axios from 'axios';

interface NotificationPayload {
  title: string;
  message: string;
  status: 'success' | 'failure' | 'warning';
  details?: string;
  url?: string;
}

export async function sendNotification(payload: NotificationPayload): Promise<void> {
  const webhookUrl = process.env.SLACK_WEBHOOK_URL || process.env.DINGDING_WEBHOOK_URL;
  
  if (!webhookUrl) {
    console.log('ğŸ“¢ Notification skipped: No webhook URL configured');
    return;
  }
  
  const color = payload.status === 'success' ? '#00E676' 
    : payload.status === 'failure' ? '#FF5252' 
    : '#F0E68C';
  
  const blocks = [
    {
      type: 'header',
      text: {
        type: 'plain_text',
        text: `ğŸ¨ ${payload.title}`,
        emoji: true,
      },
    },
    {
      type: 'section',
      text: {
        type: 'mrkdwn',
        text: payload.message,
      },
    },
    {
      type: 'context',
      elements: [
        {
          type: 'mrkdwn',
          text: `*Status:* ${payload.status.toUpperCase()}`,
        },
      ],
    },
  ];
  
  if (payload.details) {
    blocks.push({
      type: 'section',
      text: {
        type: 'mrkdwn',
        text: `*Details:*\n${payload.details}`,
      },
    });
  }
  
  if (payload.url) {
    blocks.push({
      type: 'action',
      elements: [
        {
          type: 'button',
          text: {
            type: 'plain_text',
            text: 'View Report',
            emoji: true,
          },
          url: payload.url,
        },
      ],
    });
  }
  
  try {
    await axios.post(webhookUrl, { blocks });
    console.log('âœ… Notification sent successfully');
  } catch (error) {
    console.error('âŒ Failed to send notification:', error);
  }
}
```

### ç›‘æ§æŒ‡æ ‡

| æŒ‡æ ‡ | æè¿° | å‘Šè­¦é˜ˆå€¼ |
|------|------|---------|
| æµ‹è¯•é€šè¿‡ç‡ | é€šè¿‡çš„æµ‹è¯•å æ¯” | < 95% |
| å¤±è´¥æ•°é‡ | è§†è§‰å›å½’å¤±è´¥çš„æµ‹è¯•æ•° | > 5 |
| é¦–æ¬¡å¤±è´¥æ—¶é—´ | ç¬¬ä¸€æ¬¡å¤±è´¥å‡ºç°çš„æäº¤ | è®°å½•SHA |
| é‡å¤å¤±è´¥ç‡ | è¿ç»­å¤±è´¥çš„æ¯”ä¾‹ | > 20% |

---

## æœ€ä½³å®è·µ

### 1. ç¨³å®šçš„æµ‹è¯•ç¯å¢ƒ

```typescript
// ç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§
test.use({
  // å›ºå®šè§†å£
  viewport: { width: 1920, height: 1080 },
  
  // å›ºå®šåŒºåŸŸè®¾ç½®
  locale: 'zh-CN',
  timezoneId: 'Asia/Shanghai',
  
  // ç¦ç”¨åœ°ç†å®šä½
  geolocation: undefined,
  
  // ç¦ç”¨æƒé™æç¤º
  permissions: [],
});
```

### 2. ç­‰å¾…ç­–ç•¥

```typescript
// æ¨èçš„ç­‰å¾…æ¨¡å¼
test.beforeEach(async ({ page }) => {
  // 1. ç­‰å¾…ç½‘ç»œç©ºé—²
  await page.waitForLoadState('networkidle');
  
  // 2. ç­‰å¾…å…³é”®å…ƒç´ 
  await page.waitForSelector('#dashboard-content', { state: 'visible' });
  
  // 3. ç­‰å¾…å›¾è¡¨æ¸²æŸ“å®Œæˆ
  await page.waitForFunction(() => {
    const charts = document.querySelectorAll('.echarts');
    return Array.from(charts).every(chart => {
      const canvas = chart.querySelector('canvas');
      return canvas && canvas.width > 0;
    });
  }, { timeout: 30000 });
});
```

### 3. å¤„ç†åŠ¨æ€å†…å®¹

```typescript
// ä½¿ç”¨toHaveScreenshotçš„ignoreé€‰é¡¹
await expect(page).toHaveScreenshot('page.png', {
  ignore: [
    // å¿½ç•¥åŠ¨æ€åŒºåŸŸ
    '.timestamp',
    '.live-data',
    '.loading-spinner',
  ],
});

// æˆ–ä½¿ç”¨locatorå®šä½ç‰¹å®šåŒºåŸŸ
const stableArea = page.locator('.chart-container').first();
await expect(stableArea).toHaveScreenshot('chart-only.png');
```

### 4. å®šæœŸæ›´æ–°åŸºçº¿

```bash
# æ¯å‘¨æ›´æ–°åŸºçº¿
pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots

# æˆ–é€šè¿‡CIæ‰‹åŠ¨è§¦å‘
# GitHub Actions: è¿è¡Œ "Update Visual Baselines" å·¥ä½œæµ
```

### 5. å¤„ç†Flakyæµ‹è¯•

```typescript
// å¢åŠ é‡è¯•æ¬¡æ•°
test.describe.configure({
  retries: 3,
  timeout: 60000,
});

// å¯¹ä¸ç¨³å®šæµ‹è¯•å¢åŠ ç­‰å¾…
test('Flaky chart test', async ({ page }) => {
  const chart = page.locator('#chart');
  
  // å¤šæ¬¡å°è¯•æˆªå›¾
  for (let attempt = 1; attempt <= 3; attempt++) {
    try {
      await page.waitForSelector('#chart canvas', { timeout: 10000 });
      await expect(chart).toHaveScreenshot(`chart-${attempt}.png`);
      break;
    } catch (error) {
      if (attempt === 3) throw error;
      await page.waitForTimeout(1000);
    }
  }
});
```

---

## å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€è®¾æ–½ (1å‘¨)

| ä»»åŠ¡ | è´Ÿè´£äºº | çŠ¶æ€ |
|------|--------|------|
| åˆ›å»ºtests/visualç›®å½•ç»“æ„ | å¾…å®š | â³ |
| å®ç°visual.config.ts | å¾…å®š | â³ |
| å®ç°åŸºç¡€æµ‹è¯•å¤¹å…· | å¾…å®š | â³ |
| å®ç°Dashboardé¡µé¢æµ‹è¯• | å¾…å®š | â³ |

**äº§å‡º**:
- å®Œæ•´çš„æµ‹è¯•ç›®å½•ç»“æ„
- åŸºç¡€é…ç½®æ–‡ä»¶
- Dashboardé¡µé¢è§†è§‰æµ‹è¯•

### Phase 2: æ ¸å¿ƒæµ‹è¯• (1å‘¨)

| ä»»åŠ¡ | è´Ÿè´£äºº | çŠ¶æ€ |
|------|--------|------|
| Technical Analysisé¡µé¢æµ‹è¯• | å¾…å®š | â„½ |
| Trade Managementé¡µé¢æµ‹è¯• | å¾…å®š | â„½ |
| æ‰€æœ‰P0ç»„ä»¶æµ‹è¯• | å¾…å®š | â„½ |
| å“åº”å¼æµ‹è¯•é…ç½® | å¾…å®š | â„½ |

**äº§å‡º**:
- æ‰€æœ‰P0é¡µé¢å’Œç»„ä»¶çš„è§†è§‰æµ‹è¯•
- å“åº”å¼æµ‹è¯•é…ç½®

### Phase 3: å®Œæ•´è¦†ç›– (1å‘¨)

| ä»»åŠ¡ | è´Ÿè´£äºº | çŠ¶æ€ |
|------|--------|------|
| P1ç»„ä»¶æµ‹è¯• | å¾…å®š | â„½ |
| P2ç»„ä»¶æµ‹è¯• | å¾…å®š | â„½ |
| åŸºçº¿ç®¡ç†å·¥å…· | å¾…å®š | â„½ |
| æŠ¥å‘Šç”Ÿæˆå™¨ | å¾…å®š | â„½ |

**äº§å‡º**:
- å®Œæ•´çš„è§†è§‰æµ‹è¯•è¦†ç›–
- è‡ªå®šä¹‰æŠ¥å‘Šç”Ÿæˆ
- åŸºçº¿ç®¡ç†å·¥å…·

### Phase 4: CI/CDé›†æˆ (3å¤©)

| ä»»åŠ¡ | è´Ÿè´£äºº | çŠ¶æ€ |
|------|--------|------|
| GitHub Actionså·¥ä½œæµ | å¾…å®š | â„½ |
| åŸºçº¿æ›´æ–°æµç¨‹ | å¾…å®š | â„½ |
| é€šçŸ¥é›†æˆ | å¾…å®š | â„½ |
| æ–‡æ¡£å®Œå–„ | å¾…å®š | â„½ |

**äº§å‡º**:
- è‡ªåŠ¨åŒ–CI/CDæµç¨‹
- é€šçŸ¥æœºåˆ¶
- å®Œæ•´æ–‡æ¡£

### Phase 5: è¿ç»´ä¼˜åŒ– (æŒç»­)

| ä»»åŠ¡ | é¢‘ç‡ |
|------|------|
| åŸºçº¿æ›´æ–° | æ¯å‘¨ |
| æµ‹è¯•å®¡æŸ¥ | æ¯æœˆ |
| é˜ˆå€¼ä¼˜åŒ– | æŒ‰éœ€ |
| æ–°ç»„ä»¶æ·»åŠ  | æŒ‰éœ€ |

### èµ„æºä¼°ç®—

| é˜¶æ®µ | æ—¶é—´ | å·¥ä½œé‡ |
|------|------|--------|
| Phase 1 | 1å‘¨ | 20äººæ—¶ |
| Phase 2 | 1å‘¨ | 30äººæ—¶ |
| Phase 3 | 1å‘¨ | 25äººæ—¶ |
| Phase 4 | 3å¤© | 15äººæ—¶ |
| **åˆè®¡** | **4å‘¨** | **~90äººæ—¶** |

---

## é™„å½•

### A. å¿«é€Ÿå¼€å§‹æŒ‡å—

```bash
# 1. å®‰è£…ä¾èµ–
cd web/frontend && pnpm install

# 2. å®‰è£…Playwrightæµè§ˆå™¨
pnpm exec playwright install --with-deps chromium

# 3. åˆå§‹åŒ–æµ‹è¯•ç›®å½•
node tests/visual/utils/baseline-manager.ts init

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev &

# 5. è¿è¡Œæµ‹è¯•
pnpm exec playwright test --config=tests/visual/config/visual.config.ts

# 6. æ›´æ–°åŸºçº¿ï¼ˆå¦‚éœ€è¦ï¼‰
pnpm exec playwright test --config=tests/visual/config/visual.config.ts --update-snapshots
```

### B. æ•…éšœæ’é™¤

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| æµ‹è¯•è¶…æ—¶ | å¢åŠ waitForSelectorè¶…æ—¶æ—¶é—´ |
| æˆªå›¾ä¸ä¸€è‡´ | æ£€æŸ¥åŠ¨ç”»æ˜¯å¦å·²ç¦ç”¨ |
| å†…å­˜ä¸è¶³ | å‡å°‘å¹¶è¡Œæµ‹è¯•æ•° |
| åŸºçº¿ä¸¢å¤± | ä»CI artifactsæ¢å¤ |

### C. ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ |
|------|------|
| Playwrightå®˜æ–¹æ–‡æ¡£ | https://playwright.dev/ |
| è§†è§‰æµ‹è¯•æŒ‡å— | https://playwright.dev/docs/test-snapshots |
| EChartså®˜æ–¹æ–‡æ¡£ | https://echarts.apache.org/ |
| ArtDeco V3.0è®¾è®¡ä»¤ç‰Œ | `web/frontend/src/styles/artdeco-tokens.scss` |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-01-25
**ç»´æŠ¤è€…**: Claude Code (ArtDeco V3.0 Upgrade Project)
**ä¸‹æ¬¡å®¡æŸ¥**: 2026-02-25
