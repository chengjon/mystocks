# 多CLI协作中的高效Prompt策略

**文档版本**: 1.0
**创建者**: Main CLI (Manager)
**创建时间**: 2025-12-28
**基于**: Phase 6多CLI协作实际经验
**目标**: 实现AI自主管理、接受分工、主动上报

---

## 📋 目录

1. [核心原则](#核心原则)
2. [初始化阶段Prompt策略](#初始化阶段t0h)
3. [执行阶段Prompt策略](#执行阶段t0h→t9h)
4. [集成阶段Prompt策略](#集成阶段t9h→t10h)
5. [清理阶段Prompt策略](#清理阶段t10h)
6. [Prompt模板库](#prompt模板库)
7. [常见错误和修复](#常见错误和修复)

---

## 核心原则

### 🎯 原则1: 文档化 > 对话化

**问题**: 直接对话容易遗漏细节，重复沟通效率低

**解决方案**: 使用结构化文档 + 简短prompt确认

**优势**:
- ✅ 信息完整，不易遗漏
- ✅ CLI可以反复参考文档
- ✅ 减少沟通往返次数
- ✅ 便于进度追踪和验收

**对比示例**:

❌ **对话化方式（低效）**:
```
用户: CLI-2，你需要修复语法错误
CLI-2: 好的，什么错误？
用户: 检查一下你的代码，应该有缩进问题
CLI-2: 好的，找到了。还有其他的吗？
用户: 还有import错误，也一起修复
CLI-2: 好的。修复完成
用户: 运行测试看看
CLI-2: 测试失败了，还有其他错误
（重复多轮对话，效率低）
```

✅ **文档化方式（高效）**:
```
用户: CLI-2，我已经创建了详细的工作指导文档
      请阅读 /opt/claude/mystocks_phase6_e2e/README.md
      然后按照文档独立完成任务。

      任务目标：
      - 修复13个语法错误
      - 达到100% E2E测试通过率

      验收标准：
      - [ ] 13个语法错误全部修复
      - [ ] pytest tests/e2e/ 全部通过
      - [ ] Pylint评级 > 8.5/10

      请在完成后更新README中的进度。

CLI-2: 收到。我会按照文档独立完成任务。
      定期在README中更新进度。
      遇到阻塞问题时会及时报告。
（一次性沟通，后续CLI自主执行）
```

---

### 🎯 原则2: 指导 > 指令

**问题**: 过度详细的指令会限制CLI的自主性，降低创新能力

**解决方案**: 提供目标和验收标准，让CLI自主选择技术方案

**优势**:
- ✅ CLI可以根据实际情况选择最优方案
- ✅ 培养CLI的独立解决问题能力
- ✅ 发现更好的技术方案
- ✅ 提高CLI的参与感和责任感

**对比示例**:

❌ **指令化方式（限制自主性）**:
```
用户: CLI-2，你必须使用pytest框架运行测试
      必须使用requests库进行HTTP请求
      必须按照以下步骤执行：
      1. 先运行单元测试
      2. 再运行集成测试
      3. 最后运行E2E测试

CLI-2: 好的，严格按照指令执行。
（CLI-2没有自主性，可能不是最优方案）
```

✅ **指导化方式（鼓励自主性）**:
```
用户: CLI-2，这是你的任务目标和验收标准：

      任务目标：
      - 实现100% E2E测试通过率
      - 修复所有语法错误

      验收标准：
      - [ ] pytest tests/e2e/ 18/18 PASSED
      - [ ] Pylint评级 > 8.5/10
      - [ ] 所有测试套件通过

      技术建议（可选）：
      - 推荐使用pytest框架（但如果unittest更适合，也可以使用）
      - 推荐使用requests库（但如果你觉得httpx更好，也可以使用）

      请根据你的专业判断选择最优方案。

CLI-2: 收到。我会根据实际情况选择最优方案。
      如果pytest更适合，我会使用pytest。
      如果发现更好的方案，我会采用并说明理由。
（CLI-2有自主性，可以选择最优方案）
```

---

### 🎯 原则3: 主动上报 > 被动检查

**问题**: 主CLI被动检查进度，问题发现延迟

**解决方案**: 建立定期主动汇报机制

**优势**:
- ✅ 问题及时发现，快速响应
- ✅ 主CLI不需要频繁主动检查
- ✅ 进度透明，信任度高
- ✅ 减少沟通开销

**对比示例**:

❌ **被动检查方式（问题发现延迟）**:
```
T+0h: 用户分配任务给CLI-2
T+3h: 用户检查进度，发现CLI-2阻塞了3小时
（问题发现延迟，浪费3小时）
```

✅ **主动上报方式（问题及时发现）**:
```
T+0h: 用户分配任务给CLI-2
用户: "请在每完成30%进度时，或遇到阻塞问题时，
      及时在README中更新进度并报告我。"

T+0.5h: CLI-2在README中更新："进度30%: 正在修复语法错误"
T+1h: CLI-2在README中更新："⚠️ 阻塞问题: 遇到13个语法错误，请求帮助"
（问题及时发现，只延迟1小时）
```

---

### 🎯 原则4: 结构化反馈 > 模糊评价

**问题**: "做得不错"、"继续努力"等模糊评价无指导意义

**解决方案**: 使用结构化的反馈模板

**优势**:
- ✅ 明确指出问题和优点
- ✅ 提供具体的改进建议
- ✅ 便于CLI理解和执行
- ✅ 建立可量化的标准

**对比示例**:

❌ **模糊评价方式（无指导意义）**:
```
用户: CLI-2，你的代码质量需要提高
CLI-2: 好的，我会努力提高
（CLI-2不知道具体要提高什么）
```

✅ **结构化反馈方式（明确指导）**:
```
用户: CLI-2，这是对你的代码审查反馈：

      ✅ 做得好的地方：
      - 测试覆盖率达到了95%（目标80%）
      - 所有E2E测试通过（18/18）
      - 提交信息格式规范

      ⚠️  需要改进的地方：
      - TODO注释过多（78个），需要清理到<20个
      - 部分函数复杂度过高（>15），需要拆分
      - Pylint评级7.5/10，需要提升到>8.5/10

      📋 改进建议：
      1. 优先清理TODO注释（使用grep查找）
      2. 拆分复杂函数（超过50行的函数）
      3. 运行pylint修复可自动修复的问题

      预计改进时间：1小时
      请在改进后更新README进度。

CLI-2: 收到。我会按照反馈逐项改进：
      1. 清理TODO注释（预计30分钟）
      2. 拆分复杂函数（预计20分钟）
      3. 提升Pylint评级（预计10分钟）
      总计1小时，完成后汇报。
（CLI-2明确知道要做什么）
```

---

## 初始化阶段（T+0h）

### 📝 任务分配Prompt模板

#### 模板1: 简单任务分配（适用于小任务）

```
CLI-X，请你完成以下任务：

【任务目标】
<用一句话描述任务目标>

【验收标准】
- [ ] <具体可验证的标准1>
- [ ] <具体可验证的标准2>
- [ ] <具体可验证的标准3>

【技术建议（可选）】
- 推荐<方案A>（但如果你觉得<方案B>更好，也可以使用）

【完成时间】
预计用时：<X小时>

【汇报要求】
- 每30%进度时在README中更新
- 遇到阻塞问题时立即报告

请确认收到任务，并开始独立执行。
```

**示例**:
```
CLI-3，请你完成缓存优化任务：

【任务目标】
实现高频API端点的缓存功能，提升响应速度

【验收标准】
- [ ] 实现5个核心API端点的缓存
- [ ] 缓存命中率>80%
- [ ] 平均响应时间<10ms
- [ ] Pylint评级>9.0/10

【技术建议（可选）】
- 推荐使用functools.lru_cache（但如果你觉得其他方案更好，也可以使用）

【完成时间】
预计用时：2小时

【汇报要求】
- 每30%进度时在README中更新
- 遇到阻塞问题时立即报告

请确认收到任务，并开始独立执行。
```

---

#### 模板2: 复杂任务分配（适用于大任务）

```
CLI-X，我为你创建了一个详细的工作文档。

【工作文档】
请阅读：<WORKTREE_PATH>/README.md

文档包含：
1. 任务目标（详细描述）
2. 背景信息（为什么做这个任务）
3. 验收标准（可量化的标准）
4. 技术建议（可选的实现方案）
5. 参考资料（相关文档和链接）
6. 完成标准清单（checklist）

【工作流程】
1. 阅读README.md，理解任务要求
2. 在README中创建"进度更新"章节
3. 开始独立执行任务
4. 定期在README中更新进度
5. 遇到问题先尝试独立解决
6. 无法解决时及时报告主CLI

【验收标准】
所有完成标准清单项都标记为[✅]

【完成时间】
预计用时：<X小时>

【汇报要求】
- 每30%进度时更新README
- 遇到阻塞问题立即报告
- 完成后更新README并通知主CLI

请确认收到任务，阅读README.md后开始执行。
```

**示例（Phase 6 CLI-2实际使用）**:
```
CLI-2，我为你创建了一个详细的工作文档。

【工作文档】
请阅读：/opt/claude/mystocks_phase6_e2e/README.md

文档包含：
1. 任务目标：运行7个测试套件，达到100%通过率
2. 背景信息：Phase 6需要E2E测试验证架构优化
3. 验收标准：
   - [ ] 单元测试通过
   - [ ] 集成测试通过
   - [ ] E2E测试通过（18/18）
   - [ ] Pylint评级>8.5/10
4. 技术建议：pytest框架（可选）
5. 参考资料：pytest文档，项目测试指南
6. 完成标准清单（详细checklist）

【工作流程】
1. 阅读README.md，理解任务要求
2. 在README中创建"进度更新"章节
3. 开始独立执行任务
4. 定期在README中更新进度（每30%）
5. 遇到问题先尝试独立解决
6. 无法解决时及时报告主CLI

【验收标准】
所有完成标准清单项都标记为[✅]

【完成时间】
预计用时：6小时

【汇报要求】
- 每30%进度时更新README
- 遇到阻塞问题立即报告
- 完成后更新README并通知主CLI

请确认收到任务，阅读README.md后开始执行。
```

---

#### 模板3: 文档模板（README.md结构）

**完整的README.md模板**:

```markdown
# Phase X: <任务名称>

**分配时间**: YYYY-MM-DD
**Worker CLI**: CLI-X
**预计用时**: X小时
**状态**: 🔄 进行中

---

## 📋 任务目标

<用2-3句话描述任务目标>

## 🎯 验收标准

- [ ] <可量化的标准1>
- [ ] <可量化的标准2>
- [ ] <可量化的标准3>

## 📚 背景信息

<为什么做这个任务，业务价值是什么>

## 💡 技术建议

<推荐的技术方案，但允许CLI自主选择>

- 推荐: <方案A>
- 原因: <为什么推荐A>
- 替代方案: <方案B>（如果更适合，也可以使用）

## 📖 参考资料

- [文档1](链接)
- [文档2](链接)
- [相关代码](路径)

## ✅ 完成标准清单

### 阶段1: 准备工作
- [ ] 阅读相关文档
- [ ] 理解任务要求
- [ ] 制定实施计划

### 阶段2: 执行工作
- [ ] 实现功能1
- [ ] 实现功能2
- [ ] 编写测试

### 阶段3: 验证工作
- [ ] 运行测试套件
- [ ] 达到验收标准
- [ ] 代码审查通过

### 阶段4: 提交工作
- [ ] 更新README完成状态
- [ ] Git提交到分支
- [ ] 通知主CLI验收

---

## 📊 进度更新

### T+0h: 任务接收
- 状态: ✅ 已接收任务
- 计划: <简要说明计划>

### T+Xh: 进度30%
- 状态: 🔄 进行中
- 已完成:
  - ✅ <完成项1>
  - ✅ <完成项2>
- 进行中: <进行中的项>
- 遇到问题: <如果有问题，描述问题>

### T+Yh: 进度60%
- 状态: 🔄 进行中
- 已完成:
  - ✅ <完成项1>
  - ✅ <完成项2>
  - ✅ <完成项3>
- 进行中: <进行中的项>
- 遇到问题: <如果有问题，描述问题>

### T+Zh: 进度90%
- 状态: 🔄 进行中
- 已完成:
  - ✅ <所有完成项>
- 进行中: 最后验证
- 遇到问题: <如果有问题，描述问题>

### T+Wh: 任务完成 ✅
- 状态: ✅ 完成
- 提交: <Git commit hash>
- 验收: <验收结果>

---

## ⚠️ 问题和解决方案

### 问题1: <问题描述>
- **发现时间**: T+Xh
- **严重程度**: 🟡警告级 / 🔴阻塞级
- **问题描述**: <详细描述问题>
- **已尝试方案**:
  1. <方案1>: <结果>
  2. <方案2>: <结果>
- **请求帮助**: <需要主CLI提供什么帮助>
- **解决方案**: <主CLI提供的解决方案>
- **解决时间**: T+Yh

---

## 📝 技术决策

### 决策1: 采用<方案A>
- **时间**: T+Xh
- **考虑因素**:
  - 优点: <优点1>, <优点2>
  - 缺点: <缺点1>, <缺点2>
  - 替代方案: <方案B>
- **最终选择**: <方案A>
- **原因**: <为什么选择A>

---

## 🎓 经验总结

### 学到的经验
- <经验1>
- <经验2>

### 遇到的坑
- <坑1> + <解决方案>
- <坑2> + <解决方案>

### 改进建议
- <建议1>
- <建议2>

---

**文档版本**: 1.0
**最后更新**: T+Xh
**维护者**: CLI-X
```

---

## 执行阶段（T+0h → T+9h）

### 🔄 进度监控Prompt模板

#### 模板4: 定期进度检查（非侵入式）

```
【进度检查】T+Xh

@CLI-X，我正在进行定期进度检查。

请简要回复以下问题：

1. 当前进度百分比：<0-100%>
2. 是否遇到阻塞问题：<是/否>
   - 如果是，请描述问题
3. 预计完成时间：<T+Xh>

如果一切正常，只需回复：
"✅ 进度XX%，无阻塞问题，预计T+Xh完成"

如果遇到阻塞问题，请详细描述并请求帮助。
```

**示例**:
```
【进度检查】T+2h

@CLI-2，我正在进行定期进度检查。

请简要回复以下问题：

1. 当前进度百分比：<0-100%>
2. 是否遇到阻塞问题：<是/否>
   - 如果是，请描述问题
3. 预计完成时间：<T+Xh>

如果一切正常，只需回复：
"✅ 进度XX%，无阻塞问题，预计T+Xh完成"

如果遇到阻塞问题，请详细描述并请求帮助。
```

**CLI-2的正常回复**:
```
✅ 进度30%，无阻塞问题，预计T+5.4h完成

已完成：
- ✅ 修复5个语法错误
- ✅ 运行单元测试（通过）

进行中：
- 🔄 修复剩余8个语法错误
```

**CLI-2的阻塞回复**:
```
⚠️ 进度30%，遇到阻塞问题

问题描述：
- 运行E2E测试失败
- 错误：ModuleNotFoundError: No module named 'web.backend.app'
- 严重程度：🔴 阻塞级

已尝试方案：
1. 检查import路径 → 未找到问题
2. 尝试修改为相对导入 → 仍然失败

请求帮助：
需要主CLI提供正确的配置和import路径设置
```

---

#### 模板5: 阻塞问题快速响应

**当CLI报告阻塞问题时，主CLI的快速响应模板**:

```
【问题响应】T+Xh

@CLI-X，收到你的阻塞问题报告。

**问题优先级**: 🔴 阻塞级
**响应时间**: <15分钟内>
**预计解决时间**: <X分钟>

我已经分析了你的问题，这是解决方案：

## 📍 问题定位
<根本原因分析>

## ✅ 解决步骤
1. <步骤1>
2. <步骤2>
3. <步骤3>

## 🔍 验证方法
```bash
<验证命令>
```

## ⚠️ 注意事项
<需要注意的事项>

## 📞 如果还是无法解决
<提供进一步的故障排除指南>

---

请按照此解决方案独立修复，不要请求我执行这些步骤。
我的角色是提供指导，你的角色是执行。

修复完成后，请在README中更新进度并报告结果。
```

**示例（Phase 6 CLI-2实际使用）**:
```
【问题响应】T+3h

@CLI-2，收到你的阻塞问题报告。

**问题优先级**: 🔴 阻塞级
**响应时间**: 10分钟
**预计解决时间**: 30分钟

我已经分析了你的问题，这是解决方案：

## 📍 问题定位
根本原因：PYTHONPATH未正确设置，导致无法导入web.backend.app模块

## ✅ 解决步骤
1. 设置PYTHONPATH环境变量
```bash
export PYTHONPATH=/opt/claude/mystocks_spec/web/backend:$PYTHONPATH
```

2. 修改测试导入路径
```python
# 从
from app.main import app
# 改为
import sys
sys.path.insert(0, '/opt/claude/mystocks_spec/web/backend')
from app.main import app
```

3. 验证配置
```bash
cd /opt/claude/mystocks_phase6_e2e
python -c "from app.main import app; print('Import success')"
```

## 🔍 验证方法
```bash
# 运行健康检查
curl http://localhost:8000/health

# 运行单个测试
pytest tests/e2e/test_architecture_optimization_e2e.py::TestArchitectureOptimizationE2E::test_database_stats_endpoint_exists -v
```

## ⚠️ 注意事项
- 确保在E2E测试的worktree中执行
- 每次修改后需要重启服务
- 如果还有问题，检查.env配置

## 📞 如果还是无法解决
请提供以下信息：
1. 完整错误堆栈
2. 当前PYTHONPATH值
3. tests/e2e/conftest.py内容

---

请按照此解决方案独立修复，不要请求我执行这些步骤。
我的角色是提供指导，你的角色是执行。

修复完成后，请在README中更新进度并报告结果。
```

---

#### 模板6: 优先级动态调整

**当需要调整CLI任务优先级时**:

```
【优先级调整】T+Xh

@CLI-X，基于当前项目进展，我建议调整你的任务优先级。

**当前优先级**: <当前优先级>
**建议优先级**: <新优先级>
**调整原因**: <为什么需要调整>

**调整后的任务顺序**:
1. <新任务1> （最高优先级）
2. <新任务2> （高优先级）
3. <新任务3> （中优先级）

**预计影响**:
- 时间节省: <X小时>
- 效率提升: <X%>

**是否同意此调整？**

如果同意，请回复："✅ 同意调整，开始执行新优先级"
如果有其他建议，请说明理由。
```

**示例（Phase 6 CLI-2实际使用）**:
```
【优先级调整】T+1h

@CLI-2，基于当前项目进展，我建议调整你的任务优先级。

**当前优先级**: 4（较低）
**建议优先级**: 提升（优先处理语法错误修复）
**调整原因**: 你遇到的13个语法错误阻塞了后续测试工作，
             优先修复这些错误可以解除阻塞，提升整体效率

**调整后的任务顺序**:
1. 修复13个语法错误 （最高优先级，预计1小时）
2. 运行单元测试验证 （高优先级，预计30分钟）
3. 运行E2E测试 （中优先级，预计30分钟）
4. 其他测试套件 （按原计划）

**预计影响**:
- 时间节省: 63分钟
- 效率提升: 19.4%

**是否同意此调整？**

如果同意，请回复："✅ 同意调整，开始执行新优先级"
如果有其他建议，请说明理由。
```

---

### 🎯 质量反馈Prompt模板

#### 模板7: 代码审查反馈（结构化）

```
【代码审查反馈】T+Xh

@CLI-X，我审查了你的代码，这是反馈意见：

## ✅ 做得好的地方

1. **<优点1>**
   - 描述: <详细描述>
   - 影响: <对项目的影响>

2. **<优点2>**
   - 描述: <详细描述>
   - 影响: <对项目的影响>

## ⚠️  需要改进的地方

### 问题1: <问题标题>
- **严重程度**: 🟡警告级 / 🔴阻塞级
- **问题描述**: <详细描述问题>
- **影响**: <对项目的影响>
- **改进建议**:
  1. <建议1>
  2. <建议2>
- **预计改进时间**: <X分钟>

### 问题2: <问题标题>
- **严重程度**: 🟡警告级
- **问题描述**: <详细描述问题>
- **改进建议**:
  1. <建议1>
  2. <建议2>
- **预计改进时间**: <X分钟>

## 📋 改进清单

请按照以下顺序改进：

1. **[高优先级]** <改进项1> （预计<X分钟>）
2. **[中优先级]** <改进项2> （预计<X分钟>）
3. **[低优先级]** <改进项3> （预计<X分钟>）

**总计预计时间**: <X小时>

## 🎯 验收标准

改进后的代码应该满足：
- [ ] <标准1>
- [ ] <标准2>
- [ ] <标准3>

---

请在改进完成后更新README进度并报告。
```

**示例（Phase 6实际使用）**:
```
【代码审查反馈】T+4h

@CLI-2，我审查了你的代码，这是反馈意见：

## ✅ 做得好的地方

1. **测试覆盖率优秀**
   - 描述: 测试覆盖率达到95%，远超目标80%
   - 影响: 代码质量有保障

2. **E2E测试全部通过**
   - 描述: 18/18 E2E测试通过（100%）
   - 影响: 架构优化验证成功

## ⚠️  需要改进的地方

### 问题1: TODO注释过多
- **严重程度**: 🟡警告级
- **问题描述**: 代码中有78个TODO注释，需要清理
- **影响**: 代码可维护性降低
- **改进建议**:
  1. 使用grep查找所有TODO: `grep -r "TODO" src/`
  2. 分类TODO：必须修复 vs 可以后续处理
  3. 修复必须修复的TODO，删除过期的TODO
- **预计改进时间**: 30分钟

### 问题2: 部分函数复杂度过高
- **严重程度**: 🟡警告级
- **问题描述**: 3个函数复杂度>15（超过建议值）
- **影响**: 代码可读性和可维护性降低
- **改进建议**:
  1. 使用pylint检查: `pylint --rcfile=.pylint.test.rc src/`
  2. 识别复杂函数
  3. 拆分复杂函数（>50行的函数）
- **预计改进时间**: 20分钟

### 问题3: Pylint评级偏低
- **严重程度**: 🟡警告级
- **问题描述**: Pylint评级7.5/10，低于目标8.5/10
- **影响**: 代码质量不达标
- **改进建议**:
  1. 运行pylint自动修复: `pylint --rcfile=.pylint.test.rc --fix-only src/`
  2. 手动修复无法自动修复的问题
  3. 再次运行验证
- **预计改进时间**: 10分钟

## 📋 改进清单

请按照以下顺序改进：

1. **[高优先级]** 提升Pylint评级 （预计10分钟）
2. **[中优先级]** 清理TODO注释 （预计30分钟）
3. **[低优先级]** 拆分复杂函数 （预计20分钟）

**总计预计时间**: 1小时

## 🎯 验收标准

改进后的代码应该满足：
- [ ] Pylint评级 > 8.5/10
- [ ] TODO注释 < 20个
- [ ] 所有函数复杂度 < 15

---

请在改进完成后更新README进度并报告。
```

---

## 集成阶段（T+9h → T+10h）

### 🎉 验收和合并Prompt模板

#### 模板8: 任务验收

```
【任务验收】T+Xh

@CLI-X，你的任务已完成，我现在进行验收。

## 📋 验收清单

### 验收项1: <验收项名称>
- **标准**: <具体标准>
- **验证方法**: <如何验证>
- **结果**: ✅ 通过 / ❌ 不通过

### 验收项2: <验收项名称>
- **标准**: <具体标准>
- **验证方法**: <如何验证>
- **结果**: ✅ 通过 / ❌ 不通过

### 验收项3: <验收项名称>
- **标准**: <具体标准>
- **验证方法**: <如何验证>
- **结果**: ✅ 通过 / ❌ 不通过

## 📊 验收结果

**总体评价**: ✅ 验收通过 / ⚠️ 需要改进

**通过项**: X/Y
**需要改进项**: Y/X

**如果需要改进**:
请参考改进建议（见下文），并在改进后重新提交验收。

## ✅ 如果验收通过

恭喜！你的任务已经完成并通过验收。

**后续步骤**:
1. 保持当前worktree状态（不要修改）
2. 等待主CLI合并到main分支
3. 合并完成后，worktree将被清理

感谢你的工作！🎉

## ⚠️ 如果需要改进

**改进建议**:
1. <改进项1>: <具体建议>
2. <改进项2>: <具体建议>

**预计改进时间**: <X小时>

**改进后验收时间**: T+Xh

请在改进完成后更新README并报告。
```

**示例**:
```
【任务验收】T+5.4h

@CLI-2，你的任务已完成，我现在进行验收。

## 📋 验收清单

### 验收项1: 语法错误修复
- **标准**: 13个语法错误全部修复
- **验证方法**: pylint检查无error
- **结果**: ✅ 通过

### 验收项2: E2E测试通过
- **标准**: 18/18 E2E测试通过
- **验证方法**: pytest tests/e2e/ -v
- **结果**: ✅ 通过 (18/18 PASSED)

### 验收项3: Pylint评级
- **标准**: Pylint评级 > 8.5/10
- **验证方法**: pylint --rcfile=.pylint.test.rc tests/
- **结果**: ✅ 通过 (8.92/10)

### 验收项4: TODO清理
- **标准**: TODO注释 < 20个
- **验证方法**: grep -r "TODO" | wc -l
- **结果**: ✅ 通过 (10个TODO)

## 📊 验收结果

**总体评价**: ✅ 验收通过

**通过项**: 4/4
**需要改进项**: 0/4

## ✅ 如果验收通过

恭喜！你的任务已经完成并通过验收。

**后续步骤**:
1. 保持当前worktree状态（不要修改）
2. 等待主CLI合并到main分支
3. 合并完成后，worktree将被清理

感谢你的工作！🎉

**特别表扬**:
- ✅ 提前3.1小时完成（效率提升57.4%）
- ✅ Pylint评级超过目标（8.92 vs 8.5）
- ✅ TODO清理率87.2%（78 → 10）
```

---

#### 模板9: 合并通知

```
【合并通知】T+Xh

@All Worker CLIs，主CLI现在开始合并所有分支到main。

## 📋 合并计划

**合并顺序**:
1. CLI-3: phase6-cache-optimization （最快完成）
2. CLI-4: phase6-documentation （文档专业）
3. CLI-2: phase6-e2e-testing （测试验证）
4. CLI-1: phase6-monitoring-verification （监控验证）

**预计合并时间**: 30分钟
**合并策略**: --no-ff --no-edit（保留分支历史）

## ⚠️ 合并期间请注意

- **不要提交新代码**: 合并期间暂停所有worktree的工作
- **不要切换分支**: 保持当前分支状态
- **等待合并完成**: 合并完成后会通知

## 🎯 合并后验证

合并完成后，我会运行E2E测试验证：
```bash
pytest tests/e2e/test_architecture_optimization_e2e.py -v
```

**验收标准**: 18/18 PASSED (100%)

## ✅ 合并完成后

- 所有worktree将被清理
- 所有分支将被删除
- main分支将推送到远程

请耐心等待合并完成。预计T+10h完成所有工作。

感谢大家的协作！🙏
```

---

## 清理阶段（T+10h）

### 🧹 清理和归档Prompt模板

#### 模板10: 分支清理通知

```
【清理通知】T+10h

@All Worker CLIs，Phase 6项目已经完成，现在开始清理工作。

## 📋 清理计划

**清理顺序**:
1. 验证所有分支已成功合并到main
2. 删除所有worktree（4个）
3. 删除所有本地分支（4个）
4. 删除所有远程分支（3个）
5. 推送main分支到远程

**预计清理时间**: 10分钟

## ⚠️ 清理期间请注意

- **不要访问worktree**: worktree即将被删除
- **备份重要文件**: 如果worktree中有重要文件，请提前备份
- **不要切换分支**: 分支即将被删除

## ✅ 清理完成后

- ✅ 所有Phase 6代码已合并到main
- ✅ main分支已推送到远程
- ✅ 所有worktree已清理
- ✅ 所有分支已删除
- ✅ Phase 6项目归档完成

## 📊 Phase 6成果总结

**参与CLI**: 4个（CLI-1/2/3/4）
**项目用时**: 10小时
**时间节省**: 65.5%（19小时）
**质量指标**:
- ✅ E2E测试: 18/18 PASSED (100%)
- ✅ Pylint评级: 9.32/10
- ✅ TODO清理: 87.2%减少

感谢大家的协作！Phase 6圆满完成！🎉
```

---

## Prompt模板库

### 快速参考卡片

#### 🎯 任务分配速查表

| 任务类型 | 使用模板 | 关键要素 |
|---------|---------|----------|
| 简单任务（<2h） | 模板1 | 一句话目标 + 3个验收标准 |
| 复杂任务（>2h） | 模板2+3 | 详细README文档 + 完成checklist |
| 紧急任务 | 模板1 + "🔴 最高优先级" | 简化流程，快速响应 |

#### 📊 进度监控速查表

| 监控类型 | 使用模板 | 频率 |
|---------|---------|------|
| 定期检查 | 模板4 | 每2小时 |
| 阻塞响应 | 模板5 | 15分钟内 |
| 优先级调整 | 模板6 | 按需 |
| 质量反馈 | 模板7 | 完成阶段 |

#### ✅ 验收合并速查表

| 验收类型 | 使用模板 | 关键要素 |
|---------|---------|----------|
| 任务验收 | 模板8 | 验收清单 + 通过/不通过 |
| 合并通知 | 模板9 | 合并顺序 + 验证标准 |
| 清理通知 | 模板10 | 清理步骤 + 成果总结 |

---

## 常见错误和修复

### ❌ 错误1: 过度详细指令

**问题**: Prompt过于详细，限制CLI自主性

**错误示例**:
```
CLI-X，你必须按照以下步骤执行：
1. 使用vim打开文件a.py
2. 在第10行添加代码：xxx
3. 保存文件
4. 运行pytest
5. 查看结果
（过于详细，CLI无自主性）
```

**修复**: 使用指导化Prompt
```
CLI-X，这是任务目标和验收标准：
- 目标：修复a.py中的bug
- 验收：pytest tests/test_a.py -v 全部通过

请根据你的专业判断选择最优方案。
（CLI有自主性，可以选择最优方案）
```

---

### ❌ 错误2: 缺乏验收标准

**问题**: Prompt只有任务描述，没有可验证的标准

**错误示例**:
```
CLI-X，请你优化代码性能。
（没有具体标准，CLI不知道要做到什么程度）
```

**修复**: 添加可量化的验收标准
```
CLI-X，请你优化代码性能：

验收标准：
- [ ] API响应时间 < 100ms (p95)
- [ ] 内存使用 < 500MB
- [ ] Pylint评级 > 8.5/10

请完成后提供性能测试报告。
（有明确标准，CLI知道目标）
```

---

### ❌ 错误3: 忘记汇报要求

**问题**: Prompt没有明确汇报要求，CLI不知道何时汇报

**错误示例**:
```
CLI-X，请完成缓存优化任务。
（没有汇报要求，主CLI不知道进度）
```

**修复**: 添加明确的汇报要求
```
CLI-X，请完成缓存优化任务。

汇报要求：
- 每30%进度时在README中更新
- 遇到阻塞问题立即报告
- 完成后更新README并通知我验收

（有明确汇报要求，进度透明）
```

---

### ❌ 错误4: 混乱的问题反馈

**问题**: 反馈意见结构混乱，CLI难以理解和执行

**错误示例**:
```
CLI-X，你的代码有问题。
TODO太多，函数太长，命名不规范，
还有几个测试失败，性能也不行，
总体来说需要改进。

请改进后告诉我。
（混乱，CLI不知道从何入手）
```

**修复**: 使用结构化反馈模板
```
CLI-X，这是代码审查反馈：

⚠️ 需要改进的地方：

1. TODO注释过多（78个 → 目标<20个）
   建议：grep -r "TODO" src/ 清理过期TODO

2. 函数复杂度过高（3个函数>15行）
   建议：拆分复杂函数

3. 测试失败（2个）
   - test_api_timeout: FAILED
   - test_db_connection: FAILED

改进清单：
1. 清理TODO（预计30分钟）
2. 拆分函数（预计20分钟）
3. 修复测试（预计10分钟）

总计：1小时

请在改进完成后更新README。
（结构化，CLI知道如何执行）
```

---

### ❌ 错误5: 忽略CLI的建议

**问题**: CLI提出更好的建议，但用户忽视

**错误示例**:
```
CLI-X: 我觉得方案B更适合当前场景，
        因为可以节省50%的时间。
用户: 不，你必须使用方案A。
（忽视专业建议，效率降低）
```

**修复**: 认真考虑并接受合理建议
```
CLI-X: 我觉得方案B更适合当前场景，
        因为可以节省50%的时间。
用户: 很好的建议！我同意使用方案B。
        请按照你的方案执行，并说明理由。
        如果遇到问题，随时报告。
（接受专业建议，提升效率）
```

---

## 📝 总结

### 高效Prompt的核心要素

#### ✅ 必须包含的要素

1. **任务目标** - 清晰、简洁、可理解
2. **验收标准** - 可量化、可验证、有时间限制
3. **汇报要求** - 明确的汇报频率和方式
4. **技术建议** - 提供但不强制，允许CLI自主选择

#### ⚠️ 需要避免的错误

1. ❌ 过度详细指令 - 限制CLI自主性
2. ❌ 缺乏验收标准 - CLI不知道目标
3. ❌ 忘记汇报要求 - 进度不透明
4. ❌ 混乱的反馈 - CLI难以理解和执行
5. ❌ 忽视专业建议 - 降低效率

#### 🎯 最佳实践

1. **文档化 > 对话化** - 使用README文档 + 简短prompt
2. **指导 > 指令** - 提供目标，让CLI自主选择方案
3. **主动上报 > 被动检查** - 建立定期汇报机制
4. **结构化反馈 > 模糊评价** - 使用模板提供明确指导

---

### Prompt设计原则

**SMART原则**:
- **S**pecific（具体）- 目标明确具体
- **M**easurable（可衡量）- 有可验证的标准
- **A**chievable（可实现）- 在CLI能力范围内
- **R**elevant（相关）- 与项目目标相关
- **T**ime-bound（有时限）- 有明确的时间限制

**5W1H原则**:
- **W**hat（做什么）- 任务目标
- **W**hy（为什么）- 背景和价值
- **W**hen（何时）- 时间节点
- **W**here（在哪）- worktree路径
- **W**ho（谁）- 哪个CLI
- **H**ow（如何）- 实施建议（可选）

---

**文档版本**: 1.0
**最后更新**: 2025-12-28
**维护者**: Main CLI (Manager)
**基于**: Phase 6多CLI协作实际经验

---

*希望这套Prompt策略能够帮助用户更好地与CLI协作，实现高效的AI自主管理！*
