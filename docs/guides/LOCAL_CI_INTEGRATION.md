# MyStocks æœ¬åœ°å¼€å‘ç¯å¢ƒCIé›†æˆæŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­é›†æˆCI/CDæ£€æŸ¥ï¼Œç¡®ä¿ä»£ç è´¨é‡ä»å¼€å‘é˜¶æ®µå°±å¼€å§‹æŠŠæ§ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

### ç³»ç»Ÿè¦æ±‚
- Python 3.12+
- Git 2.30+
- Node.js 16+ (å‰ç«¯å¼€å‘)

### ä¾èµ–å®‰è£…
```bash
# å®‰è£…pre-commit
pip install pre-commit

# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements-dev.txt

# å®‰è£…å‰ç«¯ä¾èµ– (å¦‚éœ€è¦å‰ç«¯å¼€å‘)
cd web/frontend && npm install
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–pre-commit hooks
```bash
# å®‰è£…pre-commit hooksåˆ°æœ¬åœ°ä»“åº“
pre-commit install

# (å¯é€‰) å®‰è£…åˆ°commit-msgæ£€æŸ¥
pre-commit install --hook-type commit-msg
```

### 2. è¿è¡Œæœ¬åœ°CIæ£€æŸ¥
```bash
# è¿è¡Œå®Œæ•´çš„æœ¬åœ°CIæ£€æŸ¥
./scripts/ci/local_ci_check.sh

# æˆ–ä½¿ç”¨pre-commitè¿è¡Œæ‰€æœ‰æ£€æŸ¥
pre-commit run --all-files

# åªè¿è¡Œæœ¬åœ°CIæ£€æŸ¥
pre-commit run local-ci-check
```

### 3. æ—¥å¸¸å¼€å‘å·¥ä½œæµ

#### å¼€å‘å‰å‡†å¤‡
```bash
# ç¡®ä¿åˆ†æ”¯æ˜¯æœ€æ–°çš„
git checkout develop
git pull origin develop

# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-quantization-strategy
```

#### å¼€å‘è¿‡ç¨‹ä¸­
```bash
# ç¼–å†™ä»£ç ...

# æäº¤å‰è‡ªåŠ¨æ£€æŸ¥ (pre-commitä¼šè‡ªåŠ¨è¿è¡Œ)
git add .
git commit -m "feat: å®ç°æ–°çš„é‡åŒ–ç­–ç•¥"

# å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œä¿®å¤é—®é¢˜åé‡æ–°æäº¤
```

#### æ¨é€åˆ°è¿œç¨‹
```bash
# æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯
git push origin feature/new-quantization-strategy

# åœ¨GitHubä¸Šåˆ›å»ºPRåˆ°developåˆ†æ”¯
```

## ğŸ”§ é…ç½®è¯¦è§£

### pre-commit hooksé…ç½®

é¡¹ç›®å·²é…ç½®ä»¥ä¸‹æ£€æŸ¥ï¼š

#### 1. ä»£ç æ ¼å¼åŒ– (Black)
- **ä½œç”¨**: ç»Ÿä¸€ä»£ç æ ¼å¼
- **è§¦å‘**: æ¯æ¬¡æäº¤Pythonæ–‡ä»¶æ—¶
- **ä¿®å¤**: `black src/`

#### 2. å¯¼å…¥æ’åº (isort)
- **ä½œç”¨**: è§„èŒƒåŒ–å¯¼å…¥è¯­å¥é¡ºåº
- **è§¦å‘**: Pythonæ–‡ä»¶æäº¤æ—¶

#### 3. ç±»å‹æ£€æŸ¥ (MyPy)
- **ä½œç”¨**: é™æ€ç±»å‹æ£€æŸ¥
- **è§¦å‘**: Pythonæ ¸å¿ƒæ–‡ä»¶æäº¤æ—¶

#### 4. æœ¬åœ°CIæ£€æŸ¥ (local-ci-check)
- **ä½œç”¨**: å¿«é€Ÿè´¨é‡éªŒè¯
- **æ£€æŸ¥å†…å®¹**:
  - Pythonç¯å¢ƒéªŒè¯
  - ä»£ç æ ¼å¼æ£€æŸ¥
  - å¿«é€Ÿç±»å‹æ£€æŸ¥
  - å®‰å…¨æ‰«æ
  - å•å…ƒæµ‹è¯•
  - é‡åŒ–ç­–ç•¥è¯­æ³•éªŒè¯

#### 5. é‡åŒ–ç­–ç•¥éªŒè¯ (quant-strategy-syntax)
- **ä½œç”¨**: ç¡®ä¿ç­–ç•¥æ–‡ä»¶è¯­æ³•æ­£ç¡®
- **è§¦å‘**: `src/strategies/`ç›®å½•ä¸‹çš„Pythonæ–‡ä»¶

#### 6. å®‰å…¨æ£€æŸ¥ (Bandit)
- **ä½œç”¨**: å‘ç°æ½œåœ¨å®‰å…¨æ¼æ´
- **è§¦å‘**: æºä»£ç æ–‡ä»¶æäº¤æ—¶

### è‡ªå®šä¹‰é…ç½®

#### ä¿®æ”¹æ£€æŸ¥èŒƒå›´
```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: local-ci-check
        files: \.(py|js|ts|vue)$  # ä¿®æ”¹æ–‡ä»¶åŒ¹é…æ¨¡å¼
        exclude: ^tests/.*        # æ’é™¤æµ‹è¯•ç›®å½•
```

#### è·³è¿‡ç‰¹å®šæ£€æŸ¥
```bash
# ä¸´æ—¶è·³è¿‡æ‰€æœ‰æ£€æŸ¥
git commit --no-verify -m "ç´§æ€¥ä¿®å¤"

# è·³è¿‡ç‰¹å®šhook
SKIP=local-ci-check git commit -m "è·³è¿‡æœ¬åœ°CIæ£€æŸ¥"
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### pre-commitæœªå®‰è£…
```bash
pip install pre-commit
pre-commit --version
```

#### æ£€æŸ¥è¿è¡Œå¤ªæ…¢
```bash
# åªè¿è¡Œç‰¹å®šæ£€æŸ¥
pre-commit run black
pre-commit run local-ci-check

# ä½¿ç”¨ç¼“å­˜
pre-commit run --all-files  # é¦–æ¬¡è¿è¡Œä¼šå»ºç«‹ç¼“å­˜
```

#### Pythonè·¯å¾„é—®é¢˜
```bash
# ç¡®ä¿Pythonè·¯å¾„æ­£ç¡®
export PYTHONPATH="${PYTHONPATH}:$(pwd)/src"
```

#### ä¾èµ–ç¼ºå¤±
```bash
# æ£€æŸ¥å¹¶å®‰è£…ç¼ºå¤±çš„å·¥å…·
pip install black mypy bandit ruff isort

# å‰ç«¯æ£€æŸ¥å·¥å…·
cd web/frontend && npm install eslint
```

### è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
# è¿è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
pre-commit run --verbose

# æŸ¥çœ‹ç‰¹å®šhookçš„æ—¥å¿—
pre-commit run local-ci-check --verbose
```

#### æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥
```bash
# æµ‹è¯•æœ¬åœ°CIè„šæœ¬
bash -x ./scripts/ci/local_ci_check.sh

# å•ç‹¬æµ‹è¯•é‡åŒ–ç­–ç•¥æ£€æŸ¥
python3 -c "
import sys
sys.path.insert(0, 'src')
# ç­–ç•¥æ£€æŸ¥ä»£ç 
"
```

## ğŸ“Š æ£€æŸ¥å†…å®¹è¯¦è§£

### æœ¬åœ°CIæ£€æŸ¥è¦†ç›–èŒƒå›´

| æ£€æŸ¥é¡¹ | è¯´æ˜ | è€—æ—¶ | é‡è¦æ€§ |
|--------|------|------|--------|
| Pythonç¯å¢ƒ | ç‰ˆæœ¬å’Œä¾èµ–éªŒè¯ | < 1s | é«˜ |
| ä»£ç æ ¼å¼ | Blackæ ¼å¼æ£€æŸ¥ | < 5s | é«˜ |
| ç±»å‹æ£€æŸ¥ | MyPyå¿«é€Ÿæ£€æŸ¥ | < 10s | ä¸­ |
| å®‰å…¨æ‰«æ | BanditåŸºç¡€æ£€æŸ¥ | < 5s | é«˜ |
| å•å…ƒæµ‹è¯• | æ ¸å¿ƒæ¨¡å—æµ‹è¯• | < 30s | é«˜ |
| ç­–ç•¥éªŒè¯ | é‡åŒ–ç­–ç•¥è¯­æ³• | < 2s | é«˜ |

### æ€§èƒ½ä¼˜åŒ–

#### ç¼“å­˜ç­–ç•¥
- pre-commitä¼šè‡ªåŠ¨ç¼“å­˜æ£€æŸ¥ç»“æœ
- åªæœ‰å˜æ›´çš„æ–‡ä»¶ä¼šè¢«é‡æ–°æ£€æŸ¥
- ä¾èµ–åŒ…ä¼šè¢«ç¼“å­˜åˆ° `~/.cache/pre-commit`

#### å¹¶è¡Œæ‰§è¡Œ
```bash
# ä½¿ç”¨å¤šè¿›ç¨‹è¿è¡Œ (å¦‚æœæ”¯æŒ)
pre-commit run --all-files --jobs 4
```

## ğŸ”„ é›†æˆåˆ°IDE

### VS Codeé…ç½®
```json
// .vscode/settings.json
{
  "python.formatting.provider": "black",
  "python.linting.enabled": true,
  "python.linting.mypyEnabled": true,
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.organizeImports": true
  }
}
```

### PyCharmé…ç½®
1. **å¤–éƒ¨å·¥å…·**: æ·»åŠ pre-commitå‘½ä»¤
2. **æ–‡ä»¶ç›‘å¬å™¨**: è‡ªåŠ¨æ ¼å¼åŒ–
3. **æäº¤å‰æ£€æŸ¥**: é›†æˆpre-commit

## ğŸ“ˆ æœ€ä½³å®è·µ

### å¼€å‘ä¹ æƒ¯
1. **é¢‘ç¹æäº¤**: å°æ­¥å¿«è·‘ï¼Œé¿å…å¤§å—ä¿®æ”¹
2. **æå‰æ£€æŸ¥**: ä¸è¦ç­‰åˆ°æäº¤æ—¶æ‰å‘ç°é—®é¢˜
3. **åˆ†æ”¯ç®¡ç†**: ä½¿ç”¨æè¿°æ€§çš„åˆ†æ”¯åç§°

### å›¢é˜Ÿåä½œ
1. **ç»Ÿä¸€ç¯å¢ƒ**: æ‰€æœ‰å¼€å‘è€…ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„å·¥å…·
2. **å®šæœŸæ›´æ–°**: ä¿æŒpre-commit hooksä¸ºæœ€æ–°ç‰ˆæœ¬
3. **é—®é¢˜åé¦ˆ**: åŠæ—¶æŠ¥å‘Šé…ç½®é—®é¢˜

### æ€§èƒ½è°ƒä¼˜
1. **é€‰æ‹©æ€§æ£€æŸ¥**: åªå¯¹ç›¸å…³æ–‡ä»¶è¿è¡Œæ£€æŸ¥
2. **ç¼“å­˜åˆ©ç”¨**: å……åˆ†åˆ©ç”¨pre-commitç¼“å­˜
3. **å®šæœŸæ¸…ç†**: æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜æ–‡ä»¶

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

âœ… **å®‰è£…æˆåŠŸ**: `pre-commit --version`æ­£å¸¸è¿è¡Œ
âœ… **æ£€æŸ¥ç”Ÿæ•ˆ**: æäº¤æ—¶è‡ªåŠ¨è§¦å‘æ£€æŸ¥
âœ… **é—®é¢˜å‘ç°**: èƒ½åŠæ—¶å‘ç°ä»£ç è´¨é‡é—®é¢˜
âœ… **å›¢é˜Ÿç»Ÿä¸€**: æ‰€æœ‰æˆå‘˜ä½¿ç”¨ç›¸åŒæ ‡å‡†
âœ… **æ€§èƒ½æ»¡æ„**: æ£€æŸ¥è€—æ—¶ä¸è¶…è¿‡30ç§’

---

**ğŸ‰ é›†æˆå®Œæˆåï¼Œä½ çš„å¼€å‘ç¯å¢ƒå°†å…·å¤‡ä¼ä¸šçº§çš„ä»£ç è´¨é‡ä¿éšœï¼**