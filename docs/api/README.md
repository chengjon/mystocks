# MyStocks API æ–‡æ¡£ä¸­å¿ƒ

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸš€ å¿«é€Ÿå¼€å§‹
- **[Apifox å¿«é€Ÿå¼€å§‹](APIFOX_QUICK_START.md)** - 5åˆ†é’Ÿä¸Šæ‰‹ Apifox
- **[API ä½¿ç”¨æŒ‡å—](API_GUIDE.md)** - å®Œæ•´çš„ API ä½¿ç”¨æ•™ç¨‹
- **[Swagger UI æŒ‡å—](SWAGGER_UI_GUIDE.md)** - æœ¬åœ° Swagger UI ä½¿ç”¨

### ğŸ“‹ å¯¼å…¥æŒ‡å—
- **[Apifox å¯¼å…¥æŒ‡å—](APIFOX_IMPORT_GUIDE.md)** - å®Œæ•´çš„å¯¼å…¥æ“ä½œæ‰‹å†Œ
- **[å¯¼å…¥æˆåŠŸæŠ¥å‘Š](APIFOX_IMPORT_SUCCESS.md)** - æœ€è¿‘ä¸€æ¬¡å¯¼å…¥ç»“æœ

### ğŸ“– API å‚è€ƒ
- **[OpenAPI è§„èŒƒ (JSON)](openapi.json)** - OpenAPI 3.1.0 æ ¼å¼
- **[OpenAPI è§„èŒƒ (YAML)](openapi.yaml)** - YAML æ ¼å¼
- **[API å‰ç«¯æ˜ å°„](API_FRONTEND_MAPPING.md)** - å‰ç«¯ç»„ä»¶ä¸APIçš„å¯¹åº”å…³ç³»

### ğŸ—‚ï¸ ä»»åŠ¡å®Œæˆæ€»ç»“

#### ä»»åŠ¡ 15: å‘Šè­¦å‡çº§æœºåˆ¶ (Task 15 - Alert Escalation Mechanism) âœ… COMPLETE
- **[ä»»åŠ¡15å®Œæˆæ€»ç»“](TASK_15_COMPLETION_SUMMARY.md)** - å¤šçº§å‘Šè­¦å‡çº§å’Œç®¡ç†ç³»ç»Ÿçš„å®Œæ•´æŠ¥å‘Š
  - 4ä¸ªæ ¸å¿ƒæ¨¡å—å®Œæ•´å®ç°
  - 13+ REST API åˆ†æç«¯ç‚¹
  - 1,100+ è¡Œç”Ÿäº§ä»£ç ï¼Œ2,300+ è¡Œæ–‡æ¡£
  - ä¼ä¸šçº§å‘Šè­¦è·¯ç”±ã€èšåˆå’Œé€šçŸ¥ç³»ç»Ÿ

- **[15.1 å¤šçº§å‘Šè­¦è§„åˆ™è®¾è®¡](TASK_15_ALERT_ESCALATION_DESIGN.md)** - ä¸‰å±‚å‘Šè­¦ä½“ç³»ä¸å‡çº§é€»è¾‘
  - L1 Critical (ä¸¥é‡)ã€L2 Warning (è­¦å‘Š)ã€L3 Info (ä¿¡æ¯) å‘Šè­¦åˆ†ç±»
  - è‡ªåŠ¨å‡çº§è§„åˆ™å’Œæ—¶é—´é˜ˆå€¼
  - 40+ å‘Šè­¦å®Œæ•´æ˜ å°„è¡¨
  - æ ¹å› åˆ†ææç¤ºå’Œè·¯ç”±çŸ©é˜µ

- **[15.2 å‘Šè­¦èšåˆå’ŒæŠ‘åˆ¶](TASK_15_ALERT_AGGREGATION_SUPPRESSION.md)** - å‘Šè­¦èšåˆå¼•æ“
  - æ—¶é—´çª—å£èšåˆ (0s/30s/60s)
  - åŸºäºæ ‡ç­¾çš„åˆ†ç»„å’Œå…³è”åˆ†ç»„
  - çˆ¶å­æŠ‘åˆ¶è§„åˆ™ (æ ¹å› æŠ‘åˆ¶ç—‡çŠ¶)
  - AlertManager å®Œæ•´é…ç½®ç¤ºä¾‹

- **[15.3 å‘Šè­¦é€šçŸ¥ç³»ç»Ÿ](TASK_15_ALERT_NOTIFICATION_SYSTEM.md)** - å¤šæ¸ é“é€šçŸ¥å®ç°
  - Email (SMTP)ã€Slackã€SMS (Twilio)ã€Webhooksã€PagerDuty
  - å¼‚æ­¥å¹¶å‘æŠ•é€’å’ŒæŒ‡æ•°é€€é¿é‡è¯•
  - SQLite é€šçŸ¥å†å²æ•°æ®åº“
  - å®Œæ•´çš„é›†æˆç¤ºä¾‹å’Œæµ‹è¯•å·¥å…·

- **[15.4 å‘Šè­¦å†å²å’Œç»Ÿè®¡](TASK_15_ALERT_HISTORY_ANALYTICS.md)** - å‘Šè­¦åˆ†ææ•°æ®åº“å±‚
  - å®Œæ•´çš„å‘Šè­¦ç”Ÿå‘½å‘¨æœŸè¿½è¸ª
  - 13+ REST API åˆ†æç«¯ç‚¹
  - æœåŠ¡å¥åº·è¯„åˆ† (0-100)
  - å‘Šè­¦ç›¸å…³æ€§æ£€æµ‹å’Œè¶‹åŠ¿åˆ†æ

#### ä»»åŠ¡ 13: ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ (Task 13 - Monitoring & Alerting)
- **[ä»»åŠ¡13å®Œæˆæ€»ç»“](TASK_13_COMPLETION_SUMMARY.md)** - ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿå®ç°çš„å®ŒæˆæŠ¥å‘Š
  - 40+ è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡å®šä¹‰
  - Prometheus Exporter å®Œæ•´å®ç°
  - Grafana ä»ªè¡¨æ¿ï¼ˆ18 ä¸ªé¢æ¿ï¼‰
  - 40+ å‘Šè­¦è§„åˆ™é…ç½®

#### ä»»åŠ¡ 12: å¥‘çº¦æµ‹è¯•æ¡†æ¶ (Task 12 - Contract Testing)
- **[ä»»åŠ¡12å®Œæˆæ€»ç»“](TASK_12_COMPLETION_SUMMARY.md)** - å¥‘çº¦æµ‹è¯•æ¡†æ¶å®ç°çš„å®ŒæˆæŠ¥å‘Š
  - 5ä¸ªæ ¸å¿ƒæ¨¡å—å®ç°
  - 29ä¸ªå•å…ƒæµ‹è¯•ï¼ˆ100%é€šè¿‡ï¼‰
  - GitHub Actions CI/CDé›†æˆ
  - å®Œæ•´çš„APIå‚è€ƒå’Œæ¡†æ¶æŒ‡å—

#### ä»»åŠ¡ 11: æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– (Task 11 - Database Optimization)
- **[ä»»åŠ¡11å®Œæˆæ€»ç»“](TASK_11_COMPLETION_SUMMARY.md)** - æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–ä»»åŠ¡çš„å®ŒæˆæŠ¥å‘Š
  - æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–ç­–ç•¥å’Œæ€§èƒ½åŸºå‡†: [DATABASE_INDEX_OPTIMIZATION_REPORT.md](DATABASE_INDEX_OPTIMIZATION_REPORT.md)
  - å®ç°ç´¢å¼•å¯¼èˆª: [IMPLEMENTATION_INDEX.md](IMPLEMENTATION_INDEX.md)

### ğŸ§ª å¥‘çº¦æµ‹è¯•æ¡†æ¶
- **[å¥‘çº¦æµ‹è¯• API å‚è€ƒ](CONTRACT_TESTING_API.md)** - å®Œæ•´çš„ API æ–‡æ¡£å’Œ SDK ä½¿ç”¨æŒ‡å—
- **[å¥‘çº¦æµ‹è¯•æ¡†æ¶æŒ‡å—](../guides/CONTRACT_TESTING_GUIDE.md)** - æ¡†æ¶ä½¿ç”¨æ•™ç¨‹å’Œæœ€ä½³å®è·µ

### ğŸ“Š ç›‘æ§ä¸å‘Šè­¦ (Task 13)
- **[ç›‘æ§æŒ‡æ ‡å®šä¹‰](MONITORING_METRICS_DEFINITION.md)** - 40+ è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡çš„å®Œæ•´è§„èŒƒ
  - ä¸šåŠ¡æŒ‡æ ‡ (å¸‚åœºæ•°æ®ã€ç”¨æˆ·è¡Œä¸ºã€äº¤æ˜“)
  - æŠ€æœ¯æŒ‡æ ‡ (APIã€WebSocketã€ç¼“å­˜ã€æ•°æ®åº“)
  - å‘Šè­¦æŒ‡æ ‡ (ç³»ç»Ÿå¥åº·ã€ä¾èµ–å¯ç”¨æ€§)
- **[å‘Šè­¦è§„åˆ™é…ç½®æŒ‡å—](ALERTING_CONFIGURATION_GUIDE.md)** - å‘Šè­¦è§„åˆ™ã€é€šçŸ¥æ¸ é“å’Œå“åº”æµç¨‹
  - 40+ å‘Šè­¦è§„åˆ™è·¨ 9 ä¸ªç±»åˆ«
  - Slack/PagerDuty/Email å¤šæ¸ é“é€šçŸ¥
  - å‘Šè­¦è·¯ç”±å’ŒæŠ‘åˆ¶è§„åˆ™
  - å“åº”å·¥ä½œæµå’Œ SLA

### ğŸ”Œ Prometheus & Grafana é›†æˆ
- **Prometheus é…ç½®**: `config/prometheus.yml` - 15 ä¸ªé‡‡é›†ä»»åŠ¡é…ç½®
- **Grafana ä»ªè¡¨æ¿**: `grafana_dashboard.json` - 18 ä¸ªç›‘æ§é¢æ¿
- **AlertManager é…ç½®**: `config/alertmanager.yml` - å¤šæ¸ é“å‘Šè­¦è·¯ç”±
- **å‘Šè­¦è§„åˆ™**: `config/alerts/mystocks-alerts.yml` - 40+ å‘Šè­¦è§„åˆ™

---

## ğŸŒ åœ¨çº¿è®¿é—®

### Apifox é¡¹ç›®
**é¡¹ç›®åœ°å€**: https://app.apifox.com/project/7376246

**å¯¼å…¥çŠ¶æ€**:
- âœ… 218 ä¸ª API ç«¯ç‚¹
- âœ… 96 ä¸ªæ•°æ®æ¨¡å‹
- âœ… 25 ä¸ªæ¥å£ç›®å½•
- âœ… 0 ä¸ªé”™è¯¯

### æœ¬åœ° Swagger UI
**Swagger UI**: http://localhost:8000/api/docs
**ReDoc**: http://localhost:8000/api/redoc
**OpenAPI JSON**: http://localhost:8000/openapi.json

---

## ğŸ“Š API æ¦‚è§ˆ

### ä¸»è¦åŠŸèƒ½æ¨¡å—

1. **ç³»ç»Ÿç®¡ç†** - å¥åº·æ£€æŸ¥ã€ç³»ç»Ÿä¿¡æ¯ã€Socket.IOçŠ¶æ€
2. **è®¤è¯æˆæƒ** - JWT Token è®¤è¯ã€CSRF ä¿æŠ¤
3. **å¸‚åœºæ•°æ®** - å®æ—¶è¡Œæƒ…ã€Kçº¿ã€èµ„é‡‘æµå‘ã€ç­¹ç åˆ†å¸ƒ
4. **å¸‚åœºæ•°æ® V2** - æ‰¹é‡è¡Œæƒ…ã€æ¿å—åˆ†æã€å¸‚åœºæ¦‚è§ˆ
5. **å¸‚åœºæ•°æ® V3** - è¡Œä¸šèµ„é‡‘æµå‘ï¼ˆç”³ä¸‡ã€è¯ç›‘ä¼šåˆ†ç±»ï¼‰
6. **è‚¡ç¥¨æœç´¢** - æ™ºèƒ½æœç´¢ã€è‚¡ç¥¨è¯¦æƒ…
7. **è‡ªé€‰è‚¡ç®¡ç†** - æ·»åŠ ã€åˆ é™¤ã€æŸ¥è¯¢è‡ªé€‰è‚¡
8. **é—®è´¢æ¥å£** - è‡ªç„¶è¯­è¨€æŸ¥è¯¢
9. **ç¼“å­˜ç®¡ç†** - ç»Ÿè®¡ã€æ¸…ç†ã€é¢„çƒ­
10. **ç­–ç•¥ç®¡ç†** - ç­–ç•¥åˆ›å»ºã€å›æµ‹ã€ç»©æ•ˆ
11. **æŒ‡æ ‡æ•°æ®** - ç³»ç»ŸæŒ‡æ ‡ã€å¸‚åœºæŒ‡æ ‡
12. **é€šçŸ¥ç®¡ç†** - æ¨é€é€šçŸ¥ã€å‘Šè­¦
13. **é€šè¾¾ä¿¡æ¥å£** - TDX æ•°æ®æº
14. **ä»»åŠ¡ç®¡ç†** - å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ
15. **ç›‘æ§ç®¡ç†** - æ€§èƒ½ç›‘æ§ã€å¥åº·æ£€æŸ¥

### API ç»Ÿè®¡

- **æ€»ç«¯ç‚¹æ•°**: 218
- **æ•°æ®æ¨¡å‹**: 96
- **è®¤è¯æ–¹å¼**: JWT Bearer Token + CSRF
- **API ç‰ˆæœ¬**: 2.0.0
- **OpenAPI ç‰ˆæœ¬**: 3.1.0

---

## ğŸ”§ å·¥å…·å’Œè„šæœ¬

### å¯¼å…¥å·¥å…·

**Python è„šæœ¬**: `scripts/runtime/import_to_apifox.py`

```bash
# è¿è¡Œå¯¼å…¥è„šæœ¬
python scripts/runtime/import_to_apifox.py
```

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨å¯¼å…¥ OpenAPI æ–‡æ¡£åˆ° Apifox
- âœ… æ™ºèƒ½åˆå¹¶ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼‰
- âœ… è¯¦ç»†çš„å¯¼å…¥ç»Ÿè®¡
- âœ… é”™è¯¯æ£€æµ‹å’ŒæŠ¥å‘Š

### åŒæ­¥è„šæœ¬

å½“ API æœ‰æ›´æ–°æ—¶ï¼Œä½¿ç”¨åŒæ­¥è„šæœ¬ï¼š

```bash
# æ–¹æ³•1: ä»è¿è¡Œä¸­çš„æœåŠ¡å¯¼å‡º
curl http://localhost:8000/openapi.json > docs/api/openapi.json

# æ–¹æ³•2: é‡æ–°å¯¼å…¥åˆ° Apifox
python scripts/runtime/import_to_apifox.py
```

---

## ğŸ¯ å¸¸ç”¨æ“ä½œ

### æµ‹è¯•å•ä¸ª API

**ä½¿ç”¨ curl**:
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# è·å–å®æ—¶è¡Œæƒ…ï¼ˆéœ€è¦è®¤è¯ï¼‰
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8000/api/market/realtime/000001
```

**ä½¿ç”¨ Apifox**:
1. åœ¨ Apifox ä¸­é€‰æ‹© API
2. å¡«å†™å‚æ•°
3. ç‚¹å‡»å‘é€

### æ‰¹é‡æµ‹è¯•

**åœ¨ Apifox ä¸­**:
1. åˆ›å»ºæµ‹è¯•å¥—ä»¶
2. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
3. è¿è¡Œæµ‹è¯•

### ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç 

**åœ¨ Apifox ä¸­**:
1. é€‰æ‹© API
2. ç‚¹å‡» "ä»£ç ç”Ÿæˆ"
3. é€‰æ‹©è¯­è¨€ï¼ˆPython/JavaScript/Java/Go...ï¼‰
4. å¤åˆ¶ä»£ç 

### å¯¼å‡ºæ–‡æ¡£

**åœ¨ Apifox ä¸­**:
1. ç‚¹å‡»å³ä¸Šè§’ "â‹¯"
2. é€‰æ‹© "å¯¼å‡º"
3. é€‰æ‹©æ ¼å¼ï¼ˆMarkdown/HTML/PDFï¼‰

---

## ğŸ” è®¤è¯æµç¨‹

### æ­¥éª¤1: è·å– CSRF Token

```http
GET /api/auth/csrf-token
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "token": "abc123..."
  }
}
```

### æ­¥éª¤2: ç™»å½•è·å– JWT Token

```http
POST /api/auth/login
Content-Type: application/json
X-CSRF-Token: abc123...

{
  "username": "admin",
  "password": "your_password"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "access_token": "eyJhbGc...",
    "token_type": "bearer",
    "expires_in": 3600
  }
}
```

### æ­¥éª¤3: ä½¿ç”¨ Token è°ƒç”¨ API

```http
GET /api/market/realtime/000001
Authorization: Bearer eyJhbGc...
```

---

## ğŸ“ å¼€å‘å»ºè®®

### 1. ä½¿ç”¨ç¯å¢ƒå˜é‡

åœ¨ Apifox ä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼š

```json
{
  "base_url": "http://localhost:8000",
  "auth_token": "{{auto_generated}}",
  "csrf_token": "{{auto_generated}}"
}
```

### 2. è‡ªåŠ¨åŒ–è®¤è¯

åœ¨ç¯å¢ƒçš„ **å‰ç½®è„šæœ¬** ä¸­æ·»åŠ è‡ªåŠ¨ç™»å½•é€»è¾‘ã€‚

### 3. Mock æ•°æ®å¼€å‘

å‰ç«¯å¼€å‘æ—¶ä½¿ç”¨ Apifox Mock æœåŠ¡ï¼Œæ— éœ€ç­‰å¾…åç«¯å®Œæˆã€‚

### 4. API æ–‡æ¡£åŒæ­¥

API å˜æ›´ååŠæ—¶æ›´æ–° Apifox æ–‡æ¡£ï¼š
```bash
python scripts/runtime/import_to_apifox.py
```

### 5. æŒç»­é›†æˆ

åœ¨ CI/CD ä¸­é›†æˆ API æµ‹è¯•ï¼š
```bash
apifox run --project-id 7376246 --test-suite "æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•"
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: 401 æœªæˆæƒ

**åŸå› **: æœªæä¾›æœ‰æ•ˆçš„ JWT Token

**è§£å†³æ–¹æ¡ˆ**:
1. å…ˆè°ƒç”¨ `/api/auth/login` è·å– token
2. åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `Authorization: Bearer {token}`

### é—®é¢˜2: 403 CSRF éªŒè¯å¤±è´¥

**åŸå› **: æœªæä¾› CSRF Token æˆ– Token æ— æ•ˆ

**è§£å†³æ–¹æ¡ˆ**:
1. è°ƒç”¨ `/api/auth/csrf-token` è·å–æ–° token
2. åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `X-CSRF-Token: {csrf_token}`

### é—®é¢˜3: 404 Not Found

**åŸå› **: API è·¯å¾„é”™è¯¯æˆ–æœåŠ¡æœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API è·¯å¾„æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ: `curl http://localhost:8000/health`

### é—®é¢˜4: 500 æœåŠ¡å™¨é”™è¯¯

**åŸå› **: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
2. éªŒè¯è¯·æ±‚å‚æ•°æ ¼å¼
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº
- **Swagger UI**: http://localhost:8000/api/docs
- **ReDoc**: http://localhost:8000/api/redoc
- **Apifox é¡¹ç›®**: https://app.apifox.com/project/7376246

### Apifox èµ„æº
- **å®˜æ–¹æ–‡æ¡£**: https://apifox.com/help/
- **è§†é¢‘æ•™ç¨‹**: https://apifox.com/help/video/
- **ç¤¾åŒºè®ºå›**: https://community.apifox.com/

### MyStocks é¡¹ç›®
- **GitHub**: [é¡¹ç›®ä»“åº“]
- **æŠ€æœ¯æ ˆ**: FastAPI + TDengine + PostgreSQL
- **æ¶æ„æ–‡æ¡£**: `../../CLAUDE.md`

---

## ğŸ‰ ä¸‹ä¸€æ­¥

1. âœ… **è®¿é—® Apifox é¡¹ç›®**: https://app.apifox.com/project/7376246
2. âœ… **é˜…è¯»å¿«é€Ÿå¼€å§‹**: [APIFOX_QUICK_START.md](APIFOX_QUICK_START.md)
3. âœ… **æµ‹è¯•æ ¸å¿ƒ API**: ä»å¥åº·æ£€æŸ¥å¼€å§‹
4. âœ… **é…ç½®è®¤è¯**: è®¾ç½®è‡ªåŠ¨ç™»å½•è„šæœ¬
5. âœ… **åˆ›å»ºæµ‹è¯•å¥—ä»¶**: è‡ªåŠ¨åŒ–æµ‹è¯•
6. âœ… **ä½¿ç”¨ Mock æœåŠ¡**: åŠ é€Ÿå‰ç«¯å¼€å‘

---

**æœ€åæ›´æ–°**: 2025-11-12
**æ–‡æ¡£ç‰ˆæœ¬**: 2.1.0
**API ç«¯ç‚¹**: 231 (+13 Alert History/Analytics endpoints)
**æ•°æ®æ¨¡å‹**: 96
**å®Œæˆä»»åŠ¡**: Task 13 (Monitoring) âœ… | Task 15 (Alert Escalation) âœ…

_å¼€å§‹æ‚¨çš„ API æ¢ç´¢ä¹‹æ—…ï¼_ ğŸš€
