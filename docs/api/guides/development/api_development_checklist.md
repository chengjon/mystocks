# API端点开发检查清单

## 📋 快速检查清单

### 🔍 开发前检查

#### 需求确认
- [ ] **业务需求明确**
  - [ ] 功能需求文档完整
  - [ ] 用户场景定义清楚
  - [ ] 验收标准确定

#### 技术设计
- [ ] **API设计完成**
  - [ ] 端点URL路径确定
  - [ ] HTTP方法选择合理
  - [ ] 请求/响应模型定义
  - [ ] 错误处理策略制定

#### 数据模型
- [ ] **数据库设计**
  - [ ] 表结构设计完成
  - [ ] 索引设计合理
  - [ ] 数据迁移脚本准备

### 🏗️ 代码实现检查

#### 文件结构
- [ ] **文件命名规范**
  - [ ] 使用小写字母和下划线
  - [ ] 名称体现模块功能
  - [ ] 文件组织合理

#### 导入和依赖
- [ ] **导入规范**
  - [ ] 标准库导入在前
  - [ ] 第三方库导入居中
  - [ ] 本地模块导入在后
  - [ ] 避免循环导入

#### 路由定义
- [ ] **路由器配置**
  - [ ] `APIRouter` 实例创建
  - [ ] `prefix` 统一规范
  - [ ] `tags` 文档标签设置
  - [ ] 错误响应定义

#### 端点实现
- [ ] **函数命名规范**
  - [ ] 使用动词+名词模式
  - [ ] 名称描述功能清楚
  - [ ] 避免缩写和模糊命名

- [ ] **参数定义**
  - [ ] 类型注解完整
  - [ ] 默认值合理
  - [ ] 参数验证充分
  - [ ] 路径参数正确

#### 数据验证
- [ ] **Pydantic模型**
  - [ ] 请求模型定义
  - [ ] 响应模型定义
  - [ ] 字段验证规则
  - [ ] 示例数据提供

#### 错误处理
- [ ] **异常捕获**
  - [ ] 业务异常处理
  - [ ] 系统异常处理
  - [ ] HTTP异常正确抛出
  - [ ] 错误日志记录

#### 安全性
- [ ] **认证检查**
  - [ ] `get_current_user` 依赖注入
  - [ ] 权限验证完整
  - [ ] 用户数据隔离

- [ ] **输入验证**
  - [ ] SQL注入防护
  - [ ] XSS攻击防护
  - [ ] 参数类型验证

### 📊 响应格式检查

#### 成功响应
- [ ] **统一响应格式**
  - [ ] `success: true`
  - [ ] `data` 字段包含实际数据
  - [ ] `message` 描述操作结果
  - [ ] `timestamp` 时间戳

#### 分页响应
- [ ] **分页信息完整**
  - [ ] `page` 当前页码
  - [ ] `size` 每页大小
  - [ ] `total` 总记录数
  - [ ] `pages` 总页数

#### 错误响应
- [ ] **错误信息规范**
  - [ ] `success: false`
  - [ ] `error.code` 错误代码
  - [ ] `error.message` 错误描述
  - [ ] `error.details` 错误详情

#### 状态码
- [ ] **HTTP状态码正确**
  - [ ] 200: 成功获取
  - [ ] 201: 创建成功
  - [ ] 204: 删除成功
  - [ ] 400: 请求错误
  - [ ] 401: 未认证
  - [ ] 403: 无权限
  - [ ] 404: 资源不存在
  - [ ] 500: 服务器错误

### 🧪 测试检查

#### 单元测试
- [ ] **测试文件创建**
  - [ ] 测试类/函数定义
  - ] 测试数据准备
  - ] Mock对象配置

#### 功能测试
- [ ] **基本功能测试**
  - [ ] 正常流程测试
  - [ ] 异常情况测试
  - [ ] 边界条件测试

#### 集成测试
- [ ] **API集成测试**
  - [ ] 端到端流程测试
  - [ ] 数据库集成测试
  - [ ] 第三方服务集成测试

### 📚 文档检查

#### 代码文档
- [ ] **函数文档字符串**
  - [ ] 功能描述清楚
  - [ ] 参数说明完整
  - [ ] 返回值说明
  - [ ] 异常说明

#### API文档
- [ ] **Swagger文档**
  - [ ] 端点描述准确
  - [ ] 参数说明详细
  - [ ] 响应示例完整
  - [ ] 错误示例提供

### 🚀 部署检查

#### 性能
- [ ] **性能指标**
  - [ ] 响应时间 < 2秒
  - ] 数据库查询优化
  - ] 缓存策略合理

#### 监控
- [ ] **日志记录**
  - [ ] 请求日志记录
  - [ ] 错误日志记录
  - [ ] 性能日志记录

---

## 🎯 质量标准

### 代码质量
- **代码覆盖率**: > 80%
- **代码复杂度**: 圈复杂度 < 10
- **代码重复率**: < 5%

### 性能标准
- **API响应时间**: P95 < 2秒
- **数据库查询时间**: < 500ms
- **内存使用**: 合理范围内

### 安全标准
- **认证覆盖率**: 100%
- **输入验证**: 100%
- **权限控制**: 正确实现

---

## ⚠️ 常见问题和解决方案

### 1. 认证问题
**问题**: 返回401未认证错误
**解决**: 检查 `get_current_user` 依赖注入

### 2. 参数验证问题
**问题**: 请求参数验证失败
**解决**: 检查Pydantic模型验证规则

### 3. 数据库问题
**问题**: 数据库查询失败
**解决**: 检查SQL语句和数据库连接

### 4. 性能问题
**问题**: API响应缓慢
**解决**: 检查查询性能和缓存策略

### 5. 错误处理问题
**问题**: 错误信息不友好
**解决**: 统一错误响应格式

---

## 📞 技术支持

### 联系方式
- **技术团队**: dev-team@mystocks.com
- **GitHub Issues**: [创建Issue](https://github.com/mystocks/issues)
- **文档问题**: docs@mystocks.com

### 相关资源
- **开发指南**: `/docs/api/API_DEVELOPMENT_GUIDELINES.md`
- **API文档**: `/api/docs`
- **代码规范**: `.claude/skills/backend-dev-guidelines/`

---

*检查清单会根据项目发展和团队反馈持续更新*
