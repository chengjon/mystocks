# MyStocks 错误码参考

## 错误码概览

| HTTP 状态码 | 业务码 | 说明 | 处理建议 |
|------------|--------|------|----------|
| 200 | 0 | 成功 | 无需处理 |
| 400 | 400 | 请求参数错误 | 检查请求参数 |
| 401 | 401 | 未认证 | 登录后重试 |
| 403 | 403 | 权限不足 | 联系管理员 |
| 404 | 404 | 资源不存在 | 检查资源ID |
| 422 | 422 | 数据验证错误 | 检查字段格式 |
| 429 | 429 | 请求过于频繁 | 稍后重试 |
| 500 | 500 | 服务器内部错误 | 联系技术支持 |
| 503 | 503 | 服务不可用 | 稍后重试 |

---

## 认证模块错误码 (1xxx)

| 业务码 | HTTP | 说明 | 原因 | 解决方案 |
|--------|------|------|------|----------|
| 1001 | 401 | 用户名或密码错误 | 凭据无效 | 检查用户名密码 |
| 1002 | 401 | Token 已过期 | Token 过期 | 刷新 Token |
| 1003 | 401 | Token 无效 | Token 格式错误 | 重新登录 |
| 1004 | 401 | Refresh Token 无效 | Refresh Token 过期 | 重新登录 |
| 1005 | 403 | 用户已禁用 | 账户状态异常 | 联系管理员 |
| 1006 | 400 | 验证码错误 | 验证码不匹配 | 重新获取验证码 |
| 1007 | 400 | 用户名已存在 | 注册时用户名重复 | 使用其他用户名 |
| 1008 | 400 | 邮箱格式错误 | 邮箱格式不正确 | 检查邮箱格式 |
| 1009 | 400 | 密码强度不足 | 密码不符合要求 | 使用更强密码 |

---

## 市场数据模块错误码 (2xxx)

| 业务码 | HTTP | 说明 | 原因 | 解决方案 |
|--------|------|------|------|----------|
| 2001 | 400 | 股票代码无效 | 代码格式错误 | 检查代码格式，如 `000001.SZ` |
| 2002 | 404 | 股票不存在 | 代码不在数据库 | 确认股票代码 |
| 2003 | 400 | 日期范围错误 | 开始日期晚于结束日期 | 调整日期范围 |
| 2004 | 400 | 日期格式错误 | 格式不为 YYYY-MM-DD | 使用正确格式 |
| 2005 | 400 | 周期参数无效 | interval 值不支持 | 使用: daily/weekly/monthly |
| 2006 | 429 | 请求过于频繁 | 超过API调用限制 | 降低请求频率 |
| 2007 | 503 | 数据源不可用 | 第三方服务异常 | 稍后重试 |
| 2008 | 500 | 数据处理错误 | 服务器内部错误 | 联系技术支持 |

---

## 策略模块错误码 (3xxx)

| 业务码 | HTTP | 说明 | 原因 | 解决方案 |
|--------|------|------|------|----------|
| 3001 | 404 | 策略不存在 | ID 无效 | 确认策略ID |
| 3002 | 400 | 参数验证失败 | 参数不符合要求 | 检查参数范围 |
| 3003 | 400 | 策略名称为空 | 缺少必填字段 | 提供策略名称 |
| 3004 | 403 | 无操作权限 | 不是策略所有者 | 确认所有权 |
| 3005 | 400 | 策略类型不存在 | type 值无效 | 使用支持的类型 |
| 3006 | 400 | JSON 格式错误 | parameters 非有效 JSON | 检查 JSON 格式 |

---

## 回测模块错误码 (4xxx)

| 业务码 | HTTP | 说明 | 原因 | 解决方案 |
|--------|------|------|------|----------|
| 4001 | 404 | 回测不存在 | ID 无效 | 确认回测ID |
| 4002 | 400 | 初始资金无效 | 资金 <= 0 | 设置正数资金 |
| 4003 | 400 | 日期范围无效 | 范围超过5年 | 缩短日期范围 |
| 4004 | 409 | 回测已在运行 | 同一策略不能重复运行 | 等待完成或取消 |
| 4005 | 500 | 回测执行失败 | 策略逻辑错误 | 检查策略参数 |
| 4006 | 403 | 无查看权限 | 不是回测所有者 | 确认所有权 |
| 4007 | 400 | 回测结果不存在 | 结果已删除 | 重新运行回测 |

---

## 交易模块错误码 (5xxx)

| 业务码 | HTTP | 说明 | 原因 | 解决方案 |
|--------|------|------|------|----------|
| 5001 | 400 | 订单参数错误 | 参数不符合要求 | 检查参数 |
| 5002 | 400 | 股票代码无效 | 代码格式错误 | 使用正确格式 |
| 5003 | 400 | 订单类型无效 | type 值不支持 | 使用 market/limit/stop |
| 5004 | 400 | 价格无效 | 价格 <= 0 或非数字 | 检查价格 |
| 5005 | 400 | 数量无效 | 数量 <= 0 或非整数 | 检查数量 |
| 5006 | 403 | 余额不足 | 可用资金不足 | 充值或减少数量 |
| 5007 | 403 | 持仓不足 | 平仓数量超过持仓 | 减少平仓数量 |
| 5008 | 404 | 订单不存在 | order_id 无效 | 确认订单ID |
| 5009 | 409 | 订单状态错误 | 订单已成交或已取消 | 不能重复操作 |
| 5010 | 429 | 下单过于频繁 | 超过交易频率限制 | 降低频率 |

---

## 系统错误码 (9xxx)

| 业务码 | HTTP | 说明 | 原因 | 解决方案 |
|--------|------|------|------|----------|
| 9001 | 500 | 数据库连接失败 | 数据库服务异常 | 检查数据库连接 |
| 9002 | 500 | Redis 连接失败 | 缓存服务异常 | 检查 Redis |
| 9003 | 503 | 服务维护中 | 系统维护中 | 等待维护完成 |
| 9004 | 500 | 内部错误 | 未预期的异常 | 联系技术支持 |
| 9005 | 429 | 限流触发 | 超过 API 限制 | 降低请求频率 |
| 9006 | 502 | 网关错误 | 上游服务异常 | 稍后重试 |

---

## 错误响应格式

### 成功响应
```json
{
  "code": 200,
  "data": {
    // 业务数据
  },
  "msg": "success"
}
```

### 错误响应
```json
{
  "code": 1001,
  "msg": "用户名或密码错误",
  "details": {
    "field": "password",
    "reason": "密码错误"
  },
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

### 验证错误响应
```json
{
  "code": 422,
  "msg": "Validation error",
  "details": [
    {
      "field": "username",
      "error": "field required"
    },
    {
      "field": "password",
      "error": "string too short"
    }
  ],
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

---

## 调试技巧

### 1. 获取 Request ID
每个错误响应都包含 `request_id`，用于追踪问题。

### 2. 查看详细日志
```bash
# 根据 request_id 查找日志
grep "550e8400-e29b-41d4-a716-446655440000" /var/log/mystocks/api.log
```

### 3. 开启调试模式
```bash
# 设置环境变量
export MYSTOCKS_DEBUG=true
export MYSTOCKS_LOG_LEVEL=debug
```

### 4. 联系技术支持
提供以下信息：
- Request ID
- 完整的请求 URL
- 请求方法和请求体
- 期望的结果
- 实际操作步骤
