# Phase 5 æ¶æ„æ¼”è¿›é›†æˆç­–ç•¥

**åˆ›å»ºæ—¥æœŸ**: 2025-12-27
**è´Ÿè´£äºº**: Claude (AI 3)
**çŠ¶æ€**: è§„åˆ’é˜¶æ®µ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£å®šä¹‰äº†å°†Phase 5æ¶æ„æ¼”è¿›äº¤ä»˜ç‰©ï¼ˆ62ä¸ªä»»åŠ¡ï¼‰é›†æˆåˆ°ä¸»åˆ†æ”¯çš„å®Œæ•´ç­–ç•¥ã€‚ç»è¿‡è´¨é‡éªŒè¯ï¼Œæ‰€æœ‰äº¤ä»˜ç‰©å‡è¾¾åˆ°ç”Ÿäº§çº§æ ‡å‡†ï¼Œå¯ä»¥å®‰å…¨é›†æˆã€‚

**é›†æˆèŒƒå›´**:
- âœ… æ€§èƒ½ç›‘æ§ä½“ç³» (Prometheus + FastAPIä¸­é—´ä»¶)
- âœ… å¤šçº§ç¼“å­˜æ¶æ„ (L1å†…å­˜ + L2 Redis)
- âœ… å¯è§‚æµ‹æ€§æ ˆ (Prometheus + Grafana + Loki + Tempo)
- âœ… E2Eæµ‹è¯•æ¡†æ¶ (Playwright)
- âœ… CI/CDæµæ°´çº¿
- âœ… SLO/SLAé…ç½®
- âœ… æ–‡æ¡£å’Œéƒ¨ç½²æ¸…å•

**é›†æˆä¼˜å…ˆçº§**: â­â­â­â­â­ (æœ€é«˜)

---

## ğŸ¯ é›†æˆç›®æ ‡

### ä¸»è¦ç›®æ ‡
1. **é›¶ä¸­æ–­é›†æˆ**: å¹³æ»‘è¿‡æ¸¡ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
2. **è´¨é‡ä¿è¯**: æ‰€æœ‰é›†æˆåæµ‹è¯•é€šè¿‡
3. **å¯å›æ»š**: å¿«é€Ÿå›æ»šæœºåˆ¶ï¼Œé™ä½é£é™©
4. **æ¸è¿›å¼éƒ¨ç½²**: åˆ†é˜¶æ®µé›†æˆï¼Œä¾¿äºé—®é¢˜å®šä½

### æˆåŠŸæ ‡å‡†
- [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] Phase 5æ–°åŠŸèƒ½å¯ç”¨ä¸”ç¨³å®š
- [ ] PrometheusæŒ‡æ ‡æ­£å¸¸é‡‡é›†
- [ ] E2Eæµ‹è¯•å¥—ä»¶å…¨éƒ¨é€šè¿‡
- [ ] ç¼“å­˜ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- [ ] æ€§èƒ½æ— å›é€€

---

## ğŸ“Š å½“å‰çŠ¶æ€åˆ†æ

### Gitåˆ†æ”¯çŠ¶æ€

**ä¸»åˆ†æ”¯ (main)**:
- ä½ç½®: `/opt/claude/mystocks_spec`
- æœ€æ–°æäº¤: `06a57f7 feat(phase1): Complete Phase 1 - UI/UX Foundation (80%)`
- çŠ¶æ€: ç¨³å®šï¼ŒåŒ…å«Phase 4æŠ€æœ¯æŒ‡æ ‡åŠŸèƒ½

**Phase 5åˆ†æ”¯ (phase5-planning)**:
- ä½ç½®: `/opt/claude/mystocks_phase5_planning`
- åŸºäºæäº¤: `cd5c02f feat: è®¾ç½®å¤šAIå¹¶è¡Œå¼€å‘ç¯å¢ƒ`
- çŠ¶æ€: åŒ…å«å®Œæ•´çš„Phase 5äº¤ä»˜ç‰©ï¼Œä½†éƒ¨åˆ†æ–‡ä»¶å°šæœªæäº¤

### æœªæäº¤çš„Phase 5æ–‡ä»¶

**æ ¸å¿ƒç»„ä»¶** (æœªè¿½è¸ª - `??`):
```
src/core/cache/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ decorators.py (6299 bytes)
â””â”€â”€ multi_level.py (13885 bytes)

src/core/middleware/
â””â”€â”€ performance.py (6095 bytes)

src/core/logging/
â””â”€â”€ (structured logging modules)

config/monitoring/
â”œâ”€â”€ alerting.yaml
â”œâ”€â”€ dashboards/api-overview.json
â”œâ”€â”€ loki-config.yaml
â”œâ”€â”€ prometheus.yml
â”œâ”€â”€ rules/mystocks-alerts.yml
â”œâ”€â”€ slo-config.yaml
â””â”€â”€ tempo-config.yaml
```

**æµ‹è¯•æ¡†æ¶** (æœªè¿½è¸ª):
```
tests/e2e/
â”œâ”€â”€ conftest.py
â”œâ”€â”€ fixtures/
â”œâ”€â”€ pages/
â”œâ”€â”€ specs/
â””â”€â”€ test_*.py (6+ test files)
```

**æ–‡æ¡£** (æœªè¿½è¸ª):
```
docs/monitoring/
docs/operations/
docs/performance/
docs/testing/
docs/reports/PHASE_5_COMPLETION_REPORT.md
```

**å·²ä¿®æ”¹æ–‡ä»¶** (å·²è¿½è¸ª - `M`):
```
.github/workflows/e2e-tests.yml
playwright.config.ts
tests/e2e/pages/__init__.py
tests/e2e/pages/base_page.py
tests/e2e/pages/login_page.py
tests/performance/benchmark.py
web/backend/app/main.py
```

### æ½œåœ¨å†²çªåˆ†æ

**æ— ç›´æ¥å†²çª**:
- Phase 5æ–°å¢ç›®å½• (`src/core/cache/`, `src/core/middleware/`, `config/monitoring/`) åœ¨ä¸»åˆ†æ”¯ä¸å­˜åœ¨
- Phase 5æ–°å¢æµ‹è¯•æ–‡ä»¶ (`tests/e2e/`) ä¸ä¸»åˆ†æ”¯æµ‹è¯•æ–‡ä»¶ä¸é‡å 

**éœ€æ³¨æ„çš„é›†æˆç‚¹**:
1. **ä¸­é—´ä»¶é›†æˆ** (`web/backend/app/main.py`):
   - éœ€è¦ç¡®ä¿ `PerformanceMiddleware` æ­£ç¡®æ³¨å†Œåˆ°FastAPIåº”ç”¨
   - æ£€æŸ¥ç°æœ‰ä¸­é—´ä»¶é¡ºåºï¼Œé¿å…å†²çª

2. **å¯¼å…¥è·¯å¾„**:
   - Phase 5ä½¿ç”¨ `from src.core.cache import ...`
   - éœ€è¦ç¡®ä¿ä¸»åˆ†æ”¯çš„ `src/` ç›®å½•ç»“æ„å…¼å®¹

3. **é…ç½®æ–‡ä»¶**:
   - `config/monitoring/*.yaml` éœ€è¦ä¸ç¯å¢ƒå˜é‡å¯¹é½
   - æ£€æŸ¥ `.env` æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€é…ç½®

---

## ğŸš€ é›†æˆç­–ç•¥ï¼šäº”é˜¶æ®µæ¸è¿›å¼é›†æˆ

### é˜¶æ®µ 0: å‡†å¤‡é˜¶æ®µ â° é¢„è®¡15åˆ†é’Ÿ

**ç›®æ ‡**: ç¡®ä¿phase5-planningåˆ†æ”¯çŠ¶æ€å®Œæ•´ï¼Œåˆ›å»ºå®‰å…¨å¤‡ä»½

**æ­¥éª¤**:
1. **æäº¤phase5-planningåˆ†æ”¯æ‰€æœ‰æ›´æ”¹**:
   ```bash
   cd /opt/claude/mystocks_phase5_planning
   git add .
   git commit -m "feat(phase5): Complete Phase 5 architecture evolution (62/62 tasks)

   - Performance monitoring middleware (Prometheus + FastAPI)
   - Multi-level cache (L1 memory + L2 Redis)
   - Observability stack (Prometheus + Grafana + Loki + Tempo)
   - E2E testing framework (Playwright)
   - CI/CD integration with quality gates
   - SLO/SLA configuration
   - Complete documentation and deployment manifests

   ğŸ¤– Generated by [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

2. **åˆ›å»ºä¸»åˆ†æ”¯å¤‡ä»½æ ‡ç­¾**:
   ```bash
   cd /opt/claude/mystocks_spec
   git tag -a pre-phase5-integration -m "Pre-Phase 5 integration backup"
   git push origin pre-phase5-integration
   ```

3. **éªŒè¯phase5-planningåˆ†æ”¯å¯è¿è¡Œæµ‹è¯•**:
   ```bash
   cd /opt/claude/mystocks_phase5_planning
   python -m pytest tests/e2e/test_login.py -v --dry-run  # éªŒè¯æµ‹è¯•å¯å‘ç°
   ```

**å®Œæˆæ ‡å‡†**:
- [ ] phase5-planningåˆ†æ”¯æ‰€æœ‰æ–‡ä»¶å·²æäº¤
- [ ] ä¸»åˆ†æ”¯å¤‡ä»½æ ‡ç­¾å·²åˆ›å»ºå¹¶æ¨é€
- [ ] æµ‹è¯•æ¡†æ¶å¯æ­£å¸¸åŠ è½½

---

### é˜¶æ®µ 1: æ–‡æ¡£å’Œé…ç½®æ–‡ä»¶é›†æˆ â° é¢„è®¡30åˆ†é’Ÿ

**é£é™©ç­‰çº§**: ğŸŸ¢ ä½é£é™© (æ— ä»£ç é€»è¾‘å˜æ›´)

**ç›®æ ‡**: é›†æˆæ–‡æ¡£å’Œé…ç½®æ–‡ä»¶ï¼Œå»ºç«‹åŸºç¡€è®¾æ–½

**é›†æˆæ–‡ä»¶æ¸…å•**:

**é…ç½®æ–‡ä»¶** (config/monitoring/):
- âœ… `prometheus.yml` - PrometheusæŠ“å–é…ç½®
- âœ… `slo-config.yaml` - SLOå®šä¹‰
- âœ… `alerting.yaml` - å‘Šè­¦è§„åˆ™
- âœ… `loki-config.yaml` - æ—¥å¿—èšåˆé…ç½®
- âœ… `tempo-config.yaml` - åˆ†å¸ƒå¼è¿½è¸ªé…ç½®
- âœ… `dashboards/api-overview.json` - Grafanaä»ªè¡¨æ¿

**æ–‡æ¡£æ–‡ä»¶**:
- âœ… `docs/monitoring/` - ç›‘æ§ä½¿ç”¨æŒ‡å—
- âœ… `docs/operations/` - è¿ç»´æ‰‹å†Œ
- âœ… `docs/performance/` - æ€§èƒ½åŸºå‡†æ–‡æ¡£
- âœ… `docs/testing/` - E2Eæµ‹è¯•æŒ‡å—
- âœ… `docs/reports/PHASE_5_COMPLETION_REPORT.md` - Phase 5å®ŒæˆæŠ¥å‘Š

**OpenSpecå˜æ›´ææ¡ˆ**:
- âœ… `openspec/changes/phase5-architecture-evolution/` - å®Œæ•´çš„å˜æ›´ææ¡ˆ

**é›†æˆæ­¥éª¤**:

1. **å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°ä¸»åˆ†æ”¯**:
   ```bash
   cd /opt/claude/mystocks_spec
   rsync -av ../mystocks_phase5_planning/config/monitoring/ config/
   git add config/monitoring/
   ```

2. **å¤åˆ¶æ–‡æ¡£æ–‡ä»¶**:
   ```bash
   rsync -av ../mystocks_phase5_planning/docs/{monitoring,operations,performance,testing}/ docs/
   git add docs/monitoring/ docs/operations/ docs/performance/ docs/testing/
   ```

3. **å¤åˆ¶OpenSpecææ¡ˆ**:
   ```bash
   rsync -av ../mystocks_phase5_planning/openspec/changes/phase5-architecture-evolution/ openspec/changes/
   git add openspec/changes/phase5-architecture-evolution/
   ```

4. **æäº¤é˜¶æ®µ1æ›´æ”¹**:
   ```bash
   git commit -m "feat(phase5): Integrate configuration and documentation (Phase 1/5)

   - Add Prometheus/Loki/Tempo monitoring configurations
   - Add Grafana dashboards and SLO definitions
   - Add operations and testing documentation
   - Add Phase 5 architecture evolution change proposal

   ğŸ¤– Generated by [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

**éªŒè¯æµ‹è¯•**:
- [ ] é…ç½®æ–‡ä»¶YAMLæ ¼å¼æ­£ç¡®
- [ ] æ–‡æ¡£é“¾æ¥æœ‰æ•ˆ
- [ ] OpenSpecææ¡ˆæ–‡ä»¶å®Œæ•´

**å›æ»šè®¡åˆ’**:
```bash
git reset --hard HEAD~1  # å›é€€æœ€åä¸€æ¬¡æäº¤
```

---

### é˜¶æ®µ 2: E2Eæµ‹è¯•æ¡†æ¶é›†æˆ â° é¢„è®¡45åˆ†é’Ÿ

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­é£é™© (æµ‹è¯•ä»£ç ï¼Œä¸å½±å“ç”Ÿäº§åŠŸèƒ½)

**ç›®æ ‡**: é›†æˆPlaywright E2Eæµ‹è¯•æ¡†æ¶ï¼Œæ‰©å±•æµ‹è¯•è¦†ç›–

**é›†æˆæ–‡ä»¶æ¸…å•**:

**æµ‹è¯•æ¡†æ¶** (tests/e2e/):
- âœ… `conftest.py` - pytesté…ç½®å’Œfixtures
- âœ… `fixtures/` - æµ‹è¯•æ•°æ®å·¥å‚
- âœ… `pages/` - é¡µé¢å¯¹è±¡æ¨¡å‹
- âœ… `test_login.py` - ç™»å½•æµ‹è¯•
- âœ… `test_market.py` - é€‰è‚¡é¡µé¢æµ‹è¯•
- âœ… `test_fund_flow.py` - èµ„é‡‘æµå‘æµ‹è¯•
- âœ… `test_risk.py` - é£æ§è§„åˆ™æµ‹è¯•
- âœ… `test_charts.py` - å›¾è¡¨æ¸²æŸ“æµ‹è¯•
- âœ… `test_export.py` - æ•°æ®å¯¼å‡ºæµ‹è¯•

**CI/CDå·¥ä½œæµ**:
- âœ… `.github/workflows/e2e-tests.yml` - E2Eæµ‹è¯•è‡ªåŠ¨åŒ–

**é›†æˆæ­¥éª¤**:

1. **å¤åˆ¶E2Eæµ‹è¯•æ–‡ä»¶**:
   ```bash
   cd /opt/claude/mystocks_spec
   rsync -av --exclude='__pycache__' --exclude='*.pyc' \
     ../mystocks_phase5_planning/tests/e2e/ tests/
   git add tests/e2e/
   ```

2. **æ›´æ–°E2Eæµ‹è¯•é…ç½®**:
   ```bash
   # æ£€æŸ¥å¹¶åˆå¹¶é…ç½®å·®å¼‚
   diff ../mystocks_phase5_planning/playwright.config.ts playwright.config.ts
   # å¦‚æœå­˜åœ¨å·®å¼‚ï¼Œæ‰‹åŠ¨åˆå¹¶
   git add playwright.config.ts
   ```

3. **æ›´æ–°CI/CDå·¥ä½œæµ**:
   ```bash
   # åˆå¹¶e2e-tests.ymlå·¥ä½œæµ
   git checkout --theirs .github/workflows/e2e-tests.yml
   git add .github/workflows/e2e-tests.yml
   ```

4. **å®‰è£…E2Eæµ‹è¯•ä¾èµ–**:
   ```bash
   pip install pytest-playwright playwright
   playwright install --with-deps chromium
   ```

5. **æäº¤é˜¶æ®µ2æ›´æ”¹**:
   ```bash
   git commit -m "feat(phase5): Integrate E2E testing framework (Phase 2/5)

   - Add Playwright E2E test suite (12 scenarios)
   - Add page object model for maintainability
   - Add test fixtures and data factories
   - Update CI/CD workflow for automated E2E testing
   - Add quality gates and test reporting

   ğŸ¤– Generated by [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

**éªŒè¯æµ‹è¯•**:
- [ ] è¿è¡Œ `pytest tests/e2e/test_login.py -v` éªŒè¯ç™»å½•æµ‹è¯•
- [ ] æ£€æŸ¥CI/CDå·¥ä½œæµè¯­æ³•æ­£ç¡®
- [ ] éªŒè¯Playwrightæµè§ˆå™¨å·²å®‰è£…

**å›æ»šè®¡åˆ’**:
```bash
git reset --hard HEAD~1  # å›é€€æœ€åä¸€æ¬¡æäº¤
pip uninstall -y pytest-playwright playwright
```

---

### é˜¶æ®µ 3: æ€§èƒ½ç›‘æ§å’Œå¯è§‚æµ‹æ€§é›†æˆ â° é¢„è®¡60åˆ†é’Ÿ

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­é£é™© (æ–°å¢ä»£ç è·¯å¾„ï¼Œéœ€è¦ä»”ç»†é›†æˆ)

**ç›®æ ‡**: é›†æˆPrometheusæ€§èƒ½ç›‘æ§å’Œç»“æ„åŒ–æ—¥å¿—

**é›†æˆæ–‡ä»¶æ¸…å•**:

**æ ¸å¿ƒç»„ä»¶** (src/core/):
- âœ… `src/core/middleware/performance.py` - Prometheusä¸­é—´ä»¶
- âœ… `src/core/logging/structured.py` - ç»“æ„åŒ–æ—¥å¿—
- âœ… `src/core/logging/tracing.py` - åˆ†å¸ƒå¼è¿½è¸ª

**æ•°æ®åº“ç›‘æ§**:
- âœ… `src/core/database_metrics.py` - æ•°æ®åº“æŒ‡æ ‡

**é›†æˆæ­¥éª¤**:

1. **å¤åˆ¶æ ¸å¿ƒç›‘æ§ç»„ä»¶**:
   ```bash
   cd /opt/claude/mystocks_spec
   rsync -av --exclude='__pycache__' --exclude='*.pyc' \
     ../mystocks_phase5_planning/src/core/ src/
   git add src/core/middleware/ src/core/logging/ src/core/database_metrics.py
   ```

2. **é›†æˆæ€§èƒ½ä¸­é—´ä»¶åˆ°FastAPIåº”ç”¨**:

   **æ£€æŸ¥** `web/backend/app/main.py`:
   ```python
   # ç¡®è®¤ä»¥ä¸‹å¯¼å…¥å’Œä¸­é—´ä»¶æ³¨å†Œå­˜åœ¨:
   from src.core.middleware.performance import PerformanceMiddleware

   app = FastAPI()
   app.add_middleware(PerformanceMiddleware)  # æ·»åŠ æ­¤è¡Œ
   ```

   **å¦‚æœä¸å­˜åœ¨ï¼Œæ‰‹åŠ¨æ·»åŠ **:
   ```python
   from fastapi import FastAPI
   from src.core.middleware.performance import PerformanceMiddleware

   app = FastAPI()
   app.add_middleware(PerformanceMiddleware)
   ```

3. **éªŒè¯/metricsç«¯ç‚¹**:
   ```bash
   # å¯åŠ¨åº”ç”¨
   cd web/backend
   python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 &
   sleep 5

   # éªŒè¯/metricsç«¯ç‚¹å¯è®¿é—®
   curl http://localhost:8000/metrics | grep http_request_duration_seconds

   # å¦‚æœæˆåŠŸï¼Œåº”è¯¥çœ‹åˆ°PrometheusæŒ‡æ ‡
   ```

4. **æäº¤é˜¶æ®µ3æ›´æ”¹**:
   ```bash
   git add src/core/ web/backend/app/main.py
   git commit -m "feat(phase5): Integrate performance monitoring and observability (Phase 3/5)

   - Add Prometheus metrics middleware for request tracking
   - Add structured logging with trace_id injection
   - Add database connection and query metrics
   - Expose /metrics endpoint for Prometheus scraping
   - Integrate middleware into FastAPI application

   ğŸ¤– Generated by [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

**éªŒè¯æµ‹è¯•**:
- [ ] `/metrics`ç«¯ç‚¹è¿”å›Prometheusæ ¼å¼æŒ‡æ ‡
- [ ] è¯·æ±‚å»¶è¿ŸHistogramæŒ‡æ ‡æ­£å¸¸é‡‡é›†
- [ ] ç»“æ„åŒ–æ—¥å¿—JSONæ ¼å¼æ­£ç¡®
- [ ] ç°æœ‰APIåŠŸèƒ½ä¸å—å½±å“

**å›æ»šè®¡åˆ’**:
```bash
git reset --hard HEAD~1
# æ‰‹åŠ¨ç§»é™¤web/backend/app/main.pyä¸­çš„ä¸­é—´ä»¶æ³¨å†Œ
systemctl restart backend  # é‡å¯åç«¯æœåŠ¡
```

---

### é˜¶æ®µ 4: ç¼“å­˜æ¶æ„é›†æˆ â° é¢„è®¡90åˆ†é’Ÿ

**é£é™©ç­‰çº§**: ğŸŸ  é«˜é£é™© (ä¿®æ”¹æ•°æ®è®¿é—®è·¯å¾„ï¼Œéœ€è¦å…¨é¢æµ‹è¯•)

**ç›®æ ‡**: é›†æˆå¤šçº§ç¼“å­˜ç³»ç»Ÿï¼ˆL1å†…å­˜ + L2 Redisï¼‰

**å‰ç½®æ¡ä»¶**:
- [ ] RedisæœåŠ¡å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] `.env` å·²é…ç½®Redisè¿æ¥å‚æ•°

**é›†æˆæ–‡ä»¶æ¸…å•**:

**ç¼“å­˜ç»„ä»¶** (src/core/cache/):
- âœ… `src/core/cache/multi_level.py` - å¤šçº§ç¼“å­˜ç®¡ç†å™¨
- âœ… `src/core/cache/decorators.py` - ç¼“å­˜è£…é¥°å™¨

**é›†æˆæ­¥éª¤**:

1. **éªŒè¯Redisç¯å¢ƒ**:
   ```bash
   # æ£€æŸ¥Redisæ˜¯å¦è¿è¡Œ
   docker ps | grep redis
   # æˆ–
   redis-cli ping
   ```

2. **æ·»åŠ Redisç¯å¢ƒå˜é‡åˆ°.env**:
   ```bash
   # æ£€æŸ¥.envæ˜¯å¦åŒ…å«ä»¥ä¸‹é…ç½®
   grep REDIS_HOST .env
   grep REDIS_PORT .env
   grep REDIS_DB .env

   # å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ :
   echo "REDIS_HOST=localhost" >> .env
   echo "REDIS_PORT=6379" >> .env
   echo "REDIS_DB=0" >> .env
   echo "REDIS_PASSWORD=" >> .env
   ```

3. **å¤åˆ¶ç¼“å­˜ç»„ä»¶**:
   ```bash
   cd /opt/claude/mystocks_spec
   rsync -av --exclude='__pycache__' --exclude='*.pyc' \
     ../mystocks_phase5_planning/src/core/cache/ src/core/
   git add src/core/cache/
   ```

4. **é›†æˆç¼“å­˜åˆ°æ•°æ®è®¿é—®å±‚** (æŒ‰éœ€):

   **æ³¨æ„**: ç¼“å­˜è£…é¥°å™¨å·²ç»å®ç°ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç ã€‚åªéœ€åœ¨ä½¿ç”¨æ—¶å¯¼å…¥:
   ```python
   from src.core.cache.decorators import cached_result

   # ç¤ºä¾‹:åœ¨APIç«¯ç‚¹ä½¿ç”¨
   @cached_result(ttl=60)
   async def get_market_data(symbol: str):
       # æ•°æ®è·å–é€»è¾‘
       pass
   ```

5. **å®‰è£…ç¼“å­˜ä¾èµ–**:
   ```bash
   pip install redis aioredis
   ```

6. **æäº¤é˜¶æ®µ4æ›´æ”¹**:
   ```bash
   git add src/core/cache/ requirements.txt
   git commit -m "feat(phase5): Integrate multi-level cache architecture (Phase 4/5)

   - Add L1 memory cache with LRU eviction
   - Add L2 Redis cache with circuit breaker
   - Add cache decorators for easy integration
   - Implement cache-aside pattern with Prometheus metrics
   - Add cache hit/miss/eviction tracking

   ğŸ¤– Generated by [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

**éªŒè¯æµ‹è¯•**:
- [ ] Redisè¿æ¥æˆåŠŸ
- [ ] L1å†…å­˜ç¼“å­˜æ­£å¸¸å·¥ä½œ
- [ ] L2 Redisç¼“å­˜æ­£å¸¸å·¥ä½œ
- [ ] ç¼“å­˜æŒ‡æ ‡ï¼ˆhits/misses/evictionsï¼‰æ­£å¸¸é‡‡é›†
- [ ] ç†”æ–­å™¨æœºåˆ¶æ­£å¸¸è§¦å‘

**å›æ»šè®¡åˆ’**:
```bash
git reset --hard HEAD~1
pip uninstall -y redis aioredis
# Redisæ•°æ®ä¿ç•™ï¼Œä¸å½±å“åŠŸèƒ½
```

---

### é˜¶æ®µ 5: æ•°æ®åº“ä¼˜åŒ–å’Œæœ€ç»ˆéªŒè¯ â° é¢„è®¡60åˆ†é’Ÿ

**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­é£é™© (ä¼˜åŒ–è„šæœ¬ï¼Œéœ€è¦å¤‡ä»½)

**ç›®æ ‡**: é›†æˆæ•°æ®åº“ä¼˜åŒ–è„šæœ¬å’Œæœ€ç»ˆéªŒè¯

**é›†æˆæ–‡ä»¶æ¸…å•**:

**æ•°æ®åº“ä¼˜åŒ–**:
- âœ… `scripts/database/optimize_queries.py` - æ…¢æŸ¥è¯¢ä¼˜åŒ–
- âœ… `scripts/database/postgres_indexes.sql` - PostgreSQLç´¢å¼•
- âœ… `scripts/database/tdengine_indexes.sql` - TDengineç´¢å¼•

**éƒ¨ç½²æ¸…å•**:
- âœ… `deployments/k8s-deployment.yaml` - Kuberneteséƒ¨ç½²é…ç½®

**é›†æˆæ­¥éª¤**:

1. **å¤åˆ¶æ•°æ®åº“ä¼˜åŒ–è„šæœ¬**:
   ```bash
   cd /opt/claude/mystocks_spec
   rsync -av ../mystocks_phase5_planning/scripts/database/ scripts/
   git add scripts/database/
   ```

2. **å¤åˆ¶éƒ¨ç½²æ¸…å•**:
   ```bash
   rsync -av ../mystocks_phase5_planning/deployments/ .
   git add deployments/
   ```

3. **è¿è¡Œæ•°æ®åº“ç´¢å¼•ä¼˜åŒ–** (è°¨æ…æ“ä½œ):
   ```bash
   # å¤‡ä»½æ•°æ®åº“
   pg_dump -h localhost -U postgres -d mystocks > backup_before_phase5.sql

   # åº”ç”¨PostgreSQLç´¢å¼•
   psql -h localhost -U postgres -d mystocks -f scripts/database/postgres_indexes.sql

   # åº”ç”¨TDengineç´¢å¼•
   python scripts/database/optimize_queries.py
   ```

4. **æäº¤é˜¶æ®µ5æ›´æ”¹**:
   ```bash
   git add scripts/database/ deployments/
   git commit -m "feat(phase5): Integrate database optimization and deployment manifests (Phase 5/5)

   - Add database index optimization scripts
   - Add PostgreSQL and TDengine index definitions
   - Add Kubernetes deployment manifests
   - Add database performance analysis tools
   - Complete Phase 5 architecture evolution integration

   ğŸ¤– Generated by [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"
   ```

5. **åˆ›å»ºPhase 5å®Œæˆæ ‡ç­¾**:
   ```bash
   git tag -a phase5-complete -m "Phase 5 Architecture Evolution Complete"
   git push origin phase5-complete
   ```

**éªŒè¯æµ‹è¯•**:
- [ ] æ‰€æœ‰æ•°æ®åº“ç´¢å¼•åˆ›å»ºæˆåŠŸ
- [ ] æ…¢æŸ¥è¯¢ä¼˜åŒ–è„šæœ¬è¿è¡Œæ— é”™è¯¯
- [ ] Kuberneteséƒ¨ç½²é…ç½®æœ‰æ•ˆ
- [ ] å®Œæ•´ç³»ç»Ÿæµ‹è¯•é€šè¿‡

**å›æ»šè®¡åˆ’**:
```bash
git reset --hard phase5-complete^1  # å›é€€åˆ°Phase 5ä¹‹å‰æ ‡ç­¾
psql -h localhost -U postgres -d mystocks -f backup_before_phase5.sql  # æ¢å¤æ•°æ®åº“
```

---

## ğŸ§ª å®Œæ•´ç³»ç»Ÿæµ‹è¯•è®¡åˆ’

é›†æˆå®Œæˆåï¼Œè¿è¡Œå®Œæ•´çš„ç³»ç»Ÿæµ‹è¯•éªŒè¯ï¼š

### 1. æ€§èƒ½ç›‘æ§éªŒè¯
```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd web/backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 &

# éªŒè¯/metricsç«¯ç‚¹
curl http://localhost:8000/metrics | grep http_request_duration_seconds

# å‘é€æµ‹è¯•è¯·æ±‚
curl http://localhost:8000/api/health

# éªŒè¯æŒ‡æ ‡æ›´æ–°
curl http://localhost:8000/metrics | grep http_requests_total
```

### 2. ç¼“å­˜ç³»ç»ŸéªŒè¯
```python
# æµ‹è¯•ç¼“å­˜åŠŸèƒ½
python -c "
from src.core.cache.multi_level import MultiLevelCache
cache = MultiLevelCache()

# æµ‹è¯•å†™å…¥
cache.set('test_key', {'data': 'test_value'}, ttl=60)

# æµ‹è¯•è¯»å–
result = cache.get('test_key')
print(f'Cache hit: {result}')

# æµ‹è¯•åˆ é™¤
cache.delete('test_key')
print('Cache test passed!')
"
```

### 3. E2Eæµ‹è¯•éªŒè¯
```bash
# è¿è¡Œå®Œæ•´E2Eæµ‹è¯•å¥—ä»¶
pytest tests/e2e/ -v --html=test-results/e2e-report.html

# æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡
pytest tests/e2e/ --cov=web/backend --cov-report=html
```

### 4. æ€§èƒ½åŸºå‡†éªŒè¯
```bash
# è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•
python scripts/performance/benchmark.py

# éªŒè¯P95å»¶è¿Ÿ < 300ms
curl -w "@-" -o /dev/null -s "http://localhost:8000/api/market/data?symbol=000001" \
  -w "P95 latency: %{time_total}s\n"
```

### 5. å¯è§‚æµ‹æ€§æ ˆéªŒè¯
```bash
# å¯åŠ¨Prometheus (Docker)
docker-compose -f docker/prometheus.yml up -d

# éªŒè¯PrometheusæŠ“å–
curl http://localhost:9090/-/healthy

# éªŒè¯Grafanaä»ªè¡¨æ¿
curl http://localhost:3000/api/health

# éªŒè¯æ—¥å¿—èšåˆ
curl http://localhost:3100/ready
```

---

## ğŸš¨ é£é™©è¯„ä¼°ä¸ç¼“è§£ç­–ç•¥

### é«˜é£é™©é¡¹

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£ç­–ç•¥ |
|------|------|------|----------|
| ä¸­é—´ä»¶é›†æˆå¯¼è‡´APIå¤±è´¥ | é«˜ | ä¸­ | é˜¶æ®µæ€§é›†æˆï¼Œæ¯é˜¶æ®µéªŒè¯APIåŠŸèƒ½ |
| Redisè¿æ¥ä¸ç¨³å®š | ä¸­ | ä½ | ç†”æ–­å™¨ä¿æŠ¤ï¼ŒL1ç¼“å­˜å…œåº• |
| E2Eæµ‹è¯•ç¯å¢ƒé…ç½®é—®é¢˜ | ä½ | ä¸­ | è¯¦ç»†æµ‹è¯•é…ç½®æ–‡æ¡£ï¼ŒDockerç®€åŒ– |
| æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–é”è¡¨ | ä¸­ | ä½ | åœ¨ä½å³°æœŸæ‰§è¡Œï¼Œå‡†å¤‡å›æ»šè„šæœ¬ |

### å›æ»šå†³ç­–æ ‘

```
é—®é¢˜å‘ç”Ÿ
    â”‚
    â”œâ”€ APIé”™è¯¯ç‡ > 5%
    â”‚   â””â”€ ç«‹å³å›æ»šåˆ°ä¸Šä¸€é˜¶æ®µ
    â”‚
    â”œâ”€ æ€§èƒ½ä¸‹é™ > 20%
    â”‚   â”œâ”€ æ£€æŸ¥é…ç½®
    â”‚   â””â”€ 30åˆ†é’Ÿå†…æ— æ³•ä¿®å¤ â†’ å›æ»š
    â”‚
    â”œâ”€ PrometheusæŒ‡æ ‡ç¼ºå¤±
    â”‚   â”œâ”€ æ£€æŸ¥ä¸­é—´ä»¶æ³¨å†Œ
    â”‚   â””â”€ é‡å¯æœåŠ¡
    â”‚
    â””â”€ ç¼“å­˜å‘½ä¸­ç‡ < 50%
        â”œâ”€ æ£€æŸ¥Redisè¿æ¥
        â””â”€ è°ƒæ•´TTLé…ç½®
```

### å¿«é€Ÿå›æ»šå‘½ä»¤

```bash
# ç´§æ€¥å›æ»šåˆ°é›†æˆå‰çŠ¶æ€
git reset --hard pre-phase5-integration
systemctl restart backend
systemctl restart prometheus

# éªŒè¯ç³»ç»Ÿæ¢å¤
curl http://localhost:8000/health
```

---

## ğŸ“… æ—¶é—´è¡¨å’Œé‡Œç¨‹ç¢‘

### Day 1: é›†æˆå‡†å¤‡å’Œä½é£é™©ç»„ä»¶
- â° 09:00-10:00: é˜¶æ®µ0 - å‡†å¤‡å’Œå¤‡ä»½
- â° 10:00-10:30: é˜¶æ®µ1 - æ–‡æ¡£å’Œé…ç½®
- â° 10:30-11:15: é˜¶æ®µ2 - E2Eæµ‹è¯•æ¡†æ¶
- â° 11:15-12:00: ä¸­æœŸéªŒè¯å’Œæµ‹è¯•

### Day 2: æ ¸å¿ƒç»„ä»¶é›†æˆ
- â° 09:00-10:00: é˜¶æ®µ3 - æ€§èƒ½ç›‘æ§
- â° 10:00-11:30: é˜¶æ®µ4 - ç¼“å­˜æ¶æ„
- â° 11:30-12:30: é˜¶æ®µ5 - æ•°æ®åº“ä¼˜åŒ–
- â° 13:30-15:00: å®Œæ•´ç³»ç»Ÿæµ‹è¯•

### Day 3: éªŒæ”¶å’Œéƒ¨ç½²
- â° 09:00-11:00: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- â° 11:00-12:00: ç›‘æ§éªŒè¯
- â° 13:00-15:00: æ€§èƒ½éªŒè¯å’Œè°ƒä¼˜
- â° 15:00-16:00: æ–‡æ¡£æ›´æ–°å’ŒçŸ¥è¯†ä¼ é€’

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰ç°æœ‰APIç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- [ ] `/metrics`ç«¯ç‚¹è¿”å›PrometheusæŒ‡æ ‡
- [ ] ç¼“å­˜ç³»ç»Ÿæ­£å¸¸å·¥ä½œï¼Œå‘½ä¸­ç‡ > 70%
- [ ] E2Eæµ‹è¯•å¥—ä»¶é€šè¿‡ç‡ > 95%
- [ ] Grafanaä»ªè¡¨æ¿æ­£å¸¸æ˜¾ç¤ºæ•°æ®

### æ€§èƒ½éªŒæ”¶
- [ ] P95 APIå»¶è¿Ÿ < 300ms
- [ ] ç¼“å­˜å‘½ä¸­å“åº”æ—¶é—´ < 10ms
- [ ] PrometheusæŠ“å–å»¶è¿Ÿ < 50ms
- [ ] E2Eæµ‹è¯•è¿è¡Œæ—¶é—´ < 15åˆ†é’Ÿ

### å¯è§‚æµ‹æ€§éªŒæ”¶
- [ ] æ‰€æœ‰è¯·æ±‚åŒ…å«trace_id
- [ ] ç»“æ„åŒ–æ—¥å¿—JSONæ ¼å¼æ­£ç¡®
- [ ] å‘Šè­¦è§„åˆ™æ­£å¸¸è§¦å‘
- [ ] SLOä»ªè¡¨æ¿æ˜¾ç¤ºæ­£ç¡®æ•°æ®

---

## ğŸ“ é›†æˆåè¡ŒåŠ¨é¡¹

### ç«‹å³è¡ŒåŠ¨
1. **æ›´æ–°AIè¿›åº¦æ–‡ä»¶** (`.ai-progress.md`):
   - æ ‡è®°Phase 5é›†æˆå®Œæˆ
   - æ›´æ–°é¡¹ç›®çŠ¶æ€

2. **åˆ›å»ºé›†æˆå®ŒæˆæŠ¥å‘Š**:
   - è®°å½•æ‰€æœ‰å˜æ›´
   - è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
   - æ›´æ–°æ¶æ„æ–‡æ¡£

3. **é€šçŸ¥å›¢é˜Ÿ**:
   - å‘é€Phase 5å®Œæˆé€šçŸ¥
   - åˆ†äº«æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### åç»­ä¼˜åŒ–
1. **æ€§èƒ½è°ƒä¼˜**: æ ¹æ®ç›‘æ§æ•°æ®ä¼˜åŒ–ç¼“å­˜TTLå’ŒPrometheusæŠ“å–é—´éš”
2. **å‘Šè­¦è°ƒæ•´**: æ ¹æ®ç”Ÿäº§ç¯å¢ƒè°ƒæ•´SLOé˜ˆå€¼
3. **æµ‹è¯•æ‰©å±•**: æ·»åŠ æ›´å¤šE2Eæµ‹è¯•åœºæ™¯
4. **æ–‡æ¡£å®Œå–„**: è¡¥å……è¿ç»´æ‰‹å†Œå’Œæ•…éšœæ’é™¤æŒ‡å—

---

## ğŸ“ é™„å½•

### A. å…³é”®æ–‡ä»¶è·¯å¾„

**æ–°å¢æ ¸å¿ƒç»„ä»¶**:
- `src/core/middleware/performance.py` - Prometheusä¸­é—´ä»¶
- `src/core/cache/multi_level.py` - å¤šçº§ç¼“å­˜
- `src/core/logging/structured.py` - ç»“æ„åŒ–æ—¥å¿—

**é…ç½®æ–‡ä»¶**:
- `config/monitoring/prometheus.yml` - Prometheusé…ç½®
- `config/monitoring/slo-config.yaml` - SLOå®šä¹‰
- `config/monitoring/alerting.yaml` - å‘Šè­¦è§„åˆ™

**æµ‹è¯•æ–‡ä»¶**:
- `tests/e2e/conftest.py` - pytesté…ç½®
- `tests/e2e/test_login.py` - ç™»å½•æµ‹è¯•
- `tests/e2e/test_market.py` - é€‰è‚¡æµ‹è¯•

### B. ç›¸å…³æ–‡æ¡£

- Phase 5äº¤ä»˜ç‰©éªŒè¯æŠ¥å‘Š: `docs/reports/PHASE5_DELIVERABLES_VERIFICATION_REPORT.md`
- Phase 5å®ŒæˆæŠ¥å‘Š: `docs/reports/PHASE_5_COMPLETION_REPORT.md`
- AIåä½œè¿›åº¦: `.ai-progress.md`
- å‰ç«¯ç»„ä»¶è§„åˆ’: `docs/06-é¡¹ç›®ç®¡ç†ä¸æŠ¥å‘Š/AI3_FRONTEND_COMPONENT_PLAN.md`

### C. è”ç³»æ–¹å¼

**é›†æˆè´Ÿè´£äºº**: Claude (AI 3)
**åˆ†æ”¯**: main
**å·¥ä½œç›®å½•**: `/opt/claude/mystocks_spec`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-27
**æœ€åæ›´æ–°**: 2025-12-27
**çŠ¶æ€**: å¾…æ‰§è¡Œ

---

**å˜æ›´å†å²**:
- 2025-12-27: åˆå§‹ç‰ˆæœ¬åˆ›å»º
