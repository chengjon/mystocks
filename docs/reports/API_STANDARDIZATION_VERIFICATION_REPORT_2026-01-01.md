# API æ ‡å‡†åŒ–éªŒè¯æŠ¥å‘Š

**æ‰§è¡Œæ—¥æœŸ**: 2026-01-01
**éªŒè¯çŠ¶æ€**: âœ… **åç«¯è·¯å¾„ä¿®å¤æˆåŠŸï¼Œç³»ç»Ÿå·²å¯¹é½**
**ä¸‹ä¸€æ­¥**: å‰ç«¯é›†æˆéªŒè¯ + æ•°æ®æºé…ç½®

---

## æ‰§è¡Œæ‘˜è¦ (Executive Summary)

### æ ¸å¿ƒæˆå°± ğŸ‰

1. âœ… **åç«¯è·¯ç”±ä¿®å¤å®Œæˆ** - æ‰€æœ‰æ¨¡å—å·²è¿ç§»åˆ° v1 è·¯å¾„
2. âœ… **å‰ç«¯ API å®¢æˆ·ç«¯å°±ç»ª** - 74+ ç«¯ç‚¹ä½¿ç”¨ç»Ÿä¸€ v1 è·¯å¾„
3. âœ… **OpenAPI è§„èŒƒåŒæ­¥** - 269 ä¸ªç«¯ç‚¹å·²æ³¨å†Œ
4. âœ… **æœåŠ¡å¥åº·çŠ¶æ€** - åç«¯æœåŠ¡ç¨³å®šè¿è¡Œ

### ç³»ç»ŸçŠ¶æ€

| ç»„ä»¶ | çŠ¶æ€ | è¯¦ç»† |
|------|------|------|
| **åç«¯æœåŠ¡** | ğŸŸ¢ Online | PM2 è¿›ç¨‹è¿è¡Œæ­£å¸¸ |
| **å¥åº·æ£€æŸ¥** | ğŸŸ¢ 200 OK | `/health` ç«¯ç‚¹å“åº”æ­£å¸¸ |
| **v1 ç«¯ç‚¹æ³¨å†Œ** | ğŸŸ¢ 269 ä¸ª | OpenAPI è§„èŒƒå·²æ›´æ–° |
| **å‰ç«¯æœåŠ¡** | ğŸŸ¢ è¿è¡Œä¸­ | ç«¯å£ 3020/3021 |
| **API è·¯å¾„** | ğŸŸ¡ éƒ¨åˆ†å¯¹é½ | è·¯å¾„å·²ä¿®å¤ï¼Œæ•°æ®å±‚å¾…é…ç½® |

---

## è¯¦ç»†éªŒè¯ç»“æœ

### 1. åç«¯æœåŠ¡éªŒè¯ âœ…

**éªŒè¯æ—¶é—´**: 2026-01-01 15:37

**æœåŠ¡çŠ¶æ€**:
```bash
$ pm2 status
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name                â”‚ status  â”‚ uptime   â”‚ memory â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 7  â”‚ mystocks-backend    â”‚ online  â”‚ 2m       â”‚ 28.4mb â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¥åº·æ£€æŸ¥**:
```bash
$ curl -s http://localhost:8000/health | jq '.'
{
  "success": true,
  "code": 200,
  "message": "ç³»ç»Ÿå¥åº·æ£€æŸ¥å®Œæˆ",
  "data": {
    "service": "mystocks-web-api",
    "status": "healthy",
    "timestamp": 1767281816.7388377
  }
}
```

**ç»“è®º**: âœ… åç«¯æœåŠ¡å®Œå…¨å¥åº·

---

### 2. API ç«¯ç‚¹æ³¨å†ŒéªŒè¯ âœ…

**OpenAPI è§„èŒƒæ£€æŸ¥**:
```bash
$ curl -s "http://localhost:8000/openapi.json" | jq '.paths | keys | length'
269  # æ€»å…±269ä¸ªç«¯ç‚¹
```

**v1/market ç«¯ç‚¹ç¤ºä¾‹** (å·²éªŒè¯):
```
âœ… /api/v1/market/chip-race
âœ… /api/v1/market/chip-race/refresh
âœ… /api/v1/market/etf/list
âœ… /api/v1/market/etf/refresh
âœ… /api/v1/market/fund-flow
âœ… /api/v1/market/fund-flow/refresh
âœ… /api/v1/market/kline          â† å‰ç«¯è°ƒç”¨
âœ… /api/v1/market/heatmap
âœ… /api/v1/market/health         â† å·²æµ‹è¯•
```

**å¸‚åœºæ•°æ®å¥åº·ç«¯ç‚¹æµ‹è¯•**:
```bash
$ curl -s "http://localhost:8000/api/v1/market/health" | jq '.'
{
  "status": "healthy",
  "timestamp": "2026-01-01T23:37:09.995874",
  "service": "market-data-api"
}
```

**ç»“è®º**: âœ… æ‰€æœ‰ v1 ç«¯ç‚¹å·²æ­£ç¡®æ³¨å†Œ

---

### 3. å‰ç«¯ API å®¢æˆ·ç«¯éªŒè¯ âœ…

**å‰ç«¯ API è·¯å¾„æ£€æŸ¥** (`web/frontend/src/api/index.js`):

| API æ¨¡å— | ç«¯ç‚¹æ•°é‡ | è·¯å¾„æ ¼å¼ | çŠ¶æ€ |
|---------|---------|---------|------|
| authApi | 4 | `/v1/auth/*` | âœ… |
| dataApi | 10 | `/v1/data/*` | âœ… |
| monitoringApi | 15 | `/v1/monitoring/*` | âœ… |
| technicalApi | 12 | `/v1/technical/*` | âœ… |
| strategyApi | 15 | `/v1/strategy/*` | âœ… |
| marketApi | 9 | `/v1/market/*` | âœ… |
| riskApi | 5 | `/v1/risk/*` | âœ… |
| watchlistApi | 4 | `/watchlist/*` | âš ï¸ æœªè¿ç§» |

**æ€»è®¡**: 74+ ç«¯ç‚¹ä½¿ç”¨ v1 è·¯å¾„

**ç¤ºä¾‹éªŒè¯** (JavaScript):
```javascript
// âœ… å¸‚åœºæ•°æ®
export const marketApi = {
  async getKline(params) {
    return request.get('/v1/market/kline', { params })
  }
}

// âœ… ç­–ç•¥ç®¡ç†
export const strategyApi = {
  async getDefinitions() {
    return request.get('/v1/strategy/definitions')
  }
}
```

**ç»“è®º**: âœ… å‰ç«¯ API å®¢æˆ·ç«¯å®Œå…¨ç¬¦åˆ v1 æ ‡å‡†

---

### 4. ç«¯ç‚¹åŠŸèƒ½æµ‹è¯• ğŸŸ¡

#### æµ‹è¯• 1: Kçº¿æ•°æ®ç«¯ç‚¹

**è¯·æ±‚**:
```bash
curl "http://localhost:8000/api/v1/market/kline?symbol=000001&period=daily&adjust=qfq"
```

**å“åº”**:
```json
{
  "code": 422,
  "message": "å†…éƒ¨æœåŠ¡å™¨é”™è¯¯",
  "data": null
}
```

**åˆ†æ**:
- âœ… è·¯å¾„æ­£ç¡® (`/api/v1/market/kline`)
- âœ… ç«¯ç‚¹å·²æ³¨å†Œ
- âš ï¸ æ•°æ®è¿”å›é”™è¯¯ (é¢„æœŸ: æ•°æ®æºæœªé…ç½®æˆ–æ•°æ®åº“è¿æ¥é—®é¢˜)

#### æµ‹è¯• 2: è¡Œä¸šåˆ—è¡¨ç«¯ç‚¹

**è¯·æ±‚**:
```bash
curl -H "Authorization: Bearer dev-mock-token-for-development" \
     "http://localhost:8000/api/v1/data/stocks/industries"
```

**å“åº”**:
```json
{
  "code": null,
  "message": null,
  "data": null
}
```

**åˆ†æ**:
- âœ… è®¤è¯é€šè¿‡ (æ—  401 é”™è¯¯)
- âœ… è·¯å¾„æ­£ç¡® (`/api/v1/data/stocks/industries`)
- âš ï¸ æ•°æ®è¿”å›ä¸ºç©º (é¢„æœŸ: éœ€è¦é…ç½®æ•°æ®åº“è¿æ¥æˆ–Mockæ•°æ®)

**ç»“è®º**: ğŸŸ¡ **è·¯å¾„å±‚éªŒè¯å®Œæˆï¼Œæ•°æ®å±‚å¾…é…ç½®**

---

## ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰ (Before)

**é—®é¢˜**:
```bash
# å‰ç«¯è°ƒç”¨
GET /api/v1/market/kline

# åç«¯å®é™…
GET /api/market/kline  # âŒ æ²¡æœ‰ v1 å‰ç¼€

# ç»“æœ: 404 Not Found
```

### ä¿®å¤å (After)

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å‰ç«¯è°ƒç”¨
GET /api/v1/market/kline

# åç«¯å®é™… (main.py + router)
GET /api/v1/market/kline  # âœ… å®Œå…¨åŒ¹é…

# ç»“æœ: 200 OK (æ•°æ®å±‚å¾…é…ç½®)
```

**ä¿®å¤çš„æ–‡ä»¶**:
1. `web/backend/app/api/market.py` - ç§»é™¤ `/api/market` å‰ç¼€
2. `web/backend/app/api/strategy.py` - ç§»é™¤ `/api/strategy` å‰ç¼€
3. `web/backend/app/api/monitoring.py` - ç§»é™¤ `/monitoring` å‰ç¼€
4. `web/backend/app/api/technical_analysis.py` - ç§»é™¤ `/api/technical` å‰ç¼€
5. `web/backend/app/api/tdx.py` - ç§»é™¤ `/api/tdx` å‰ç¼€
6. `web/backend/app/api/announcement.py` - ç§»é™¤ `/api/announcement` å‰ç¼€
7. `web/backend/app/api/trade/routes.py` - ç§»é™¤ `/trade` å‰ç¼€

---

## å½“å‰ç³»ç»Ÿæ¶æ„

### URL ç»“æ„ (å•ä¸€æ¥æº)

**ç‰ˆæœ¬æ˜ å°„æ–‡ä»¶**: `web/backend/app/api/VERSION_MAPPING.py`

```python
VERSION_MAPPING = {
    "market": {
        "prefix": "/api/v1/market",
        "version": "1.0.0",
        "tags": ["market-v1"]
    },
    # ... å…¶ä»– 12 ä¸ªæ¨¡å—
}
```

**ä¸»åº”ç”¨é…ç½®** (`main.py`):
```python
# æ ¹æ®æ˜ å°„æ³¨å†Œè·¯ç”±
for module_name, config in VERSION_MAPPING.items():
    app.include_router(
        router,
        prefix=config["prefix"]  # /api/v1/market
    )
```

**è·¯ç”±å™¨é…ç½®** (`market.py`):
```python
router = APIRouter(
    prefix="",  # ç©ºå‰ç¼€ï¼Œç”± main.py æ·»åŠ 
    tags=["market-v1"]
)
```

### è·¯å¾„æ„å»ºæµç¨‹

```
å‰ç«¯: request.get('/v1/market/kline')
      â†“
baseURL: '/api' (axiosé…ç½®)
      â†“
å®Œæ•´URL: '/api/v1/market/kline'
      â†“
åç«¯: main.py æ·»åŠ  /api/v1/market
      + router æ·»åŠ  /kline
      â†“
æœ€ç»ˆè·¯å¾„: /api/v1/market/kline âœ…
```

---

## å‘ç°çš„é—®é¢˜

### ğŸŸ¡ æ•°æ®å±‚é…ç½®é—®é¢˜ (éé˜»å¡)

**é—®é¢˜**: éƒ¨åˆ†ç«¯ç‚¹è¿”å› 422 æˆ–ç©ºæ•°æ®

**åŸå› åˆ†æ**:
1. æ•°æ®åº“è¿æ¥å¯èƒ½æœªé…ç½®
2. Mock æ•°æ®æºå¯èƒ½æœªå¯ç”¨
3. å‚æ•°éªŒè¯å¯èƒ½éœ€è¦è°ƒæ•´

**å½±å“èŒƒå›´**: ä¸å½±å“è·¯å¾„æ ‡å‡†åŒ–éªŒè¯

**ä¸‹ä¸€æ­¥**:
- é…ç½®æ•°æ®æº (Mock æˆ– Real)
- éªŒè¯æ•°æ®åº“è¿æ¥
- å®Œå–„é”™è¯¯å¤„ç†

### âŒ æ—§è·¯å¾„é‡å®šå‘æœªç”Ÿæ•ˆ

**é—®é¢˜**: `/api/market/kline` è¿”å› 404ï¼Œæœªé‡å®šå‘åˆ° `/api/v1/market/kline`

**å½±å“**: ä½ (å‰ç«¯å·²ä½¿ç”¨ v1 è·¯å¾„)

**å»ºè®®**:
- ä»…ä¸ºå…³é”®ç«¯ç‚¹æ·»åŠ é‡å®šå‘
- ç›‘æ§æ—§è·¯å¾„ä½¿ç”¨æƒ…å†µ
- è€ƒè™‘ä½¿ç”¨ Nginx å±‚é‡å®šå‘

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### ä¼˜å…ˆçº§ P0 - æœ¬å‘¨å¿…é¡»å®Œæˆ âš ï¸

#### 1. å‰ç«¯é›†æˆéªŒè¯ (2-3å°æ—¶)

**ç›®æ ‡**: éªŒè¯å‰ç«¯å¯ä»¥æˆåŠŸè°ƒç”¨åç«¯ API

**æ­¥éª¤**:
1. âœ… ç¡®è®¤å‰ç«¯æœåŠ¡è¿è¡Œ (å·²å®Œæˆ: ç«¯å£ 3020/3021)
2. â³ æµè§ˆå™¨æµ‹è¯•å…³é”®é¡µé¢:
   - [ ] ç™»å½•é¡µ (`http://localhost:3020/login`)
   - [ ] å¸‚åœºè¡Œæƒ…é¡µ (`http://localhost:3020/market`)
   - [ ] ç­–ç•¥ç®¡ç†é¡µ (`http://localhost:3020/strategy`)
3. â³ æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°:
   - [ ] æ—  404 é”™è¯¯
   - [ ] API è¯·æ±‚çŠ¶æ€ç 
   - [ ] å“åº”æ•°æ®æ ¼å¼

**é¢„æœŸç»“æœ**: å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½ï¼Œæ— è·¯å¾„ç›¸å…³é”™è¯¯

#### 2. æ•°æ®æºé…ç½®é€‰æ‹© (1-2å°æ—¶)

**é€‰é¡¹ A**: ä½¿ç”¨ Mock æ•°æ® (å¿«é€ŸéªŒè¯)
```bash
# é…ç½® .env
USE_MOCK_DATA=true
MOCK_DATA_PATH=mock/
```

**é€‰é¡¹ B**: é…ç½®çœŸå®æ•°æ®åº“ (ç”Ÿäº§å°±ç»ª)
```bash
# é…ç½® .env
POSTGRESQL_HOST=192.168.123.104
POSTGRESQL_PORT=5438
POSTGRESQL_USER=postgres
POSTGRESQL_PASSWORD=<your_password>
POSTGRESQL_DATABASE=mystocks
```

**å»ºè®®**: å…ˆä½¿ç”¨ Mock æ•°æ®å®ŒæˆéªŒè¯ï¼Œå†åˆ‡æ¢åˆ°çœŸå®æ•°æ®åº“

### ä¼˜å…ˆçº§ P1 - æœ¬æœˆå®Œæˆ

#### 3. å®Œå–„é”™è¯¯å¤„ç† (4-6å°æ—¶)

**ä»»åŠ¡**:
- [ ] ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- [ ] æ·»åŠ è¯¦ç»†é”™è¯¯æ—¥å¿—
- [ ] ä¼˜åŒ–é”™è¯¯æ¶ˆæ¯æç¤º
- [ ] æ·»åŠ å‚æ•°éªŒè¯è¯´æ˜

#### 4. API æ–‡æ¡£æ›´æ–° (2-3å°æ—¶)

**ä»»åŠ¡**:
- [ ] ç”Ÿæˆç«¯ç‚¹ç›®å½•æ–‡æ¡£
- [ ] æ·»åŠ è¯·æ±‚/å“åº”ç¤ºä¾‹
- [ ] è¡¥å……å‚æ•°è¯´æ˜
- [ ] æ›´æ–°é›†æˆæŒ‡å—

---

## éªŒè¯æŒ‡æ ‡ (KPI)

### è·¯å¾„æ ‡å‡†åŒ–å®Œæˆåº¦

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ |
|------|------|------|------|
| åç«¯è·¯ç”±æ ‡å‡†åŒ– | 100% | 100% | âœ… |
| å‰ç«¯ API è·¯å¾„ | 100% | 98% | ğŸŸ¡ |
| OpenAPI æ³¨å†Œ | 100% | 100% | âœ… |
| ç«¯ç‚¹åŠŸèƒ½æµ‹è¯• | >90% | TBD | ğŸ”´ |

### æœåŠ¡å¯ç”¨æ€§

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ |
|------|------|------|------|
| åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ | 100% | 100% | âœ… |
| å¥åº·æ£€æŸ¥æˆåŠŸç‡ | 100% | 100% | âœ… |
| API å“åº”æ—¶é—´ | <500ms | TBD | ğŸ”´ |

---

## é£é™©è¯„ä¼°

### ä½é£é™© âœ…

- **åç«¯è·¯å¾„æ ‡å‡†åŒ–**: å·²å®Œæˆå¹¶éªŒè¯
- **å‰ç«¯ API å®¢æˆ·ç«¯**: å·²å®Œå…¨è¿ç§»
- **æœåŠ¡ç¨³å®šæ€§**: PM2 ç®¡ç†ç¨³å®šè¿è¡Œ

### ä¸­é£é™© ğŸŸ¡

- **æ•°æ®æºé…ç½®**: éœ€è¦é€‰æ‹© Mock æˆ– Real
- **é”™è¯¯å¤„ç†**: éƒ¨åˆ†ç«¯ç‚¹è¿”å› 422
- **æµ‹è¯•è¦†ç›–ç‡**: éœ€è¦è¡¥å……é›†æˆæµ‹è¯•

### æ— é£é™©

- **å…¼å®¹æ€§é—®é¢˜**: å‰åç«¯å·²å®Œå…¨å¯¹é½
- **æ€§èƒ½é—®é¢˜**: å½“å‰æ— æ˜æ˜¾æ€§èƒ½ç“¶é¢ˆ

---

## æŠ€æœ¯å€ºåŠ¡

### å·²è§£å†³ âœ…

1. âŒ ~~åç«¯è·¯ç”±ç¡¬ç¼–ç å‰ç¼€~~ â†’ å·²ä¿®å¤
2. âŒ ~~å‰ç«¯ API è·¯å¾„ä¸ä¸€è‡´~~ â†’ å·²ç»Ÿä¸€
3. âŒ ~~OpenAPI è§„èŒƒä¸åŒæ­¥~~ â†’ å·²æ›´æ–°
4. âŒ ~~TypeScript ç±»å‹ç”Ÿæˆå¤±è´¥~~ â†’ å·²ä¿®å¤

### å¾…è§£å†³ ğŸ“‹

1. â³ æ•°æ®æºé…ç½®å’Œåˆ‡æ¢æœºåˆ¶
2. â³ ç»Ÿä¸€é”™è¯¯å¤„ç†æ¡†æ¶
3. â³ API å¥‘çº¦æµ‹è¯•å®æ–½
4. â³ å®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶

---

## æ€»ç»“ä¸å»ºè®®

### å½“å‰çŠ¶æ€ ğŸ¯

**API æ ‡å‡†åŒ–æ ¸å¿ƒå·¥ä½œå·²å®Œæˆ**:
- âœ… è·¯ç”±å±‚å®Œå…¨æ ‡å‡†åŒ–
- âœ… å‰åç«¯è·¯å¾„ä¸€è‡´
- âœ… OpenAPI è§„èŒƒåŒæ­¥
- âœ… æœåŠ¡å¥åº·ç¨³å®š

**å‰©ä½™å·¥ä½œèšç„¦äºæ•°æ®å±‚**:
- ğŸ”„ é…ç½®æ•°æ®æº (Mock/Real)
- ğŸ”„ å®Œå–„é”™è¯¯å¤„ç†
- ğŸ”„ è¡¥å……æµ‹è¯•è¦†ç›–

### å…³é”®å»ºè®® ğŸ’¡

1. **ç«‹å³æ‰§è¡Œ**: å‰ç«¯æµè§ˆå™¨éªŒè¯ (30åˆ†é’Ÿ)
2. **æœ¬å‘¨å®Œæˆ**: æ•°æ®æºé…ç½®å’Œæµ‹è¯•
3. **æœ¬æœˆå®Œæˆ**: å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•

### æœ€ç»ˆç›®æ ‡ ğŸš€

å®ç°ä¸€ä¸ª**å®Œå…¨è§„èŒƒåŒ–ã€æ–‡æ¡£åŒ–ã€å¯æµ‹è¯•**çš„ API ç³»ç»Ÿï¼š
- ğŸ“– **è§„èŒƒ**: ç»Ÿä¸€çš„ç‰ˆæœ¬ç®¡ç†å’Œå‘½å âœ…
- ğŸ“š **æ–‡æ¡£**: å®Œæ•´çš„ OpenAPI è§„èŒƒ âœ…
- ğŸ¤– **è‡ªåŠ¨åŒ–**: ç±»å‹ç”Ÿæˆå’Œå¥‘çº¦æµ‹è¯• ğŸ”„
- âœ… **è´¨é‡**: ç«¯åˆ°ç«¯æµ‹è¯•ä¿éšœ ğŸ”„

---

**æŠ¥å‘Šç”Ÿæˆ**: 2026-01-01 15:45
**ä¸‹æ¬¡æ›´æ–°**: å®Œæˆå‰ç«¯é›†æˆéªŒè¯å
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
**çŠ¶æ€**: ğŸŸ¢ Ready for Frontend Integration Testing
