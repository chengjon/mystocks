version: '3.0.0'
metadata:
  project: 'MyStocks量化交易数据管理系统'
  created_by: 'ConfigDrivenTableManager'
  last_updated: '2025-10-11T00:00:00'
  description: '完整的23个数据分类表结构配置'
  compatible_databases: ['TDengine 3.0+', 'PostgreSQL 14+', 'MySQL 8.0+', 'Redis 6.0+']

# 数据库连接配置
databases:
  tdengine:
    host: '${TDENGINE_HOST:localhost}'
    port: '${TDENGINE_REST_PORT:6041}'
    user: '${TDENGINE_USER:root}'
    password: '${TDENGINE_PASSWORD:taosdata}'
    database: '${TDENGINE_DATABASE:market_data}'
    description: '高频时序数据存储'

  postgresql:
    host: '${POSTGRESQL_HOST:localhost}'
    port: '${POSTGRESQL_PORT:5432}'
    user: '${POSTGRESQL_USER:postgres}'
    password: '${POSTGRESQL_PASSWORD}'
    database: '${POSTGRESQL_DATABASE:mystocks}'
    description: '历史分析数据存储'

  mysql:
    host: '${MYSQL_HOST:localhost}'
    port: '${MYSQL_PORT:3306}'
    user: '${MYSQL_USER:root}'
    password: '${MYSQL_PASSWORD}'
    database: '${MYSQL_DATABASE:mystocks_reference}'
    description: '参考数据和元数据存储'

  redis:
    host: '${REDIS_HOST:localhost}'
    port: '${REDIS_PORT:6379}'
    password: '${REDIS_PASSWORD:}'
    db: '${REDIS_DB:1}'
    description: '实时缓存'

# 表结构配置
tables:
  # =====================================
  # 第1类: 市场数据 (Market Data) - 6个实体
  # =====================================

  # 1.1 Tick数据
  - database_type: 'TDengine'
    database_name: 'market_data'
    table_name: 'tick_data'
    classification: 'TICK_DATA'
    description: 'Tick逐笔成交数据'
    is_super_table: true
    compression:
      enabled: true
      codec: 'zstd'
      level: 'high'
    retention_days: 730  # 2年
    columns:
      - name: 'ts'
        type: 'TIMESTAMP'
        nullable: false
        comment: '成交时间戳(毫秒精度)'
      - name: 'price'
        type: 'DOUBLE'
        nullable: false
        comment: '成交价格'
      - name: 'volume'
        type: 'BIGINT'
        nullable: false
        comment: '成交量(股)'
      - name: 'amount'
        type: 'DOUBLE'
        nullable: false
        comment: '成交额(元)'
      - name: 'direction'
        type: 'TINYINT'
        nullable: true
        comment: '买卖方向(1=主动买,-1=主动卖,0=未知)'
      - name: 'buy_count'
        type: 'INT'
        nullable: true
        comment: '买盘笔数'
      - name: 'sell_count'
        type: 'INT'
        nullable: true
        comment: '卖盘笔数'
      - name: 'bid_price'
        type: 'DOUBLE'
        nullable: true
        comment: '买一价'
      - name: 'ask_price'
        type: 'DOUBLE'
        nullable: true
        comment: '卖一价'
    tags:
      - name: 'symbol'
        type: 'BINARY(16)'
        comment: '股票代码'
      - name: 'exchange'
        type: 'BINARY(16)'
        comment: '交易所(SSE/SZSE)'
      - name: 'security_type'
        type: 'BINARY(16)'
        comment: '证券类型(STOCK/INDEX/BOND)'

  # 1.2 分钟K线数据
  - database_type: 'TDengine'
    database_name: 'market_data'
    table_name: 'minute_kline'
    classification: 'MINUTE_KLINE'
    description: '分钟K线数据(1/5/15/30/60分钟)'
    is_super_table: true
    compression:
      enabled: true
      codec: 'zstd'
      level: 'high'
    retention_days: 730
    columns:
      - name: 'ts'
        type: 'TIMESTAMP'
        nullable: false
        comment: 'K线时间戳(分钟精度)'
      - name: 'open'
        type: 'DOUBLE'
        nullable: false
        comment: '开盘价'
      - name: 'high'
        type: 'DOUBLE'
        nullable: false
        comment: '最高价'
      - name: 'low'
        type: 'DOUBLE'
        nullable: false
        comment: '最低价'
      - name: 'close'
        type: 'DOUBLE'
        nullable: false
        comment: '收盘价'
      - name: 'volume'
        type: 'BIGINT'
        nullable: false
        comment: '成交量'
      - name: 'amount'
        type: 'DOUBLE'
        nullable: false
        comment: '成交额'
      - name: 'num_trades'
        type: 'INT'
        nullable: true
        comment: '成交笔数'
      - name: 'vwap'
        type: 'DOUBLE'
        nullable: true
        comment: '成交均价'
    tags:
      - name: 'symbol'
        type: 'BINARY(16)'
        comment: '股票代码'
      - name: 'exchange'
        type: 'BINARY(16)'
        comment: '交易所'
      - name: 'interval_type'
        type: 'BINARY(8)'
        comment: 'K线周期(1min/5min/15min/30min/60min)'

  # 1.3 日线/周线/月线数据
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'daily_kline'
    classification: 'DAILY_KLINE'
    description: '日线/周线/月线K线数据'
    is_timescale_hypertable: true
    time_column: 'trade_date'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['symbol', 'interval_type']
      order_by: 'trade_date DESC'
    retention_days: 3650  # 10年
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
        comment: '自增主键'
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
        comment: '股票代码'
      - name: 'trade_date'
        type: 'TIMESTAMPTZ'
        nullable: false
        comment: '交易日期'
      - name: 'interval_type'
        type: 'VARCHAR'
        length: 8
        nullable: false
        comment: 'D=日线,W=周线,M=月线'
      - name: 'open'
        type: 'DOUBLE PRECISION'
        nullable: false
        comment: '开盘价'
      - name: 'high'
        type: 'DOUBLE PRECISION'
        nullable: false
        comment: '最高价'
      - name: 'low'
        type: 'DOUBLE PRECISION'
        nullable: false
        comment: '最低价'
      - name: 'close'
        type: 'DOUBLE PRECISION'
        nullable: false
        comment: '收盘价'
      - name: 'volume'
        type: 'BIGINT'
        nullable: false
        comment: '成交量'
      - name: 'amount'
        type: 'DOUBLE PRECISION'
        nullable: true
        comment: '成交额'
      - name: 'turnover_rate'
        type: 'DOUBLE PRECISION'
        nullable: true
        comment: '换手率(%)'
      - name: 'pe_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
        comment: '市盈率'
      - name: 'pb_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
        comment: '市净率'
      - name: 'adj_factor'
        type: 'DOUBLE PRECISION'
        nullable: true
        comment: '复权因子'
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
        comment: '创建时间'
      - name: 'updated_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
        comment: '更新时间'
    indexes:
      - name: 'idx_daily_kline_symbol_date'
        type: 'INDEX'
        columns: ['symbol', 'trade_date DESC']
      - name: 'idx_daily_kline_interval'
        type: 'INDEX'
        columns: ['interval_type', 'trade_date DESC']

  # 1.4 订单簿深度数据
  - database_type: 'TDengine'
    database_name: 'market_data'
    table_name: 'order_book_depth'
    classification: 'ORDER_BOOK_DEPTH'
    description: '订单簿深度数据(10档行情)'
    is_super_table: true
    compression:
      enabled: true
      codec: 'zstd'
      level: 'medium'
    retention_days: 365
    columns:
      - name: 'ts'
        type: 'TIMESTAMP'
        nullable: false
        comment: '快照时间戳'
      - name: 'bid_prices'
        type: 'BINARY(512)'
        nullable: true
        comment: '买盘10档价格(JSON数组)'
      - name: 'bid_volumes'
        type: 'BINARY(512)'
        nullable: true
        comment: '买盘10档数量(JSON数组)'
      - name: 'ask_prices'
        type: 'BINARY(512)'
        nullable: true
        comment: '卖盘10档价格(JSON数组)'
      - name: 'ask_volumes'
        type: 'BINARY(512)'
        nullable: true
        comment: '卖盘10档数量(JSON数组)'
      - name: 'total_bid_volume'
        type: 'BIGINT'
        nullable: true
        comment: '买盘总量'
      - name: 'total_ask_volume'
        type: 'BIGINT'
        nullable: true
        comment: '卖盘总量'
      - name: 'spread'
        type: 'DOUBLE'
        nullable: true
        comment: '价差'
      - name: 'mid_price'
        type: 'DOUBLE'
        nullable: true
        comment: '中间价'
    tags:
      - name: 'symbol'
        type: 'BINARY(16)'
        comment: '股票代码'
      - name: 'exchange'
        type: 'BINARY(16)'
        comment: '交易所'

  # 1.5 Level-2盘口快照
  - database_type: 'TDengine'
    database_name: 'market_data'
    table_name: 'level2_snapshot'
    classification: 'LEVEL2_SNAPSHOT'
    description: 'Level-2盘口快照(五档行情)'
    is_super_table: true
    compression:
      enabled: true
      codec: 'zstd'
      level: 'high'
    retention_days: 365
    columns:
      - name: 'ts'
        type: 'TIMESTAMP'
        nullable: false
        comment: '快照时间戳'
      - name: 'current_price'
        type: 'DOUBLE'
        nullable: false
        comment: '当前价'
      - name: 'pre_close'
        type: 'DOUBLE'
        nullable: false
        comment: '昨收价'
      - name: 'bid1_price'
        type: 'DOUBLE'
        nullable: true
        comment: '买一价'
      - name: 'bid1_volume'
        type: 'BIGINT'
        nullable: true
        comment: '买一量'
      - name: 'bid2_price'
        type: 'DOUBLE'
        nullable: true
        comment: '买二价'
      - name: 'bid2_volume'
        type: 'BIGINT'
        nullable: true
        comment: '买二量'
      - name: 'bid3_price'
        type: 'DOUBLE'
        nullable: true
        comment: '买三价'
      - name: 'bid3_volume'
        type: 'BIGINT'
        nullable: true
        comment: '买三量'
      - name: 'bid4_price'
        type: 'DOUBLE'
        nullable: true
        comment: '买四价'
      - name: 'bid4_volume'
        type: 'BIGINT'
        nullable: true
        comment: '买四量'
      - name: 'bid5_price'
        type: 'DOUBLE'
        nullable: true
        comment: '买五价'
      - name: 'bid5_volume'
        type: 'BIGINT'
        nullable: true
        comment: '买五量'
      - name: 'ask1_price'
        type: 'DOUBLE'
        nullable: true
        comment: '卖一价'
      - name: 'ask1_volume'
        type: 'BIGINT'
        nullable: true
        comment: '卖一量'
      - name: 'ask2_price'
        type: 'DOUBLE'
        nullable: true
        comment: '卖二价'
      - name: 'ask2_volume'
        type: 'BIGINT'
        nullable: true
        comment: '卖二量'
      - name: 'ask3_price'
        type: 'DOUBLE'
        nullable: true
        comment: '卖三价'
      - name: 'ask3_volume'
        type: 'BIGINT'
        nullable: true
        comment: '卖三量'
      - name: 'ask4_price'
        type: 'DOUBLE'
        nullable: true
        comment: '卖四价'
      - name: 'ask4_volume'
        type: 'BIGINT'
        nullable: true
        comment: '卖四量'
      - name: 'ask5_price'
        type: 'DOUBLE'
        nullable: true
        comment: '卖五价'
      - name: 'ask5_volume'
        type: 'BIGINT'
        nullable: true
        comment: '卖五量'
      - name: 'total_volume'
        type: 'BIGINT'
        nullable: true
        comment: '总成交量'
      - name: 'total_amount'
        type: 'DOUBLE'
        nullable: true
        comment: '总成交额'
      - name: 'weighted_buy_price'
        type: 'DOUBLE'
        nullable: true
        comment: '加权买价'
      - name: 'weighted_sell_price'
        type: 'DOUBLE'
        nullable: true
        comment: '加权卖价'
    tags:
      - name: 'symbol'
        type: 'BINARY(16)'
        comment: '股票代码'
      - name: 'exchange'
        type: 'BINARY(16)'
        comment: '交易所'

  # 1.6 指数行情(分时)
  - database_type: 'TDengine'
    database_name: 'market_data'
    table_name: 'index_intraday_quotes'
    classification: 'INDEX_QUOTES'
    description: '指数分时行情'
    is_super_table: true
    compression:
      enabled: true
      codec: 'zstd'
      level: 'high'
    retention_days: 180
    columns:
      - name: 'ts'
        type: 'TIMESTAMP'
        nullable: false
        comment: '行情时间戳'
      - name: 'index_value'
        type: 'DOUBLE'
        nullable: false
        comment: '指数点位'
      - name: 'change'
        type: 'DOUBLE'
        nullable: true
        comment: '涨跌点数'
      - name: 'change_pct'
        type: 'DOUBLE'
        nullable: true
        comment: '涨跌幅(%)'
      - name: 'volume'
        type: 'BIGINT'
        nullable: true
        comment: '成交量'
      - name: 'amount'
        type: 'DOUBLE'
        nullable: true
        comment: '成交额'
    tags:
      - name: 'index_code'
        type: 'BINARY(16)'
        comment: '指数代码(如000001.SH)'
      - name: 'index_name'
        type: 'BINARY(64)'
        comment: '指数名称'
      - name: 'market'
        type: 'BINARY(16)'
        comment: '市场(SSE/SZSE/CSI)'

  # =====================================
  # 第2类: 参考数据 (Reference Data) - 9个实体 → MySQL
  # =====================================

  # 2.1 股票基础信息
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'stock_info'
    classification: 'SYMBOLS_INFO'
    description: '股票基础信息表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
        comment: '自增主键'
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
        unique: true
        comment: '股票代码(统一格式:600000.SH)'
      - name: 'name'
        type: 'VARCHAR'
        length: 64
        nullable: false
        comment: '股票名称'
      - name: 'exchange'
        type: 'VARCHAR'
        length: 16
        nullable: false
        comment: '交易所(SSE/SZSE)'
      - name: 'security_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
        comment: '证券类型(STOCK/INDEX/BOND/FUND)'
      - name: 'list_date'
        type: 'DATE'
        nullable: true
        comment: '上市日期'
      - name: 'delist_date'
        type: 'DATE'
        nullable: true
        comment: '退市日期'
      - name: 'status'
        type: 'VARCHAR'
        length: 16
        nullable: false
        default: "'ACTIVE'"
        comment: '状态(ACTIVE/SUSPENDED/DELISTED)'
      - name: 'listing_board'
        type: 'VARCHAR'
        length: 16
        nullable: true
        comment: '上市板块(MAIN/GEM/STAR/BJ)'
      - name: 'market_cap'
        type: 'DOUBLE'
        nullable: true
        comment: '总市值(元)'
      - name: 'circulating_market_cap'
        type: 'DOUBLE'
        nullable: true
        comment: '流通市值(元)'
      - name: 'total_shares'
        type: 'BIGINT'
        nullable: true
        comment: '总股本'
      - name: 'circulating_shares'
        type: 'BIGINT'
        nullable: true
        comment: '流通股本'
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
        comment: '创建时间'
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
        comment: '更新时间'
    indexes:
      - name: 'idx_symbol'
        type: 'INDEX'
        columns: ['symbol']
      - name: 'idx_exchange_status'
        type: 'INDEX'
        columns: ['exchange', 'status']
      - name: 'idx_security_type'
        type: 'INDEX'
        columns: ['security_type']

  # 2.2 行业分类
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'industry_classification'
    classification: 'INDUSTRY_CLASS'
    description: '行业分类表(申万/证监会/同花顺)'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'industry_standard'
        type: 'VARCHAR'
        length: 32
        nullable: false
        comment: '分类标准(SW=申万,CSRC=证监会,THS=同花顺)'
      - name: 'industry_level'
        type: 'VARCHAR'
        length: 8
        nullable: false
        comment: '行业层级(L1=一级,L2=二级,L3=三级)'
      - name: 'industry_code'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'industry_name'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'parent_industry_code'
        type: 'VARCHAR'
        length: 16
        nullable: true
      - name: 'valid_from'
        type: 'DATE'
        nullable: false
      - name: 'valid_to'
        type: 'DATE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_symbol_standard'
        type: 'INDEX'
        columns: ['symbol', 'industry_standard']
      - name: 'idx_industry_code'
        type: 'INDEX'
        columns: ['industry_code']
      - name: 'idx_valid_period'
        type: 'INDEX'
        columns: ['valid_from', 'valid_to']

  # 2.3 概念分类
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'concept_classification'
    classification: 'CONCEPT_CLASS'
    description: '概念分类表(AI/新能源/国企改革等)'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'concept_name'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'concept_category'
        type: 'VARCHAR'
        length: 32
        nullable: true
        comment: '概念类别(TECH/NEW_ENERGY/POLICY)'
      - name: 'concept_source'
        type: 'VARCHAR'
        length: 32
        nullable: false
        comment: '概念来源(THS/EASTMONEY/WIND)'
      - name: 'join_date'
        type: 'DATE'
        nullable: false
      - name: 'exit_date'
        type: 'DATE'
        nullable: true
      - name: 'weight'
        type: 'DOUBLE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_symbol'
        type: 'INDEX'
        columns: ['symbol']
      - name: 'idx_concept_name'
        type: 'INDEX'
        columns: ['concept_name']
      - name: 'idx_concept_category'
        type: 'INDEX'
        columns: ['concept_category']

  # 2.4 指数成分股
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'index_constituents'
    classification: 'INDEX_CONSTITUENTS'
    description: '指数成分股表(沪深300/中证500等)'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'index_code'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'index_name'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'weight'
        type: 'DOUBLE'
        nullable: true
        comment: '权重(%)'
      - name: 'in_date'
        type: 'DATE'
        nullable: false
      - name: 'out_date'
        type: 'DATE'
        nullable: true
      - name: 'adjustment_reason'
        type: 'VARCHAR'
        length: 128
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_index_code'
        type: 'INDEX'
        columns: ['index_code', 'in_date DESC']
      - name: 'idx_symbol'
        type: 'INDEX'
        columns: ['symbol']

  # 2.5 交易日历
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'trade_calendar'
    classification: 'TRADE_CALENDAR'
    description: '交易日历表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'trade_date'
        type: 'DATE'
        nullable: false
        unique: true
      - name: 'is_open'
        type: 'BOOLEAN'
        nullable: false
      - name: 'exchange'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'day_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
        comment: 'TRADING/WEEKEND/HOLIDAY'
      - name: 'holiday_name'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'prev_trade_date'
        type: 'DATE'
        nullable: true
      - name: 'next_trade_date'
        type: 'DATE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_trade_date'
        type: 'INDEX'
        columns: ['trade_date DESC']
      - name: 'idx_is_open_exchange'
        type: 'INDEX'
        columns: ['is_open', 'exchange']

  # 2.6 财务指标
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'fundamental_metrics'
    classification: 'FUNDAMENTAL_METRICS'
    description: '财务指标表(营收/净利润/ROE等)'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'report_period'
        type: 'DATE'
        nullable: false
      - name: 'report_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
        comment: 'Q1/Q2/Q3/ANNUAL'
      - name: 'revenue'
        type: 'DOUBLE'
        nullable: true
      - name: 'net_profit'
        type: 'DOUBLE'
        nullable: true
      - name: 'eps'
        type: 'DOUBLE'
        nullable: true
      - name: 'roe'
        type: 'DOUBLE'
        nullable: true
      - name: 'roa'
        type: 'DOUBLE'
        nullable: true
      - name: 'gross_margin'
        type: 'DOUBLE'
        nullable: true
      - name: 'net_margin'
        type: 'DOUBLE'
        nullable: true
      - name: 'debt_ratio'
        type: 'DOUBLE'
        nullable: true
      - name: 'current_ratio'
        type: 'DOUBLE'
        nullable: true
      - name: 'quick_ratio'
        type: 'DOUBLE'
        nullable: true
      - name: 'total_assets'
        type: 'DOUBLE'
        nullable: true
      - name: 'total_liabilities'
        type: 'DOUBLE'
        nullable: true
      - name: 'shareholders_equity'
        type: 'DOUBLE'
        nullable: true
      - name: 'operating_cash_flow'
        type: 'DOUBLE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_symbol_period'
        type: 'INDEX'
        columns: ['symbol', 'report_period DESC']
      - name: 'idx_report_period'
        type: 'INDEX'
        columns: ['report_period DESC']

  # 2.7 分红送配
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'dividend_data'
    classification: 'DIVIDEND_DATA'
    description: '分红送配表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'announcement_date'
        type: 'DATE'
        nullable: false
      - name: 'ex_dividend_date'
        type: 'DATE'
        nullable: false
      - name: 'record_date'
        type: 'DATE'
        nullable: true
      - name: 'payment_date'
        type: 'DATE'
        nullable: true
      - name: 'dividend_ratio'
        type: 'DOUBLE'
        nullable: true
        comment: '每股派息(元)'
      - name: 'bonus_share_ratio'
        type: 'DOUBLE'
        nullable: true
        comment: '每股送股(股)'
      - name: 'transfer_ratio'
        type: 'DOUBLE'
        nullable: true
        comment: '每股转增(股)'
      - name: 'total_dividend_amount'
        type: 'DOUBLE'
        nullable: true
      - name: 'payout_ratio'
        type: 'DOUBLE'
        nullable: true
      - name: 'dividend_yield'
        type: 'DOUBLE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_symbol_ex_date'
        type: 'INDEX'
        columns: ['symbol', 'ex_dividend_date DESC']

  # 2.8 股东数据
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'shareholder_data'
    classification: 'SHAREHOLDER_DATA'
    description: '股东数据表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'report_period'
        type: 'DATE'
        nullable: false
      - name: 'holder_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'holder_type'
        type: 'VARCHAR'
        length: 32
        nullable: false
        comment: 'FUND/QFII/INSURANCE/CORP/INDIVIDUAL'
      - name: 'holder_rank'
        type: 'INT'
        nullable: true
      - name: 'shareholding'
        type: 'BIGINT'
        nullable: true
      - name: 'shareholding_pct'
        type: 'DOUBLE'
        nullable: true
      - name: 'change_shares'
        type: 'BIGINT'
        nullable: true
      - name: 'change_pct'
        type: 'DOUBLE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_symbol_period'
        type: 'INDEX'
        columns: ['symbol', 'report_period DESC']
      - name: 'idx_holder_name'
        type: 'INDEX'
        columns: ['holder_name']

  # 2.9 市场规则
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'market_rules'
    classification: 'MARKET_RULES'
    description: '市场规则表(涨跌停幅度/最小价格变动等)'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: true
        comment: 'NULL表示全市场规则'
      - name: 'exchange'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'listing_board'
        type: 'VARCHAR'
        length: 16
        nullable: true
      - name: 'price_limit_up_pct'
        type: 'DOUBLE'
        nullable: false
      - name: 'price_limit_down_pct'
        type: 'DOUBLE'
        nullable: false
      - name: 'tick_size'
        type: 'DOUBLE'
        nullable: false
      - name: 'lot_size'
        type: 'INT'
        nullable: false
      - name: 'max_order_volume'
        type: 'BIGINT'
        nullable: true
      - name: 'trading_hours'
        type: 'VARCHAR'
        length: 128
        nullable: true
      - name: 'rule_effective_date'
        type: 'DATE'
        nullable: false
      - name: 'rule_expiry_date'
        type: 'DATE'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_symbol'
        type: 'INDEX'
        columns: ['symbol']
      - name: 'idx_exchange_board'
        type: 'INDEX'
        columns: ['exchange', 'listing_board']

# Continue in next message due to length...

  # =====================================
  # 第3类: 衍生数据 (Derived Data) - 6个实体 → PostgreSQL
  # =====================================

  # 3.1 技术指标
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'technical_indicators'
    classification: 'TECHNICAL_INDICATORS'
    description: '技术指标表(MACD/RSI/BOLL等)'
    is_timescale_hypertable: true
    time_column: 'calc_date'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['symbol', 'indicator_name']
      order_by: 'calc_date DESC'
    retention_days: 1825  # 5年
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'calc_date'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'indicator_name'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'indicator_value'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'indicator_params'
        type: 'JSONB'
        nullable: true
      - name: 'signal_line'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'histogram'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'upper_band'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'lower_band'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_tech_symbol_date'
        type: 'INDEX'
        columns: ['symbol', 'calc_date DESC']
      - name: 'idx_tech_indicator'
        type: 'INDEX'
        columns: ['indicator_name']

  # 3.2 量化因子
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'quant_factors'
    classification: 'QUANT_FACTORS'
    description: '量化因子表(动量/价值/质量)'
    is_timescale_hypertable: true
    time_column: 'factor_date'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['symbol', 'factor_category', 'factor_name']
      order_by: 'factor_date DESC'
    retention_days: 1825
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'factor_date'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'factor_category'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'factor_name'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'factor_value'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'factor_percentile'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'factor_z_score'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'sector_neutral_value'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'market_neutral_value'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'factor_params'
        type: 'JSONB'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_quant_symbol_date'
        type: 'INDEX'
        columns: ['symbol', 'factor_date DESC']
      - name: 'idx_quant_factor_name'
        type: 'INDEX'
        columns: ['factor_name', 'factor_date DESC']

  # 3.3 模型输出
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'model_output'
    classification: 'MODEL_OUTPUT'
    description: '模型输出表(价格预测/收益率预测)'
    is_timescale_hypertable: true
    time_column: 'prediction_time'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['model_id', 'symbol']
      order_by: 'prediction_time DESC'
    retention_days: 1825
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'model_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'model_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'model_version'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'prediction_time'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'prediction_horizon'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'prediction_value'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'confidence'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'prediction_type'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'feature_importance'
        type: 'JSONB'
        nullable: true
      - name: 'model_metadata'
        type: 'JSONB'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_model_symbol_time'
        type: 'INDEX'
        columns: ['symbol', 'prediction_time DESC']
      - name: 'idx_model_id'
        type: 'INDEX'
        columns: ['model_id', 'prediction_time DESC']

  # 3.4 交易信号
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'trade_signals'
    classification: 'TRADE_SIGNALS'
    description: '交易信号表(BUY/SELL/HOLD)'
    is_timescale_hypertable: true
    time_column: 'signal_time'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['strategy_id', 'symbol', 'signal_status']
      order_by: 'signal_time DESC'
    retention_days: 1825
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'signal_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'strategy_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'strategy_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'signal_time'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'signal_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'signal_strength'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'target_price'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'stop_loss_price'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'take_profit_price'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'position_size'
        type: 'INT'
        nullable: true
      - name: 'signal_reason'
        type: 'TEXT'
        nullable: true
      - name: 'signal_status'
        type: 'VARCHAR'
        length: 16
        nullable: false
        default: "'ACTIVE'"
      - name: 'executed_time'
        type: 'TIMESTAMPTZ'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_signal_symbol_time'
        type: 'INDEX'
        columns: ['symbol', 'signal_time DESC']
      - name: 'idx_signal_strategy'
        type: 'INDEX'
        columns: ['strategy_id', 'signal_time DESC']

  # 3.5 回测结果
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'backtest_results'
    classification: 'BACKTEST_RESULTS'
    description: '回测结果表'
    is_timescale_hypertable: true
    time_column: 'backtest_start_date'
    chunk_interval: '1 month'
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'backtest_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'strategy_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'strategy_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'backtest_start_date'
        type: 'DATE'
        nullable: false
      - name: 'backtest_end_date'
        type: 'DATE'
        nullable: false
      - name: 'initial_capital'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'final_capital'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'total_return'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'annualized_return'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'max_drawdown'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'sharpe_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'sortino_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'calmar_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'win_rate'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'profit_factor'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'total_trades'
        type: 'INT'
        nullable: false
      - name: 'winning_trades'
        type: 'INT'
        nullable: true
      - name: 'losing_trades'
        type: 'INT'
        nullable: true
      - name: 'avg_winning_trade'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'avg_losing_trade'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'return_curve'
        type: 'JSONB'
        nullable: true
      - name: 'drawdown_curve'
        type: 'JSONB'
        nullable: true
      - name: 'strategy_params'
        type: 'JSONB'
        nullable: true
      - name: 'backtest_metadata'
        type: 'JSONB'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_backtest_strategy'
        type: 'INDEX'
        columns: ['strategy_id', 'backtest_start_date DESC']

  # 3.6 风险指标
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'risk_metrics'
    classification: 'RISK_METRICS'
    description: '风险指标表(VaR/Beta/Alpha)'
    is_timescale_hypertable: true
    time_column: 'metric_date'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'portfolio_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'portfolio_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'metric_date'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'var_95'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'var_99'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'cvar_95'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'beta'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'alpha'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'volatility'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'tracking_error'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'information_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'industry_exposure'
        type: 'JSONB'
        nullable: true
      - name: 'factor_exposure'
        type: 'JSONB'
        nullable: true
      - name: 'concentration_risk'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'liquidity_risk'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_risk_portfolio_date'
        type: 'INDEX'
        columns: ['portfolio_id', 'metric_date DESC']

  # =====================================
  # 第4类: 交易数据 (Transaction Data) - 7个实体
  # =====================================

  # 4.1 订单历史
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'order_history'
    classification: 'ORDER_RECORDS'
    description: '历史订单记录'
    is_timescale_hypertable: true
    time_column: 'order_time'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['account_id', 'symbol', 'status']
      order_by: 'order_time DESC'
    retention_days: 1095  # 3年
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'order_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'account_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'order_time'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'order_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'direction'
        type: 'VARCHAR'
        length: 8
        nullable: false
      - name: 'price'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'quantity'
        type: 'BIGINT'
        nullable: false
      - name: 'filled_quantity'
        type: 'BIGINT'
        default: '0'
        nullable: false
      - name: 'cancelled_quantity'
        type: 'BIGINT'
        default: '0'
        nullable: false
      - name: 'status'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'commission'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'tax'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'avg_filled_price'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'reject_reason'
        type: 'TEXT'
        nullable: true
      - name: 'strategy_id'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'signal_id'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'updated_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_order_account_time'
        type: 'INDEX'
        columns: ['account_id', 'order_time DESC']
      - name: 'idx_order_symbol_time'
        type: 'INDEX'
        columns: ['symbol', 'order_time DESC']

  # 4.2 成交历史
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'trade_history'
    classification: 'TRADE_RECORDS'
    description: '历史成交记录'
    is_timescale_hypertable: true
    time_column: 'trade_time'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['account_id', 'symbol']
      order_by: 'trade_time DESC'
    retention_days: 1095
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'trade_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'order_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'account_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'trade_time'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'direction'
        type: 'VARCHAR'
        length: 8
        nullable: false
      - name: 'price'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'quantity'
        type: 'BIGINT'
        nullable: false
      - name: 'amount'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'commission'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'tax'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'net_amount'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'counter_party'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'exchange_trade_id'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_trade_account_time'
        type: 'INDEX'
        columns: ['account_id', 'trade_time DESC']
      - name: 'idx_trade_order'
        type: 'INDEX'
        columns: ['order_id']

  # 4.3 持仓历史快照
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'position_history'
    classification: 'POSITION_HISTORY'
    description: '持仓历史快照'
    is_timescale_hypertable: true
    time_column: 'snapshot_time'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['account_id', 'symbol']
      order_by: 'snapshot_time DESC'
    retention_days: 1095
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'snapshot_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'account_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'symbol'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'snapshot_time'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'quantity'
        type: 'BIGINT'
        nullable: false
      - name: 'available_quantity'
        type: 'BIGINT'
        nullable: false
      - name: 'frozen_quantity'
        type: 'BIGINT'
        default: '0'
        nullable: false
      - name: 'cost_price'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'current_price'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'market_value'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'profit_loss'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'profit_loss_pct'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'position_ratio'
        type: 'DOUBLE PRECISION'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_position_account_time'
        type: 'INDEX'
        columns: ['account_id', 'snapshot_time DESC']

  # 4.4 资金流水
  - database_type: 'PostgreSQL'
    database_name: 'mystocks'
    table_name: 'fund_flow'
    classification: 'FUND_FLOW'
    description: '资金流水记录'
    is_timescale_hypertable: true
    time_column: 'flow_time'
    chunk_interval: '1 day'
    compression:
      enabled: true
      after_days: 30
      segment_by: ['account_id', 'flow_type']
      order_by: 'flow_time DESC'
    retention_days: 1095
    columns:
      - name: 'id'
        type: 'BIGSERIAL'
        nullable: false
        primary_key: true
      - name: 'flow_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'account_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'flow_time'
        type: 'TIMESTAMPTZ'
        nullable: false
      - name: 'flow_type'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'amount'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'balance'
        type: 'DOUBLE PRECISION'
        nullable: false
      - name: 'related_order_id'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'related_trade_id'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'remark'
        type: 'TEXT'
        nullable: true
      - name: 'operator'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMPTZ'
        default: 'NOW()'
        nullable: false
    indexes:
      - name: 'idx_fund_account_time'
        type: 'INDEX'
        columns: ['account_id', 'flow_time DESC']

  # 4.5-4.7 Redis实时数据 (不需要在table_config中定义表结构)
  # REALTIME_POSITIONS, REALTIME_ACCOUNT, ORDER_QUEUE 使用Redis数据结构

  # =====================================
  # 第5类: 元数据 (Meta Data) - 6个实体 → MySQL
  # =====================================

  # 5.1 数据源状态
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'data_source_status'
    classification: 'DATA_SOURCE_STATUS'
    description: '数据源状态表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'source_name'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'source_type'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'health_status'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'last_update_time'
        type: 'TIMESTAMP'
        nullable: false
      - name: 'last_success_time'
        type: 'TIMESTAMP'
        nullable: true
      - name: 'last_error_time'
        type: 'TIMESTAMP'
        nullable: true
      - name: 'error_count'
        type: 'INT'
        default: '0'
        nullable: false
      - name: 'success_count'
        type: 'INT'
        default: '0'
        nullable: false
      - name: 'avg_response_time'
        type: 'DOUBLE'
        nullable: true
      - name: 'last_error_message'
        type: 'TEXT'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_health_status'
        type: 'INDEX'
        columns: ['health_status']

  # 5.2 任务调度
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'task_schedule'
    classification: 'TASK_SCHEDULE'
    description: '任务调度表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'task_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'task_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'task_type'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'schedule_expr'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'enabled'
        type: 'BOOLEAN'
        nullable: false
        default: 'TRUE'
      - name: 'last_run_time'
        type: 'TIMESTAMP'
        nullable: true
      - name: 'next_run_time'
        type: 'TIMESTAMP'
        nullable: true
      - name: 'last_run_status'
        type: 'VARCHAR'
        length: 16
        nullable: true
      - name: 'last_run_duration'
        type: 'INT'
        nullable: true
      - name: 'last_error_message'
        type: 'TEXT'
        nullable: true
      - name: 'consecutive_failures'
        type: 'INT'
        default: '0'
        nullable: false
      - name: 'task_params'
        type: 'JSON'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_enabled_next_run'
        type: 'INDEX'
        columns: ['enabled', 'next_run_time']

  # 5.3 策略参数
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'strategy_params'
    classification: 'STRATEGY_PARAMS'
    description: '策略参数表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'strategy_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'strategy_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'param_key'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'param_value'
        type: 'TEXT'
        nullable: false
      - name: 'param_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'param_description'
        type: 'TEXT'
        nullable: true
      - name: 'version'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'is_active'
        type: 'BOOLEAN'
        nullable: false
        default: 'TRUE'
      - name: 'created_by'
        type: 'VARCHAR'
        length: 64
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_strategy_version'
        type: 'INDEX'
        columns: ['strategy_id', 'version']

  # 5.4 系统配置
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'system_config'
    classification: 'SYSTEM_CONFIG'
    description: '系统配置表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'config_key'
        type: 'VARCHAR'
        length: 128
        nullable: false
        unique: true
      - name: 'config_value'
        type: 'TEXT'
        nullable: false
      - name: 'config_category'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'value_type'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'description'
        type: 'TEXT'
        nullable: true
      - name: 'is_sensitive'
        type: 'BOOLEAN'
        default: 'FALSE'
        nullable: false
      - name: 'is_readonly'
        type: 'BOOLEAN'
        default: 'FALSE'
        nullable: false
      - name: 'default_value'
        type: 'TEXT'
        nullable: true
      - name: 'validation_rule'
        type: 'TEXT'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_category'
        type: 'INDEX'
        columns: ['config_category']

  # 5.5 数据质量指标
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'data_quality_metrics'
    classification: 'DATA_QUALITY_METRICS'
    description: '数据质量指标表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'metric_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
        unique: true
      - name: 'data_classification'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'table_name'
        type: 'VARCHAR'
        length: 128
        nullable: false
      - name: 'check_time'
        type: 'TIMESTAMP'
        nullable: false
      - name: 'completeness_rate'
        type: 'DOUBLE'
        nullable: true
      - name: 'freshness_seconds'
        type: 'INT'
        nullable: true
      - name: 'accuracy_rate'
        type: 'DOUBLE'
        nullable: true
      - name: 'missing_records'
        type: 'INT'
        nullable: true
      - name: 'duplicate_records'
        type: 'INT'
        nullable: true
      - name: 'invalid_records'
        type: 'INT'
        nullable: true
      - name: 'total_records'
        type: 'BIGINT'
        nullable: true
      - name: 'check_result'
        type: 'VARCHAR'
        length: 16
        nullable: false
      - name: 'check_details'
        type: 'JSON'
        nullable: true
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_classification_time'
        type: 'INDEX'
        columns: ['data_classification', 'check_time DESC']

  # 5.6 用户配置
  - database_type: 'MySQL'
    database_name: 'mystocks_reference'
    table_name: 'user_config'
    classification: 'USER_CONFIG'
    description: '用户配置表'
    columns:
      - name: 'id'
        type: 'BIGINT UNSIGNED'
        nullable: false
        primary_key: true
        auto_increment: true
      - name: 'user_id'
        type: 'VARCHAR'
        length: 64
        nullable: false
      - name: 'config_type'
        type: 'VARCHAR'
        length: 32
        nullable: false
      - name: 'config_name'
        type: 'VARCHAR'
        length: 128
        nullable: true
      - name: 'config_data'
        type: 'JSON'
        nullable: false
      - name: 'is_default'
        type: 'BOOLEAN'
        default: 'FALSE'
        nullable: false
      - name: 'is_shared'
        type: 'BOOLEAN'
        default: 'FALSE'
        nullable: false
      - name: 'created_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP'
        nullable: false
      - name: 'updated_at'
        type: 'TIMESTAMP'
        default: 'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'
        nullable: false
    indexes:
      - name: 'idx_user_type'
        type: 'INDEX'
        columns: ['user_id', 'config_type']

# =====================================
# 系统维护任务配置
# =====================================
maintenance:
  auto_create_tables: true
  safe_mode: true  # 安全模式: 添加列自动,删除/修改需确认
  
  daily_tasks:
    - name: 'data_quality_check'
      time: '01:00'
      enabled: true
      description: '数据质量检查'
    - name: 'performance_monitoring'
      time: '02:00'
      enabled: true
      description: '性能监控'
    - name: 'backup_operations'
      time: '03:00'
      enabled: false
      description: '备份操作'
    - name: 'log_cleanup'
      time: '04:00'
      enabled: true
      description: '日志清理'
      
  weekly_tasks:
    - name: 'table_structure_validation'
      day: 'sunday'
      time: '05:00'
      enabled: true
      description: '表结构验证'
    - name: 'database_optimization'
      day: 'sunday'
      time: '06:00'
      enabled: false
      description: '数据库优化'
