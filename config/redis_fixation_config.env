# Redis热数据固化配置文件
# 解决Redis 5分钟过期数据的持久化问题

# ==================== 固化策略配置 ====================
# 固化策略: immediate=立即, scheduled=定时, before_expire=过期前, on_demand=按需
FIXATION_STRATEGY=before_expire

# 固化间隔（秒）- 建议设置为Redis过期时间的80%
FIXATION_INTERVAL_SECONDS=240

# Redis缓存过期时间（秒）
REDIS_EXPIRE_SECONDS=300

# ==================== 存储目标配置 ====================
# 备份到TDengine Tick数据（推荐）
BACKUP_TO_TICK_DATA=true

# 备份到PostgreSQL日线数据（可选）
BACKUP_TO_DAILY_KLINE=false

# 备份到文件系统（应急方案）
BACKUP_TO_FILE_SYSTEM=false

# ==================== 性能配置 ====================
# 最大重试次数
MAX_RETRY_ATTEMPTS=3

# 启用数据压缩
ENABLE_COMPRESSION=true

# 批处理大小
BATCH_SIZE=1000

# ==================== 维护配置 ====================
# 数据保留天数
RETENTION_DAYS=30

# 启用自动清理过期固化数据
ENABLE_AUTO_CLEANUP=true

# 固化日志级别
FIXATION_LOG_LEVEL=INFO

# ==================== 备用方案配置 ====================
# 文件系统备份目录（当数据库不可用时）
BACKUP_DIRECTORY=./backup/redis_fixation

# CSV导出格式
CSV_EXPORT_FORMAT=true

# JSON导出格式
JSON_EXPORT_FORMAT=false

# ==================== 监控配置 ====================
# 启用固化监控
ENABLE_FIXATION_MONITORING=true

# 固化失败告警阈值
FAILURE_ALERT_THRESHOLD=3

# 性能监控间隔（秒）
PERFORMANCE_MONITOR_INTERVAL=60

# ==================== 说明 ====================
# Redis热数据固化解决方案：
#
# 1. 问题：Redis中的实时数据5分钟后过期，导致历史数据丢失
#
# 2. 解决方案：
#    - 定时固化：在数据过期前自动备份到永久存储
#    - 多重备份：TDengine(时序) + PostgreSQL(分析) + 文件系统(应急)
#    - 强制更新：支持跳过缓存强制获取最新数据
#
# 3. 存储策略：
#    - TDengine: 适合高频Tick数据的时序分析
#    - PostgreSQL: 适合聚合后的日线数据分析
#    - 文件系统: 应急备份方案，确保数据不丢失
#
# 4. 使用命令：
#    python save_realtime_market_data.py --force-update    # 强制更新
#    python save_realtime_market_data.py --enable-fixation # 启用固化
