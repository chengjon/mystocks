# Apache 配置示例 - MyStocks 前端部署
# 文件位置: /etc/apache2/sites-available/mystocks.conf

<VirtualHost *:80>
    ServerName your-domain.com  # 替换为实际域名
    DocumentRoot /var/www/mystocks/dist  # Vue build 输出目录

    # SSL 配置 (推荐)
    # <VirtualHost *:443>
    #     SSLEngine on
    #     SSLCertificateFile /path/to/cert.pem
    #     SSLCertificateKeyFile /path/to/key.pem

    # SPA 路由回退 - History 模式核心配置
    <Directory "/var/www/mystocks/dist">
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # History 模式回退规则
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]

        # 安全头
        Header always set X-Frame-Options SAMEORIGIN
        Header always set X-XSS-Protection "1; mode=block"
        Header always set X-Content-Type-Options nosniff
        Header always set Referrer-Policy "no-referrer-when-downgrade"
    </Directory>

    # API 代理到后端 (如果需要)
    ProxyPass /api/ http://localhost:8000/
    ProxyPassReverse /api/ http://localhost:8000/

    # 静态文件缓存
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, immutable"
    </LocationMatch>

    # 日志
    ErrorLog /var/log/apache2/mystocks_error.log
    CustomLog /var/log/apache2/mystocks_access.log combined
</VirtualHost>