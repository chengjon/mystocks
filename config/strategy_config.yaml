version: '1.0'
metadata:
  project: 'MyStocks 量化交易系统 - 策略配置'
  created_by: 'QuantTradingIntegration'
  last_updated: '2025-10-18'
  description: '量化策略执行、回测、可视化配置文件'

# ===================================
# TDX 数据源配置
# ===================================
tdx:
  enabled: true
  data_path: '${TDX_DATA_PATH:/mnt/d/ProgramData/tdx_new/vipdoc}'
  markets:
    - sh   # 上海证券交易所
    - sz   # 深圳证券交易所
    - bj   # 北京证券交易所
    - cw   # 财务数据
    - ds   # 分红送股数据
    - ot   # 其他数据
  apply_adjustment: true     # 自动复权
  skip_weekends: true        # 跳过周末
  cache_ttl: 3600           # 缓存过期时间(秒)
  parallel_import: true     # 并行导入
  batch_size: 100           # 批量处理大小

# ===================================
# 策略执行配置
# ===================================
strategy:
  execution:
    parallel_workers: ${STRATEGY_PARALLEL_WORKERS:4}  # 并行进程数
    max_stocks_per_run: ${STRATEGY_MAX_STOCKS_PER_RUN:1000}  # 单次运行最大股票数
    timeout_seconds: 600    # 执行超时时间
    retry_on_failure: true  # 失败重试
    max_retries: 3         # 最大重试次数

  stock_filter:
    # 股票池过滤配置
    exclude_st: true        # 排除ST股票
    exclude_suspended: true # 排除停牌股票
    min_market_cap: 1e9    # 最小市值(元)
    min_volume: 1000000    # 最小成交量(股)
    max_price: 1000        # 最大价格(元)
    min_price: 1.0         # 最小价格(元)

  signal_storage:
    database: 'postgresql'  # 信号存储数据库
    table: 'strategy_signals'
    batch_insert: true      # 批量插入
    batch_size: 1000       # 批量大小
    auto_create_table: true # 自动创建表

# ===================================
# 技术指标配置
# ===================================
indicators:
  cache:
    enabled: true          # 启用缓存
    ttl: 3600             # 缓存过期时间(秒)
    max_memory_mb: 1024   # 最大内存占用(MB)

  calculation:
    vectorized: true      # 使用向量化计算
    min_warmup_periods: 30 # 最小预热周期

  talib:
    enabled: true
    version: '0.6.7'

  tdx_compatible:
    # TDX兼容函数
    functions:
      - MA      # 简单移动平均
      - SMA     # 平滑移动平均
      - EMA     # 指数移动平均
      - CROSS   # 交叉函数
      - HHV     # 最高值
      - LLV     # 最低值
      - REF     # 引用函数
      - BARSLAST # 上一次条件成立位置

# ===================================
# 回测配置
# ===================================
backtest:
  engine:
    type: 'vectorized'     # vectorized (自定义) 或 rqalpha
    parallel: true         # 并行回测

  default_params:
    initial_capital: ${BACKTEST_INITIAL_CAPITAL:100000}
    commission_rate: ${BACKTEST_COMMISSION_RATE:0.0003}  # 万3佣金
    slippage_rate: ${BACKTEST_SLIPPAGE_RATE:0.0001}      # 滑点
    min_commission: 5.0    # 最小佣金(元)
    stamp_tax_rate: 0.001  # 印花税(卖出时)

  position_management:
    max_position_size: 1.0  # 最大仓位(0-1)
    equal_weight: true      # 等权重分配
    rebalance_frequency: 'daily'  # 调仓频率

  risk_control:
    max_drawdown_threshold: 0.30  # 最大回撤阈值(30%)
    stop_loss_pct: 0.10          # 止损比例(10%)
    take_profit_pct: 0.20        # 止盈比例(20%)

  metrics:
    # 计算的性能指标
    calculate:
      - total_return        # 总收益率
      - annualized_return   # 年化收益率
      - sharpe_ratio        # 夏普比率
      - max_drawdown        # 最大回撤
      - win_rate           # 胜率
      - profit_factor      # 盈亏比
      - sortino_ratio      # 索提诺比率
      - calmar_ratio       # 卡尔玛比率

  benchmark:
    enabled: true
    index: '000300'        # 沪深300指数
    compare_metrics: true

# ===================================
# 可视化配置
# ===================================
visualization:
  charts:
    default_type: 'candle'  # candle, ohlc, line
    width: 1200             # 图表宽度(像素)
    height: 800             # 图表高度(像素)
    dpi: 150                # 分辨率

  kline:
    show_volume: true       # 显示成交量
    show_signals: true      # 显示买卖信号
    show_holding_periods: true  # 显示持仓期
    volume_ratio: 0.3       # 成交量子图高度比例

  signals:
    buy_marker: '^'         # 买入标记符号
    buy_color: 'red'        # 买入颜色
    buy_size: 100          # 买入标记大小
    sell_marker: 'v'        # 卖出标记符号
    sell_color: 'green'     # 卖出颜色
    sell_size: 100         # 卖出标记大小

  moving_averages:
    default_periods: [5, 20, 60]  # 默认均线周期
    colors:
      5: '#FF6B6B'
      20: '#4ECDC4'
      60: '#45B7D1'
    line_width: 1.5

  output:
    format: 'png'           # png, jpg, html
    save_path: './charts'   # 保存路径
    auto_create_dir: true   # 自动创建目录
    filename_template: '{symbol}_{start_date}_{end_date}.{format}'

# ===================================
# 数据质量监控
# ===================================
monitoring:
  data_quality:
    enabled: true
    checks:
      - missing_data        # 缺失数据检查
      - duplicate_records   # 重复记录检查
      - outlier_detection   # 异常值检测
      - data_freshness      # 数据新鲜度

  performance:
    enabled: true
    log_slow_queries: true
    slow_query_threshold: 5.0  # 慢查询阈值(秒)

  alerts:
    enabled: true
    channels:
      - log
      - email  # 需配置SMTP

# ===================================
# 日志配置
# ===================================
logging:
  level: 'INFO'             # DEBUG, INFO, WARNING, ERROR
  format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
  handlers:
    console:
      enabled: true
      level: 'INFO'
    file:
      enabled: true
      level: 'DEBUG'
      path: './logs/strategy.log'
      max_bytes: 10485760   # 10MB
      backup_count: 5

# ===================================
# 高级配置
# ===================================
advanced:
  multiprocessing:
    method: 'spawn'         # spawn, fork, forkserver
    daemon: false

  memory_management:
    gc_threshold: 0.8       # GC触发阈值(80%内存使用)
    max_cache_size_mb: 2048 # 最大缓存大小(MB)

  optimization:
    use_numba: false        # 使用Numba加速(需安装numba)
    use_cython: false       # 使用Cython加速(需编译)
    vectorize_operations: true  # 向量化操作
